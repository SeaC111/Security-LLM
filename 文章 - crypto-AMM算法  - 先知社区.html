<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<p>AMM算法（Adleman-Manders-Miller算法）可以追溯到1977年，当时Leonard Adleman、Eric Manders和G.L. Miller首次提出了这个求解二次剩余的方法。然而，原始的AMM算法主要关注于二次剩余问题，并且在尝试将其推广到一般的高次剩余问题时遇到了困难，因为推广过程中会产生新的障碍。</p>
<p>在AMM算法的基础上，后来的研究者们进行了进一步的探索和改进。例如，在2006年，Paulo S. L. M. Barreto和Benjamin Voloch提出了一个针对有限域F_q^m上的r次剩余求解问题的新算法（简称BV算法）。这个算法在特定条件下（如r整除q-1且(m,r)=1）具有较低的复杂度。</p>
<p>在AMM算法的历史中，值得注意的是它在密码学和数论领域的应用。由于AMM算法可以用于求解二次剩余问题，它在公钥密码学、数字签名等领域有着广泛的应用。例如，RSA公钥密码系统就依赖于求解大整数的模平方根问题，而AMM算法或其改进版本可以用于加速这一过程的计算。</p>
<p>总的来说，AMM算法（包括原始的Adleman-Manders-Miller算法及其后续改进版本）在密码学、数论和计算机科学等领域都有着重要的历史和应用。随着技术的不断发展，AMM算法及其相关技术将继续在这些领域中发挥重要作用。</p>
<p>在CTF比赛中，AMM主要是为了解决RSA解密中e与phi都不互素的问题，一般的方法是将m^gcd看作m然后求出m^gcd，再开根号得到m,但当e与p-1、q-1都不互素的时候，用上面的方法最后变成了将m^e看作m，也就是说e被约为了1，这显然是解不了的，所以有了AMM算法，他使我们能够在有限域内开根号（可以简单的理解为在模p的情况下开根号），我们通过分别在模p、q下开e次方分别得到模p、q下的m，再用中国剩余定理CRT求m，接下来简单介绍一下相关的算法原理。</p>
<h3 data-content="1" id="378493c91c2fb2edec3b6e941b5b40af"><strong>1、AMM开2次方(解决二次剩余问题)</strong></h3>
<p>AMM算法最初是为了解决二次剩余问题而设计的，其核心思想是通过迭代计算算术平均数和几何平均数来逼近一个特定的值。在二次方的情境下，这个值通常是一个数的平方根。所以我们先从最简单的开二次方来了解，然后通过二次方来推广到高次方。（补充一下，下面的p都默认为奇素数）</p>
<p>首先对于二次方式子我们有：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203353-0f48add8-1125-1.png"/></p>
<p>式子中p为素数，此时我们可以将p-1写成2^t*s的形式并且s为奇数。(就是将p-1里所有的2都提出来)</p>
<p>由欧拉准则（注意这里是准则不是定理，如果不知道可以去了解一下）：</p>
<p>对二次剩余x<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203724-8ce4f238-1125-1.png"/><br/>
对二次非剩余y：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203748-9b3fef9a-1125-1.png"/></p>
<h4 data-content="1" id="34a6930c72eb781c23caf161864773fb">1-1、当t=1时</h4>
<p>如果t=1，此时t-1=0，(p-1)/2=s，二次剩余：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203824-b0ca03c8-1125-1.png"/></p>
<p>两边同乘x，然后开根号得：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203844-bc635f7c-1125-1.png"/>现在将c代入可以得到：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203918-d0b94d9c-1125-1.png"/><br/>
又有:<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513203946-e158f8c8-1125-1.png"/><br/>
于是就能得到m。</p>
<p>上面的就是可以说就是AMM算法的精髓，大概步骤就是：</p>
<ol>
<li>将p-1变成2^t*s的形式。</li>
<li>在想办法将t消掉。</li>
<li>然后两边乘x再开根号</li>
</ol>
<p>后面开高次方也是同样的道理，比较麻烦的是消掉t。</p>
<p>举个栗子：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204015-f2e4b62c-1125-1.png"/><br/>
7为明文，11为密文</p>
<p>如果是二次非剩余则为-x(1/2)不能用来求出m，所以不会拿来用，你可能会疑惑没用为什么写，在后面会有它的用处。</p>
<h4 data-content="1" id="574f882a9114947bb1c49011196e78b8">1-2、当t&gt;=2时</h4>
<p>即p-1有两个以上的2时，这时想消掉t就要用点技巧了，我们的第一反应当然是开平方。<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204255-51f3d08a-1126-1.png"/><br/>
开方后会有两种结果，我们前面说了我们不需要负根（或者叫二次非剩余），所以我们给负根配上一个非二次剩余y（随便自己找一个）<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204315-5dc91b90-1126-1.png"/><br/>
这里的k是为了控制是否引入非二次剩余项，我们开出正时根k=0，开出负根时k=1，之后不断对x开根，一直到2的指数为0，一共t-1个k：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204402-7a1baaf6-1126-1.png"/><br/>
此时两边同时乘x再开根号得到：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204432-8c082618-1126-1.png"/><br/>
和t=1一样将c代入就能求出明文：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204453-9845296c-1126-1.png"/><br/>
开二次方的算法脚本如下：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">AMM2</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

    <span class="c1"># 计算t,s</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1">#当t=1时</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="c1">#生成非二次剩余时，回炉重造</span>
    <span class="n">noresidue</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="n">h</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="c1">#消掉t</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="n">e</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
        <span class="n">d</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">b</span><span class="o">=</span><span class="n">b</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="n">h</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="o">%</span><span class="n">p</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
</pre></div>
<h4 data-content="1" id="2b530c600d0e89338e1e2638d0d99eca">1-3、由AMM得到的一个解求另一个解</h4>
<p>我们在开平方的时候都知道一般都有两个解x和-x，所以在有限域中很简单的就用p-x就能得到另一个解，但是我们讲e=2的情况是为了引入e&gt;2时开高次方，所以还是讲一下原理</p>
<p>首先我们在前面已经得到了一个根记为m0,已知<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204825-16e756c8-1127-1.png"/><br/>
由费马小定理可以得到：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513204740-fc17f2c6-1126-1.png"/></p>
<p>于是得到了两不同的解res1=m0、res2=m0*X^((p-1)/2)%p(X为有限域里的数)。</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="c1">#随便取a然后计算另一个解，如果不为p那说明找到了另一个解</span>
    <span class="n">root</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">a</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>
</pre></div>
<p>完整代码：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">root</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">a</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>

<span class="k">def</span> <span class="nf">AMM2</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="n">noresidue</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">h</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="n">e</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
        <span class="n">d</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">b</span><span class="o">=</span><span class="n">b</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="n">h</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="o">%</span><span class="n">p</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
</pre></div>
<p>上面的是指数e为2的情况下AMM算法的算法原理，也是最初求有限域二次方根算法，我们通过最简单的情况来引入AMM算法，后面当e大于2时的情况也类似。</p>
<h3 data-content="1" id="d49cae2c46fdf62835b2241ed422ec60">2、AMM开高次方</h3>
<p>同样的，对于多次方式子我们有：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205423-ebf020ca-1127-1.png"/></p>
<p>这里先要可以分两组情况来考虑：</p>
<h4 data-content="1" id="62b7b9defaa3632cd06c2809dc782868">2-1、gcd(e,p-1)=1</h4>
<p>这种就是最简单的RSA，不过赘述。</p>
<h4 data-content="1" id="78d317bd7af2d602afa0654b7b996b78">2-2、e|p-1</h4>
<p>和上面一样，先令$p-1=e^t*s$，就是将2改为了e</p>
<p>再同样由费马小定理：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205227-a6e0192c-1127-1.png"/><br/>
我们从p-1中提一个e出来<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205245-b17d5bd8-1127-1.png"/><br/>
现在找一个最小的非负整数d，使s|ed-1，可以认为d就是模s下r的逆元，有ed-1=ks（k为常数）<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205257-b89932fc-1127-1.png"/><br/>
有ed-1=ks，就相当于两边同时k次方,所以模p后的结果仍然为1:<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205314-c2e37966-1127-1.png"/></p>
<p>就像上面一样，我们要考虑两种情况</p>
<h5 data-content="1" id="f72b1e388c3a2902ad110982edaf170b">2-2-1、当t=1时</h5>
<p>此时e^(t-1)=1，于是上式就等于<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205341-d30d44fc-1127-1.png"/><br/>
两边同时乘c，得到<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205353-da2e116c-1127-1.png"/><br/>
所以c^d为c在模p下的一个e次根，这里相当于上面乘x后再开根号一样。</p>
<h5 data-content="1" id="b2a968fb8981dc17ca1ecd02c1563a66">2-2-2、当t&gt;=2时</h5>
<p>同样像上面一样先想到开e次方，但注意取e次非剩余q时，因为不是2次方根，所以非剩余不是-1，而是：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210047-d0dd0216-1128-1.png"/><br/>
我们可以定义一个生成元为q的模p的循环群G<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210104-db12ba3c-1128-1.png"/><br/>
在该循环群G中,我们现在定义：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210115-e1c53062-1128-1.png"/><br/>
所以可以得到一个生成元为$K_1=q^{{p-1}\over e}$为的G的·子群K:</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210129-e9d78dd6-1128-1.png"/><br/>
在这个子群里，所有的元素都是由$K_1=q^{{p-1}\over e}$生成的，所以所有元素的e次方都为1，因为子群K里正好有e个元素，所以K是模1开r次方根的结果的集合。</p>
<p>对于群来说每个元素都存在逆元，而且由于$q^{p-1}\equiv 1(modp)$,所以对于子群里如何一个元素$q^{{p-1}\over e}$,都有：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205817-77dfb21c-1128-1.png"/><br/>
所以：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205842-86890304-1128-1.png"/><br/>
有了这两个条件，我们可以开始像解平方根那样解n次方根了：</p>
<p>首先<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205901-91b52b04-1128-1.png"/><br/>
上式在前面有写，忘了可以看看（2-2、r|p-1下面）</p>
<p>开e次方后余数为集合K中的一个数，设为$K_{e-j}$,即：(虽然上面是从余1进行e次方来的，但开了e次方会有很多解)：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205932-a41e67ba-1128-1.png"/><br/>
两边同乘逆元$K_j$，得：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205945-ac14b208-1128-1.png"/><br/>
即：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205535-16d655fc-1128-1.png"/><br/>
继续开方得到：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205627-35df0386-1128-1.png"/><br/>
然后再乘c在所有项提e次方：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205643-3fad46f2-1128-1.png"/><br/>
再开e次方得到：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513205705-4c8d5be6-1128-1.png"/><br/>
然后得到了解</p>
<p>脚本：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">AMM</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># 计算t,s</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="n">e</span>

    <span class="c1">#用求逆元计算d</span>
    <span class="n">d</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="c1">#当t=1时的情况</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="c1">#t&gt;=2的情况</span>
    <span class="c1">#计算一个e次非剩余</span>
    <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">noresidue</span> <span class="p">,</span> <span class="p">(</span> <span class="n">e</span> <span class="o">**</span> <span class="p">(</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span> <span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">residue</span> <span class="p">,</span> <span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">noresidue</span> <span class="p">,</span> <span class="n">s</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">h</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="n">d</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">b</span> <span class="p">,</span> <span class="n">e</span><span class="o">**</span> <span class="p">(</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="p">)</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="nb">pow</span> <span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">e</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="p">,</span> <span class="n">j</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">b</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">h</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">j</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">e</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span> <span class="n">residue</span> <span class="p">,</span> <span class="n">d</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>
</pre></div>
<h4 data-content="1" id="60662c11da5d90bbf54823dbc55fa337">2-3、由AMM得到的一个解求其他解</h4>
<p>对于：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210204-ff26e8a8-1128-1.png"/><br/>
当r|p-1，会有e个单位根（翻译一下，在模p下e个e次方根），当e不能整除p-1时，只有一个单位根，即1本身。</p>
<p>从一个根得到其他根的思路为：首先找到r个不同的单位根，然后让(AMM得到的根)*单位根%q。<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240513210220-08b32f30-1129-1.png"/></p>
<p>上面的x是随机的并且是在p以内的正整数，因此$x^{q-1\over e}$是r次单位根，只要找到r个不同的单位根就可以了。</p>
<p>完整代码：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>

<span class="k">def</span> <span class="nf">AMM</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># 计算t,s</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="n">e</span>

    <span class="n">d</span><span class="o">=</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">a</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">noresidue</span> <span class="p">,</span> <span class="p">(</span> <span class="n">e</span> <span class="o">**</span> <span class="p">(</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span> <span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">residue</span> <span class="p">,</span> <span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">noresidue</span> <span class="p">,</span> <span class="n">s</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="n">h</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="n">d</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">b</span> <span class="p">,</span> <span class="n">e</span><span class="o">**</span> <span class="p">(</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="p">)</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="nb">pow</span> <span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">e</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="p">,</span> <span class="n">j</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">b</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">h</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">j</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="n">e</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span> <span class="n">residue</span> <span class="p">,</span> <span class="n">d</span> <span class="p">,</span> <span class="n">p</span> <span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>

<span class="n">residue</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">131</span>
<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">e</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">mp</span> <span class="o">=</span> <span class="n">AMM</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"AMM得到的一个根为:"</span><span class="err">，</span><span class="n">mp</span><span class="p">)</span>
    <span class="n">root_list</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root_list</span><span class="p">)):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">root_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">p</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"第{}个根:{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"e不能整除(p-1),AMM不适用"</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="57a54995dfe6a6056978abc3015e5d2d">3、结合中国剩余定理求解</h3>
<p>将模p和模q下求得的所有解通过爆破的方式求出所有解，然后在筛选出要的</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>


<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>


<span class="k">def</span> <span class="nf">AMM</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># 计算t,s</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="n">e</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">noresidue</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">noresidue</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">%</span> <span class="n">p</span>

<span class="c1">#中国剩余定理脚本，m_list为余数，a_list为除数</span>
<span class="k">def</span> <span class="nf">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">M_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
        <span class="n">M_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="n">mi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">M_list</span>

<span class="k">def</span> <span class="nf">Get_resMi</span><span class="p">(</span><span class="n">M_list</span><span class="p">,</span> <span class="n">m_list</span><span class="p">):</span>
    <span class="n">resM_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_list</span><span class="p">)):</span>
        <span class="n">resM_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Get_ni</span><span class="p">(</span><span class="n">M_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m_list</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">resM_list</span>

<span class="k">def</span> <span class="nf">Get_ni</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">Get_ni</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span> <span class="o">*</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span>

<span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="n">m_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m_list</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">m_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m_list</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"不能直接利用中国剩余定理"</span><span class="p">)</span>
                <span class="k">return</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">*=</span> <span class="n">mi</span>
    <span class="n">Mi_list</span> <span class="o">=</span> <span class="n">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">Mi_inverse</span> <span class="o">=</span> <span class="n">Get_resMi</span><span class="p">(</span><span class="n">Mi_list</span><span class="p">,</span> <span class="n">m_list</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_list</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">Mi_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Mi_inverse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">%=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">x</span>
<span class="k">def</span> <span class="nf">RSA_dec</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="n">phi</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">gcd1</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">gcd1</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">m_gcd1</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">m_gcd1</span><span class="p">,</span> <span class="n">gcd1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span>
<span class="c1">#m=197</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">22487</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">131</span>
<span class="n">q</span><span class="o">=</span><span class="mi">181</span>
<span class="n">lp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">mp</span> <span class="o">=</span> <span class="n">AMM</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">root_list</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root_list</span><span class="p">)):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">root_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">lp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="n">lq</span><span class="o">=</span><span class="p">[]</span>
<span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">mq</span> <span class="o">=</span> <span class="n">AMM</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">root_list</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root_list</span><span class="p">)):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mq</span> <span class="o">*</span> <span class="n">root_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">q</span>
        <span class="n">lq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">clis</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">]</span>
<span class="n">ylis</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lp</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lq</span><span class="p">:</span>
        <span class="n">ylis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
        <span class="n">ylis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">j</span>
        <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">(</span><span class="n">ylis</span><span class="p">,</span><span class="n">clis</span><span class="p">))</span>
</pre></div>
<p>上面提到的中国剩余定理定理，就是通过一个数除以多个数得到多个余数，根据除数和余数得到原本的数，如果不懂的可以去了解一下。</p>
</div>
</div>