<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h2 data-content="1" id="3d4a29dfdeb1ebd31c68d3aaae82b0ea">简介</h2>
<p>项目地址   <a href="https://github.com/xtekky/gpt4free" target="_blank">https://github.com/xtekky/gpt4free</a><br/>
该项目能够让用户免费试用GPT，具体的实现是针对公网GPT存在的各种安全问题进行了认证的绕过<br/>
截止写这篇文章的时候 gpt4free使用的GPT3.5的接口有<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1702892484031-cc23f5e5-e7bd-4138-afb3-77664dc2715f.png#averageHue=%238cd064&amp;clientId=u80e6ca59-eb0b-4&amp;from=paste&amp;height=514&amp;id=pqjmj&amp;originHeight=771&amp;originWidth=761&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=105077&amp;status=done&amp;style=none&amp;taskId=u6d064d7d-3a36-4c22-b525-9bf875f4742&amp;title=&amp;width=507.3333333333333"/></p>
<p>另外还有一个很多用户自行搭建的GPT站点 对应的源码是 <a href="https://github.com/Chanzhaoyu/chatgpt-web" target="_blank">https://github.com/Chanzhaoyu/chatgpt-web</a></p>
<p>但是老版本存在未授权访问的问题，可以通过未授权直接使用，使用FOFA搜索<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1702892585883-d6b6112d-d9c6-483a-8b19-394636f44a67.png#averageHue=%230b1527&amp;clientId=u5a2e958e-9ace-4&amp;from=paste&amp;height=491&amp;id=mB9nh&amp;originHeight=736&amp;originWidth=1337&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=102103&amp;status=done&amp;style=none&amp;taskId=u549b8bb1-d876-4cce-a2ec-6486f1cc69f&amp;title=&amp;width=891.3333333333334"/><br/>
多尝试几个就可以找到可用的<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1702892655948-7fddede3-ff7b-45e5-b70e-6593fb2be648.png#averageHue=%23debe89&amp;clientId=u5a2e958e-9ace-4&amp;from=paste&amp;height=329&amp;id=fNYpM&amp;originHeight=493&amp;originWidth=1753&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=64591&amp;status=done&amp;style=none&amp;taskId=u30517cca-24b0-49e6-a5c2-c06117723ad&amp;title=&amp;width=1168.6666666666667"/><br/>
gpt4free使用的GPT4的接口有<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1702892807633-3e75136f-e76d-4677-87f4-24f1e9921dc4.png#averageHue=%23c9c280&amp;clientId=u5a2e958e-9ace-4&amp;from=paste&amp;height=247&amp;id=tqNqe&amp;originHeight=371&amp;originWidth=739&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=40326&amp;status=done&amp;style=none&amp;taskId=ub0eb661c-5b89-4bba-aa1d-8fe0db17d4a&amp;title=&amp;width=492.6666666666667"/></p>
<h2 data-content="1" id="37cd292690f7ca8488f4db1b9f66da7c">安装运行</h2>
<p>运行web版本的</p>
<blockquote>
<p>python .\g4f\gui\run.py</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704553567868-cfad4f44-82a0-441c-8c6e-0c70c5f4e190.png#averageHue=%23181817&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=314&amp;id=ue01bca5d&amp;originHeight=471&amp;originWidth=1742&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=83104&amp;status=done&amp;style=none&amp;taskId=u167b4bd4-93ed-412d-98be-50c6d572c26&amp;title=&amp;width=1161.3333333333333"/><br/>
默认的模型是3.5<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704553529134-bde34841-115f-409d-bb88-587dcd893989.png#averageHue=%23160e20&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=553&amp;id=u0a5cb969&amp;originHeight=830&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=221883&amp;status=done&amp;style=none&amp;taskId=uc3364746-52cf-4ec4-9266-4f54e875f10&amp;title=&amp;width=1280"/><br/>
切换到gpt4之后就不行了<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704554237868-26109578-5cb7-4276-808b-d098135fd8c8.png#averageHue=%23160e20&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=549&amp;id=u04f24c77&amp;originHeight=823&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=229834&amp;status=done&amp;style=none&amp;taskId=u4aef6ca8-450c-4550-9a1b-9bba3c6a087&amp;title=&amp;width=1280"/></p>
<p>也可以使用python包的方式</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">g4f</span>

<span class="n">g4f</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Enable debug logging</span>
<span class="n">g4f</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">check_version</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Disable automatic version checking</span>
<span class="c1"># print(g4f.Provider.Bing.params)  # Print supported args for Bing</span>

<span class="c1"># Using automatic a provider for the given model</span>
<span class="c1">## Streamed completion</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">g4f</span><span class="o">.</span><span class="n">ChatCompletion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">"gpt-3.5-turbo"</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"昨天的当天是明天的什么"</span><span class="p">}],</span>
    <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</pre></div>
<p>输出答案为（实际测试的时候这部分输出等待的时间挺长的）<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1703507397276-3b11795f-92c3-41ca-84ee-13ea3cf0dd12.png#averageHue=%232e2e2d&amp;clientId=u2290c72c-00e3-4&amp;from=paste&amp;height=143&amp;id=rt7MY&amp;originHeight=143&amp;originWidth=563&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9121&amp;status=done&amp;style=none&amp;taskId=u30e6ec89-1fac-4b55-b05f-fadf1c5653c&amp;title=&amp;width=563"/><br/>
如果使用GPT4的API</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">g4f</span>

<span class="n">g4f</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># Enable debug logging</span>
<span class="n">g4f</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">check_version</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Disable automatic version checking</span>

<span class="c1">## Normal response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">g4f</span><span class="o">.</span><span class="n">ChatCompletion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">g4f</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">gpt_4</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"昨天的当天是明天的什么"</span><span class="p">}],</span>
<span class="p">)</span>  <span class="c1"># Alternative model setting</span>

<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
<p>在国内IP的情况下 运行结果如下<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1703508056531-eefd6a4b-c90a-4452-8e1d-c9318a52cfd9.png#averageHue=%23302c2c&amp;clientId=u2290c72c-00e3-4&amp;from=paste&amp;height=427&amp;id=Y8VUs&amp;originHeight=427&amp;originWidth=1050&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=86679&amp;status=done&amp;style=none&amp;taskId=u4499538c-5125-4bc6-8e97-84fcb94cd8e&amp;title=&amp;width=1050"/></p>
<h2 data-content="1" id="cb52a17d2b9a7bdb9392072e458fbfb6">运行流程</h2>
<p>从web入口run.py跟进查看</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_gui_args</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">host</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>
    <span class="n">run_gui</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</pre></div>
<p>web后端是使用的flask框架，对话的API接口是 /backend-api/v2/conversation<br/>
前端收到了用户的输入之后传递给对应接口<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704556068391-8a68af77-d345-4078-8573-5c162a0968c2.png#averageHue=%232f2c2b&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=407&amp;id=u67b69821&amp;originHeight=611&amp;originWidth=1148&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=86834&amp;status=done&amp;style=none&amp;taskId=ucea0f3ce-8cae-4264-8aa0-51df7472bd0&amp;title=&amp;width=765.3333333333334"/><br/>
后台python解析参数并且传递给选择的模型，最后返回结果</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">......</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">][</span><span class="s1">'content'</span><span class="p">][</span><span class="s1">'parts'</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="k">if</span> <span class="n">model</span> <span class="k">else</span> <span class="n">g4f</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">default</span>
    <span class="o">......</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">g4f</span><span class="o">.</span><span class="n">ChatCompletion</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">ignore_stream_and_auth</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">):</span>
        <span class="k">yield</span> <span class="o">......</span>
</pre></div>
<p>默认的模型跟进查看</p>
<div class="highlight"><pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
    <span class="n">name</span>          <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
    <span class="n">base_provider</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
    <span class="n">best_provider</span> <span class="o">=</span> <span class="n">RetryProvider</span><span class="p">([</span>
        <span class="n">Bing</span><span class="p">,</span>
        <span class="n">ChatgptAi</span><span class="p">,</span> <span class="n">GptGo</span><span class="p">,</span> <span class="n">GeekGpt</span><span class="p">,</span>
        <span class="n">You</span><span class="p">,</span>
        <span class="n">Chatgpt4Online</span>
    <span class="p">])</span>
<span class="p">)</span>
</pre></div>
<p>这也是相对来说比较稳定的，我们就从这些模型里面学习是如何《偷走》GPT资源的</p>
<h2 data-content="1" id="4e6ede6ed743a705778d6ef0d1c4ea80">机制绕过</h2>
<p>在Provider文件夹下面可以看到所有的模型，下面的部分网址需要使用魔法</p>
<h3 data-content="1" id="3b96090a0675419717e26a391ef80490">Bing</h3>
<p>使用谷歌浏览器访问 <a href="https://bing.com/chat" target="_blank">https://bing.com/chat</a> ， 进入聊天界面<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704962528621-2ca2350e-e540-4a27-8f53-fa5ae2a664da.png#averageHue=%23e2e9f7&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=414&amp;id=uf20000fc&amp;originHeight=621&amp;originWidth=1800&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=321418&amp;status=done&amp;style=none&amp;taskId=u123b7f87-2290-47cf-aed9-33b9cfe1957&amp;title=&amp;width=1200"/><br/>
测试之后可以发现最后返回的数据接口是  wss://sydney.bing.com/sydney/ChatHub<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704964027637-a0ae7666-58da-49a8-85eb-dc6538ed97a3.png#averageHue=%2383ba5d&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=213&amp;id=u97cc00da&amp;originHeight=320&amp;originWidth=1902&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=69622&amp;status=done&amp;style=none&amp;taskId=u12e8faf6-4dac-4fcb-95f2-299125e7c05&amp;title=&amp;width=1268"/><br/>
需要带上一个 sec_access_token<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704964101367-1dd85ee4-3ec2-4832-acbd-f3cb3476cca9.png#averageHue=%23ededef&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=217&amp;id=uc44ae5df&amp;originHeight=326&amp;originWidth=1267&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=62887&amp;status=done&amp;style=none&amp;taskId=u57decba7-96f6-4bbe-ac29-847b8a6532e&amp;title=&amp;width=844.6666666666666"/><br/>
而sec_access_token又在访问/turing/conversation/create?bundleVersion=时会返回在响应头里面作为X-Sydney-Encryptedconversationsignature<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704964428920-9b558f0d-d249-48d1-bb6f-f00f5e12f181.png#averageHue=%23eb9f78&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=215&amp;id=u3ba1274f&amp;originHeight=323&amp;originWidth=1903&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=103834&amp;status=done&amp;style=none&amp;taskId=uf64af1a6-9a81-4b4d-8e35-c71df4c520f&amp;title=&amp;width=1268.6666666666667"/><br/>
但是好像没有提到我们怎么把prompt传过去的，因为这个是websocket建立链接后进行的，直接在F12里面看不到<br/>
使用burpsuite查看websockets history，这个是我们发过去的数据<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704965622608-d1ea1ad9-7ab6-41fd-a672-dc868390af1a.png#averageHue=%23b3b497&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=647&amp;id=ub8fa04c4&amp;originHeight=971&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=199228&amp;status=done&amp;style=none&amp;taskId=u082dca66-b542-4973-89e0-51a82e2192b&amp;title=&amp;width=1280"/><br/>
回复的响应为<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704965751192-1b55082d-6270-4e3f-ba28-122253d52515.png#averageHue=%2391a695&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=501&amp;id=u23b630e5&amp;originHeight=752&amp;originWidth=1876&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=153586&amp;status=done&amp;style=none&amp;taskId=ua15b2d96-b9c5-4c18-9b5f-b975126d64d&amp;title=&amp;width=1250.6666666666667"/><br/>
可以看到是一致的<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704965776918-c3969b64-6a42-4049-ad62-404ded989b56.png#averageHue=%23e2eaf7&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=452&amp;id=u9bdc5a4a&amp;originHeight=678&amp;originWidth=1904&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=104310&amp;status=done&amp;style=none&amp;taskId=u697a44d5-52ef-44eb-b4d3-560805ac7f7&amp;title=&amp;width=1269.3333333333333"/><br/>
所以整体步骤就是先获取sec_access_token，再组装websocket内容发送出去</p>
<h4 data-content="1" id="6641aeb0698eafd93935118e8bd1b5a6">获取sec_access_token和其他参数</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://bing.com/chat"</span>
    <span class="n">url1</span> <span class="o">=</span> <span class="s1">'https://www.bing.com/turing/conversation/create?bundleVersion=1.1467.3'</span>

    <span class="n">working</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">supports_message_history</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">supports_gpt_4</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="s2">"hi"</span>
    <span class="n">context</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">f</span><span class="s2">"13.{random.randint(104, 107)}.{random.randint(0, 255)}.{random.randint(0, 255)}"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'accept'</span><span class="p">:</span> <span class="s1">'*/*'</span><span class="p">,</span>
        <span class="s1">'accept-language'</span><span class="p">:</span> <span class="s1">'en-US,en;q=0.9'</span><span class="p">,</span>
        <span class="s1">'cache-control'</span><span class="p">:</span> <span class="s1">'max-age=0'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua'</span><span class="p">:</span> <span class="s1">'"Chromium";v="110", "Not A(Brand";v="24", "Microsoft Edge";v="110"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-arch'</span><span class="p">:</span> <span class="s1">'"x86"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-bitness'</span><span class="p">:</span> <span class="s1">'"64"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-full-version'</span><span class="p">:</span> <span class="s1">'"110.0.1587.69"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-full-version-list'</span><span class="p">:</span> <span class="s1">'"Chromium";v="110.0.5481.192", "Not A(Brand";v="24.0.0.0", "Microsoft Edge";v="110.0.1587.69"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-mobile'</span><span class="p">:</span> <span class="s1">'?0'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-model'</span><span class="p">:</span> <span class="s1">'""'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-platform'</span><span class="p">:</span> <span class="s1">'"Windows"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-platform-version'</span><span class="p">:</span> <span class="s1">'"15.0.0"'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-dest'</span><span class="p">:</span> <span class="s1">'document'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-mode'</span><span class="p">:</span> <span class="s1">'navigate'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-site'</span><span class="p">:</span> <span class="s1">'none'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-user'</span><span class="p">:</span> <span class="s1">'?1'</span><span class="p">,</span>
        <span class="s1">'upgrade-insecure-requests'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'user-agent'</span><span class="p">:</span> <span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36 Edg/110.0.1587.69'</span><span class="p">,</span>
        <span class="s1">'x-edge-shopping-flag'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'x-forwarded-for'</span><span class="p">:</span> <span class="n">ip_address</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'SRCHD'</span><span class="p">:</span> <span class="s1">'AF=NOFORM'</span><span class="p">,</span>
        <span class="s1">'PPLState'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'KievRPSSecAuth'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
        <span class="s1">'SUID'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
        <span class="s1">'SRCHUSR'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
        <span class="s1">'SRCHHPGUSR'</span><span class="p">:</span> <span class="n">f</span><span class="s1">'HV={int(time.time())}'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">cookies</span> <span class="k">else</span> <span class="p">{</span><span class="o">**</span><span class="n">headers</span><span class="p">,</span> <span class="s2">"Cookie"</span><span class="p">:</span> <span class="s2">"; "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="s2">"{k}={v}"</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cookies</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">conversationId</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'conversationId'</span><span class="p">)</span>
    <span class="n">clientId</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'clientId'</span><span class="p">)</span>
    <span class="n">conversationSignature</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'X-Sydney-Encryptedconversationsignature'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"conversationId:{conversationId}</span><span class="se">\n</span><span class="s2">clientId:{clientId}</span><span class="se">\n</span><span class="s2">conversationSignature:{conversationSignature}"</span><span class="p">)</span>
</pre></div>
<p>可以得到<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704967687763-07140a4b-4c20-4b3d-b1b7-e1265be406c7.png#averageHue=%2331302f&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=164&amp;id=u53745056&amp;originHeight=246&amp;originWidth=1428&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=48342&amp;status=done&amp;style=none&amp;taskId=u05d1ad50-70eb-491b-aff9-e9b89faa615&amp;title=&amp;width=952"/></p>
<h4 data-content="1" id="3af9c13fa0f2b9b686762a92e16a7b7d">建立websocket连接</h4>
<p>源码中使用ClientSession建立websocket连接</p>
<div class="highlight"><pre><span></span><span class="n">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">(</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">900</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">Defaults</span><span class="o">.</span><span class="n">headers</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">cookies</span> <span class="k">else</span> <span class="p">{</span><span class="o">**</span><span class="n">Defaults</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="s2">"Cookie"</span><span class="p">:</span> <span class="s2">"; "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="s2">"{k}={v}"</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cookies</span><span class="o">.</span><span class="n">items</span><span class="p">())},</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">conversation</span> <span class="o">=</span> <span class="n">await</span> <span class="n">create_conversation</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tone</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">ws_connect</span><span class="p">(</span><span class="s1">'wss://sydney.bing.com/sydney/ChatHub'</span><span class="p">,</span> <span class="n">autoping</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">'sec_access_token'</span><span class="p">:</span> <span class="n">conversation</span><span class="o">.</span><span class="n">conversationSignature</span><span class="p">},</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">)</span> <span class="k">as</span> <span class="n">wss</span><span class="p">:</span>

            <span class="n">await</span> <span class="n">wss</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">format_message</span><span class="p">({</span><span class="s1">'protocol'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'version'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
            <span class="n">await</span> <span class="n">wss</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>
            <span class="n">await</span> <span class="n">wss</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">create_message</span><span class="p">(</span><span class="n">conversation</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">tone</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">web_search</span><span class="p">,</span> <span class="n">gpt4_turbo</span><span class="p">))</span>
        <span class="o">......</span>
</pre></div>
<p>create_message用来构建发送的数据，结构如下</p>
<div class="highlight"><pre><span></span><span class="n">struct</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'arguments'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">'source'</span><span class="p">:</span> <span class="s1">'cib'</span><span class="p">,</span>
            <span class="s1">'optionsSets'</span><span class="p">:</span> <span class="n">optionsSets</span><span class="p">,</span>
            <span class="s1">'allowedMessageTypes'</span><span class="p">:</span> <span class="n">allowedMessageTypes</span><span class="p">,</span>
            <span class="s1">'sliceIds'</span><span class="p">:</span> <span class="n">sliceIds</span><span class="p">,</span>
            <span class="s1">'traceId'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span>
            <span class="s1">'isStartOfSession'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s1">'requestId'</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
            <span class="s1">'message'</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span>
                <span class="s1">'author'</span><span class="p">:</span> <span class="s1">'user'</span><span class="p">,</span>
                <span class="s1">'inputMethod'</span><span class="p">:</span> <span class="s1">'Keyboard'</span><span class="p">,</span>
                <span class="s1">'text'</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
                <span class="s1">'messageType'</span><span class="p">:</span> <span class="s1">'Chat'</span><span class="p">,</span>
                <span class="s1">'requestId'</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
                <span class="s1">'messageId'</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
            <span class="p">}},</span>
            <span class="s2">"scenario"</span><span class="p">:</span> <span class="s2">"SERP"</span><span class="p">,</span>
            <span class="s1">'tone'</span><span class="p">:</span> <span class="n">tone</span><span class="p">,</span>
            <span class="s1">'spokenTextMode'</span><span class="p">:</span> <span class="s1">'None'</span><span class="p">,</span>
            <span class="s1">'conversationId'</span><span class="p">:</span> <span class="n">conversationId</span><span class="p">,</span>
            <span class="s1">'participant'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'id'</span><span class="p">:</span> <span class="n">clientId</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">'invocationId'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
    <span class="s1">'target'</span><span class="p">:</span> <span class="s1">'chat'</span><span class="p">,</span>
    <span class="s1">'type'</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">}</span>
</pre></div>
<h3 data-content="1" id="2d9100f22cc04e2705055048cc0136af">Chatgpt4Online</h3>
<p>先在网页上找到入口  <a href="https://chatgpt4online.org" target="_blank">https://chatgpt4online.org</a><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704954243938-050dfde1-c948-4c25-baee-c323edd20c19.png#averageHue=%2346c07b&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=551&amp;id=c9lGi&amp;originHeight=826&amp;originWidth=1899&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=639181&amp;status=done&amp;style=none&amp;taskId=ufb968324-6ded-4a97-aad1-9ef6227a394&amp;title=&amp;width=1266"/><br/>
在这个位置可以输入我们的问题 并且获得回复<br/>
具体的接口为 /wp-json/mwai-ui/v1/chats/submit<br/>
header为</p>
<blockquote>
<p>Content-Type:application/json<br/>
Referer:<a href="https://chatgpt4online.org/" target="_blank">https://chatgpt4online.org/</a><br/>
Sec-Ch-Ua:"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"<br/>
Sec-Ch-Ua-Mobile:?0<br/>
Sec-Ch-Ua-Platform:"Windows"<br/>
User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36<br/>
X-Wp-Nonce:03b66db665</p>
</blockquote>
<p>X-Wp-Nonce这个值是我们第一次访问该网页会给我们的一个值，这个值在跟GPT对话的时候需要带到header里面去</p>
<p>尝试使用requests库来进行获取</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://chatgpt4online.org"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"accept"</span><span class="p">:</span> <span class="s2">"*/*"</span><span class="p">,</span>
        <span class="s2">"accept-language"</span><span class="p">:</span> <span class="s2">"en-US"</span><span class="p">,</span>
        <span class="s2">"content-type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Not_A Brand</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">8</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Chromium</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">120</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Google Chrome</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">120</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-mobile"</span><span class="p">:</span> <span class="s2">"?0"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-platform"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Windows</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-dest"</span><span class="p">:</span> <span class="s2">"empty"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-mode"</span><span class="p">:</span> <span class="s2">"cors"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-site"</span><span class="p">:</span> <span class="s2">"same-origin"</span><span class="p">,</span>
        <span class="s2">"user-agent"</span><span class="p">:</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"</span><span class="p">,</span>
        <span class="s2">"referer"</span><span class="p">:</span> <span class="s2">"https://chatgpt4online.org/"</span><span class="p">,</span>
        <span class="s2">"referrer-policy"</span><span class="p">:</span> <span class="s2">"strict-origin-when-cross-origin"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s2">"{url}/"</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'restNonce&amp;quot;:&amp;quot;(.*?)&amp;quot;'</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">_wpnonce</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">_wpnonce</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">_wpnonce</span><span class="p">)</span>
</pre></div>
<p>可以获取到_wpnonce<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704955334809-0470441c-4745-4f02-b43d-0b0512558c6d.png#averageHue=%23302d2d&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=244&amp;id=KYKZk&amp;originHeight=366&amp;originWidth=1160&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=45678&amp;status=done&amp;style=none&amp;taskId=u69e43411-8610-48d8-b2f3-e0868eda1a6&amp;title=&amp;width=773.3333333333334"/><br/>
尝试问个问题</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://chatgpt4online.org"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"accept"</span><span class="p">:</span> <span class="s2">"*/*"</span><span class="p">,</span>
        <span class="s2">"accept-language"</span><span class="p">:</span> <span class="s2">"en-US"</span><span class="p">,</span>
        <span class="s2">"content-type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Not_A Brand</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">8</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Chromium</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">120</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Google Chrome</span><span class="se">\"</span><span class="s2">;v=</span><span class="se">\"</span><span class="s2">120</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-mobile"</span><span class="p">:</span> <span class="s2">"?0"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-platform"</span><span class="p">:</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Windows</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-dest"</span><span class="p">:</span> <span class="s2">"empty"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-mode"</span><span class="p">:</span> <span class="s2">"cors"</span><span class="p">,</span>
        <span class="s2">"sec-fetch-site"</span><span class="p">:</span> <span class="s2">"same-origin"</span><span class="p">,</span>
        <span class="s2">"user-agent"</span><span class="p">:</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"</span><span class="p">,</span>
        <span class="s2">"referer"</span><span class="p">:</span> <span class="s2">"https://chatgpt4online.org/"</span><span class="p">,</span>
        <span class="s2">"referrer-policy"</span><span class="p">:</span> <span class="s2">"strict-origin-when-cross-origin"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s2">"{url}/"</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'restNonce&amp;quot;:&amp;quot;(.*?)&amp;quot;'</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">_wpnonce</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">_wpnonce</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">_wpnonce</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"botId"</span><span class="p">:</span> <span class="s2">"default"</span><span class="p">,</span>
        <span class="s2">"customId"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s2">"session"</span><span class="p">:</span> <span class="s2">"N/A"</span><span class="p">,</span>
        <span class="s2">"chatId"</span><span class="p">:</span> <span class="n">get_random_string</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
        <span class="s2">"contextId"</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span>
        <span class="s2">"messages"</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"n1r8ruarf4c"</span><span class="p">,</span>
            <span class="s2">"role"</span><span class="p">:</span> <span class="s2">"assistant"</span><span class="p">,</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"Hi, How can I help you?"</span><span class="p">,</span>
            <span class="s2">"who"</span><span class="p">:</span> <span class="s2">"AI: "</span><span class="p">,</span>
            <span class="s2">"timestamp"</span><span class="p">:</span> <span class="mi">1704953575128</span>
        <span class="p">}],</span>
        <span class="s2">"newMessage"</span><span class="p">:</span> <span class="s1">'你是谁'</span><span class="p">,</span>
        <span class="s2">"newImageId"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s2">"stream"</span><span class="p">:</span> <span class="bp">True</span>
    <span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">"https://chatgpt4online.org/wp-json/mwai-ui/v1/chats/submit"</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"Content-Type"</span><span class="p">:</span><span class="s2">"application/json"</span><span class="p">,</span>
            <span class="s2">"Referer"</span><span class="p">:</span><span class="s2">"https://chatgpt4online.org/"</span><span class="p">,</span>
            <span class="s2">"Sec-Ch-Ua"</span><span class="p">:</span><span class="s1">'"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"'</span><span class="p">,</span>
            <span class="s2">"Sec-Ch-Ua-Mobile"</span><span class="p">:</span><span class="s2">"?0"</span><span class="p">,</span>
            <span class="s2">"Sec-Ch-Ua-Platform"</span><span class="p">:</span><span class="s2">"Windows"</span><span class="p">,</span>
            <span class="s2">"User-Agent"</span><span class="p">:</span><span class="s2">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"</span><span class="p">,</span>
            <span class="s2">"x-wp-nonce"</span><span class="p">:</span> <span class="n">_wpnonce</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p>看来没有问题<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704956518441-410a5931-8fb6-434e-b904-52027c110718.png#averageHue=%232f2e2d&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=240&amp;id=U8lYl&amp;originHeight=360&amp;originWidth=1777&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=55401&amp;status=done&amp;style=none&amp;taskId=u9d1615a1-5fa3-4b29-b85a-77d5fdbe7b6&amp;title=&amp;width=1184.6666666666667"/><br/>
但是在实际测试的过程中 有的时候会被Cloudflare人机验证拦截，所以这个接口也不稳定</p>
<h3 data-content="1" id="d93b31a1e7ab58c3b4b0beba1dde381e">ChatgptAi</h3>
<p>网址为 <a href="https://chatgpt.ai" target="_blank">https://chatgpt.ai</a><br/>
这里的实现方式跟Chatgpt4Online是类似的 ，就不再对ChatgptAi进行赘述了<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704960827364-5517d28a-cfcf-4357-8518-908789ff869d.png#averageHue=%23312c2b&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=316&amp;id=u4e7bc24a&amp;originHeight=474&amp;originWidth=1133&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=63806&amp;status=done&amp;style=none&amp;taskId=ubf83ac26-4d4d-493c-927e-40e560a3cf1&amp;title=&amp;width=755.3333333333334"/></p>
<h3 data-content="1" id="1768ff7f1f93948beeb83758dc084f3c">GptGo</h3>
<p>查看gpt4free里面的代码 可以知道我们需要先获取到token，然后再带着token去查询答案<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704959902495-79201bba-8b1c-41e1-b8f5-bfb68d4e9d2f.png#averageHue=%23e0b37c&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=357&amp;id=u1a3eaf40&amp;originHeight=535&amp;originWidth=1901&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=85814&amp;status=done&amp;style=none&amp;taskId=u329c46cf-e319-4c65-95f7-6c04404c59c&amp;title=&amp;width=1267.3333333333333"/><br/>
token在这个里面<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704959790612-b7100803-9229-4806-bdf2-a9795e065f8c.png#averageHue=%23f2af8b&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=153&amp;id=u9c3b2348&amp;originHeight=229&amp;originWidth=1905&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=36678&amp;status=done&amp;style=none&amp;taskId=u5f4d0894-3214-413d-9c79-c189307bab1&amp;title=&amp;width=1270"/><br/>
获取token的python代码</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://gptgo.ai"</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">"hi"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"User-Agent"</span><span class="p">:</span> <span class="s2">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36"</span><span class="p">,</span>
        <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"*/*"</span><span class="p">,</span>
        <span class="s2">"Accept-language"</span><span class="p">:</span> <span class="s2">"en-US"</span><span class="p">,</span>
        <span class="s2">"Origin"</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s2">"Referer"</span><span class="p">:</span> <span class="n">f</span><span class="s2">"{url}/"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua"</span><span class="p">:</span> <span class="s1">'"Google Chrome";v="116", "Chromium";v="116", "Not?A_Brand";v="24"'</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-mobile"</span><span class="p">:</span> <span class="s2">"?0"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-platform"</span><span class="p">:</span> <span class="s1">'"Windows"'</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Dest"</span><span class="p">:</span> <span class="s2">"empty"</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Mode"</span><span class="p">:</span> <span class="s2">"cors"</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Site"</span><span class="p">:</span> <span class="s2">"same-origin"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"https://gptgo.ai/get_token.php"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"ask"</span><span class="p">:</span> <span class="n">message</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
    <span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
<p>拿到token之后 去访问 web.php 页面<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704960585067-bf3f50c7-7bcb-4093-bfa1-e1d646210b92.png#averageHue=%23d8dad8&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=173&amp;id=u9061a034&amp;originHeight=259&amp;originWidth=1904&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=71000&amp;status=done&amp;style=none&amp;taskId=u285b0dbd-4848-4e0c-8a05-7f542722498&amp;title=&amp;width=1269.3333333333333"/><br/>
就可以获取到结果<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704960613622-501681be-b076-4bbf-b770-69310ac4aa01.png#averageHue=%23d8dad8&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=175&amp;id=u319880aa&amp;originHeight=262&amp;originWidth=1896&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=75175&amp;status=done&amp;style=none&amp;taskId=u789200de-138e-4f58-b65f-d12ca69549a&amp;title=&amp;width=1264"/><br/>
所以同步的代码为</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://gptgo.ai"</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">"hi"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"User-Agent"</span><span class="p">:</span> <span class="s2">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36"</span><span class="p">,</span>
        <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"*/*"</span><span class="p">,</span>
        <span class="s2">"Accept-language"</span><span class="p">:</span> <span class="s2">"en-US"</span><span class="p">,</span>
        <span class="s2">"Origin"</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s2">"Referer"</span><span class="p">:</span> <span class="n">f</span><span class="s2">"{url}/"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua"</span><span class="p">:</span> <span class="s1">'"Google Chrome";v="116", "Chromium";v="116", "Not?A_Brand";v="24"'</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-mobile"</span><span class="p">:</span> <span class="s2">"?0"</span><span class="p">,</span>
        <span class="s2">"sec-ch-ua-platform"</span><span class="p">:</span> <span class="s1">'"Windows"'</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Dest"</span><span class="p">:</span> <span class="s2">"empty"</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Mode"</span><span class="p">:</span> <span class="s2">"cors"</span><span class="p">,</span>
        <span class="s2">"Sec-Fetch-Site"</span><span class="p">:</span> <span class="s2">"same-origin"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"https://gptgo.ai/get_token.php"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">"ask"</span><span class="p">:</span> <span class="n">message</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
    <span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"https://api.gptgo.ai/web.php"</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"array_chat"</span><span class="p">:</span> <span class="n">token</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p>输出结果<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704960672959-01178cf8-72a3-4063-baa4-1a24fefa9621.png#averageHue=%2331302f&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=349&amp;id=u9ab7f70d&amp;originHeight=524&amp;originWidth=1851&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=125219&amp;status=done&amp;style=none&amp;taskId=u7ab885a8-446a-45f6-9fb7-b67115ad552&amp;title=&amp;width=1234"/></p>
<h3 data-content="1" id="e96a34040549ae7cb9956ee5b6d0d124">GeekGpt</h3>
<p>这里的网址是 <a href="https://chat.geekgpt.org/" target="_blank">https://chat.geekgpt.org/</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1703508800248-e2a060e8-c2bc-4451-a772-5c87a02ee82e.png#averageHue=%23373742&amp;clientId=u2290c72c-00e3-4&amp;from=paste&amp;height=959&amp;id=Co4Vu&amp;originHeight=959&amp;originWidth=1917&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=60304&amp;status=done&amp;style=none&amp;taskId=u28213d57-ca9d-4952-bae6-3f63776b1ea&amp;title=&amp;width=1917"/><br/>
这里就是剩余的余额，也就是说每个用户都会有一定初始额度<br/>
<img src="https://cdn.nlark.com/yuque/0/2023/png/21398751/1703508838548-5928aab0-f65e-4078-bcf6-8aedf2c492e7.png#averageHue=%233c3c49&amp;clientId=u2290c72c-00e3-4&amp;from=paste&amp;height=453&amp;id=kOz2s&amp;originHeight=453&amp;originWidth=884&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=21924&amp;status=done&amp;style=none&amp;taskId=u1db1a2d0-6648-45f0-a889-ec2bfbae6cb&amp;title=&amp;width=884"/><br/>
根据源码找接口<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704957859877-1ba7cf00-dfe3-4c08-be98-98677d883c08.png#averageHue=%23dde0dd&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=167&amp;id=u5e510ada&amp;originHeight=251&amp;originWidth=1753&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=34873&amp;status=done&amp;style=none&amp;taskId=u77f2fc8a-2bfd-4947-b1e7-6d5159f6e17&amp;title=&amp;width=1168.6666666666667"/><br/>
带上payload来进行访问</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"You are ChatGPT, a large language model trained by OpenAI.</span><span class="se">\n</span><span class="s2">Carefully heed the user's instructions. </span><span class="se">\n</span><span class="s2">Respond using Markdown."</span><span class="p">,</span>
            <span class="s2">"role"</span><span class="p">:</span> <span class="s2">"system"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"who are you"</span><span class="p">,</span>
            <span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s2">"gpt-3.5-turbo"</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'messages'</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">'temperature'</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'presence_penalty'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">'top_p'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'frequency_penalty'</span><span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
        <span class="s1">'stream'</span><span class="p">:</span> <span class="bp">True</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s1">':'</span><span class="p">))</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'authority'</span><span class="p">:</span> <span class="s1">'Bearer pk-this-is-a-real-free-pool-token-for-everyone'</span><span class="p">,</span>
        <span class="c1"># 'authority': 'ai.fakeopen.com',</span>
        <span class="s1">'accept'</span><span class="p">:</span> <span class="s1">'*/*'</span><span class="p">,</span>
        <span class="s1">'accept-language'</span><span class="p">:</span> <span class="s1">'en,fr-FR;q=0.9,fr;q=0.8,es-ES;q=0.7,es;q=0.6,en-US;q=0.5,am;q=0.4,de;q=0.3'</span><span class="p">,</span>
        <span class="s1">'authorization'</span><span class="p">:</span> <span class="s1">'Bearer pk-this-is-a-real-free-pool-token-for-everyone'</span><span class="p">,</span>
        <span class="s1">'content-type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
        <span class="s1">'origin'</span><span class="p">:</span> <span class="s1">'https://chat.geekgpt.org'</span><span class="p">,</span>
        <span class="s1">'referer'</span><span class="p">:</span> <span class="s1">'https://chat.geekgpt.org/'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua'</span><span class="p">:</span> <span class="s1">'"Chromium";v="118", "Google Chrome";v="118", "Not=A?Brand";v="99"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-mobile'</span><span class="p">:</span> <span class="s1">'?0'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-platform'</span><span class="p">:</span> <span class="s1">'"macOS"'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-dest'</span><span class="p">:</span> <span class="s1">'empty'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-mode'</span><span class="p">:</span> <span class="s1">'cors'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-site'</span><span class="p">:</span> <span class="s1">'cross-site'</span><span class="p">,</span>
        <span class="s1">'user-agent'</span><span class="p">:</span> <span class="s1">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"https://ai.fakeopen.com/v1/chat/completions"</span><span class="p">,</span>
                             <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_lines</span><span class="p">():</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">'content'</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"data: "</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">json_data</span> <span class="o">==</span> <span class="s2">"[DONE]"</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)[</span><span class="s2">"choices"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">"delta"</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">f</span><span class="s1">'error | {e} :'</span><span class="p">,</span> <span class="n">json_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></div>
<p>实际测试的过程中发现authority是Bearer pk-this-is-a-real-free-pool-token-for-everyone<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704959355214-e90878fc-e54c-4b28-8de2-9fae999295be.png#averageHue=%23f5eeee&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=168&amp;id=ufc1958aa&amp;originHeight=252&amp;originWidth=1215&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=25665&amp;status=done&amp;style=none&amp;taskId=u01089ac5-32ee-435d-be17-820b8cb020f&amp;title=&amp;width=810"/><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704959406533-58050036-a829-4e5c-a66f-018daccef563.png#averageHue=%232c2c2b&amp;clientId=u564ef7ad-5412-4&amp;from=paste&amp;height=395&amp;id=u37dd95d5&amp;originHeight=592&amp;originWidth=739&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=16746&amp;status=done&amp;style=none&amp;taskId=u662879bf-e3d3-4307-99d5-4fd6e9e15a8&amp;title=&amp;width=492.6666666666667"/><br/>
不过使用 ai.fakeopen.com 也有返回结果，还挺奇怪的</p>
<h3 data-content="1" id="03b8b6047648583b52b3627f6ffac0d4">You</h3>
<p>网址是 <a "="" href="https://you.com" target="_blank">https://you.com</a>，谷歌F12打开查看网络流，观察可知接口是 <a href="https://you.com/api/streamingSearch" target="_blank">/api/streamingSearch</a><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704557824082-117d5b1c-a277-424e-87e5-6db7177cdce8.png#averageHue=%23e2b57f&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=362&amp;id=u5ee4bb2f&amp;originHeight=543&amp;originWidth=1910&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=110004&amp;status=done&amp;style=none&amp;taskId=ub852334e-997c-465c-a0ca-73a5c1a3f30&amp;title=&amp;width=1273.3333333333333"/><br/>
不过代码里面将部分冗余的参数进行了省略<br/>
手动在浏览器里面访问 <a href="https://you.com/api/streamingSearch?q=hi&amp;domain=youchat&amp;chat=" target="_blank">https://you.com/api/streamingSearch?q=hi&amp;domain=youchat&amp;chat=</a><br/>
可以看到后面返回的内容也就是GPT返回的答案<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704560051348-82dc9c51-a2fa-46cc-971d-1eafe49d6815.png#averageHue=%23fdfcf0&amp;clientId=u59b017dd-cbbc-4&amp;from=paste&amp;height=547&amp;id=ue044718d&amp;originHeight=821&amp;originWidth=916&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=86432&amp;status=done&amp;style=none&amp;taskId=ud63c4363-ea49-458f-88f0-d1a983f89f6&amp;title=&amp;width=610.6666666666666"/><br/>
然而如果把You的代码改为同步</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">fetch_chat_data</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://you.com"</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="s2">"hi"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"text/event-stream"</span><span class="p">,</span>
        <span class="s2">"Referer"</span><span class="p">:</span> <span class="n">f</span><span class="s2">"{url}/search?fromSearchBar=true&amp;tbm=youchat"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"q"</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span> <span class="s2">"domain"</span><span class="p">:</span> <span class="s2">"youchat"</span><span class="p">,</span> <span class="s2">"chat"</span><span class="p">:</span> <span class="s2">""</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">"{url}/api/streamingSearch"</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span> <span class="mi">120</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">fetch_chat_data</span><span class="p">()</span>
</pre></div>
<p>直接使用不太稳定，因为目标存在检测<br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704788815964-670f0f24-3555-46f5-85f9-a0a59d16639f.png#averageHue=%232d2b2b&amp;clientId=u7dc511ac-f8af-4&amp;from=paste&amp;height=244&amp;id=ub2d0186b&amp;originHeight=366&amp;originWidth=1461&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=24580&amp;status=done&amp;style=none&amp;taskId=u2f80bed8-c9c9-45e5-9eff-c18f34f3016&amp;title=&amp;width=974"/></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704788729484-78f10a1c-1e44-440a-99bc-bfb4c94609bf.png#averageHue=%23fcfcfc&amp;clientId=u7dc511ac-f8af-4&amp;from=paste&amp;height=471&amp;id=u42d19898&amp;originHeight=706&amp;originWidth=1116&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=39858&amp;status=done&amp;style=none&amp;taskId=u9d20f4f2-f1f9-4c99-b5c5-1325e9bd2fc&amp;title=&amp;width=744"/><br/>
为了规避特征检测，原代码里面使用了curl_cffi impersonate进行绕过</p>
<div class="highlight"><pre><span></span><span class="n">async</span> <span class="k">with</span> <span class="n">StreamSession</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="p">{</span><span class="s2">"https"</span><span class="p">:</span> <span class="n">proxy</span><span class="p">},</span> <span class="n">impersonate</span><span class="o">=</span><span class="s2">"chrome107"</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</pre></div>
<p>这里我们简单测试一下<br/>
使用浏览器访问  <a href="https://tls.browserleaks.com/json" target="_blank">https://tls.browserleaks.com/json</a><br/>
<img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704790013368-6d1c19eb-9df0-4485-8a89-7efbb86e998a.png#averageHue=%23fcfbfa&amp;clientId=u7dc511ac-f8af-4&amp;from=paste&amp;height=220&amp;id=uad1c7361&amp;originHeight=330&amp;originWidth=1697&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=68944&amp;status=done&amp;style=none&amp;taskId=u60d41c77-fd5d-4fe4-ab80-f888862fe82&amp;title=&amp;width=1131.3333333333333"/><br/>
可以看到akamai_hash akamai_text两个字段都是有值的<br/>
但是用下面的代码进行requests访问</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'accept'</span><span class="p">:</span> <span class="s1">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'</span><span class="p">,</span>
        <span class="s1">'accept-language'</span><span class="p">:</span> <span class="s1">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span><span class="p">,</span>
        <span class="s1">'cache-control'</span><span class="p">:</span> <span class="s1">'no-cache'</span><span class="p">,</span>
        <span class="s1">'dnt'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'pragma'</span><span class="p">:</span> <span class="s1">'no-cache'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua'</span><span class="p">:</span> <span class="s1">'"Chromium";v="118", "Microsoft Edge";v="118", "Not=A?Brand";v="99"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-mobile'</span><span class="p">:</span> <span class="s1">'?0'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-platform'</span><span class="p">:</span> <span class="s1">'"macOS"'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-dest'</span><span class="p">:</span> <span class="s1">'document'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-mode'</span><span class="p">:</span> <span class="s1">'navigate'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-site'</span><span class="p">:</span> <span class="s1">'same-origin'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-user'</span><span class="p">:</span> <span class="s1">'?1'</span><span class="p">,</span>
        <span class="s1">'upgrade-insecure-requests'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'user-agent'</span><span class="p">:</span> <span class="s1">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36 Edg/118.0.2088.46'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://tls.browserleaks.com/json'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">formatted_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">formatted_data</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704790101795-83191b8f-7569-4b65-851b-1941aa3f3187.png#averageHue=%232f2d2c&amp;clientId=u7dc511ac-f8af-4&amp;from=paste&amp;height=298&amp;id=u7d8e3911&amp;originHeight=447&amp;originWidth=1140&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=57101&amp;status=done&amp;style=none&amp;taskId=uecf9f454-4924-4b5b-99ce-f6b8672613e&amp;title=&amp;width=760"/><br/>
现在就为空了</p>
<blockquote>
<p>这里的akamai是一家提供内容传输网络（Content Delivery Network，CDN）和网络安全解决方案的公司<br/>
在签名防爬虫方面，Akamai 提供了一种称为 "EdgeScape Threat Intelligence" 的功能。这个功能可以根据客户端请求的特征生成一个加密签名（通常是一个短字符串），将该签名添加到请求中的 HTTP 头部或参数中。然后，目标网站可以使用 Akamai 提供的 SDK 或 API 验证并解析该签名，以确认请求是否来自合法的 Akamai 代理，而不是恶意机器人直接访问。</p>
</blockquote>
<p>针对You网站的反爬使用curl_cffi来生成对应浏览器版本的指纹信息，在一定程度上防止被检测到</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">curl_cffi</span> <span class="kn">import</span> <span class="n">requests</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'accept'</span><span class="p">:</span> <span class="s1">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'</span><span class="p">,</span>
        <span class="s1">'accept-language'</span><span class="p">:</span> <span class="s1">'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6'</span><span class="p">,</span>
        <span class="s1">'cache-control'</span><span class="p">:</span> <span class="s1">'no-cache'</span><span class="p">,</span>
        <span class="s1">'dnt'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'pragma'</span><span class="p">:</span> <span class="s1">'no-cache'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua'</span><span class="p">:</span> <span class="s1">'"Chromium";v="118", "Microsoft Edge";v="118", "Not=A?Brand";v="99"'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-mobile'</span><span class="p">:</span> <span class="s1">'?0'</span><span class="p">,</span>
        <span class="s1">'sec-ch-ua-platform'</span><span class="p">:</span> <span class="s1">'"macOS"'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-dest'</span><span class="p">:</span> <span class="s1">'document'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-mode'</span><span class="p">:</span> <span class="s1">'navigate'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-site'</span><span class="p">:</span> <span class="s1">'same-origin'</span><span class="p">,</span>
        <span class="s1">'sec-fetch-user'</span><span class="p">:</span> <span class="s1">'?1'</span><span class="p">,</span>
        <span class="s1">'upgrade-insecure-requests'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
        <span class="s1">'user-agent'</span><span class="p">:</span> <span class="s1">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36 Edg/118.0.2088.46'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://tls.browserleaks.com/json'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
                            <span class="p">,</span><span class="n">impersonate</span><span class="o">=</span><span class="s2">"chrome110"</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">formatted_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">formatted_data</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21398751/1704790395650-6110e515-a259-4df4-a7d1-4c3cf252a362.png#averageHue=%23302e2d&amp;clientId=u7dc511ac-f8af-4&amp;from=paste&amp;height=247&amp;id=u1ba2a4e4&amp;originHeight=370&amp;originWidth=1107&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=60841&amp;status=done&amp;style=none&amp;taskId=ua69e5df8-8b0f-48b3-b38e-9d64a666143&amp;title=&amp;width=738"/><br/>
现在就会自带浏览器的指纹信息了</p>
<h2 data-content="1" id="90102c962c779997349699c32b62cc38">参考链接</h2>
<ul>
<li><a href="https://github.com/xtekky/gpt4free" target="_blank">https://github.com/xtekky/gpt4free</a></li>
<li><a href="https://github.com/Cl0udG0d/Fofa-hack" target="_blank">https://github.com/Cl0udG0d/Fofa-hack</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2278728" target="_blank">https://cloud.tencent.com/developer/article/2278728</a></li>
<li><a href="https://blog.csdn.net/resphina/article/details/132507212" target="_blank">https://blog.csdn.net/resphina/article/details/132507212</a></li>
<li><a href="https://www.kingname.info/2023/10/17/curl-cffi/" target="_blank">https://www.kingname.info/2023/10/17/curl-cffi/</a></li>
<li><a href="https://linweiyuan.github.io/2023/03/14/%E4%B8%80%E7%A7%8D%E5%8F%96%E5%B7%A7%E7%9A%84%E6%96%B9%E5%BC%8F%E7%BB%95%E8%BF%87-Cloudflare-v2-%E9%AA%8C%E8%AF%81.html" target="_blank">https://linweiyuan.github.io/2023/03/14/%E4%B8%80%E7%A7%8D%E5%8F%96%E5%B7%A7%E7%9A%84%E6%96%B9%E5%BC%8F%E7%BB%95%E8%BF%87-Cloudflare-v2-%E9%AA%8C%E8%AF%81.html</a></li>
<li><a href="https://mp.weixin.qq.com/s/efloBirboVfH2hK3cNoU5A" target="_blank">https://mp.weixin.qq.com/s/efloBirboVfH2hK3cNoU5A</a></li>
</ul>
</div>
</div>