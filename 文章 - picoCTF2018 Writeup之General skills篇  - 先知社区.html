<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="418dcbe14483c8232c68a0e8c34451b5">前言</h1>
<p>接上篇，General-skills部分主要是一些linux命令的使用和小tricks。部分题目文件已打包为附件。</p>
<h1 data-content="1" id="ca462b7cbe64d22ba827ed4b2a280c12">General Warmup 1 2 3</h1>
<h2 data-content="1" id="218bb4b64759d2d5f1309ed7b5bd2f83">Question</h2>
<blockquote>
<p>If I told you your grade was 0x41 in hexadecimal, what would it be in ASCII?</p>
<p>Can you convert the number 27 (base 10) to binary (base 2)?</p>
<p>What is 0x3D (base 16) in decimal (base 10).</p>
</blockquote>
<h1 data-content="1" id="4cb728c245c3396528f25c9d23010c2f">Solution</h1>
<p>三题签到题，差不多一个意思，就放一起了。</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; chr<span class="o">(</span>0x41<span class="o">)</span>
<span class="s1">'A'</span>
&gt;&gt;&gt; bin<span class="o">(</span><span class="m">27</span><span class="o">)[</span><span class="m">2</span>:<span class="o">]</span>
<span class="s1">'11011'</span>
&gt;&gt;&gt; 0x3d
<span class="m">61</span>
</pre></div>
<p>flag:</p>
<ul>
<li><code>picoCTF{A}</code></li>
<li>
<code>picoCTF{11011}</code> </li>
<li><code>picoCTF{61}</code></li>
</ul>
<h1 data-content="1" id="e13aae23d691bc402c3e5125f298fdb7">Resources</h1>
<h2 data-content="1" id="aac876091a9fe261cbe8c7ce3dce38a8">Question</h2>
<blockquote>
<p>We put together a bunch of resources to help you out on our website! If you go over there, you might even find a flag! <a href="https://picoctf.com/resources" target="_blank">https://picoctf.com/resources</a> (<a href="https://picoctf.com/resources" target="_blank">link</a>)</p>
</blockquote>
<h3 data-content="1" id="009722839c1b51a4f92d199e0539c6b1">Hint</h3>
<p>No hints available</p>
<h2 data-content="1" id="2c88a3a62e060c5ff88ad7df604572df">Solution</h2>
<p>打开网页下拉，就能看到flag</p>
<div class="highlight"><pre><span></span>Thanks for reading the resources page! Here’s a flag for your time: picoCTF{xiexie_ni_lai_zheli}
</pre></div>
<p>flag:<code>picoCTF{xiexie_ni_lai_zheli}</code></p>
<h1 data-content="1" id="723e2e04f33943d21d100645c0eebf66">Grep 1</h1>
<h2 data-content="1" id="833c2537726cf4b55f90699d2eba64a8">Question</h2>
<blockquote>
<p>Can you find the flag in <a href="https://2018shell2.picoctf.com/static/7216e49d925b623c5d2cf9d141a6e180/file" target="_blank">file</a>? This would be really obnoxious to look through by hand, see if you can find a faster way. You can also find the file in /problems/grep-1_3_8d9cff3d178c231ab735dfef3267a1c2 on the shell server.</p>
</blockquote>
<h3 data-content="1" id="3dc26c14ccef9c8f2387cf0c4965306a">Hint</h3>
<blockquote>
<p>grep <a href="https://ryanstutorials.net/linuxtutorial/grep.php" target="_blank">tutorial</a></p>
</blockquote>
<h2 data-content="1" id="4e6bc8ed2af94c534222b426a3394323">Solution</h2>
<p><code>grep</code>，(global search regular expression(RE) and print out the line,全面搜索正则表达式并把行打印出来)是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。</p>
<p><code>cat file</code>会有一大堆乱码字符，使用<code>grep picoCTF file</code>可以把flag从乱码中提取出来。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/grep-1_2_ee2b29d2f2b29c65db957609a3543418$ grep picoCTF file              
picoCTF<span class="o">{</span>grep_and_you_will_find_42783683<span class="o">}</span>
</pre></div>
<h1 data-content="1" id="03a6893fcf86fae9713d9e420a27a13a">net cat</h1>
<h2 data-content="1" id="fa3c42918ae3cda2968d1e2eae155791">Question</h2>
<blockquote>
<p>Using netcat (nc) will be a necessity throughout your adventure. Can you connect to <code>2018shell1.picoctf.com</code> at port <code>49387</code> to get the flag?</p>
</blockquote>
<h3 data-content="1" id="2ca71d03d78626716738e31397c98cc7">Hint</h3>
<p>nc <a href="https://linux.die.net/man/1/nc" target="_blank">tutorial</a></p>
<h2 data-content="1" id="0ba51e3ef61771fc52939083b35beed5">Solution</h2>
<p><code>nc</code>是一个简单、可靠的网络工具，可通过TCP或UDP协议传输读写数据。</p>
<p>通过nc连接题目的服务器得到flag。</p>
<div class="highlight"><pre><span></span>❯ nc 2018shell2.picoctf.com <span class="m">36356</span>
That wasn<span class="err">'</span>t so hard was it?
picoCTF<span class="o">{</span>NEtcat_iS_a_NEcESSiTy_9454f3e0<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{NEtcat_iS_a_NEcESSiTy_9454f3e0}</code></p>
<h1 data-content="1" id="4073dc8c39fca77498af21bcca6dec66">pipe</h1>
<h2 data-content="1" id="fb3b6b4c88cdf1dacb687294f3dc36c1">Question</h2>
<blockquote>
<p>During your adventure, you will likely encounter a situation where you need to process data that you receive over the network rather than through a file. Can you find a way to save the output from this program and search for the flag? Connect with <code>2018shell1.picoctf.com 48696</code>.</p>
</blockquote>
<h3 data-content="1" id="436b88fa85a58e54197a9191d05dd4c2">Hint</h3>
<blockquote>
<p>Remember the flag format is picoCTF{XXXX}</p>
<p>Ever heard of a pipe? No not that kind of pipe... This <a href="http://www.linfo.org/pipes.html" target="_blank">kind</a></p>
</blockquote>
<h2 data-content="1" id="860afa47bd2f945facc36f074c0fd370">Solution</h2>
<p><strong>管道命令</strong>操作符是：<code>|</code>,它能处理经由前面一个指令传出的正确输出信息，也就是 standard output 的信息，然后作为标准的输入 standard input，传递给下一个命令。</p>
<p>连接服务器，配合<code>grep</code>得到flag。</p>
<div class="highlight"><pre><span></span>❯ nc 2018shell2.picoctf.com <span class="m">34532</span> <span class="p">|</span>grep picoCTF
picoCTF<span class="o">{</span>almost_like_mario_b797f2b3<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{almost_like_mario_b797f2b3}</code></p>
<h1 data-content="1" id="586b4656512881dce740beb20261569f">Strings</h1>
<h2 data-content="1" id="b7e24f5815f14e3b1eac8dbb30dcfc1c">Question</h2>
<blockquote>
<p>Can you find the flag in this <a href="https://2018shell2.picoctf.com/static/a3d311b507256d5d9299c0e94dfc4fc5/strings" target="_blank">file</a> without actually running it? You can also find the file in /problems/strings_2_b7404a3aee308619cb2ba79677989960 on the shell server.</p>
</blockquote>
<h3 data-content="1" id="14da602d03c919497a901b68b8454c6c">Hint</h3>
<blockquote>
<p><a href="https://linux.die.net/man/1/strings" target="_blank">strings</a></p>
</blockquote>
<h2 data-content="1" id="8d9566ada9187db9761499850090b5f6">Solution</h2>
<p><code>strings</code>命令可以打印文件中可打印的字符，使用<code>strings</code>命令配合<code>grep</code>命令可以把flag提取出来。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/strings_4_40d221755b4a0b134c2a7a2e825ef95f$ strings strings <span class="p">|</span>grep picoCTF    
picoCTF<span class="o">{</span>sTrIngS_sAVeS_Time_d3ffa29c<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{sTrIngS_sAVeS_Time_d3ffa29c}</code></p>
<h1 data-content="1" id="116a34314b8ffadf757295eec0f02b06">grep 2</h1>
<h2 data-content="1" id="80f6f1a710e680296da64bad50e91b7f">Question</h2>
<blockquote>
<p>This one is a little bit harder. Can you find the flag in /problems/grep-2_3_826f886f547acb8a9c3fccb030e8168d/files on the shell server? Remember, grep is your friend.</p>
</blockquote>
<h3 data-content="1" id="17530a9ad4e38fd68168e2cddfc7cab1">Hint</h3>
<blockquote>
<p>grep <a href="https://ryanstutorials.net/linuxtutorial/grep.php" target="_blank">tutorial</a></p>
</blockquote>
<h2 data-content="1" id="3aea4eb36e22badcd288a0cc87668a45">Solution</h2>
<p>目录下有许多个文件夹，每个文件夹下面又有文件夹和文件。可以使用<code>grep -r</code>选项来递归的搜寻文件。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/grep-2_3_826f886f547acb8a9c3fccb030e8168d/files$ grep -r picoCTF             
files2/file20:picoCTF<span class="o">{</span>grep_r_and_you_will_find_556620f7<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{grep_r_and_you_will_find_556620f7}</code></p>
<h1 data-content="1" id="b82c1ef1b689aba601e9d6e7832d19e0">Aca-Shell-A</h1>
<h2 data-content="1" id="07cd62223aef79adc884854a2561241a">Question</h2>
<blockquote>
<p>It's never a bad idea to brush up on those linux skills or even learn some new ones before you set off on this adventure! Connect with <code>nc 2018shell1.picoctf.com 27833</code>.</p>
</blockquote>
<h3 data-content="1" id="1f2d7225109a8c7bed2e072f7a09b0dc">Hint</h3>
<blockquote>
<p>Linux for <a href="https://maker.pro/education/basic-linux-commands-for-beginners" target="_blank">Beginners</a></p>
</blockquote>
<h2 data-content="1" id="5bb140b97de5ffa8c96623a175df4cc1">Solution</h2>
<p>这题用到了以下的基础linux命令：</p>
<ul>
<li><code>ls</code></li>
<li><code>cd</code></li>
<li><code>rm</code></li>
<li><code>whoami</code></li>
<li><code>cat</code></li>
<li>如何执行二进制可执行文件</li>
</ul>
<p>依照指示输入命令就可以了。</p>
<div class="highlight"><pre><span></span>$ nc 2018shell1.picoctf.com <span class="m">27833</span>
Sweet! We have gotten access into the system but we aren<span class="s1">'t root.</span>
<span class="s1">It'</span>s some sort of restricted shell! I can<span class="s1">'t see what you are typing</span>
<span class="s1">but I can see your output. I'</span>ll be here to <span class="nb">help</span> you along.
If you need help, <span class="nb">type</span> <span class="s2">"echo 'Help Me!'"</span> and I<span class="s1">'ll see what I can do</span>
<span class="s1">There is not much time left!</span>
<span class="s1">~/$ ls</span>
<span class="s1">blackmail</span>
<span class="s1">executables</span>
<span class="s1">passwords</span>
<span class="s1">photos</span>
<span class="s1">secret</span>
<span class="s1">~/$ cd secret</span>
<span class="s1">Now we are cookin'</span>! Take a look around there and tell me what you find!
~/secret$ ls
intel_1
intel_2
intel_3
intel_4
intel_5
profile_AipieG5Ua9aewei5ieSoh7aph
profile_Xei2uu5suwangohceedaifohs
profile_ahShaighaxahMooshuP1johgo
profile_ahqueith5aekongieP4ahzugi
profile_aik4hah9ilie9foru0Phoaph0
profile_bah9Ech9oa4xaicohphahfaiG
profile_ie7sheiP7su2At2ahw6iRikoe
profile_of0Nee4laith8odaeLachoonu
profile_poh9eij4Choophaweiwev6eev
profile_poo3ipohGohThi9Cohverai7e
Sabatoge them! Get rid of all their intel files!
~/secret$ rm intel*
Nice! Once they are all gone, I think I can drop you a file of an exploit!
Just <span class="nb">type</span> <span class="s2">"echo 'Drop it in!' "</span> and we can give it a whirl!
~/secret$ <span class="nb">echo</span> <span class="s1">'Drop it in!'</span>
Drop it in!
I placed a file in the executables folder as it looks like the only place we can execute from!
Run the script I wrote to have a little more impact on the system!
~/secret$ <span class="nb">cd</span> ..
~/$ <span class="nb">cd</span> executables
~/executables$ ls  
dontLookHere
~/executables$ ./dontLookHere
...
...
...
Looking through the text above, I think I have found the password. I am just having trouble with a username.
Oh drats! They are onto us! We could get kicked out soon!
Quick! Print the username to the screen so we can close are backdoor and log into the account directly!
You have to find another way other than echo!
~/executables$ whoami
l33th4x0r
Perfect! One second!
Okay, I think I have got what we are looking <span class="k">for</span>. I just need to to copy the file to a place we can read.
Try copying the file called TopSecret in tmp directory into the passwords folder.
~/executables$ cp /tmp/TopSecret passwords
Server shutdown in <span class="m">10</span> seconds...
Quick! go <span class="nb">read</span> the file before we lose our connection!
~/executables$ <span class="nb">cd</span> ..
~/$ ls
blackmail
executables
passwords
photos
secret
~/$ <span class="nb">cd</span> passwords
~/passwords$ ls
TopSecret
~/passwords$ cat TopSecret
Major General John M. Schofield<span class="err">'</span>s graduation address to the graduating class of <span class="m">1879</span> at West Point is as follows: The discipline which makes the soldiers of a free country reliable in battle is not to be gained by harsh or tyrannical treatment.On the contrary, such treatment is far more likely to destroy than to make an army.It is possible to impart instruction and give commands in such a manner and such a tone of voice as to inspire in the soldier no feeling butan intense desire to obey, <span class="k">while</span> the opposite manner and tone of voice cannot fail to excite strong resentment and a desire to disobey.The one mode or other of dealing with subordinates springs from a corresponding spirit in the breast of the commander.He who feels the respect which is due to others, cannot fail to inspire in them respect <span class="k">for</span> himself, <span class="k">while</span> he who feels,and hence manifests disrespect towards others, especially his subordinates, cannot fail to inspire hatred against himself.
picoCTF<span class="o">{</span>CrUsHeD_It_9edaa84a<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{CrUsHeD_It_9edaa84a}</code></p>
<h1 data-content="1" id="fc6f14e7cd0e7226c6cc1b4903a49a8e">environ</h1>
<h2 data-content="1" id="8be5ff655ee62d2d8007423d4a86b3c8">Question</h2>
<blockquote>
<p>Sometimes you have to configure environment variables before executing a program. Can you find the flag we've hidden in an environment variable on the shell server?</p>
</blockquote>
<h3 data-content="1" id="0f5344191507d4710d0a50dc9b44143e">Hint</h3>
<blockquote>
<p>unix <a href="https://www.tutorialspoint.com/unix/unix-environment.htm" target="_blank">env</a></p>
</blockquote>
<h2 data-content="1" id="3e71628e5d16181fc346ea6fe4c0a111">Solution</h2>
<p>考察linux系统环境变量，使用<code>env</code>命令可以列出系统中所有的环境变量，配合<code>grep</code>命令得到flag。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/grep-2_3_826f886f547acb8a9c3fccb030e8168d/files$ env<span class="p">|</span>grep pico               
<span class="nv">SECRET_FLAG</span><span class="o">=</span>picoCTF<span class="o">{</span>eNv1r0nM3nT_v4r14Bl3_fL4g_3758492<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{eNv1r0nM3nT_v4r14Bl3_fL4g_3758492}</code></p>
<h1 data-content="1" id="d675cf9de017fdb0366064abd9777a5a">ssh-keyz</h1>
<h2 data-content="1" id="3ed96026a4edb63e3a2d47127c6cbeee">Question</h2>
<blockquote>
<p>As nice as it is to use our webshell, sometimes its helpful to connect directly to our machine. To do so, please add your own public key to ~/.ssh/authorized_keys, using the webshell. The flag is in the ssh banner which will be displayed when you login remotely with ssh to with your username.</p>
</blockquote>
<h3 data-content="1" id="b48bec3a7b7edcff70e1a9b1e2f09ac9">Hint</h3>
<blockquote>
<p>key generation <a href="https://confluence.atlassian.com/bitbucketserver/creating-ssh-keys-776639788.html" target="_blank">tutorial</a></p>
<p>We also have an expert demonstrator to help you along. <a href="https://www.youtube.com/watch?v=3CN65ccfllU&amp;list=PLJ_vkrXdcgH-lYlRV8O-kef2zWvoy79yP&amp;index=4" target="_blank">link</a></p>
</blockquote>
<h2 data-content="1" id="4ea98288f231fbf89a32d62c8d2d5948">Solution</h2>
<p>公钥连接服务器相关，在shell服务器中使用<code>ssh-keygen -t rsa</code>生成自己的公私钥对，默认生成为<em>~/.ssh/id_rsa.pub</em>(公钥)和<em>~/.ssh/id_rsa</em>（私钥），将私钥下载到本地，然后用<code>ssh &lt;username&gt;@2018shell2.picoctf.com</code>连接服务器即可在欢迎信息的banner中看到flag。</p>
<p>这题也可以直接查看banner文件。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:~$ cat /etc/ssh/sshd_config <span class="p">|</span>grep banner                                               
Banner /opt/ssh_banner
finn@pico-2018-shell-2:~$ cat /opt/ssh_banner                                                                 
picoCTF<span class="o">{</span>who_n33ds_p4ssw0rds_38dj21<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{who_n33ds_p4ssw0rds_38dj21}</code></p>
<h1 data-content="1" id="80ebe41eaa932b67bbbac26ea6d3bd3e">what base is this?</h1>
<h2 data-content="1" id="83c6ef37b9695333be31b8b95a5c1164">Question</h2>
<blockquote>
<p>To be successful on your mission, you must be able read data represented in different ways, such as hexadecimal or binary. Can you get the flag from this program to prove you are ready? Connect with <code>nc 2018shell1.picoctf.com 1225</code>.</p>
</blockquote>
<h3 data-content="1" id="00f61e6bf27d19a41702bedca85c29fe">Hint</h3>
<blockquote>
<p>I hear python is a good means (among many) to convert things.</p>
<p>It might help to have multiple windows open</p>
</blockquote>
<h2 data-content="1" id="ee92599ef28dfbbfdede39007b521bb8">Solution</h2>
<p>三个不通的进制转换，分别是二进制、十六进制和八进制，转换为十进制，然后发送对应ascii码的单词，写个脚本处理一下就可以了。</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>


<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">'2018shell2.picoctf.com'</span><span class="p">,</span> <span class="mi">31711</span><span class="p">)</span>

<span class="n">binary</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">'as a word.'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(\d+)'</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
<span class="n">binary_word</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">binary</span><span class="p">])</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">binary_word</span><span class="p">)</span>

<span class="n">hexnum</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">'as a word.'</span><span class="p">)</span>
<span class="n">hexnum</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'([0-9a-f]+) as'</span><span class="p">,</span> <span class="n">hexnum</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">hexword</span> <span class="o">=</span> <span class="n">hexnum</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">hexword</span><span class="p">)</span>

<span class="n">octal</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">'as a word.'</span><span class="p">)</span>
<span class="n">octal</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'([0-9]+)'</span><span class="p">,</span> <span class="n">octal</span><span class="p">)</span>
<span class="n">octal_word</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">octal</span><span class="p">])</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">octal_word</span><span class="p">)</span>

<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">'}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span>$ python nc_convert.py
<span class="o">[</span>+<span class="o">]</span> Opening connection to 2018shell2.picoctf.com on port <span class="m">31711</span>: Done

Input:
You got it! You<span class="err">'</span>re super quick!
Flag: picoCTF<span class="o">{</span>delusions_about_finding_values_68051dea<span class="o">}</span>

<span class="o">[</span>*<span class="o">]</span> Closed connection to 2018shell2.picoctf.com port <span class="m">31711</span>
</pre></div>
<p>flag:<code>picoCTF{delusions_about_finding_values_68051dea}</code></p>
<h1 data-content="1" id="c414d333b0221acd946ee7fbbca488d3">you can't see me</h1>
<h2 data-content="1" id="fe5d4657ce6d166b8a46cfd90f5900f1">Question</h2>
<blockquote>
<p>'...reading transmission... Y.O.U. .C.A.N.'.T. .S.E.E. .M.E. ...transmission ended...' Maybe something lies in /problems/you-can-t-see-me_3_1a39ec6c80b3f3a18610074f68acfe69.</p>
</blockquote>
<h3 data-content="1" id="b0c28ff9f15309b8fc903047bd1f0f47">Hint</h3>
<blockquote>
<p>What command can see/read files?</p>
<p>What's in the manual page of ls?</p>
</blockquote>
<h2 data-content="1" id="34a2abf658cb7c89a83aacda4a70a844">Solution</h2>
<p><code>ls -a</code>可以查看以<code>.</code>开头的隐藏文件。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/you-can-t-see-me_2_cfb71908d8368e3062423b45959784aa$ ls -a                   
.  .    ..
</pre></div>
<p>其中一个<code>.</code>代表当前目录，另一个是一个文件，直接<code>cat .</code>会显示</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/you-can-t-see-me_2_cfb71908d8368e3062423b45959784aa$ cat .                   
cat: .: Is a directory
</pre></div>
<p>输入<code>cat</code>然后用tab键补全就能看到真正的文件名了，是一个<code>.</code>和两个<code>空格</code></p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/you-can-t-see-me_2_cfb71908d8368e3062423b45959784aa$ cat .<span class="se">\ \ </span>               
picoCTF<span class="o">{</span>j0hn_c3na_paparapaaaaaaa_paparapaaaaaa_093d6aff<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{j0hn_c3na_paparapaaaaaaa_paparapaaaaaa_093d6aff}</code></p>
<h1 data-content="1" id="10465461e059dd5a45ff45cd97ec87e5">absolutely relative</h1>
<h2 data-content="1" id="9901ba68923ecd15280b1124431c2b52">Question</h2>
<blockquote>
<p>In a filesystem, everything is relative ¯_(ツ)_/¯. Can you find a way to get a flag from this <a href="https://2018shell2.picoctf.com/static/3a286144f1c251a493c223d6a8ff0a6d/absolutely-relative" target="_blank">program</a>? You can find it in /problems/absolutely-relative_1_15eb86fcf5d05ec169cc417d24e02c87 on the shell server. <a href="https://2018shell2.picoctf.com/static/3a286144f1c251a493c223d6a8ff0a6d/absolutely-relative.c" target="_blank">Source</a>.</p>
</blockquote>
<h3 data-content="1" id="8479cda5cc587dcde6a589a666889eb9">Hint</h3>
<blockquote>
<p>Do you have to run the program in the same directory? (⊙.☉)7</p>
<p>Ever used a text editor? Check out the program 'nano'</p>
</blockquote>
<h2 data-content="1" id="1c7273de7e7b3b8353bdca8877873191">Solution</h2>
<p>阅读程序源码</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;                                                                                            </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;                                                                                           </span><span class="cp"></span>

<span class="cp">#define yes_len 3                                                                                             </span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">yes</span> <span class="o">=</span> <span class="s">"yes"</span><span class="p">;</span>                                                                                      

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>                                                                                                    
<span class="p">{</span>                                                                                                             
    <span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">99</span><span class="p">];</span>                                                                                            
    <span class="kt">char</span> <span class="n">permission</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>                                                                                      
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>                                                                                                    
    <span class="kt">FILE</span> <span class="o">*</span> <span class="n">file</span><span class="p">;</span>                                                                                              


    <span class="n">file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"/problems/absolutely-relative_0_d4f0f1c47f503378c4bb81981a80a9b6/flag.txt"</span> <span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>          
    <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>                                                                                               
        <span class="k">while</span> <span class="p">(</span><span class="n">fscanf</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span><span class="o">!=</span><span class="n">EOF</span><span class="p">)</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
    <span class="p">}</span>                                                                                                         

    <span class="n">file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span> <span class="s">"./permission.txt"</span> <span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>                                                                  
    <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>                                                                                               
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
            <span class="n">fscanf</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">permission</span><span class="p">);</span>                                                                   
        <span class="p">}</span>                                                                                                     
        <span class="n">permission</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>                                                                                 
        <span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>                                                                                         
    <span class="p">}</span>                                                                                                         

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">yes</span><span class="p">,</span> <span class="n">yes_len</span><span class="p">))</span> <span class="p">{</span>                                                                 
        <span class="n">printf</span><span class="p">(</span><span class="s">"You have the write permissions.</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>                                                
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>                                                                                                  
        <span class="n">printf</span><span class="p">(</span><span class="s">"You do not have sufficient permissions to view the flag.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>                                 
    <span class="p">}</span>                                                                                                         

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                                                                                                 
<span class="p">}</span>
</pre></div>
<p>程序会判断当前目录下时候有一个名为<code>permission.txt</code>的文件，且文件内容为<code>yes</code>，如果满足，则输出flag。</p>
<p>由于flag文件打开的位置是绝对的，而permission文件的打开位置是相对的，所以只需要到一个自己有写权限的目录下创建一个permission.txt文件，写入<code>yes</code>，然后运行程序就行了。</p>
<p>而我们在用户主目录下就拥有写权限，所以在用户主目录下写入并运行程序：</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:~$ <span class="nb">echo</span> -n <span class="s2">"yes"</span> &gt; permission.txt                                                      
finn@pico-2018-shell-2:~$ /problems/absolutely-relative_0_d4f0f1c47f503378c4bb81981a80a9b6/absolutely-relative

You have the write permissions.
picoCTF<span class="o">{</span>3v3r1ng_1<span class="nv">$_r3l3t1v3_befc0ce1</span><span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{3v3r1ng_1$_r3l3t1v3_befc0ce1}</code></p>
<h1 data-content="1" id="b4fa67451429415ff427cad1ced1cc06">in out error</h1>
<h2 data-content="1" id="65434ca528a05bee8656ca19db89302b">Question</h2>
<blockquote>
<p>Can you utlize stdin, stdout, and stderr to get the flag from this <a href="https://2018shell2.picoctf.com/static/d4999df1f1d898c76bbc6f4c70444886/in-out-error" target="_blank">program</a>? You can also find it in /problems/in-out-error_2_c33e2a987fbd0f75e78481b14bfd15f4 on the shell server</p>
</blockquote>
<h3 data-content="1" id="680f4cb9f3f7f060eff30b68b55af2f3">Hint</h3>
<blockquote>
<p>Maybe you can split the stdout and stderr output?</p>
</blockquote>
<h2 data-content="1" id="79d2f32ff803880fb0e5111d2751d4ca">Solution</h2>
<p>linux输出重定向，可以参考<a href="https://www.cnblogs.com/softidea/p/3965093.html" target="_blank">Linux标准输入、输出和错误和文件重定向</a>。</p>
<p>直接执行程序会把<code>Rick Roll'd</code>的歌词和<code>flag</code>混在一起输出，flag在<code>stderr</code>中，把<code>stdout</code>重定向到<code>/dev/null</code>就可以得到flag。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/in-out-error_0_0f875f7714b995dad5946a15be6267a7$ ./in-out-error <span class="m">1</span>&gt;/dev/null  
Please may I have the flag?                                                                                   
picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoC
TF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1
p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_
1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_
7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng
_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6
fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>
picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoC
TF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1
p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_
1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_
7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng
_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6
fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>
picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoC
TF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1
p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>picoCTF<span class="o">{</span>p1p1ng_1S_4_7h1ng_85f6fd2c<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{p1p1ng_1S_4_7h1ng_85f6fd2c}</code></p>
<h1 data-content="1" id="8993e7ece21dc7d6f8d109208f93f773">learn gdb</h1>
<h2 data-content="1" id="7584348991451c4b76f91c939fd1f795">Question</h2>
<blockquote>
<p>Using a debugging tool will be extremely useful on your missions. Can you run this <a href="https://2018shell2.picoctf.com/static/999e37c9737d95c105ea29ae5b3fac1f/run" target="_blank">program</a> in gdb and find the flag? You can find the file in /problems/learn-gdb_0_716957192e537ac769f0975c74b34194 on the shell server.</p>
</blockquote>
<h3 data-content="1" id="f6fc36f86fcc5b58d187edd13c50ec83">Hint</h3>
<blockquote>
<p>Try setting breakpoints in gdb</p>
<p>Try and find a point in the program after the flag has been read into memory to break on</p>
<p>Where is the flag being written in memory?</p>
</blockquote>
<h2 data-content="1" id="e43523fe35d2d8dccfca8e2e98b72ff7">Solution</h2>
<p>执行程序会解密flag，但是不会输出。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/learn-gdb_3_f1f262d9d48b9ff39efc3bc092ea9d7b$ ./run                          
Decrypting the Flag into global variable <span class="s1">'flag_buf'</span>                                                           
.....................................                                                                         
Finished Reading Flag into global variable <span class="s1">'flag_buf'</span>. Exiting.
</pre></div>
<p>用<code>gdb</code>加载程序，反汇编<code>main</code>函数。</p>
<div class="highlight"><pre><span></span>finn@pico-2018-shell-2:/problems/learn-gdb_3_f1f262d9d48b9ff39efc3bc092ea9d7b$ gdb run
...
<span class="o">(</span>gdb<span class="o">)</span> disassemble main
... 
   0x00000000004008f1 &lt;+40&gt;:    callq  0x400650 &lt;setvbuf@plt&gt;                                                 
   0x00000000004008f6 &lt;+45&gt;:    mov    <span class="nv">$0</span>x4009d0,%edi                                                         
   0x00000000004008fb &lt;+50&gt;:    callq  0x400600 &lt;puts@plt&gt;                                                    
   0x0000000000400900 &lt;+55&gt;:    mov    <span class="nv">$0</span>x0,%eax                                                              
   0x0000000000400905 &lt;+60&gt;:    callq  0x400786 &lt;decrypt_flag&gt;                                                
...
</pre></div>
<p>再反汇编<code>decrypt_flag</code>函数，在打印break-line直接下断点。</p>
<div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> disas decrypt_flag                                                                                      
...                                               

   0x0000000000400896 &lt;+272&gt;:   mov    0x200b4b<span class="o">(</span>%rip<span class="o">)</span>,%rdx        <span class="c1"># 0x6013e8 &lt;flag_buf&gt;                       </span>
   0x000000000040089d &lt;+279&gt;:   mov    -0x20<span class="o">(</span>%rbp<span class="o">)</span>,%eax                                                       
   0x00000000004008a0 &lt;+282&gt;:   cltq                                                                          
   0x00000000004008a2 &lt;+284&gt;:   add    %rdx,%rax                                                              
   0x00000000004008a5 &lt;+287&gt;:   movb   <span class="nv">$0</span>x0,<span class="o">(</span>%rax<span class="o">)</span>                                                            
   0x00000000004008a8 &lt;+290&gt;:   mov    <span class="nv">$0</span>xa,%edi                                                              
   0x00000000004008ad &lt;+295&gt;:   callq  0x4005f0 &lt;putchar@plt&gt;                                                 
   0x00000000004008b2 &lt;+300&gt;:   nop                                                                           
...
<span class="o">(</span>gdb<span class="o">)</span> b *0x00000000004008a8                                                                                   
Breakpoint <span class="m">1</span> at 0x4008a8                                                                                      
<span class="o">(</span>gdb<span class="o">)</span> r                                                                                                       
Starting program: /problems/learn-gdb_3_f1f262d9d48b9ff39efc3bc092ea9d7b/run                                  
Decrypting the Flag into global variable <span class="s1">'flag_buf'</span>                                                           
.....................................                                                                         
Breakpoint <span class="m">1</span>, 0x00000000004008a8 in decrypt_flag <span class="o">()</span>
</pre></div>
<p><code>printf "%s", (char *) flag_buf</code>打印<code>flag_buf</code>变量，得到flag。</p>
<div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">printf</span> <span class="s2">"%s"</span>, <span class="o">(</span>char *<span class="o">)</span> flag_buf                                                                          
picoCTF<span class="o">{</span>gDb_iS_sUp3r_u53fuL_efaa2b29<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{gDb_iS_sUp3r_u53fuL_efaa2b29}</code></p>
<h1 data-content="1" id="be5b5267cebea748555d0c6f2aecaa27">roulette</h1>
<h2 data-content="1" id="ff9b915bfe69de46423e09d2c184ebc8">Question</h2>
<blockquote>
<p>This Online <a href="https://2018shell2.picoctf.com/static/2d8417ef7707fec56592db02da54575e/roulette" target="_blank">Roulette</a> Service is in Beta. Can you find a way to win $1,000,000,000 and get the flag? <a href="https://2018shell2.picoctf.com/static/2d8417ef7707fec56592db02da54575e/roulette.c" target="_blank">Source</a>. Connect with <code>nc 2018shell1.picoctf.com 5731</code></p>
</blockquote>
<h3 data-content="1" id="9c507750796ecf68f75c866fcd01efb0">Hint</h3>
<blockquote>
<p>There are 2 bugs!</p>
</blockquote>
<h2 data-content="1" id="335e47978440d0597d3c69b6014532b6">Solution</h2>
<p>查看源码，发现出问题的地方有两个。</p>
<div class="highlight"><pre><span></span><span class="kt">long</span> <span class="nf">get_rand</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="n">seed</span><span class="p">;</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"/dev/urandom"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
  <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">seed</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span> <span class="o">%</span> <span class="mi">5000</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">seed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">srand</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">seed</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">cash</span> <span class="o">=</span> <span class="n">get_rand</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>这里直接用随机数种子作为初始cash值，所以可以用cash来预测后面的随机数。</p>
<p>第二个问题出现在<code>get_long()</code>函数。</p>
<div class="highlight"><pre><span></span><span class="kt">long</span> <span class="nf">get_long</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">);</span>
    <span class="kt">uint64_t</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">is_digit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">while</span><span class="p">(</span><span class="n">is_digit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">LONG_MAX</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">LONG_MAX</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">l</span> <span class="o">*=</span> <span class="mi">10</span><span class="p">;</span>
      <span class="n">l</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">l</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这个函数会返回一个有符号长整型的值，但是，在中间的运算过程却使用了一个无符号的<code>uint64_t</code>。</p>
<p>所以当我们构造一个特别大的输入时，就可以造成溢出，使函数返回一个有符号的负数。</p>
<p>基于以上两个bug，我们就可以构造出满足以下要求的输入了。</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">cash</span> <span class="o">&gt;</span> <span class="n">ONE_BILLION</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// cash大于十亿</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"*** Current Balance: $%lu ***</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cash</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">wins</span> <span class="o">&gt;=</span> <span class="n">HOTSTREAK</span><span class="p">)</span> <span class="p">{</span><span class="c1">// 连胜次数大于等于三次</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Wow, I can't believe you did it.. You deserve this flag!"</span><span class="p">);</span>
      <span class="n">print_flag</span><span class="p">();</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>预测随机数用的c程序</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">36</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"%ld "</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>产生随机数序列</p>
<div class="highlight"><pre><span></span>~ gcc generator.c -o random_predict
~ ./random_predict <span class="m">611</span>
<span class="m">12</span> <span class="m">23</span> <span class="m">34</span> <span class="m">26</span>
~
</pre></div>
<div class="highlight"><pre><span></span>$ nc 2018shell2.picoctf.com <span class="m">48312</span>
Welcome to ONLINE ROULETTE!
Here, have <span class="nv">$611</span> to start on the house! You<span class="s1">'ll lose it all anyways &gt;:)</span>

<span class="s1">How much will you wager?</span>
<span class="s1">Current Balance: $611    Current Wins: 0</span>
<span class="s1">&gt; 611</span>
<span class="s1">Choose a number (1-36)</span>
<span class="s1">&gt; 12</span>

<span class="s1">Spinning the Roulette for a chance to win $1222!</span>

<span class="s1">Roulette  :  12</span>

<span class="s1">You chose correct!</span>

<span class="s1">How much will you wager?</span>
<span class="s1">Current Balance: $1222   Current Wins: 1</span>
<span class="s1">&gt; 1222</span>
<span class="s1">Choose a number (1-36)</span>
<span class="s1">&gt; 23</span>

<span class="s1">Spinning the Roulette for a chance to win $2444!</span>

<span class="s1">Roulette  :  23</span>

<span class="s1">Wow, you won!</span>

<span class="s1">How much will you wager?</span>
<span class="s1">Current Balance: $2444   Current Wins: 2</span>
<span class="s1">&gt; 2444</span>
<span class="s1">Choose a number (1-36)</span>
<span class="s1">&gt; 34</span>

<span class="s1">Spinning the Roulette for a chance to win $4888!</span>

<span class="s1">Roulette  :  34</span>

<span class="s1">Congrats!</span>

<span class="s1">How much will you wager?</span>
<span class="s1">Current Balance: $4888   Current Wins: 3</span>
<span class="s1">&gt; 3221225472</span>
<span class="s1">Choose a number (1-36)</span>
<span class="s1">&gt; 25</span>

<span class="s1">Spinning the Roulette for a chance to win $2147483648!</span>

<span class="s1">Roulette  :  26</span>

<span class="s1">WRONG</span>
<span class="s1">If you keep it up, maybe you'</span>ll get the flag in <span class="m">100000000000</span> years

*** Current Balance: <span class="nv">$1073746712</span> ***
Wow, I can<span class="err">'</span>t believe you did it.. You deserve this flag!
picoCTF<span class="o">{</span>1_h0p3_y0u_f0uNd_b0tH_bUg5_8fb4d984<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{1_h0p3_y0u_f0uNd_b0tH_bUg5_8fb4d984}</code></p>
<h1 data-content="1" id="a35e5230c1920cdb20d9d052bb4b251d">store</h1>
<h2 data-content="1" id="0e8a4de871159f8ce7f4150b9ea9be30">Question</h2>
<blockquote>
<p>We started a little <a href="https://2018shell2.picoctf.com/static/52a992a4afd3bd8ad54489efbec0fd5c/store" target="_blank">store</a>, can you buy the flag? <a href="https://2018shell2.picoctf.com/static/52a992a4afd3bd8ad54489efbec0fd5c/source.c" target="_blank">Source</a>. Connect with <code>2018shell1.picoctf.com 53220</code>.</p>
</blockquote>
<h3 data-content="1" id="9c0246525c202abe6b238d3c5847f7c7">Hint</h3>
<blockquote>
<p>Two's compliment can do some weird things when numbers get really big!</p>
</blockquote>
<h2 data-content="1" id="53717842d5d0199d24f472a920a98ca2">Solution</h2>
<p>也是一个整数溢出的问题，购买一个小额的商品，造成负数溢出就可以使自己的钱数增加。</p>
<p>但是……出题人好像忘记去掉一些东西，直接把flag放在了二进制可执行文件里，所以直接<code>strings</code>就能得到flag了=-=。</p>
<div class="highlight"><pre><span></span>~ strings store <span class="p">|</span>grep pico
YOUR FLAG IS: picoCTF<span class="o">{</span>numb3r3_4r3nt_s4f3_dbd42a50<span class="o">}</span>
</pre></div>
<p>常规解法如下。</p>
<div class="highlight"><pre><span></span>Welcome to the Store App V1.0
World<span class="s1">'s Most Secure Purchasing App</span>

<span class="s1">[1] Check Account Balance</span>

<span class="s1">[2] Buy Stuff</span>

<span class="s1">[3] Exit</span>

<span class="s1"> Enter a menu selection</span>
<span class="s1">2</span>
<span class="s1">Current Auctions</span>
<span class="s1">[1] I Can'</span>t Believe its not a Flag!
<span class="o">[</span><span class="m">2</span><span class="o">]</span> Real Flag
<span class="m">1</span>
Imitation Flags cost <span class="m">1000</span> each, how many would you like?
<span class="m">10000000000000000</span>

Your total cost is: -1981284352

Your new balance: <span class="m">1981285452</span>

Welcome to the Store App V1.0
World<span class="s1">'s Most Secure Purchasing App</span>

<span class="s1">[1] Check Account Balance</span>

<span class="s1">[2] Buy Stuff</span>

<span class="s1">[3] Exit</span>

<span class="s1"> Enter a menu selection</span>
<span class="s1">2</span>
<span class="s1">Current Auctions</span>
<span class="s1">[1] I Can'</span>t Believe its not a Flag!
<span class="o">[</span><span class="m">2</span><span class="o">]</span> Real Flag
<span class="m">2</span>
A genuine Flag costs <span class="m">100000</span> dollars, and we only have <span class="m">1</span> in stock
Enter <span class="m">1</span> to purchase1
YOUR FLAG IS: picoCTF<span class="o">{</span>numb3r3_4r3nt_s4f3_dbd42a50<span class="o">}</span>
</pre></div>
<p>flag:<code>picoCTF{numb3r3_4r3nt_s4f3_dbd42a50}</code></p>
</div>
</div>