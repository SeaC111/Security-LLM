<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="f80e7b71375cd086dc7417fda6e944f7">子域名探测</h1>
<blockquote>
<p>通过收集子域名信息来进行渗透是目前常见的一种手法。<br/>
子域名信息收集可以通过手工，也可以通过工具，还可以通过普通及漏洞搜索引擎来进行分析。<br/>
在挖SRC漏洞时，子域名信息的收集至关重要！</p>
</blockquote>
<h2 data-content="1" id="101693f266081da47c202238e1e0fca4">为什么要进行子域名探测？</h2>
<blockquote>
<ul>
<li>子域名探测可以帮我们发现渗透测试中更多的服务，这将增加发现漏洞的可能性</li>
<li>查找一些用户上较少，被人遗忘的子域名，其上运行的应用程序可能会使我们发现关键漏洞</li>
<li>通常，同一组织的不同域名/应用程序中存在相同的漏洞</li>
<li>子域名中的常见资产类型一般包括办公系统，邮箱系统，论坛，商城等，其他管理系统，网站管理后台等较少出现在子域名中</li>
</ul>
</blockquote>
<h2 data-content="1" id="cab8366f9c60a92890682105a5cc97ba">子域名探测方法大全</h2>
<h3 data-content="1" id="40478c0b7ccf022b95d4090a0c91ac1f">在线接口</h3>
<blockquote>
<p><a href="https://crt.sh/" target="_blank">https://crt.sh/</a><br/>
<a href="https://censys.io/" target="_blank">https://censys.io/</a><br/>
<a href="https://transparencyreport.google.com/https/certificates" target="_blank">https://transparencyreport.google.com/https/certificates</a><br/>
<a href="https://dnsdumpster.com/" target="_blank">https://dnsdumpster.com/</a><br/>
<a href="https://hackertarget.com/find-dns-host-records/" target="_blank">https://hackertarget.com/find-dns-host-records/</a><br/>
<a href="https://x.threatbook.cn/" target="_blank">https://x.threatbook.cn/</a><br/>
<a href="https://www.virustotal.com/gui/home/search" target="_blank">https://www.virustotal.com/gui/home/search</a><br/>
<a href="https://phpinfo.me/domain/" target="_blank">https://phpinfo.me/domain/</a><br/>
<a href="https://site.ip138.com/baidu.com/domain.htm" target="_blank">https://site.ip138.com/baidu.com/domain.htm</a><br/>
<a href="https://www.t1h2ua.cn/tools/" target="_blank">https://www.t1h2ua.cn/tools/</a><br/>
<a href="http://tool.chinaz.com/subdomain/" target="_blank">http://tool.chinaz.com/subdomain/</a><br/>
<a href="https://spyse.com/site/not-found?q=domain%3A%22github%22&amp;criteria=cert" target="_blank">https://spyse.com/site/not-found?q=domain%3A%22github%22&amp;criteria=cert</a></p>
</blockquote>
<h3 data-content="1" id="9a79b0ef672df501922b74bae555c280">暴力枚举</h3>
<blockquote>
<p>Layer子域名爆破机<br/>
Layer是windows下的一款子域名探测工具，其工作原理是利用子域名字典进行爆破，使用简单容易上手。<br/>
<img src="https://img-blog.csdnimg.cn/20201211120912792.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
<p><strong>Amass<br/>
工具描述：爆破, google, VirusTotal, alt names</strong><br/>
go get -u github.com/OWASP/Amass/...<br/>
amass -d target.com -o $outfile<br/>
Knock</p>
<p><strong>工具描述：AXFR, virustotal, 爆破</strong><br/>
apt-get install python-dnspython<br/>
git clone <a href="https://xxx.com/guelfoweb/knock.git" target="_blank">https://xxx.com/guelfoweb/knock.git</a><br/>
cd knock<br/>
nano knockpy/config.json # &lt;- set your virustotal API_KEY<br/>
python setup.py install<br/>
<img src="https://img-blog.csdnimg.cn/20201211134459728.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
</blockquote>
<h3 data-content="1" id="e0462c3dd0fbbad19b2da10fe8ba112e">搜索引擎</h3>
<blockquote>
<ul>
<li>
<p><strong>Google</strong><br/>
intitle=公司名称<br/>
过滤掉 -site:www.target.com<br/>
我们可以在Google搜索中使用 site:运算符来查找一个域的所有子域名<br/>
谷歌还额外支持减号运算符 site:*.wikimedia.org -www -store -jobs -uk 以排除我们不感兴趣的子域名<br/>
<img src="https://img-blog.csdnimg.cn/20201211115552119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
</li>
<li>
<p><strong>Bing</strong><br/>
Bing搜索引擎也支持一些高级搜索运算符。与Google一样，Bing也支持site:运算符，可以帮助您检查除Google搜索之外的其他结果。<br/>
发现子域名: site:target.com</p>
</li>
<li>
<strong>百度</strong><br/>
intitle=公司名称</li>
<li>
<strong>钟馗之眼</strong><br/>
<a href="https://www.zoomeye.org/" target="_blank">https://www.zoomeye.org/</a><br/>
site=域名</li>
<li>
<strong>FOFA</strong><br/>
<a href="https://fofa.so/" target="_blank">https://fofa.so/</a><br/>
语法：domain=”baidu.com”<br/>
提示：以上方法无需爆破，查询速度快，需要快速收集资产时可以优先使用，后面再用其他方法补充。</li>
</ul>
</blockquote>
<h3 data-content="1" id="b336c26c031eaa3217d7e7015f700129">Certificate Transparency（证书透明）</h3>
<p><strong>SSL/TLS证书</strong></p>
<blockquote>
<p>证书透明度(Certificate Transparency)是证书授权机构的一个项目，证书授权机构会将每个SSL/TLS证书发布到公共日志中。一个SSL/TLS证书通常包含域名、子域名和邮件地址。查找某个域名所属证书的最简单的方法就是使用搜索引擎搜索一些公开的CT日志。</p>
<p><strong>在线查询：</strong><br/>
<a href="https://crt.sh/" target="_blank">https://crt.sh/</a><br/>
<a href="https://censys.io/" target="_blank">https://censys.io/</a><br/>
<a href="https://developers.facebook.com/tools/ct/" target="_blank">https://developers.facebook.com/tools/ct/</a><br/>
<a href="https://google.com/transparencyreport/https/ct/" target="_blank">https://google.com/transparencyreport/https/ct/</a><br/>
<a href="https://transparencyreport.google.com/https/certificates" target="_blank">https://transparencyreport.google.com/https/certificates</a></p>
<p><strong>CTFR<br/>
工具描述：滥用证书透明记录</strong><br/>
git clone <a href="https://xxx.com/UnaPibaGeek/ctfr.git" target="_blank">https://xxx.com/UnaPibaGeek/ctfr.git</a><br/>
cd ctfr<br/>
pip3 install -r requirements.txt<br/>
python3 ctfr.py -d target.com -o $outfile</p>
<p><strong>Censys_subdomain_enum.py<br/>
工具描述：提取子域名，从Censys的SSL/TLS证书中收集子域名</strong><br/>
pip install censys<br/>
git clone <a href="https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git" target="_blank">https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git</a><br/>
python censys_enumeration.py target.com<br/>
<img src="https://img-blog.csdnimg.cn/20201211134531656.png"/></p>
<p><strong>Cloudflare_enum.py<br/>
工具描述：从Cloudflare提取子域名<br/>
dns聚合器</strong><br/>
pip install censys<br/>
git clone <a href="https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git" target="_blank">https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git</a><br/>
cloudflare_subdomain_enum.py your@cloudflare.email target.com</p>
<p><strong>Crt_enum_web.py<br/>
工具描述：解析<a href="https://crt.sh/页面的子域名" target="_blank">https://crt.sh/页面的子域名</a></strong><br/>
pip install psycopg2<br/>
git clone <a href="https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git" target="_blank">https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git</a><br/>
python3 crtsh_enum_web.py target.com</p>
<p><strong>San_subdomain_enum.py<br/>
工具描述：SSL/TLS证书中的SAN获取子域名</strong><br/>
git clone <a href="https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git" target="_blank">https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git</a><br/>
./san_subdomain_enum.py target.com</p>
</blockquote>
<h3 data-content="1" id="46511e87bcd1527631a894c5d9109970">Subject Alternate Name (SAN) - 主题备用名称</h3>
<blockquote>
<p>SAN(Subject Alternate Name)主题备用名称，主题备用名称证书简单来说，在需要多个域名，将其用于各项服务时，可使用SAN证书。允许在安全证书中使用subjectAltName字段将多种值与证书关联，这些值被称为主题备用名称。名称可包括：IP地址、DNS名称等。</p>
<p><strong>San_subdomain_enum.py<br/>
工具描述：SSL/TLS证书中的SAN获取子域名</strong><br/>
如上。</p>
</blockquote>
<h3 data-content="1" id="0b787d74aa807c53978d44f7fda0ee5a">Public datasets（公开数据集）</h3>
<blockquote>
<p>有些项目收集了全互联网范围内的扫描数据，并将其提供给研究人员和安全社区。该项目发布的数据集是子域名信息的宝库。虽然在这个庞大的数据集中找到子域名就像大海捞针，但却值得我们去一试。</p>
<p><strong>Rapid7 Forward DNS dataset (Project Sonar)<br/>
工具描述：来自rapid7 sonar项目的公共数据集</strong><br/>
wget <a href="https://scans.io/data/rapid7/sonar.fdns_v2/20170417-fdns.json.gz" target="_blank">https://scans.io/data/rapid7/sonar.fdns_v2/20170417-fdns.json.gz</a><br/>
cat 20170417-fdns.json.gz | pigz -dc | grep ".target.org" | jq`</p>
<p><strong>Forward DNS</strong>(<a href="https://scans.io/study/sonar.fdns_v2" target="_blank">https://scans.io/study/sonar.fdns_v2</a>) 数据集作为Project Sonar的一部分发布。<br/>
数据格式是通过gzip压缩的JSON文件。我们可以解析数据集以查找给定域名的子域名。<br/>
数据集很大(压缩后：20+GB，压缩前：300+GB）<br/>
Command to parse &amp; extract sub-domains for a given domain<br/>
$ curl -silent <a href="https://scans.io/data/rapid7/sonar.fdns_v2/20170417-fdns.json.gz" target="_blank">https://scans.io/data/rapid7/sonar.fdns_v2/20170417-fdns.json.gz</a> | pigz -dc | grep ".icann.org" | jq<br/>
<img src="https://img-blog.csdnimg.cn/20201211122853885.png"/></p>
<p><strong>数据聚合网站</strong><br/>
threatcrowd<br/>
<a href="https://scans.io/study/sonar.rdns_v2" target="_blank">https://scans.io/study/sonar.rdns_v2</a><br/>
<a href="https://opendata.rapid7.com/" target="_blank">https://opendata.rapid7.com/</a></p>
</blockquote>
<h3 data-content="1" id="c0fc3386d70492b9e4f5ca52629a19bb">信息泄露</h3>
<blockquote>
<ul>
<li>
<strong>信息泄露</strong><br/>
首先找到目标站点，在官网中可能会找到相关资产（多为办公系统，邮箱系统等），关注一下页面底部，也许有管理后台等收获。</li>
<li>
<strong>文件泄漏</strong><br/>
crossdomain.xml(跨域策略文件cdx)<br/>
robots.txt</li>
<li><strong>Git仓库泄露</strong></li>
<li><strong>从流量中分析提取</strong></li>
</ul>
</blockquote>
<h3 data-content="1" id="2c267cf1dbe97e589f5a8a2351012b58">内容解析（HTML，JavaScript，文件）</h3>
<blockquote>
<p><strong>BiLE-suite<br/>
工具描述：HTML解析，反向dns解析</strong><br/>
aptitude install httrack<br/>
git clone <a href="https://xxx.com/sensepost/BiLE-suite.git" target="_blank">https://xxx.com/sensepost/BiLE-suite.git</a><br/>
perl BiLE.pl target.com</p>
<p><strong>Second Order<br/>
工具描述：第二阶段域名扫描<br/>
通过HTML提取子域名</strong><br/>
go get xxx.com/mhmdiaa/second-order<br/>
cp ~/go/src/xxx.com/mhmdiaa/second-order/config.json ~/go/src/xxx.com/mhmdiaa/second-order/config-subs-enum.json<br/>
编辑修改LogCrawledURLs为True<br/>
second-order -base <a href="https://target.com" target="_blank">https://target.com</a> -config config.json -output target.com</p>
<h3>DNS解析</h3>
<p><strong>在线查询:</strong><br/>
VirusTotal(<a href="https://www.virustotal.com/" target="_blank">https://www.virustotal.com/</a>)<br/>
ViewDNS(<a href="https://viewdns.info/" target="_blank">https://viewdns.info/</a>)<br/>
DNSdumpster(<a href="https://dnsdumpster.com/" target="_blank">https://dnsdumpster.com/</a>)<br/>
Threatcrowd(<a href="https://www.threatcrowd.org/" target="_blank">https://www.threatcrowd.org/</a>)</p>
<p><strong>BiLE-suite<br/>
工具描述：HTML解析，反向dns解析</strong><br/>
如上。</p>
<p><strong>Massdns<br/>
工具描述：dns解析</strong><br/>
git clone <a href="https://xxx.com/blechschmidt/massdns.git" target="_blank">https://xxx.com/blechschmidt/massdns.git</a><br/>
cd massdns/<br/>
make<br/>
解析域名：/bin/massdns -r lists/resolvers.txt -t AAAA -w results.txt domains.txt -o S -w output.txt<br/>
爆破域名：./scripts/subbrute.py wordlist.txt target.com | ./bin/massdns -r lists/resolvers.txt -t A -o S -w output.txt<br/>
CT解析：./scripts/ct.py target.com | ./bin/massdns -r lists/resolvers.txt -t A -o S -w output.txt<br/>
<img src="https://img-blog.csdnimg.cn/20201211093315310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
</blockquote>
<h3 data-content="1" id="c833b177120223fb69741d21cdd247cd">区域传送</h3>
<blockquote>
<p>域传送是一种DNS事务，DNS服务器将其全部或部分域文件的副本传递给另一个DNS服务器。如果未安全地配置域传输送，则任何人都可以对指定名称的服务器启动域传送并获取域文件的副本。根据设计，域文件包含有关域和保存在域中的大量主机信息。</p>
<p><strong>Windows：</strong></p>
<ol>
<li>nslookup命令进入交互式shell</li>
<li>server命令 参数设定查询将要使用的DNS服务器</li>
<li>ls命令列出某个域中的所有域名</li>
</ol>
<p><strong>Linux：</strong><br/>
<strong>Dig<br/>
工具描述：dns区域传送，dns反向解析，dns解析</strong><br/>
dig +multi AXFR target.com<br/>
dig +multi AXFR $ns_server target.com</p>
<h3>DNS aggregators（DNS聚合器）</h3>
<p><strong>Cloudflare_enum.py<br/>
工具描述：从Cloudflare提取子域名<br/>
dns聚合器</strong><br/>
pip install censys<br/>
git clone <a href="https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git" target="_blank">https://xxx.com/appsecco/the-art-of-subdomain-enumeration.git</a><br/>
cloudflare_subdomain_enum.py your@cloudflare.email target.com</p>
</blockquote>
<h3 data-content="1" id="4ee3c58df145d767d8133001edfdedfb">DNS Cache Snooping（域名缓存侦测）</h3>
<blockquote>
<p><strong>域名缓存侦测（DNS Cache Snooping）技术</strong><br/>
在企业网络中，通常都会配置DNS服务器，为网络内的主机提供域名解析服务。这些DNS不仅解析自己的私有域名，还会用递归方式，请求公网的DNS解析第三方域名，如baidu.com之类。为了提升性能，通常会使用缓存记录，记录解析过的域名，尤其是第三方域名。<br/>
域名缓存侦测（DNS Cache Snooping）技术就是向这些服务器发送域名解析请求，但要求不使用递归模式。这样DNS只能解析私有域名和缓存中保存的域名。借助该项技术，渗透测试人员就知道哪些域名是否被过请求过。例如，测试人员可以提交某安全软件更新所使用的域名，如果有记录，说明该网络使用该种安全软件。</p>
<h3>Alterations &amp; permutations（换置 &amp; 排序）</h3>
<p><strong>AltDNS</strong><br/>
<strong>工具描述：通过换置&amp;排序技术发现子域名</strong><br/>
git clone <a href="https://xxx.com/infosec-au/altdns.git" target="_blank">https://xxx.com/infosec-au/altdns.git</a><br/>
cd altdns<br/>
pip install -r requirements.txt<br/>
./altdns.py -i subdomains.txt -o data_output -w words.txt -r -s results_output.txt<br/>
<img src="https://img-blog.csdnimg.cn/20201210230908625.png"/></p>
</blockquote>
<h3 data-content="1" id="30a304b248816486932a27f0ea8e9501">DNSSEC(Domain Name System Security Extensions)，DNS安全扩展，DNSSEC区域漫步</h3>
<blockquote>
<p>由于DNSSEC处理不存在域名的方式，您可以"遍历"DNSSEC域并枚举该域中的所有域名。您可以从这里(<a href="https://info.menandmice.com/blog/bid/73645/Take-your-DNSSEC-with-a-grain-of-salt" target="_blank">https://info.menandmice.com/blog/bid/73645/Take-your-DNSSEC-with-a-grain-of-salt</a>) 了解有关此技术的更多信息。</p>
<p><strong>Ldns-walk<br/>
工具描述：DNSSEC zone walking, 如果DNSSEC NSEC开启，可以获得全部域名。</strong><br/>
aptitude install ldnsutils<br/>
ldns-walk target.com<br/>
ldns-walk @nsserver.com target.com<br/>
如果DNSSEC NSEC开启，可以获得全部域名。<br/>
<img src="https://img-blog.csdnimg.cn/20201211122654923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
</blockquote>
<h3 data-content="1" id="f31094bc94e2341b99eb313f700d535b">CSP HTTP首部</h3>
<blockquote>
<p><strong>Domains-from-csp<br/>
工具描述：从CSP头提取子域名</strong><br/>
git clone <a href="https://xxx.com/yamakira/domains-from-csp.git" target="_blank">https://xxx.com/yamakira/domains-from-csp.git</a><br/>
pip install click<br/>
python csp_parser.py $URL<br/>
python csp_parser.py $URL -r</p>
<h3>SPF记录</h3>
<p>SPF是通过域名的TXT记录来进行设置的，SPF记录列出了所有被授权代表域名发送电子邮件的主机</p>
<p><strong>Assets-from-spf</strong><br/>
<strong>工具描述：SPF域名记录</strong><br/>
git clone <a href="https://xxx.com/yamakira/assets-from-spf.git" target="_blank">https://xxx.com/yamakira/assets-from-spf.git</a><br/>
pip install click ipwhois<br/>
python assets_from_spf.py target.com<br/>
<img src="https://img-blog.csdnimg.cn/2020121023102340.png"/></p>
<h3>虚拟主机爆破</h3>
<p><strong>vhost-brute<br/>
工具描述：虚拟主机爆破</strong><br/>
aptitude install php-curl<br/>
git clone <a href="https://xxx.com/gwen001/vhost-brute.git" target="_blank">https://xxx.com/gwen001/vhost-brute.git</a><br/>
<img src="https://img-blog.csdnimg.cn/20201211094356968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjY1Njc0,size_16,color_FFFFFF,t_70"/></p>
<p><strong>Virtual-host-discovery<br/>
工具描述：虚拟主机爆破</strong><br/>
git clone <a href="https://xxx.com/jobertabma/virtual-host-discovery.git" target="_blank">https://xxx.com/jobertabma/virtual-host-discovery.git</a><br/>
ruby scan.rb --ip=1.1.1.1 --host=target.com --output output.txt</p>
</blockquote>
<h3 data-content="1" id="7a5af372817299d90b3c6bb11da2b71c">ASN发现</h3>
<blockquote>
<p>通过域名查询到 ASN，再通过 ASN 查询到所属的所有 ip 范围</p>
<h3>爬虫 Scraping（抓取）</h3>
<h2>泛解析问题</h2>
<p>目前最好的解决方式是通过先获取一个绝对不存在域名的响应内容，再遍历获取每个字典对应的子域名的响应内容，通过和不存在域名的内容做相似度比对，来枚举子域名，但这样的实现是以牺牲速度为代价</p>
<ul>
<li><a href="https://www.freebuf.com/news/133873.html" target="_blank">https://www.freebuf.com/news/133873.html</a></li>
<li><a href="https://xz.aliyun.com/t/5509" target="_blank">https://xz.aliyun.com/t/5509</a></li>
</ul>
</blockquote>
<h2 data-content="1" id="37c3598cebf3e1e327dfc3261bbf13d2">tools</h2>
<h3 data-content="1" id="6ccb98a22ca4253b3db7d72e1880ae1a">OneForAll</h3>
<blockquote>
<p><a href="https://github.com/shmilylty/OneForAll" target="_blank">https://github.com/shmilylty/OneForAll</a><br/>
工具也有很多厉害的，平时我一般使用 OneForALL + ESD + JSfinder 来进行搜集，（ESD 可以加载 layer 的字典，很好用）</p>
<h3>Sublist3r</h3>
<p><a href="https://github.com/aboul3la/Sublist3r" target="_blank">https://github.com/aboul3la/Sublist3r</a> - 强大的快速子域枚举工具<br/>
评分:</p>
</blockquote>
</div>
</div>