<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="74092b9caeb476659c152a6ea971d3b2">libFuzzer类库模糊测试引擎调研</h1>
<h2 data-content="1" id="dd6c96fdf0618e3de670ab9b00ab8fb5">一、简介</h2>
<p><strong>项目地址</strong>:<a href="https://github.com/llvm/llvm-project/tree/main/compiler-rt/lib/fuzzer" target="_blank">llvm-project/compiler-rt/lib/fuzzer at main · llvm/llvm-project (github.com)</a><br/>
libFuzzer 是由 LLVM 项目开发的覆盖率引导模糊测试引擎，广泛用于自动发现软件中的漏洞和错误。它通过不断生成和测试输入数据，提高代码覆盖率，找到潜在的缺陷。libFuzzer 尤其适合测试用 C 和 C++ 编写的代码。</p>
<h2 data-content="1" id="14ac9d00189ebcba06a6330f04db69a2">二、libFuzzer 的模块结构</h2>
<p>libFuzzer 是一个面向库的模糊测试引擎，广泛用于发现软件中的漏洞。了解其模块结构有助于深入理解其工作原理和扩展能力。以下是 libFuzzer 的主要模块结构：</p>
<ol>
<li>
<strong>FuzzerDriver</strong><ul>
<li>
<strong>功能</strong>：这是 libFuzzer 的核心入口点，负责初始化模糊测试环境、读取输入文件、启动模糊测试循环。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>main</code>: 入口函数，负责解析命令行参数并调用 <code>FuzzerDriver</code>。</li>
<li>
<code>FuzzerDriver</code>: 核心循环，包含模糊测试的主逻辑。</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Mutation</strong><ul>
<li>
<strong>功能</strong>：负责生成新的测试用例，通过变异（Mutation）已有的输入数据来发现更多潜在的漏洞。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>Mutate</code>: 对输入数据进行变异。</li>
<li>
<code>CrossOver</code>: 将两个输入数据交叉生成新的输入。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerMutate.cpp</code>, <code>FuzzerMutate.h</code>
</li>
</ul>
</li>
<li>
<strong>Corpus</strong><ul>
<li>
<strong>功能</strong>：管理测试用例集合（Corpus），包括收集和存储有效的测试用例。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>AddToCorpus</code>: 将新的测试用例添加到集合中。</li>
<li>
<code>LoadCorpus</code>: 从磁盘加载测试用例集合。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerCorpus.cpp</code>, <code>FuzzerCorpus.h</code>
</li>
</ul>
</li>
<li>
<strong>Coverage</strong><ul>
<li>
<strong>功能</strong>：收集代码覆盖率信息，以便评估测试用例的有效性和指导变异策略。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>UpdateCoverage</code>: 更新覆盖率信息。</li>
<li>
<code>GetCoverage</code>: 获取当前的覆盖率。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerTracePC.cpp</code>, <code>FuzzerTracePC.h</code>
</li>
</ul>
</li>
<li>
<strong>Crash Detection</strong><ul>
<li>
<strong>功能</strong>：检测程序崩溃，并记录相关的崩溃信息以便后续分析。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>HandleCrash</code>: 处理崩溃事件。</li>
<li>
<code>ReportCrash</code>: 报告崩溃信息。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerFork.cpp</code>, <code>FuzzerFork.h</code>
</li>
</ul>
</li>
<li>
<strong>FuzzerInterface</strong><ul>
<li>
<strong>功能</strong>：定义模糊测试引擎的接口，包括用户需要实现的目标函数。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>LLVMFuzzerTestOneInput</code>: 用户提供的函数，libFuzzer 将变异后的输入传递给该函数进行测试。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerInterface.h</code>
</li>
</ul>
</li>
<li>
<strong>Options</strong><ul>
<li>
<strong>功能</strong>：管理 libFuzzer 的配置选项，允许用户通过命令行参数或配置文件来调整模糊测试行为。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>ParseFlags</code>: 解析命令行参数。</li>
<li>
<code>PrintHelp</code>: 打印帮助信息。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerOptions.cpp</code>, <code>FuzzerOptions.h</code>
</li>
</ul>
</li>
<li>
<strong>Utils</strong><ul>
<li>
<strong>功能</strong>：提供各种实用工具函数，用于日志记录、内存管理等。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>Print</code>: 打印日志信息。</li>
<li>
<code>AllocateMemory</code>: 分配内存。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerUtil.cpp</code>, <code>FuzzerUtil.h</code>
</li>
</ul>
</li>
<li>
<strong>MainLoop</strong><ul>
<li>
<strong>功能</strong>：控制模糊测试的主循环，协调各模块的工作。</li>
<li>
<strong>关键函数</strong>：<ul>
<li>
<code>RunOne</code>: 运行一个测试用例。</li>
<li>
<code>Loop</code>: 主循环，反复调用 <code>RunOne</code> 进行模糊测试。</li>
</ul>
</li>
<li>
<strong>相关文件</strong>：<code>FuzzerLoop.cpp</code>, <code>FuzzerLoop.h</code>
</li>
</ul>
</li>
</ol>
<h2 data-content="1" id="49de2e7b4687ae896262da56486c842b">三、libFuzzer 功能详解</h2>
<p>libFuzzer 的主要功能包括：</p>
<ul>
<li>
<strong>覆盖率引导测试</strong>：通过覆盖率信息指导输入生成，使测试尽可能覆盖更多代码路径。</li>
<li>
<strong>最小化崩溃输入</strong>：自动最小化导致崩溃的输入，便于调试。</li>
<li>
<strong>多样化输入生成</strong>：支持多种输入生成策略，包括基于变异的输入生成。</li>
<li>
<strong>词典支持</strong>：支持用户提供的词典文件，以增强输入生成的效果。</li>
<li>
<strong>内存错误检测</strong>：结合 AddressSanitizer 使用，可以检测到各种内存错误，如缓冲区溢出和使用未初始化内存等。</li>
<li>
<strong>并行模糊测试</strong>：libFuzzer可以指定行运行加速模糊测试、提高覆盖率。</li>
<li>
<strong>fork模式</strong>：它通过创建多个子进程来同时进行模糊测试，从而提高测试效率。</li>
</ul>
<h2 data-content="1" id="048008cd3559106fc0b5312b70dd8fc6">四、libFuzzer源码解析</h2>
<h3 data-content="1" id="d433b91ca7b5b0bbb5d4f3424eb51bf6">Libfuzzer的主类构成</h3>
<p>源码位置：<a href="https://github.com/llvm/llvm-project/tree/main/compiler-rt/lib/fuzzer" target="_blank">llvm-project/compiler-rt/lib/fuzzer at main · llvm/llvm-project (github.com)</a><br/>
这个 <code>Fuzzer</code> 类的构成可以分为以下几个部分：</p>
<h4 data-content="1" id="0c425bfa0dbd81b1a78fdccce25e37a2">1. <strong>构造函数与析构函数</strong>
</h4>
<ul>
<li><code>Fuzzer(UserCallback CB, InputCorpus &amp;Corpus, MutationDispatcher &amp;MD, FuzzingOptions Options);</code></li>
<li>
<code>~Fuzzer();</code><br/>
#### 2. <strong>公有成员函数（Public Member Functions）</strong>
</li>
<li>
<p><strong>主要功能函数：</strong></p>
<ul>
<li>
<code>void Loop(Vector&lt;SizedFile&gt; &amp;CorporaFiles);</code>  // 主循环，执行模糊测试过程</li>
<li>
<code>void ReadAndExecuteSeedCorpora(Vector&lt;SizedFile&gt; &amp;CorporaFiles);</code>  // 读取并执行种子语料</li>
<li>
<code>void MinimizeCrashLoop(const Unit &amp;U);</code>  // 最小化崩溃处理</li>
<li>
<code>void RereadOutputCorpus(size_t MaxSize);</code>  // 重新读取输出语料库</li>
</ul>
</li>
<li>
<p><strong>时间与状态函数：</strong></p>
<ul>
<li>
<code>size_t secondsSinceProcessStartUp();</code>  // 获取从进程启动到现在的秒数</li>
<li>
<code>bool TimedOut();</code>  // 检查是否超时</li>
<li>
<code>size_t execPerSec();</code>  // 计算每秒执行的次数</li>
<li>
<code>size_t getTotalNumberOfRuns();</code>  // 获取总执行次数</li>
</ul>
</li>
<li>
<p><strong>静态回调函数（Static Callback Functions）：</strong></p>
<ul>
<li><code>static void StaticAlarmCallback();</code></li>
<li><code>static void StaticCrashSignalCallback();</code></li>
<li><code>static void StaticExitCallback();</code></li>
<li><code>static void StaticInterruptCallback();</code></li>
<li><code>static void StaticFileSizeExceedCallback();</code></li>
<li><code>static void StaticGracefulExitCallback();</code></li>
</ul>
</li>
<li>
<p><strong>其他功能函数：</strong></p>
<ul>
<li>
<code>void ExecuteCallback(const uint8_t *Data, size_t Size);</code>  // 执行用户回调</li>
<li>
<code>bool RunOne(const uint8_t *Data, size_t Size, bool MayDeleteFile = false, InputInfo *II = nullptr, bool *FoundUniqFeatures = nullptr);</code>  // 运行一次模糊测试</li>
<li>
<code>void Merge(const Vector&lt;std::string&gt; &amp;Corpora);</code>  // 合并语料库</li>
<li>
<code>void CrashResistantMergeInternalStep(const std::string &amp;ControlFilePath);</code>  // 崩溃情况下的内部合并步骤</li>
<li>
<code>MutationDispatcher &amp;GetMD();</code>  // 获取变异调度器</li>
<li>
<code>void PrintFinalStats();</code>  // 打印最终统计信息</li>
<li>
<code>void SetMaxInputLen(size_t MaxInputLen);</code>  // 设置最大输入长度</li>
<li>
<code>void SetMaxMutationLen(size_t MaxMutationLen);</code>  // 设置最大变异长度</li>
<li>
<code>void RssLimitCallback();</code>  // 内存使用限制的回调</li>
<li>
<code>bool InFuzzingThread() const;</code>  // 检查是否在模糊测试线程中</li>
<li>
<code>size_t GetCurrentUnitInFuzzingThead(const uint8_t **Data) const;</code>  // 获取模糊测试线程中的当前单元数据</li>
<li>
<code>void TryDetectingAMemoryLeak(const uint8_t *Data, size_t Size, bool DuringInitialCorpusExecution);</code>  // 尝试检测内存泄漏</li>
<li>
<code>void HandleMalloc(size_t Size);</code>  // 处理内存分配操作</li>
<li>
<code>static void MaybeExitGracefully();</code>  // 可能会优雅退出程序</li>
<li>
<code>std::string WriteToOutputCorpus(const Unit &amp;U);</code>  // 将单元写入输出语料库</li>
</ul>
</li>
</ul>
<h4 data-content="1" id="ec97b124b814676d142f57274b9c5c48">3. <strong>私有成员函数（Private Member Functions）</strong>
</h4>
<ul>
<li>
<code>void AlarmCallback();</code>  // 闹钟信号的回调</li>
<li>
<code>void CrashCallback();</code>  // 崩溃信号的回调</li>
<li>
<code>void ExitCallback();</code>  // 程序退出的回调</li>
<li>
<code>void CrashOnOverwrittenData();</code>  // 数据被覆盖时崩溃的回调</li>
<li>
<code>void InterruptCallback();</code>  // 中断信号的回调</li>
<li>
<code>void MutateAndTestOne();</code>  // 变异并测试一个单元</li>
<li>
<code>void PurgeAllocator();</code>  // 清理内存分配器</li>
<li>
<code>void ReportNewCoverage(InputInfo *II, const Unit &amp;U);</code>  // 报告新覆盖率</li>
<li>
<code>void PrintPulseAndReportSlowInput(const uint8_t *Data, size_t Size);</code>  // 打印状态并报告慢速输入</li>
<li>
<code>void WriteUnitToFileWithPrefix(const Unit &amp;U, const char *Prefix);</code>  // 使用前缀将单元写入文件</li>
<li>
<code>void PrintStats(const char *Where, const char *End = "\n", size_t Units = 0, size_t Features = 0);</code>  // 打印统计信息</li>
<li>
<code>void PrintStatusForNewUnit(const Unit &amp;U, const char *Text);</code>  // 打印新单元的状态信息</li>
<li>
<code>void CheckExitOnSrcPosOrItem();</code>  // 检查是否需要退出</li>
<li>
<code>static void StaticDeathCallback();</code>  // 处理死亡信号的回调</li>
<li>
<code>void DumpCurrentUnit(const char *Prefix);</code>  // 转储当前单元数据</li>
<li>
<code>void DeathCallback();</code>  // 死亡信号的回调</li>
<li>
<code>void AllocateCurrentUnitData();</code>  // 分配当前单元数据</li>
</ul>
<h4 data-content="1" id="16a6d04abf22ad6d7f1ade0159064040">4. <strong>私有成员变量（Private Member Variables）</strong>
</h4>
<ul>
<li>
<code>uint8_t *CurrentUnitData = nullptr;</code>  // 当前单元数据指针</li>
<li>
<code>std::atomic&lt;size_t&gt; CurrentUnitSize;</code>  // 当前单元大小（原子变量）</li>
<li>
<code>uint8_t BaseSha1[kSHA1NumBytes];</code>  // 基本单元的SHA1校验和</li>
<li>
<code>bool GracefulExitRequested = false;</code>  // 是否请求优雅退出</li>
<li>
<code>size_t TotalNumberOfRuns = 0;</code>  // 总执行次数</li>
<li>
<code>size_t NumberOfNewUnitsAdded = 0;</code>  // 新单元的数量</li>
<li>
<code>size_t LastCorpusUpdateRun = 0;</code>  // 上次语料库更新的运行次数</li>
<li>
<code>bool HasMoreMallocsThanFrees = false;</code>  // 是否有比释放更多的内存分配操作</li>
<li>
<code>size_t NumberOfLeakDetectionAttempts = 0;</code>  // 检测内存泄漏的尝试次数</li>
<li>
<code>system_clock::time_point LastAllocatorPurgeAttemptTime = system_clock::now();</code>  // 上次内存分配器清理的时间点</li>
<li>
<code>UserCallback CB;</code>  // 用户回调函数</li>
<li>
<code>InputCorpus &amp;Corpus;</code>  // 输入语料库的引用</li>
<li>
<code>MutationDispatcher &amp;MD;</code>  // 变异调度器的引用</li>
<li>
<code>FuzzingOptions Options;</code>  // 模糊测试选项</li>
<li>
<code>DataFlowTrace DFT;</code>  // 数据流跟踪对象</li>
<li>
<code>system_clock::time_point ProcessStartTime = system_clock::now();</code>  // 进程启动时间</li>
<li>
<code>system_clock::time_point UnitStartTime;</code>  // 当前单元开始时间</li>
<li>
<code>system_clock::time_point UnitStopTime;</code>  // 当前单元结束时间</li>
<li>
<code>long TimeOfLongestUnitInSeconds = 0;</code>  // 最长单元执行时间（秒）</li>
<li>
<code>long EpochOfLastReadOfOutputCorpus = 0;</code>  // 最后读取输出语料库的时间</li>
<li>
<code>size_t MaxInputLen = 0;</code>  // 最大输入长度</li>
<li>
<code>size_t MaxMutationLen = 0;</code>  // 最大变异长度</li>
<li>
<code>size_t TmpMaxMutationLen = 0;</code>  // 临时最大变异长度</li>
<li>
<code>Vector&lt;uint32_t&gt; UniqFeatureSetTmp;</code>  // 唯一特征集的临时存储</li>
<li>
<code>static thread_local bool IsMyThread;</code>  // 用于标识当前线程是否是模糊测试线程</li>
</ul>
<p>这个类主要涉及模糊测试的核心功能，包括种子语料库的处理、崩溃管理、变异调度、统计信息打印等多个方面。</p>
<h3 data-content="1" id="65c0bf0397ac0ec0da78a56476156559">libFuzzer的核心运行流程</h3>
<p>Libfuzzer源码学习项目:<a href="https://github.com/Dor1s/libfuzzer-workshop" target="_blank">Dor1s/libfuzzer-workshop: Repository for materials of "Modern fuzzing of C/C++ Projects" workshop. (github.com)</a><br/>
libfuzzer最新源码位置:<a href="https://github.com/llvm/llvm-project/tree/main/compiler-rt/lib/fuzzer" target="_blank">llvm-project/compiler-rt/lib/fuzzer at main · llvm/llvm-project (github.com)</a><br/>
源码讲解:<a href="https://www.bilibili.com/video/BV1RH4y1r74p/?spm_id_from=333.788" target="_blank">https://www.bilibili.com/video/BV1RH4y1r74p/?spm_id_from=333.788</a></p>
<p>libFuzzer 是 LLVM 项目中的一部分，专门用于通过模糊测试来自动化测试 C/C++ 项目中的漏洞。其核心流程大致分为以下几个步骤：</p>
<h4 data-content="1" id="5a377a2ab1acf836a3a3fafa31c5bc99">1. <strong>主函数入口 (<code>FuzzerMain.cpp</code>)</strong>：</h4>
<p>主函数入口代码如下：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"FuzzerDefs.h"</span><span class="cp"></span>

<span class="k">extern</span> <span class="s">"C"</span> <span class="p">{</span>
<span class="c1">// 该函数由用户定义，用于测试目标函数</span>
<span class="kt">int</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">Data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">Size</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// extern "C"</span>

<span class="n">ATTRIBUTE_INTERFACE</span> <span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">fuzzer</span><span class="o">::</span><span class="n">FuzzerDriver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">,</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>在这个主函数中，调用了 <code>fuzzer::FuzzerDriver</code> 函数，并传入了用户定义的 <code>LLVMFuzzerTestOneInput</code> 函数。<code>LLVMFuzzerTestOneInput</code> 是由用户编写的，用于定义模糊测试的目标函数，它接收输入数据进行测试并返回测试结果。<code>FuzzerDriver</code> 函数则负责模糊测试的核心逻辑。</p>
<h4 data-content="1" id="b27eea0a92b7425780750e90bfd53f78">2. <strong>进入核心函数 <code>FuzzerDriver</code> (<code>FuzzerDriver.cpp</code>)</strong>：</h4>
<p><code>FuzzerDriver</code> 是 libFuzzer 的核心函数，它的主要作用是设置和启动模糊测试。函数签名如下：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">FuzzerDriver</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">***</span><span class="n">argv</span><span class="p">,</span> <span class="n">UserCallback</span> <span class="n">Callback</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 进行对象初始化</span>
  <span class="k">auto</span> <span class="o">*</span><span class="n">MD</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MutationDispatcher</span><span class="p">(</span><span class="n">Rand</span><span class="p">,</span> <span class="n">Options</span><span class="p">);</span>
  <span class="k">auto</span> <span class="o">*</span><span class="n">Corpus</span> <span class="o">=</span> <span class="n">new</span> <span class="n">InputCorpus</span><span class="p">(</span><span class="n">Options</span><span class="p">.</span><span class="n">OutputCorpus</span><span class="p">);</span>
  <span class="k">auto</span> <span class="o">*</span><span class="n">F</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Fuzzer</span><span class="p">(</span><span class="n">Callback</span><span class="p">,</span> <span class="o">*</span><span class="n">Corpus</span><span class="p">,</span> <span class="o">*</span><span class="n">MD</span><span class="p">,</span> <span class="n">Options</span><span class="p">);</span>

<span class="c1">// 解析命令选项</span>
<span class="p">...</span>

<span class="c1">// 读取并处理输入的语料库文件，传入模糊测试主循环</span>
  <span class="k">auto</span> <span class="n">CorporaFiles</span> <span class="o">=</span> <span class="n">ReadCorpora</span><span class="p">(</span><span class="o">*</span><span class="n">Inputs</span><span class="p">,</span> <span class="n">ParseSeedInuts</span><span class="p">(</span><span class="n">Flags</span><span class="p">.</span><span class="n">seed_inputs</span><span class="p">));</span>
  <span class="n">F</span><span class="o">-&gt;</span><span class="n">Loop</span><span class="p">(</span><span class="n">CorporaFiles</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>
<p>核心步骤包括：</p>
<ul>
<li>
<strong>对象初始化</strong>：创建并初始化负责输入变异的 <code>MutationDispatcher</code>、输入语料库 <code>InputCorpus</code> 以及核心 <code>Fuzzer</code> 对象。<ul>
<li>
<code>MutationDispatcher</code>：负责生成新的输入变异，目的是探索更多可能的代码路径。</li>
<li>
<code>InputCorpus</code>：管理模糊测试所使用的输入数据集合（语料库）。</li>
<li>
<code>Fuzzer</code>：负责执行具体的模糊测试流程，调用用户定义的 <code>LLVMFuzzerTestOneInput</code>。</li>
</ul>
</li>
<li>
<strong>解析命令行选项</strong>：处理用户通过命令行传递的选项，包括模糊测试的各种配置参数。</li>
<li>
<strong>处理语料库</strong>：通过 <code>ReadCorpora</code> 函数从输入文件中读取语料库文件，并调用 <code>Fuzzer::Loop</code> 函数启动模糊测试的主循环。</li>
</ul>
</li>
<li>
<p><strong>主循环 (Fuzzer::Loop)</strong>：<br/>
<code>Loop</code> 是 libFuzzer 中用于执行模糊测试的核心循环。它会不断从语料库中提取输入数据，进行输入变异，并将变异后的输入传递给 <code>LLVMFuzzerTestOneInput</code> 进行测试。循环的目的是通过广泛探索输入空间，发现导致程序崩溃或行为异常的输入，从而发现潜在的漏洞。</p>
</li>
<li>
<strong>变异引擎</strong>：<br/>
<code>MutationDispatcher</code> 是 libFuzzer 的变异引擎，它会生成各种输入数据变种，覆盖尽可能多的代码路径。变异策略包括：<ul>
<li>位变异、字节翻转</li>
<li>随机插入或删除数据</li>
<li>拼接不同输入的部分<br/>
通过不断生成新的变种，libFuzzer 可以更深入地挖掘目标程序中的代码路径，进而发现隐藏的错误或漏洞。</li>
</ul>
</li>
<li>
<strong>测试结果收集</strong>：<br/>
  每次输入变异后，libFuzzer 会将结果反馈给 <code>Fuzzer</code> 对象，判断程序是否崩溃或异常。出现崩溃时，libFuzzer 会记录触发崩溃的输入，并终止循环进行进一步分析。</li>
</ul>
<h1 data-content="1" id="7d400cf60d667653734dbafa7cced87c">libFuzzer源码编译环境与使用</h1>
<h2 data-content="1" id="dc1cd892578ed1c1f8d31c354dd81cf4">源码安装 Clang</h2>
<p>更多版本:<a href="https://github.com/llvm/llvm-project/releases/tag/llvmorg-18.1.8" target="_blank">Release LLVM 18.1.8 · llvm/llvm-project (github.com)</a><br/>
libFuzzer的源码根据需要下载对应版本进行源码编译。</p>
<p>一键配置clang脚本:，该脚本在Ubuntu20上成功测试运行过：</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># 安装 Clang 的依赖</span>
sudo apt-get --yes install curl subversion screen gcc g++ cmake ninja-build golang autoconf libtool apache2 python-dev pkg-config zlib1g-dev libgcrypt20-dev libgss-dev libssl-dev libxml2-dev ragel nasm libarchive-dev make automake libdbus-1-dev libboost-dev autoconf-archive libtinfo5

<span class="c1"># 定义 Clang 的版本和下载链接</span>
<span class="nv">CLANG_VERSION</span><span class="o">=</span><span class="s2">"18.1.8"</span>
<span class="nv">CLANG_TAR</span><span class="o">=</span><span class="s2">"clang+llvm-</span><span class="si">${</span><span class="nv">CLANG_VERSION</span><span class="si">}</span><span class="s2">-x86_64-linux-gnu-ubuntu-18.04.tar.xz"</span>
<span class="nv">CLANG_URL</span><span class="o">=</span><span class="s2">"https://github.com/llvm/llvm-project/releases/download/llvmorg-</span><span class="si">${</span><span class="nv">CLANG_VERSION</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">CLANG_TAR</span><span class="si">}</span><span class="s2">"</span>
<span class="nv">CLANG_INSTALL_DIR</span><span class="o">=</span><span class="s2">"/usr/local/clang-</span><span class="si">${</span><span class="nv">CLANG_VERSION</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># 检查 Clang 是否已下载</span>
<span class="k">if</span> <span class="o">[</span> -f <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_TAR</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"Clang 已经下载 (</span><span class="si">${</span><span class="nv">CLANG_TAR</span><span class="si">}</span><span class="s2">)"</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">"正在下载 Clang..."</span>
    wget <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_URL</span><span class="si">}</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c1"># 检查 Clang 是否已安装</span>
<span class="k">if</span> <span class="o">[</span> -d <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"Clang 已经安装在 </span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">"</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">"正在安装 Clang..."</span>

    <span class="c1"># 创建目录</span>
    sudo mkdir -p <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">"</span>

    <span class="nb">echo</span> <span class="s2">"正在安装 解压时间比较久..."</span>
    <span class="c1"># 解压 Clang</span>
    sudo tar -xf <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_TAR</span><span class="si">}</span><span class="s2">"</span> -C <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">"</span> --strip-components<span class="o">=</span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># 检查环境变量是否已经设置</span>
<span class="k">if</span> ! grep -q <span class="s2">"</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">/bin"</span> ~/.bashrc<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"添加环境变量..."</span>
    <span class="nb">echo</span> <span class="s2">"export PATH=</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">/bin:\$PATH"</span> &gt;&gt; ~/.bashrc
    <span class="nb">echo</span> <span class="s2">"export LD_LIBRARY_PATH=</span><span class="si">${</span><span class="nv">CLANG_INSTALL_DIR</span><span class="si">}</span><span class="s2">/lib:\$LD_LIBRARY_PATH"</span> &gt;&gt; ~/.bashrc

    <span class="c1"># 使环境变量生效</span>
    <span class="nb">source</span> ~/.bashrc
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">"环境变量已经配置"</span>
<span class="k">fi</span>

<span class="c1"># 运行 Clang 验证安装</span>
<span class="nb">echo</span> <span class="s2">"验证 Clang 安装..."</span>
clang --version
<span class="nb">echo</span> <span class="s2">"如果验证失败再次运行该命令: source ~/.bashrc"</span>
</pre></div>
<h2 data-content="1" id="7fe4aecccec19c97d68b5b204ae6dceb">libFuzzer与覆盖率有关的命令行使用</h2>
<h3 data-content="1" id="2a63e3fabbbb8f97ef0113e571b17ce3">libfuzzer与覆盖率有关的命令行</h3>
<p>与覆盖率相关的选项如下：</p>
<div class="highlight"><pre><span></span><span class="c1">// 是否打印新覆盖的 PC 地址</span>
<span class="n">Options</span><span class="p">.</span><span class="n">PrintNewCovPcs</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">print_pcs</span><span class="p">;</span>

<span class="c1">// 是否打印新覆盖的函数</span>
<span class="n">Options</span><span class="p">.</span><span class="n">PrintNewCovFuncs</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">print_funcs</span><span class="p">;</span>

<span class="c1">// 是否打印覆盖率信息</span>
<span class="n">Options</span><span class="p">.</span><span class="n">PrintCoverage</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">print_coverage</span><span class="p">;</span>

<span class="c1">// 是否打印完整的覆盖率信息</span>
<span class="n">Options</span><span class="p">.</span><span class="n">PrintFullCoverage</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">print_full_coverage</span><span class="p">;</span>
</pre></div>
<p>以下是与覆盖率相关的选项的使用方法和案例说明：</p>
<h4 data-content="1" id="7dff7223a00089abdfa5a757442499b4">1. <strong><code>Options.PrintNewCovPcs = Flags.print_pcs</code></strong>
</h4>
<ul>
<li>
<strong>功能</strong>: 打印新的覆盖 PC（程序计数器）地址。</li>
<li>
<strong>使用方法</strong>: 当你希望在测试过程中显示每次新发现的代码路径（对应的 PC 地址）时，可以启用此选项。</li>
<li>
<strong>命令行示例</strong>:</li>
</ul>
<div class="highlight"><pre><span></span>./woff2-2016-05-06-fsanitize_fuzzer -print_pcs<span class="o">=</span><span class="m">1</span>
</pre></div>
<ul>
<li>
<strong>案例输出</strong>:</li>
</ul>
<pre><code>INFO: Running with entropic power schedule (0xFF, 100).
INFO: Seed: 2544448443
INFO: Loaded 1 modules   (10708 inline 8-bit counters): 10708 [0x562f5c3345c0, 0x562f5c336f94),
INFO: Loaded 1 PC tables (10708 PCs): 10708 [0x562f5c336f98,0x562f5c360cd8),
INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes
INFO: A corpus is not provided, starting from an empty corpus
#2  INITED cov: 15 ft: 16 corp: 1/1b exec/s: 0 rss: 32Mb
    NEW_PC: 0x562f5c220771 in ReadWOFF2Header /home/ub20/FTS/woff/SRC/src/woff2_dec.cc:987:7
#21 NEW    cov: 16 ft: 17 corp: 2/5b lim: 4 exec/s: 0 rss: 33Mb L: 4/4 MS: 4 CrossOver-InsertByte-ChangeBit-CopyPart-
    NEW_PC: 0x562f5c2161a8 in ReadU32 /home/ub20/FTS/woff/SRC/src/./buffer.h:127:9
#999    NEW    cov: 17 ft: 18 corp: 3/9b lim: 11 exec/s: 0 rss: 34Mb L: 4/4 MS: 3 ChangeByte-ShuffleBytes-CMP- DE: "wOF2"-
    NEW_PC: 0x562f5c22077c in ReadU32 /home/ub20/FTS/woff/SRC/src/./buffer.h:127:9
#1300   NEW    cov: 18 ft: 19 corp: 4/17b lim: 11 exec/s: 0 rss: 34Mb L: 8/8 MS: 1 PersAutoDict- DE: "wOF2"-
    NEW_PC: 0x562f5c22103f in ReadWOFF2Header /home/ub20/FTS/woff/SRC/src/woff2_dec.cc:995:7
#1618   NEW    cov: 19 ft: 20 corp: 5/29b lim: 14 exec/s: 0 rss: 34Mb L: 12/12 MS: 3 InsertRepeatedBytes-PersAutoDict-InsertRepeatedBytes- DE: "wOF2"-</code></pre>
<h4 data-content="1" id="87182b92022fa4fd694ffafddcad261c">2. <strong><code>Options.PrintNewCovFuncs = Flags.print_funcs</code></strong>
</h4>
<ul>
<li>
<strong>功能</strong>: 打印新覆盖的函数。</li>
<li>
<strong>使用方法</strong>: 当你想知道每次新发现的函数覆盖时，可以启用此选项。</li>
<li>
<strong>命令行示例</strong>:<div class="highlight"><pre><span></span>./woff2-2016-05-06-fsanitize_fuzzer -print_funcs<span class="o">=</span><span class="m">1</span>
</pre></div>
</li>
<li>
<strong>案例输出</strong>:
<pre><code>ub20@ub20:~/FTS/woff$ ./woff2-2016-05-06-fsanitize_fuzzer -print_funcs=1
INFO: Running with entropic power schedule (0xFF, 100).
INFO: Seed: 2688967800
INFO: Loaded 1 modules   (10708 inline 8-bit counters): 10708 [0x55b819abf5c0, 0x55b819ac1f94), 
INFO: Loaded 1 PC tables (10708 PCs): 10708 [0x55b819ac1f98,0x55b819aebcd8), 
INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes
INFO: A corpus is not provided, starting from an empty corpus
#2  INITED cov: 15 ft: 16 corp: 1/1b exec/s: 0 rss: 32Mb
#10 NEW    cov: 16 ft: 17 corp: 2/5b lim: 4 exec/s: 0 rss: 32Mb L: 4/4 MS: 3 CrossOver-InsertByte-CrossOver-
...
#144927 NEW    cov: 29 ft: 30 corp: 14/437b lim: 1390 exec/s: 48309 rss: 47Mb L: 119/119 MS: 1 PersAutoDict- DE: "\012\000\000\000\000\000\000\000"-
NEW_FUNC[1/1]: 0x55b8199a0050 in woff2::ReadBase128(woff2::Buffer*, unsigned int*) /home/ub20/FTS/woff/SRC/src/variable_length.cc:94
...</code></pre>
</li>
</ul>
<h4 data-content="1" id="dcc4e83f9e3b47c026f2c9bdf5789fef">3. <strong><code>Options.PrintCoverage = Flags.print_coverage</code></strong>
</h4>
<ul>
<li>
<strong>功能</strong>: 打印覆盖率信息。</li>
<li>
<strong>使用方法</strong>: 启用此选项可以在 fuzzing 过程中定期打印当前的覆盖率统计信息。</li>
<li>
<strong>命令行示例</strong>:<div class="highlight"><pre><span></span>./openssl-1.0.1f-fsanitize_fuzzer -print_coverage<span class="o">=</span><span class="m">1</span>
</pre></div>
</li>
<li>
<strong>案例输出</strong>:
<pre><code>UNCOVERED_FUNC: hits: 0 edges: 0/5 Init() /home/ub20/FTS/openssl-1.0.1f/target.cc:9
COVERED_FUNC: hits: 42 edges: 2/5 LLVMFuzzerTestOneInput /home/ub20/FTS/openssl-1.0.1f/target.cc:26
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f/target.cc:27
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f/target.cc:27
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f/target.cc:0
COVERED_FUNC: hits: 42 edges: 19/34 ssleay_rand_add /home/ub20/FTS/openssl-1.0.1f_crash/BUILD/crypto/rand/md_rand.c:194
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f_crash/BUILD/crypto/rand/md_rand.c:228
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f_crash/BUILD/crypto/rand/md_rand.c:228
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f_crash/BUILD/crypto/rand/md_rand.c:249
...
UNCOVERED_PC: /home/ub20/FTS/openssl-1.0.1f_crash/BUILD/crypto/rand/md_rand.c:322</code></pre>
</li>
</ul>
<h4 data-content="1" id="9ab1da230747a7bcdc20c11fbc43d51f">4. <strong><code>Options.PrintFullCoverage = Flags.print_full_coverage</code></strong>
</h4>
<ul>
<li>
<strong>功能</strong>: 打印完整的覆盖率信息。</li>
<li>
<strong>使用方法</strong>: 启用此选项时，程序会在结束时输出完整的覆盖率报告，详细列出所有覆盖到的代码。</li>
<li>
<p><strong>命令行示例</strong>:</p>
<div class="highlight"><pre><span></span>./woff2-2016-05-06-fsanitize_fuzzer -print_full_coverage<span class="o">=</span><span class="m">1</span>
</pre></div>
</li>
<li>
<p><strong>案例输出</strong>:</p>
<div class="highlight"><pre><span></span><span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">$</span> <span class="p">./</span><span class="n">woff2</span><span class="p">-</span><span class="mi">2016</span><span class="p">-</span><span class="mo">05</span><span class="p">-</span><span class="mo">06</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span> <span class="p">-</span><span class="n">print_coverage</span><span class="p">=</span><span class="mi">1</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Running</span> <span class="k">with</span> <span class="n">entropic</span> <span class="n">power</span> <span class="n">schedule</span> <span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Seed</span><span class="p">:</span> <span class="mi">3116423339</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Loaded</span> <span class="mi">1</span> <span class="n">modules</span>   <span class="p">(</span><span class="mi">10708</span> <span class="n">inline</span> <span class="mi">8</span><span class="p">-</span><span class="n">bit</span> <span class="n">counters</span><span class="p">):</span> <span class="mi">10708</span> <span class="p">[</span><span class="mh">0x5652816785c0</span><span class="p">,</span> <span class="mh">0x56528167af94</span><span class="p">),</span> 
<span class="n">INFO</span><span class="p">:</span> <span class="n">Loaded</span> <span class="mi">1</span> <span class="n">PC</span> <span class="n">tables</span> <span class="p">(</span><span class="mi">10708</span> <span class="n">PCs</span><span class="p">):</span> <span class="mi">10708</span> <span class="p">[</span><span class="mh">0x56528167af98</span><span class="p">,</span><span class="mh">0x5652816a4cd8</span><span class="p">),</span> 
<span class="n">INFO</span><span class="p">:</span> <span class="p">-</span><span class="n">max_len</span> <span class="k">is</span> <span class="n">not</span> <span class="n">provided</span><span class="p">;</span> <span class="n">libFuzzer</span> <span class="n">will</span> <span class="n">not</span> <span class="n">generate</span> <span class="n">inputs</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">4096</span> <span class="n">bytes</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">A</span> <span class="n">corpus</span> <span class="k">is</span> <span class="n">not</span> <span class="n">provided</span><span class="p">,</span> <span class="n">starting</span> <span class="n">from</span> <span class="n">an</span> <span class="n">empty</span> <span class="n">corpus</span>
<span class="err">#</span><span class="mi">2</span>  <span class="n">INITED</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">15</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">16</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">1</span><span class="p">/</span><span class="mi">1</span><span class="n">b</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">32</span><span class="n">Mb</span>
<span class="err">#</span><span class="mi">27</span> <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">16</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">17</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">2</span><span class="p">/</span><span class="mi">5</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">4</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">33</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">4</span><span class="p">/</span><span class="mi">4</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">5</span> <span class="n">ChangeBit</span><span class="p">-</span><span class="n">ChangeBit</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span><span class="n">CopyPart</span><span class="p">-</span><span class="n">CopyPart</span><span class="p">-</span>
<span class="err">#</span><span class="mi">433</span>    <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">17</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">18</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">3</span><span class="p">/</span><span class="mi">10</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">6</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">33</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">5</span><span class="p">/</span><span class="mi">5</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">CMP</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"wOF2"</span><span class="p">-</span>
<span class="err">#</span><span class="mi">636</span>    <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">17</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">18</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">3</span><span class="p">/</span><span class="mi">9</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">6</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">33</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">4</span><span class="p">/</span><span class="mi">4</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">3</span> <span class="n">ShuffleBytes</span><span class="p">-</span><span class="n">ChangeBit</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span>
<span class="err">#</span><span class="mi">884</span>    <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">18</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">19</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">4</span><span class="p">/</span><span class="mi">17</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">8</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">34</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">8</span><span class="p">/</span><span class="mi">8</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">3</span> <span class="n">InsertRepeatedBytes</span><span class="p">-</span><span class="n">ChangeByte</span><span class="p">-</span><span class="n">PersAutoDict</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"wOF2"</span><span class="p">-</span>
<span class="err">#</span><span class="mi">1635</span>   <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">19</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">20</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">5</span><span class="p">/</span><span class="mi">29</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">14</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">34</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">12</span><span class="p">/</span><span class="mi">12</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">CrossOver</span><span class="p">-</span>
<span class="err">#</span><span class="mi">3505</span>   <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">20</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">21</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">6</span><span class="p">/</span><span class="mi">58</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">29</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">35</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">29</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">5</span> <span class="n">PersAutoDict</span><span class="p">-</span><span class="n">CrossOver</span><span class="p">-</span><span class="n">InsertRepeatedBytes</span><span class="p">-</span><span class="n">ChangeByte</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"wOF2"</span><span class="p">-</span>
<span class="err">#</span><span class="mi">4629</span>   <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">21</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">22</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">7</span><span class="p">/</span><span class="mi">87</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">38</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">35</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">29</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">4</span> <span class="n">ChangeBit</span><span class="p">-</span><span class="n">CopyPart</span><span class="p">-</span><span class="n">ShuffleBytes</span><span class="p">-</span><span class="n">ChangeBit</span><span class="p">-</span>
<span class="err">#</span><span class="mi">9279</span>   <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">21</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">22</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">7</span><span class="p">/</span><span class="mi">72</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">80</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">35</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">14</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">5</span> <span class="n">EraseBytes</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span><span class="n">ChangeBit</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span>
<span class="err">#</span><span class="mi">9535</span>   <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">22</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">23</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">8</span><span class="p">/</span><span class="mi">86</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">80</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">35</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">14</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">ChangeByte</span><span class="p">-</span>
<span class="err">#</span><span class="mi">27928</span>  <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">23</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">24</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">9</span><span class="p">/</span><span class="mi">99</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">261</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">37</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">13</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">3</span> <span class="n">ChangeBit</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span>
<span class="err">#</span><span class="mi">31817</span>  <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">24</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">25</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">10</span><span class="p">/</span><span class="mi">120</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">293</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">37</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">21</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">4</span> <span class="n">ChangeBit</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span><span class="n">ChangeBit</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span>
<span class="err">#</span><span class="mi">40024</span>  <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">24</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">25</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">10</span><span class="p">/</span><span class="mi">119</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">373</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">38</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">12</span><span class="p">/</span><span class="mi">29</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">2</span> <span class="n">EraseBytes</span><span class="p">-</span><span class="n">CMP</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"\001\000\000\000\000\000\000\014"</span><span class="p">-</span>
<span class="err">#</span><span class="mi">42588</span>  <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">25</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">26</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">11</span><span class="p">/</span><span class="mi">155</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">397</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">38</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">36</span><span class="p">/</span><span class="mi">36</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">4</span> <span class="n">CrossOver</span><span class="p">-</span><span class="n">CopyPart</span><span class="p">-</span><span class="n">InsertByte</span><span class="p">-</span><span class="n">ChangeBinInt</span><span class="p">-</span>
<span class="p">^</span><span class="n">C</span><span class="p">==</span><span class="mi">12029</span><span class="p">==</span> <span class="n">libFuzzer</span><span class="p">:</span> <span class="n">run</span> <span class="n">interrupted</span><span class="p">;</span> <span class="n">exiting</span>
<span class="n">COVERAGE</span><span class="p">:</span>
<span class="n">UNCOVERED_FUNC</span><span class="p">:</span> <span class="n">hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">edges</span><span class="p">:</span> <span class="mi">0</span><span class="p">/</span><span class="mi">19</span> <span class="n">brotli</span><span class="p">::</span><span class="n">ZopfliCreateCommands</span><span class="p">(</span><span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="p">&lt;</span><span class="n">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">allocator</span><span class="p">&lt;</span><span class="n">unsigned</span> <span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="k">const</span><span class="p">&amp;,</span> <span class="n">brotli</span><span class="p">::</span><span class="n">ZopfliNode</span> <span class="k">const</span><span class="p">*,</span> <span class="kt">int</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">*,</span> <span class="n">brotli</span><span class="p">::</span><span class="n">Command</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">*)</span> <span class="p">/</span><span class="n">home</span><span class="p">/</span><span class="n">ub20</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">/</span><span class="n">BROTLI</span><span class="p">/</span><span class="n">enc</span><span class="p">/</span><span class="n">backward_references</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">437</span>
<span class="n">UNCOVERED_FUNC</span><span class="p">:</span> <span class="n">hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">edges</span><span class="p">:</span> <span class="mi">0</span><span class="p">/</span><span class="mi">18</span> <span class="n">brotli</span><span class="p">::</span><span class="n">Command</span><span class="p">::</span><span class="n">Command</span><span class="p">(</span><span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="p">/</span><span class="n">home</span><span class="p">/</span><span class="n">ub20</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">/</span><span class="n">BROTLI</span><span class="p">/</span><span class="n">enc</span><span class="p">/././</span><span class="n">command</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">102</span>
<span class="n">UNCOVERED_FUNC</span><span class="p">:</span> <span class="n">hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">edges</span><span class="p">:</span> <span class="mi">0</span><span class="p">/</span><span class="mi">31</span> <span class="n">brotli</span><span class="p">::</span><span class="n">ZopfliComputeShortestPath</span><span class="p">(</span><span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">char</span> <span class="k">const</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="kt">int</span> <span class="k">const</span><span class="p">*,</span> <span class="n">brotli</span><span class="p">::</span><span class="n">HashToBinaryTree</span><span class="p">*,</span> <span class="n">brotli</span><span class="p">::</span><span class="n">ZopfliNode</span><span class="p">*,</span> <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="p">&lt;</span><span class="n">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">allocator</span><span class="p">&lt;</span><span class="n">unsigned</span> <span class="kt">int</span><span class="p">&gt;&gt;*)</span> <span class="p">/</span><span class="n">home</span><span class="p">/</span><span class="n">ub20</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">/</span><span class="n">BROTLI</span><span class="p">/</span><span class="n">enc</span><span class="p">/</span><span class="n">backward_references</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">510</span>
<span class="n">UNCOVERED_FUNC</span><span class="p">:</span> <span class="n">hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">edges</span><span class="p">:</span> <span class="mi">0</span><span class="p">/</span><span class="mi">27</span> <span class="n">brotli</span><span class="p">::</span><span class="n">ZopfliCostModel</span><span class="p">::</span><span class="n">SetFromLiteralCosts</span><span class="p">(</span><span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">char</span> <span class="k">const</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="p">/</span><span class="n">home</span><span class="p">/</span><span class="n">ub20</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">/</span><span class="n">BROTLI</span><span class="p">/</span><span class="n">enc</span><span class="p">/</span><span class="n">backward_references</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">77</span>
<span class="n">UNCOVERED_FUNC</span><span class="p">:</span> <span class="n">hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">edges</span><span class="p">:</span> <span class="mi">0</span><span class="p">/</span><span class="mi">44</span> <span class="n">brotli</span><span class="p">::</span><span class="n">HashToBinaryTree</span><span class="p">::</span><span class="n">FindAllMatches</span><span class="p">(</span><span class="n">unsigned</span> <span class="kt">char</span> <span class="k">const</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="n">brotli</span><span class="p">::</span><span class="n">BackwardMatch</span><span class="p">*)</span> <span class="p">/</span><span class="n">home</span><span class="p">/</span><span class="n">ub20</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff</span><span class="p">/</span><span class="n">BROTLI</span><span class="p">/</span><span class="n">enc</span><span class="p">/././</span><span class="n">hash</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">681</span>
<span class="p">...</span>
</pre></div>
</li>
</ul>
<h4 data-content="1" id="f37cb8f6ee71f8e636eff5802e530073">总结</h4>
<ul>
<li>
<strong><code>-print_pcs=1</code></strong>: 适用于监控每次 fuzzing 发现的新代码路径。</li>
<li>
<strong><code>-print_funcs=1</code></strong>: 适用于了解每次 fuzzing 发现的新函数覆盖。</li>
<li>
<strong><code>-print_coverage=1</code></strong>: 适用于定期检查当前覆盖率的进展情况。</li>
<li>
<strong><code>-print_full_coverage=1</code></strong>: 适用于获取 fuzzing 结束后的完整覆盖率报告。<br/>
这些选项可以帮助你更好地理解 fuzzing 的进展和覆盖的代码区域。</li>
</ul>
<h3 data-content="1" id="816bc0d721ce5e2a920394fea5e00f43">libFuzzer所有可用的命令行参数:</h3>
<p>在libfuzzer中有很多命令并未实现可以自行寻找，这是在vscode匹配命令选项的正则表达式:<code>Options\.\w+\s*=\s*Flags\.\w+</code>;</p>
<div class="highlight"><pre><span></span><span class="c1">// 设置详细程度的级别</span>
<span class="n">Options</span><span class="p">.</span><span class="n">Verbosity</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">verbosity</span><span class="p">;</span>

<span class="c1">// 设置最大输入长度</span>
<span class="n">Options</span><span class="p">.</span><span class="n">MaxLen</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">max_len</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// 是否处理 SIGINT 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleInt</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_int</span><span class="p">;</span>

<span class="c1">// 是否处理 SIGSEGV 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleSegv</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_segv</span><span class="p">;</span>

<span class="c1">// 是否处理 SIGTERM 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleTerm</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_term</span><span class="p">;</span>

<span class="c1">// 是否处理 SIGXFSZ 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleXfsz</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_xfsz</span><span class="p">;</span>

<span class="c1">// 是否处理 SIGUSR1 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleUsr1</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_usr1</span><span class="p">;</span>

<span class="c1">// 是否处理 SIGUSR2 信号</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleUsr2</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_usr2</span><span class="p">;</span>

<span class="c1">// 是否处理 Windows 异常</span>
<span class="n">Options</span><span class="p">.</span><span class="n">HandleWinExcept</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">handle_winexcept</span><span class="p">;</span>

<span class="c1">// 是否启用分叉的种子组</span>
<span class="n">Options</span><span class="p">.</span><span class="n">ForkCorpusGroups</span> <span class="p">=</span> <span class="n">Flags</span><span class="p">.</span><span class="n">fork_corpus_groups</span><span class="p">;</span>
</pre></div>
<h1 data-content="1" id="daad9dfa898764379f3db399edf176d2">libFuzzer自定义开发与编译</h1>
<p>为了满足以下二次开发需求：</p>
<ol>
<li>将模糊测试的数据导出并编写接口传递到前端页面。</li>
<li>解决 libFuzzer 无法持续性 fuzz 的问题，如遇到 crash 就停止模糊测试。<br/>
可以通过以下方式进行源码修改与编译。<br/>
## 1. 模糊测试的覆盖率接口编写<br/>
首先，修改 <code>libFuzzer/FuzzerLoop.cpp</code>，增加用于导出模糊测试过程中数据的接口。我们可以通过直接修改 libFuzzer 的覆盖率部分，创建接口来收集并输出信息。下面是覆盖率和其他统计信息的部分代码片段：</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1">// 返回总的程序计数器覆盖率（PC Coverage）</span>
<span class="kt">size_t</span> <span class="nf">GetTotalPCCoverage</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">TPC</span><span class="p">.</span><span class="n">GetTotalPCCoverage</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回发现的特征数量</span>
<span class="kt">size_t</span> <span class="nf">GetNumFeatures</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Corpus</span><span class="p">.</span><span class="n">NumFeatures</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回活跃输入的数量</span>
<span class="kt">size_t</span> <span class="nf">GetNumActiveUnits</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Corpus</span><span class="p">.</span><span class="n">NumActiveUnits</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回语料库大小（以字节为单位）</span>
<span class="kt">size_t</span> <span class="nf">GetSizeInBytes</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Corpus</span><span class="p">.</span><span class="n">SizeInBytes</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回触发重点功能（Focus Function）的输入数量</span>
<span class="kt">size_t</span> <span class="nf">GetNumInputsThatTouchFocusFunction</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Corpus</span><span class="p">.</span><span class="n">NumInputsThatTouchFocusFunction</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回每秒执行次数</span>
<span class="kt">size_t</span> <span class="nf">GetExecPerSec</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">execPerSec</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 返回临时最大变异长度</span>
<span class="kt">size_t</span> <span class="nf">GetTmpMaxMutationLen</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">TmpMaxMutationLen</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 返回峰值内存使用量（以MB为单位）</span>
<span class="kt">size_t</span> <span class="nf">GetPeakRSSMb</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">GetPeakRSSMb</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 打印模糊测试的统计信息并导出数据</span>
<span class="kt">void</span> <span class="n">Fuzzer</span><span class="o">::</span><span class="n">PrintStats</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">Where</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">End</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">Units</span><span class="p">,</span>
                        <span class="kt">size_t</span> <span class="n">Features</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">ExecPerSec</span> <span class="o">=</span> <span class="n">GetExecPerSec</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Options</span><span class="p">.</span><span class="n">Verbosity</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">Printf</span><span class="p">(</span><span class="s">"#%zd</span><span class="se">\t</span><span class="s">%s"</span><span class="p">,</span> <span class="n">TotalNumberOfRuns</span><span class="p">,</span> <span class="n">Where</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="n">GetTotalPCCoverage</span><span class="p">())</span>
        <span class="n">Printf</span><span class="p">(</span><span class="s">" cov: %zd"</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Features</span> <span class="o">?</span> <span class="nl">Features</span> <span class="p">:</span> <span class="n">GetNumFeatures</span><span class="p">())</span>
        <span class="n">Printf</span><span class="p">(</span><span class="s">" ft: %zd"</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Corpus</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">Printf</span><span class="p">(</span><span class="s">" corp: %zd"</span><span class="p">,</span> <span class="n">GetNumActiveUnits</span><span class="p">());</span>

        <span class="k">if</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="n">GetSizeInBytes</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">))</span>
                <span class="n">Printf</span><span class="p">(</span><span class="s">"/%zdb"</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">))</span>
                <span class="n">Printf</span><span class="p">(</span><span class="s">"/%zdKb"</span><span class="p">,</span> <span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="nf">Printf</span><span class="p">(</span><span class="s">"/%zdMb"</span><span class="p">,</span> <span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">FF</span> <span class="o">=</span> <span class="n">GetNumInputsThatTouchFocusFunction</span><span class="p">())</span>
            <span class="n">Printf</span><span class="p">(</span><span class="s">" focus: %zd"</span><span class="p">,</span> <span class="n">FF</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">Lim</span> <span class="o">=</span> <span class="n">GetTmpMaxMutationLen</span><span class="p">())</span>
        <span class="n">Printf</span><span class="p">(</span><span class="s">" lim: %zd"</span><span class="p">,</span> <span class="n">Lim</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Units</span><span class="p">)</span>
        <span class="n">Printf</span><span class="p">(</span><span class="s">" units: %zd"</span><span class="p">,</span> <span class="n">Units</span><span class="p">);</span>

    <span class="n">Printf</span><span class="p">(</span><span class="s">" exec/s: %zd"</span><span class="p">,</span> <span class="n">ExecPerSec</span><span class="p">);</span>
    <span class="n">Printf</span><span class="p">(</span><span class="s">" rss: %zdMb"</span><span class="p">,</span> <span class="n">GetPeakRSSMb</span><span class="p">());</span>

    <span class="c1">// 添加魔改标识</span>
    <span class="n">Printf</span><span class="p">(</span><span class="s">" [MODIFIED] Custom version of Fuzzer::PrintStats is running!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">// 输出结束符</span>
    <span class="n">Printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">End</span><span class="p">);</span>

    <span class="c1">// 可以在这里添加接口将数据传递到前端</span>
    <span class="n">ExportDataToFrontend</span><span class="p">({</span>
        <span class="p">{</span><span class="s">"TotalNumberOfRuns"</span><span class="p">,</span> <span class="n">TotalNumberOfRuns</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"PCCoverage"</span><span class="p">,</span> <span class="n">GetTotalPCCoverage</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">"NumFeatures"</span><span class="p">,</span> <span class="n">GetNumFeatures</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">"NumActiveUnits"</span><span class="p">,</span> <span class="n">GetNumActiveUnits</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">"SizeInBytes"</span><span class="p">,</span> <span class="n">GetSizeInBytes</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">"ExecPerSec"</span><span class="p">,</span> <span class="n">GetExecPerSec</span><span class="p">()},</span>
        <span class="p">{</span><span class="s">"PeakRSSMb"</span><span class="p">,</span> <span class="n">GetPeakRSSMb</span><span class="p">()}</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 示例数据导出函数，可将数据通过接口传递给前端</span>
<span class="kt">void</span> <span class="n">ExportDataToFrontend</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;&amp;</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 通过网络接口、文件、或者其他方式将数据传递到前端页面</span>
    <span class="c1">// 这里可以通过 JSON 格式将数据发送到 HTTP 服务器或 WebSocket</span>
<span class="p">}</span>
</pre></div>
<p>在 <code>Fuzzer::PrintStats</code> 函数中，我们已经将覆盖率、执行次数、内存使用情况等统计信息打印，并通过 <code>ExportDataToFrontend</code> 函数导出到外部系统，可以进一步传递到前端页面。</p>
<h2 data-content="1" id="0a4c1896a640a7236b5f8e6fc3b91044">2. 解决 libFuzzer 无法持续性 fuzz 的问题</h2>
<p>要实现 libFuzzer 的持久模糊测试，并且避免在发现 crash 后终止，可以通过修改 libFuzzer 源码来调整其行为。libFuzzer 默认行为是当检测到崩溃（如非法内存访问、堆溢出等）时终止模糊测试。为了避免这种情况，目标是允许 fuzzing 继续进行而不退出。</p>
<h3 data-content="1" id="3b6ece6e8935a711a5ee5b1b5f4ef7b4">修改思路</h3>
<ol>
<li>
<p><strong>定位崩溃处理逻辑</strong>：<br/>
libFuzzer 在检测到 crash 后会调用 <code>LLVMFuzzerTestOneInput</code>，这段代码可能会引发未处理异常，导致 fuzzing 过程终止。我们可以通过修改 libFuzzer 的 crash 处理逻辑，使其在崩溃时记录问题但继续模糊测试。</p>
</li>
<li>
<p><strong>关键代码修改点</strong>：<br/>
需要查找 libFuzzer 源码中的崩溃处理位置，一般在 <code>FuzzerLoop.cpp</code> 和 <code>FuzzerDriver.cpp</code> 文件中。</p>
<ul>
<li>
<code>FuzzerLoop.cpp</code>: 此文件控制模糊测试的主循环。在这里可以捕获崩溃异常并继续模糊测试。</li>
<li>
<code>FuzzerDriver.cpp</code>: 此文件负责驱动整个 libFuzzer 运行，崩溃检测和异常处理可能在这里发生。</li>
</ul>
</li>
<li>
<p><strong>持久化模糊测试的入口</strong>：<br/>
如果你想让模糊测试保持“持久化”，即反复利用同一测试环境进行测试，可以在 <code>FuzzerLoop.cpp</code> 中引入一个持久化模式（Persistent Mode）。这种模式会允许测试继续，而不是每次退出。</p>
</li>
</ol>
<h3 data-content="1" id="fc143b3c1af6200ad793cc8fb0731fc0">示例修改步骤</h3>
<ol>
<li>
<p><strong>实现持久化模式</strong>：<br/>
在 <code>FuzzerLoop.cpp</code> 中找到模糊测试的主要循环。将其改成持久化循环模式，像这样：</p>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 记录崩溃信息，但不终止</span>
        <span class="c1">// 继续模糊测试循环</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 如果检测到崩溃，记录日志或者保存问题</span>
        <span class="n">LogCrash</span><span class="p">();</span>
        <span class="c1">// 但不要退出程序，继续模糊测试</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</li>
<li>
<p><strong>捕获崩溃并继续测试</strong>：<br/>
修改 libFuzzer 中的 <code>FuzzerDriver.cpp</code> 文件，让崩溃不会终止程序。可以在捕获崩溃的地方加入 <code>try-catch</code> 或平台相关的异常处理机制，确保在崩溃时记录并恢复。</p>
<div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
    <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="c1">// 捕获异常，记录崩溃，不退出</span>
    <span class="n">ReportCrash</span><span class="p">();</span>
    <span class="k">continue</span><span class="p">;</span>  <span class="c1">// 继续模糊测试</span>
<span class="p">}</span>
</pre></div>
</li>
<li>
<p><strong>处理信号（Signal Handling）</strong>：<br/>
在某些情况下，libFuzzer 可能通过信号（如 SIGSEGV, SIGABRT）来处理崩溃。你可以修改信号处理函数，确保信号不会导致进程终止。</p>
<div class="highlight"><pre><span></span><span class="n">signal</span><span class="p">(</span><span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">HandleSignal</span><span class="p">);</span>
<span class="n">signal</span><span class="p">(</span><span class="n">SIGABRT</span><span class="p">,</span> <span class="n">HandleSignal</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">HandleSignal</span><span class="p">(</span><span class="kt">int</span> <span class="n">signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 捕获信号并记录信息</span>
    <span class="n">LogSignalCrash</span><span class="p">(</span><span class="n">signal</span><span class="p">);</span>
    <span class="c1">// 继续执行</span>
<span class="p">}</span>
</pre></div>
</li>
</ol>
<h3 data-content="1" id="972b400a055f57acac8609b5f4735b43">具体修改位置：</h3>
<ol>
<li>
<strong><code>libFuzzer/FuzzerLoop.cpp</code></strong>: 主模糊测试循环部分。</li>
<li>
<strong><code>libFuzzer/FuzzerDriver.cpp</code></strong>: 驱动整个模糊测试的入口。</li>
<li>
<strong>信号处理部分</strong>：如果有需要，检查是否需要在 <code>libFuzzer</code> 中添加或修改信号处理机制。<br/>
通过以上修改，可以避免在检测到崩溃时 libFuzzer 终止程序，并且实现持久模糊测试模式。如果你有特定的需求或问题，还可以进一步定制相关代码。</li>
</ol>
<h2 data-content="1" id="e8eb9af6d3f693aacb610e65afb8b9ea">3. 编译自定义的 libFuzzer</h2>
<p>编译脚本文件路径:<a href="https://github.com/llvm/llvm-project/blob/main/compiler-rt/lib/fuzzer/build.sh" target="_blank">llvm-project/compiler-rt/lib/fuzzer/build.sh at main · llvm/llvm-project (github.com)</a><br/>
在完成代码修改后，需要重新编译 libFuzzer 生成 <code>libFuzzer.a</code> 静态库。可以使用如下编译脚本：</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">LIBFUZZER_SRC_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span>
<span class="nv">CXX</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">CXX</span><span class="k">:-</span><span class="nv">clang</span><span class="si">}</span><span class="s2">"</span>
<span class="k">for</span> f in <span class="nv">$LIBFUZZER_SRC_DIR</span>/*.cpp<span class="p">;</span> <span class="k">do</span>
  <span class="nv">$CXX</span> -g -O2 -fno-omit-frame-pointer -std<span class="o">=</span>c++17 <span class="nv">$f</span> -c <span class="p">&amp;</span>
<span class="k">done</span>
<span class="nb">wait</span>
rm -f libFuzzer.a
ar r libFuzzer.a Fuzzer*.o
rm -f Fuzzer*.o
</pre></div>
<p>将修改后的源码放置到 libFuzzer 源码目录，运行该脚本编译，生成一个 <code>libFuzzer.a</code> 静态库，用于后续的模糊测试项目链接使用。</p>
<p>自定义的libFuzzer的使用方式：</p>
<div class="highlight"><pre><span></span><span class="n">clang</span><span class="p">++</span> <span class="p">-</span><span class="n">g</span> <span class="p">-</span><span class="n">O1</span> <span class="n">fuzz_target</span><span class="p">.</span><span class="n">cc</span> <span class="n">libFuzzer</span><span class="p">.</span><span class="n">a</span> <span class="p">-</span><span class="n">o</span> <span class="n">mytarget_fuzzer</span>
</pre></div>
<p>这里的libFuzzer.a是自己使用项目提供的build.sh编译出来的版本，还可以添加其他编译选项自行添加！</p>
<h1 data-content="1" id="a6da0ff36efc34abcb231c2e9502f0de">libFuzzer模糊测试运行案例</h1>
<p>教程地址:<a href="https://github.com/google/fuzzing/blob/master/tutorial/libFuzzerTutorial.md" target="_blank">fuzzing/tutorial/libFuzzerTutorial.md 在 master ·谷歌/模糊测试 (github.com)</a></p>
<h2 data-content="1" id="783f2d008388a4039084ba11a4f6ae81">案例一:长时间无crash的案例</h2>
<h5 data-content="1" id="b8436c6db0b668bddbc235c619080ea2"><strong>步骤 1：下载测试目标</strong></h5>
<div class="highlight"><pre><span></span><span class="err">#使用官方案例进行测试</span>
<span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~$</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="c1">//github.com/google/fuzzer-test-suite.git FTS</span>
<span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~$</span><span class="n">cd</span> <span class="n">FTS</span><span class="p">;</span> <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="n">woff</span><span class="p">;</span> <span class="n">cd</span> <span class="n">woff</span><span class="p">;</span>
<span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~$~/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff2</span><span class="p">-</span><span class="mi">2016</span><span class="p">-</span><span class="mo">05</span><span class="p">-</span><span class="mo">06</span><span class="p">/</span><span class="n">build</span><span class="p">.</span><span class="n">sh</span>
</pre></div>
<h5 data-content="1" id="aa855add5cf86ec4c4bda0ad4b8907fe"><strong>步骤 2：创建模糊测试目标</strong></h5>
<p>文件位置:FTS/woff2-2016-05-06/target.cc</p>
<div class="highlight"><pre><span></span><span class="c1">// Copyright 2016 Google Inc. All Rights Reserved.</span>
<span class="c1">// Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="err">#</span><span class="n">include</span> <span class="p">&lt;</span><span class="n">stddef</span><span class="p">.</span><span class="n">h</span><span class="p">&gt;</span>
<span class="err">#</span><span class="n">include</span> <span class="p">&lt;</span><span class="n">stdint</span><span class="p">.</span><span class="n">h</span><span class="p">&gt;</span>

<span class="err">#</span><span class="n">include</span> <span class="s">"woff2_dec.h"</span>

<span class="c1">// Entry point for LibFuzzer.</span>
<span class="k">extern</span> <span class="s">"C"</span> <span class="kt">int</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8_t</span><span class="p">*</span> <span class="n">data</span><span class="p">,</span> <span class="nb">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="p">::</span><span class="nb">string</span> <span class="n">buf</span><span class="p">;</span>
  <span class="n">woff2</span><span class="p">::</span><span class="n">WOFF2StringOut</span> <span class="k">out</span><span class="p">(&amp;</span><span class="n">buf</span><span class="p">);</span>
  <span class="k">out</span><span class="p">.</span><span class="n">SetMaxSize</span><span class="p">(</span><span class="mi">30</span> <span class="p">*</span> <span class="mi">1024</span> <span class="p">*</span> <span class="mi">1024</span><span class="p">);</span>
  <span class="n">woff2</span><span class="p">::</span><span class="n">ConvertWOFF2ToTTF</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="p">&amp;</span><span class="k">out</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h5 data-content="1" id="d12af1a6eae5be11f43b347bc0428890"><strong>步骤 3：编译模糊测试目标</strong></h5>
<div class="highlight"><pre><span></span><span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~/</span><span class="n">woff</span><span class="p">$</span> <span class="p">~/</span><span class="n">Fuzz</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff2</span><span class="p">-</span><span class="mi">2016</span><span class="p">-</span><span class="mo">05</span><span class="p">-</span><span class="mo">06</span><span class="p">/</span><span class="n">build</span><span class="p">.</span><span class="n">sh</span>
<span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~/</span><span class="n">woff</span><span class="p">$</span> <span class="p">~/</span><span class="n">Fuzz</span><span class="p">/</span><span class="n">FTS</span><span class="p">/</span><span class="n">woff2</span><span class="p">-</span><span class="mi">2016</span><span class="p">-</span><span class="mo">05</span><span class="p">-</span><span class="mo">06</span><span class="p">/</span><span class="n">build</span><span class="p">.</span><span class="n">sh</span>
<span class="err">正克隆到</span> <span class="err">'</span><span class="n">SRC</span><span class="err">'</span><span class="p">...</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">1150</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">24</span><span class="p">/</span><span class="mi">24</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">23</span><span class="p">/</span><span class="mi">23</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">1150</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">2</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">20</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pack</span><span class="p">-</span><span class="n">reused</span> <span class="mi">1126</span> <span class="p">(</span><span class="n">from</span> <span class="mi">1</span><span class="p">)</span>
<span class="err">接收对象中</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">1150</span><span class="p">/</span><span class="mi">1150</span><span class="p">),</span> <span class="mf">3.48</span> <span class="n">MiB</span> <span class="p">|</span> <span class="mf">6.03</span> <span class="n">MiB</span><span class="p">/</span><span class="n">s</span><span class="p">,</span> <span class="err">完成</span><span class="p">.</span>
<span class="err">处理</span> <span class="n">delta</span> <span class="err">中</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">680</span><span class="p">/</span><span class="mi">680</span><span class="p">),</span> <span class="err">完成</span><span class="p">.</span>
<span class="p">...</span>
<span class="err">#编译成功后</span>
<span class="n">ub20</span><span class="nd">@ub20</span><span class="p">:~/</span><span class="n">woff</span><span class="p">$</span> <span class="n">ls</span>
<span class="n">backward_references</span><span class="p">.</span><span class="n">o</span>  <span class="n">compress_fragment_two_pass</span><span class="p">.</span><span class="n">o</span>  <span class="n">font</span><span class="p">.</span><span class="n">o</span>          <span class="n">normalize</span><span class="p">.</span><span class="n">o</span>    <span class="n">table_tags</span><span class="p">.</span><span class="n">o</span>                       <span class="n">woff2_dec</span><span class="p">.</span><span class="n">o</span>
<span class="n">bit_reader</span><span class="p">.</span><span class="n">o</span>           <span class="n">decode</span><span class="p">.</span><span class="n">o</span>                      <span class="n">glyph</span><span class="p">.</span><span class="n">o</span>         <span class="n">seeds</span>          <span class="n">transform</span><span class="p">.</span><span class="n">o</span>                        <span class="n">woff2_enc</span><span class="p">.</span><span class="n">o</span>
<span class="n">block_splitter</span><span class="p">.</span><span class="n">o</span>       <span class="n">dictionary</span><span class="p">.</span><span class="n">o</span>                  <span class="n">histogram</span><span class="p">.</span><span class="n">o</span>     <span class="n">SRC</span>            <span class="n">utf8_util</span><span class="p">.</span><span class="n">o</span>                        <span class="n">woff2_out</span><span class="p">.</span><span class="n">o</span>
<span class="n">BROTLI</span>                 <span class="n">encode</span><span class="p">.</span><span class="n">o</span>                      <span class="n">huffman</span><span class="p">.</span><span class="n">o</span>       <span class="n">state</span><span class="p">.</span><span class="n">o</span>        <span class="n">variable_length</span><span class="p">.</span><span class="n">o</span>
<span class="n">brotli_bit_stream</span><span class="p">.</span><span class="n">o</span>    <span class="n">encode_parallel</span><span class="p">.</span><span class="n">o</span>             <span class="n">literal_cost</span><span class="p">.</span><span class="n">o</span>  <span class="n">static_dict</span><span class="p">.</span><span class="n">o</span>  <span class="n">woff2</span><span class="p">-</span><span class="mi">2016</span><span class="p">-</span><span class="mo">05</span><span class="p">-</span><span class="mo">06</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span>
<span class="n">compress_fragment</span><span class="p">.</span><span class="n">o</span>    <span class="n">entropy_encode</span><span class="p">.</span><span class="n">o</span>              <span class="n">metablock</span><span class="p">.</span><span class="n">o</span>     <span class="n">streams</span><span class="p">.</span><span class="n">o</span>      <span class="n">woff2_common</span><span class="p">.</span><span class="n">o</span>
</pre></div>
<h5 data-content="1" id="ea5efcabb7674e789cc1b58f6236f612"><strong>步骤 4：运行模糊测试</strong></h5>
<pre><code>ub20@ub20:~/woff$ ./woff2-2016-05-06-fsanitize_fuzzer
INFO: Seed: 707405402
INFO: Loaded 1 modules   (11231 inline 8-bit counters): 11231 [0x799080, 0x79bc5f), 
INFO: Loaded 1 PC tables (11231 PCs): 11231 [0x726be0,0x7529d0), 
INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes
INFO: A corpus is not provided, starting from an empty corpus
#2      INITED cov: 15 ft: 16 corp: 1/1b exec/s: 0 rss: 28Mb
#9      NEW    cov: 16 ft: 17 corp: 2/5b lim: 4 exec/s: 0 rss: 28Mb L: 4/4 MS: 2 CopyPart-CrossOver-
#3134   NEW    cov: 17 ft: 18 corp: 3/10b lim: 33 exec/s: 0 rss: 28Mb L: 5/5 MS: 5 InsertByte-ShuffleBytes-ChangeBinInt-ChangeByte-CMP- DE: "wOF2"-
....</code></pre>
<h2 data-content="1" id="6214309ef538f41a1ca192081f8a2b2b">案例二:快速有crash的案例</h2>
<h5 data-content="1" id="ed5062de553ae76305f5d5a34597fefa"><strong>步骤 1：下载测试目标</strong></h5>
<p>准备对：CVE-2014-0160 进行复现<br/>
漏洞原理：<a href="https://blog.csdn.net/qq_62803993/article/details/128765935" target="_blank">OpenSSL 心脏滴血漏洞(CVE-2014-0160)漏洞讲解（小白可懂，简单详细）-CSDN博客</a><br/>
使用github项目已经准备好的编译脚本：</p>
<div class="highlight"><pre><span></span><span class="err">#下载对应目标漏洞的</span><span class="n">fuzzer项目</span>
<span class="p">[</span><span class="n">AFL</span><span class="p">++</span> <span class="mi">570</span><span class="n">d9dc7fa7e</span><span class="p">]</span> <span class="p">/</span><span class="n">downloads</span> <span class="err">#</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="c1">//github.com/google/fuzzer-test-suite.git</span>
<span class="n">Cloning</span> <span class="n">into</span> <span class="err">'</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="err">'</span><span class="p">...</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">3521</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">26</span><span class="p">/</span><span class="mi">26</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">18</span><span class="p">/</span><span class="mi">18</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">3521</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">10</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">19</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">8</span><span class="p">),</span> <span class="n">pack</span><span class="p">-</span><span class="n">reused</span> <span class="mi">3495</span>
<span class="n">Receiving</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">3521</span><span class="p">/</span><span class="mi">3521</span><span class="p">),</span> <span class="mf">2.78</span> <span class="n">MiB</span> <span class="p">|</span> <span class="mf">3.69</span> <span class="n">MiB</span><span class="p">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Resolving</span> <span class="n">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="p">%</span> <span class="p">(</span><span class="mi">2267</span><span class="p">/</span><span class="mi">2267</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
</pre></div>
<h5 data-content="1" id="5890004d364f8d672c8f6d52cc98601e"><strong>步骤 2：创建模糊测试目标</strong></h5>
<p>创建一个包含 <code>LLVMFuzzerTestOneInput</code> 函数的模糊测试目标：<br/>
文件所在路径:fuzzer-test-suite/openssl-1.0.1f</p>
<div class="highlight"><pre><span></span><span class="c1">// Copyright 2016 Google Inc. All Rights Reserved.</span>
<span class="c1">// Licensed under the Apache License, Version 2.0 (the "License");</span>

<span class="cp">#include</span> <span class="cpf">&lt;openssl/ssl.h&gt;    // OpenSSL 库，用于 SSL/TLS 功能</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;openssl/err.h&gt;    // OpenSSL 错误处理</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;         // 断言</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;         // 定义标准整数类型</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;         // 定义标准数据类型</span><span class="cp"></span>

<span class="c1">// 初始化 OpenSSL 库并设置 SSL 上下文</span>
<span class="n">SSL_CTX</span> <span class="o">*</span><span class="nf">Init</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">SSL_library_init</span><span class="p">();</span>       <span class="c1">// 初始化 OpenSSL 库</span>
  <span class="n">SSL_load_error_strings</span><span class="p">();</span> <span class="c1">// 加载错误字符串</span>
  <span class="n">ERR_load_BIO_strings</span><span class="p">();</span>   <span class="c1">// 加载 BIO 错误字符串</span>
  <span class="n">OpenSSL_add_all_algorithms</span><span class="p">();</span> <span class="c1">// 加载所有加密算法</span>

  <span class="n">SSL_CTX</span> <span class="o">*</span><span class="n">sctx</span><span class="p">;</span>
  <span class="c1">// 创建一个新的 SSL_CTX 对象，使用 TLSv1 协议</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">sctx</span> <span class="o">=</span> <span class="n">SSL_CTX_new</span><span class="p">(</span><span class="n">TLSv1_method</span><span class="p">()));</span>
  <span class="cm">/* 使用以下命令创建这两个文件：</span>
<span class="cm">      openssl req -x509 -newkey rsa:512 -keyout server.key \</span>
<span class="cm">      -out server.pem -days 9999 -nodes -subj /CN=a/</span>
<span class="cm">  */</span>
  <span class="c1">// 加载服务器证书</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">SSL_CTX_use_certificate_file</span><span class="p">(</span><span class="n">sctx</span><span class="p">,</span> <span class="s">"runtime/server.pem"</span><span class="p">,</span>
                                      <span class="n">SSL_FILETYPE_PEM</span><span class="p">));</span>
  <span class="c1">// 加载服务器私钥</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">SSL_CTX_use_PrivateKey_file</span><span class="p">(</span><span class="n">sctx</span><span class="p">,</span> <span class="s">"runtime/server.key"</span><span class="p">,</span>
                                     <span class="n">SSL_FILETYPE_PEM</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">sctx</span><span class="p">;</span> <span class="c1">// 返回 SSL_CTX 对象</span>
<span class="p">}</span>

<span class="c1">// fuzzer 的入口函数</span>
<span class="k">extern</span> <span class="s">"C"</span> <span class="kt">int</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">Data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">Size</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">static</span> <span class="n">SSL_CTX</span> <span class="o">*</span><span class="n">sctx</span> <span class="o">=</span> <span class="n">Init</span><span class="p">();</span> <span class="c1">// 初始化 SSL_CTX，仅在第一次调用时执行</span>
  <span class="n">SSL</span> <span class="o">*</span><span class="n">server</span> <span class="o">=</span> <span class="n">SSL_new</span><span class="p">(</span><span class="n">sctx</span><span class="p">);</span>   <span class="c1">// 创建一个新的 SSL 对象</span>

  <span class="c1">// BIO（Basic Input/Output）对象用于处理输入和输出操作</span>
  <span class="c1">// 内存 BIO (Memory BIO)：使用内存缓冲区进行读写操作</span>
  <span class="n">BIO</span> <span class="o">*</span><span class="n">sinbio</span> <span class="o">=</span> <span class="n">BIO_new</span><span class="p">(</span><span class="n">BIO_s_mem</span><span class="p">());</span>
  <span class="n">BIO</span> <span class="o">*</span><span class="n">soutbio</span> <span class="o">=</span> <span class="n">BIO_new</span><span class="p">(</span><span class="n">BIO_s_mem</span><span class="p">());</span>

  <span class="c1">// 将 BIO 对象与 SSL 对象关联，使 SSL 对象可以通过 BIO 进行 I/O 操作</span>
  <span class="n">SSL_set_bio</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">sinbio</span><span class="p">,</span> <span class="n">soutbio</span><span class="p">);</span>
  <span class="n">SSL_set_accept_state</span><span class="p">(</span><span class="n">server</span><span class="p">);</span> <span class="c1">// 将 SSL 对象设置为接受状态，准备进行 SSL/TLS 握手</span>

  <span class="c1">// 将模糊测试输入数据写入 sinbio，以便模拟从客户端接收数据</span>
  <span class="n">BIO_write</span><span class="p">(</span><span class="n">sinbio</span><span class="p">,</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>

  <span class="c1">// 执行 SSL/TLS 握手过程</span>
  <span class="n">SSL_do_handshake</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

  <span class="c1">// 释放 SSL 对象，清理资源</span>
  <span class="n">SSL_free</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 返回 0 表示成功</span>
<span class="p">}</span>
</pre></div>
<h5 data-content="1" id="f98f1356a7f3f03a7ff1c3cdcf2511a6"><strong>步骤 3：编译模糊测试目标</strong></h5>
<p>在项目根目录中，运行以下命令编译模糊测试目标,详细的编译选项可以查看build.sh ：</p>
<div class="highlight"><pre><span></span><span class="err">#对目标项目进行</span><span class="n">clang插桩</span>
<span class="p">[</span><span class="n">AFL</span><span class="p">++</span> <span class="mi">570</span><span class="n">d9dc7fa7e</span><span class="p">]</span> <span class="p">/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span> <span class="err">#</span> <span class="p">./</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">/</span><span class="n">build</span><span class="p">.</span><span class="n">sh</span> 
<span class="n">Cloning</span> <span class="n">into</span> <span class="err">'</span><span class="n">SRC</span><span class="err">'</span><span class="p">...</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">480247</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
</pre></div>
<h5 data-content="1" id="5838effa027becaa31ac9b91271eac22"><strong>步骤 4：运行模糊测试</strong></h5>
<p>在项目根目录中，运行以下命令开始模糊测试，成功跑出堆溢出漏洞：</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">AFL</span><span class="p">++</span> <span class="mi">570</span><span class="n">d9dc7fa7e</span><span class="p">]</span> <span class="p">/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span> <span class="err">#</span> <span class="p">./</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span> 
<span class="n">INFO</span><span class="p">:</span> <span class="n">Running</span> <span class="k">with</span> <span class="n">entropic</span> <span class="n">power</span> <span class="n">schedule</span> <span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Seed</span><span class="p">:</span> <span class="mi">528530075</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Loaded</span> <span class="mi">1</span> <span class="n">modules</span>   <span class="p">(</span><span class="mi">35481</span> <span class="n">inline</span> <span class="mi">8</span><span class="p">-</span><span class="n">bit</span> <span class="n">counters</span><span class="p">):</span> <span class="mi">35481</span> <span class="p">[</span><span class="mh">0x5da29cfd2410</span><span class="p">,</span> <span class="mh">0x5da29cfdaea9</span><span class="p">),</span> 
<span class="n">INFO</span><span class="p">:</span> <span class="n">Loaded</span> <span class="mi">1</span> <span class="n">PC</span> <span class="n">tables</span> <span class="p">(</span><span class="mi">35481</span> <span class="n">PCs</span><span class="p">):</span> <span class="mi">35481</span> <span class="p">[</span><span class="mh">0x5da29cfdaeb0</span><span class="p">,</span><span class="mh">0x5da29d065840</span><span class="p">),</span> 
<span class="n">INFO</span><span class="p">:</span> <span class="p">-</span><span class="n">max_len</span> <span class="k">is</span> <span class="n">not</span> <span class="n">provided</span><span class="p">;</span> <span class="n">libFuzzer</span> <span class="n">will</span> <span class="n">not</span> <span class="n">generate</span> <span class="n">inputs</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">4096</span> <span class="n">bytes</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">A</span> <span class="n">corpus</span> <span class="k">is</span> <span class="n">not</span> <span class="n">provided</span><span class="p">,</span> <span class="n">starting</span> <span class="n">from</span> <span class="n">an</span> <span class="n">empty</span> <span class="n">corpus</span>
<span class="err">#</span><span class="mi">2</span>  <span class="n">INITED</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">402</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">403</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">1</span><span class="p">/</span><span class="mi">1</span><span class="n">b</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">41</span><span class="n">Mb</span>
<span class="err">#</span><span class="mi">3</span>  <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">402</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">404</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">4</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">41</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">2</span><span class="p">/</span><span class="mi">2</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">CrossOver</span><span class="p">-</span>
<span class="err">#</span><span class="mi">45</span> <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">402</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">404</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">2</span><span class="p">/</span><span class="mi">2</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">4</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">43</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">1</span><span class="p">/</span><span class="mi">1</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">2</span> <span class="n">ChangeBinInt</span><span class="p">-....</span>
                                             <span class="n">suite</span><span class="p">/</span><span class="n">BUILD</span><span class="p">/</span><span class="n">crypto</span><span class="p">/</span><span class="n">rand</span><span class="p">/</span><span class="n">rand_lib</span><span class="p">.</span><span class="n">c</span><span class="p">:</span><span class="mi">169</span>
<span class="err">#</span><span class="mi">23239</span>  <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">532</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">775</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">35</span><span class="p">/</span><span class="mi">784</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">110</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">23239</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">387</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">11</span><span class="p">/</span><span class="mi">88</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">CMP</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"\001\000\003R"</span><span class="p">-</span>
<span class="err">#</span><span class="mi">23380</span>  <span class="n">NEW</span>    <span class="n">cov</span><span class="p">:</span> <span class="mi">535</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">780</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">36</span><span class="p">/</span><span class="mi">800</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">110</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">23380</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">387</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">16</span><span class="p">/</span><span class="mi">88</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">1</span> <span class="n">CrossOver</span><span class="p">-</span>
<span class="err">#</span><span class="mi">23802</span>  <span class="n">REDUCE</span> <span class="n">cov</span><span class="p">:</span> <span class="mi">535</span> <span class="n">ft</span><span class="p">:</span> <span class="mi">780</span> <span class="n">corp</span><span class="p">:</span> <span class="mi">36</span><span class="p">/</span><span class="mi">797</span><span class="n">b</span> <span class="n">lim</span><span class="p">:</span> <span class="mi">110</span> <span class="n">exec</span><span class="p">/</span><span class="n">s</span><span class="p">:</span> <span class="mi">23802</span> <span class="n">rss</span><span class="p">:</span> <span class="mi">387</span><span class="n">Mb</span> <span class="n">L</span><span class="p">:</span> <span class="mi">28</span><span class="p">/</span><span class="mi">88</span> <span class="n">MS</span><span class="p">:</span> <span class="mi">2</span> <span class="n">ChangeBinInt</span><span class="p">-</span><span class="n">EraseBytes</span><span class="p">-</span>
<span class="p">=================================================================</span>
<span class="p">==</span><span class="mi">2346</span><span class="p">==</span><span class="n">ERROR</span><span class="p">:</span> <span class="n">AddressSanitizer</span><span class="p">:</span> <span class="n">heap</span><span class="p">-</span><span class="n">buffer</span><span class="p">-</span><span class="n">overflow</span> <span class="n">on</span> <span class="n">address</span> <span class="mh">0x629000009748</span> <span class="n">at</span> <span class="n">pc</span> <span class="mh">0x5da29cb00a7d</span> <span class="n">bp</span> <span class="mh">0x7ffd011caf10</span> <span class="n">sp</span> <span class="mh">0x7ffd011ca6d8</span>
<span class="n">READ</span> <span class="n">of</span> <span class="n">size</span> <span class="mi">17731</span> <span class="n">at</span> <span class="mh">0x629000009748</span> <span class="n">thread</span> <span class="n">T0</span>
    <span class="err">#</span><span class="mi">0</span> <span class="mh">0x5da29cb00a7c</span> <span class="k">in</span> <span class="n">__asan_memcpy</span> <span class="p">(/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span><span class="p">+</span><span class="mh">0x272a7c</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="n">b91eb95b107c49cb91fb52d711a75150508e5122</span><span class="p">)</span>
    <span class="err">#</span><span class="mi">1</span> <span class="mh">0x5da29cb4a42d</span> <span class="k">in</span> <span class="n">tls1_process_heartbeat</span> <span class="p">/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">BUILD</span><span class="p">/</span><span class="n">ssl</span><span class="p">/</span><span class="n">t1_lib</span><span class="p">.</span><span class="n">c</span><span class="p">:</span><span class="mi">2586</span><span class="p">:</span><span class="mi">3</span>
    <span class="err">#</span><span class="mi">2</span> <span class="mh">0x5da29cbb35c9</span> <span class="k">in</span> <span class="n">ssl3_read_bytes</span> <span class="p">/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">BUILD</span><span class="p">/</span><span class="n">ssl</span><span class="p">/</span><span class="n">s3_pkt</span><span class="p">.</span><span class="n">c</span><span class="p">:</span><span class="mi">1092</span><span class="p">:</span><span class="mi">4</span>
    <span class="err">#</span><span class="mi">3</span> <span class="mh">0x5da29cbb7990</span> <span class="k">in</span> <span class="n">ssl3_get_message</span> <span class="p">/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">BUILD</span><span class="p">/</span><span class="n">ssl</span><span class="p">/</span><span class="n">s3_both</span><span class="p">.</span><span class="n">c</span><span class="p">:</span><span class="mi">457</span><span class="p">:</span><span class="mi">7</span>
<span class="p">....</span><span class="n">fsanitize_fuzzer</span><span class="p">+</span><span class="mh">0x1c25d3</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="n">b91eb95b107c49cb91fb52d711a75150508e5122</span><span class="p">)</span>
    <span class="err">#</span><span class="mi">10</span> <span class="mh">0x5da29ca3e760</span> <span class="k">in</span> <span class="n">fuzzer</span><span class="p">::</span><span class="n">FuzzerDriver</span><span class="p">(</span><span class="kt">int</span><span class="p">*,</span> <span class="kt">char</span><span class="p">***,</span> <span class="kt">int</span> <span class="p">(*)(</span><span class="n">unsigned</span> <span class="kt">char</span> <span class="k">const</span><span class="p">*,</span> <span class="n">unsigned</span> <span class="kt">long</span><span class="p">))</span> <span class="p">(/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span><span class="p">+</span><span class="mh">0x1b0760</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="n">b91eb95b107c49cb91fb52d711a75150508e5122</span><span class="p">)</span>
    <span class="err">#</span><span class="mi">11</span> <span class="mh">0x5da29ca67aa2</span> <span class="k">in</span> <span class="n">main</span> <span class="p">(/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span><span class="p">+</span><span class="mh">0x1d9aa2</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="n">b91eb95b107c49cb91fb52d711a75150508e5122</span><span class="p">)</span>
    <span class="err">#</span><span class="mi">12</span> <span class="mh">0x724301664d8f</span>  <span class="p">(/</span><span class="n">lib</span><span class="p">/</span><span class="n">x86_64</span><span class="p">-</span><span class="n">linux</span><span class="p">-</span><span class="n">gnu</span><span class="p">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">+</span><span class="mh">0x29d8f</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="mi">490</span><span class="n">fef8403240c91833978d494d39e537409b92e</span><span class="p">)</span>

<span class="n">SUMMARY</span><span class="p">:</span> <span class="n">AddressSanitizer</span><span class="p">:</span> <span class="n">heap</span><span class="p">-</span><span class="n">buffer</span><span class="p">-</span><span class="n">overflow</span> <span class="p">(/</span><span class="n">downloads</span><span class="p">/</span><span class="n">fuzzer</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">suite</span><span class="p">/</span><span class="n">openssl</span><span class="p">-</span><span class="mf">1.0.1f</span><span class="p">-</span><span class="n">fsanitize_fuzzer</span><span class="p">+</span><span class="mh">0x272a7c</span><span class="p">)</span> <span class="p">(</span><span class="n">BuildId</span><span class="p">:</span> <span class="n">b91eb95b107c49cb91fb52d711a75150508e5122</span><span class="p">)</span> <span class="k">in</span> <span class="n">__asan_memcpy</span>
<span class="n">Shadow</span> <span class="n">bytes</span> <span class="n">around</span> <span class="n">the</span> <span class="n">buggy</span> <span class="n">address</span><span class="p">:</span>
  <span class="mh">0x629000009480</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
  <span class="mh">0x629000009500</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
  <span class="mh">0x629000009580</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
  <span class="mh">0x629000009600</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
  <span class="mh">0x629000009680</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>
<span class="p">=&gt;</span><span class="mh">0x629000009700</span><span class="p">:</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span><span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
  <span class="mh">0x629000009780</span><span class="p">:</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
  <span class="mh">0x629000009800</span><span class="p">:</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
  <span class="mh">0x629000009880</span><span class="p">:</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
  <span class="mh">0x629000009900</span><span class="p">:</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
  <span class="mh">0x629000009980</span><span class="p">:</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span> <span class="n">fa</span>
<span class="n">Shadow</span> <span class="kt">byte</span> <span class="n">legend</span> <span class="p">(</span><span class="n">one</span> <span class="n">shadow</span> <span class="kt">byte</span> <span class="n">represents</span> <span class="mi">8</span> <span class="n">application</span> <span class="n">bytes</span><span class="p">):</span>
  <span class="n">Addressable</span><span class="p">:</span>           <span class="mo">00</span>
  <span class="n">Partially</span> <span class="n">addressable</span><span class="p">:</span> <span class="mo">01</span> <span class="mo">02</span> <span class="mo">03</span> <span class="mo">04</span> <span class="mo">05</span> <span class="mo">06</span> <span class="mo">07</span> 
  <span class="n">Heap</span> <span class="n">left</span> <span class="n">redzone</span><span class="p">:</span>       <span class="n">fa</span>
  <span class="n">Freed</span> <span class="n">heap</span> <span class="n">region</span><span class="p">:</span>       <span class="n">fd</span>
  <span class="n">Stack</span> <span class="n">left</span> <span class="n">redzone</span><span class="p">:</span>      <span class="n">f1</span>
  <span class="n">Stack</span> <span class="n">mid</span> <span class="n">redzone</span><span class="p">:</span>       <span class="n">f2</span>
  <span class="n">Stack</span> <span class="n">right</span> <span class="n">redzone</span><span class="p">:</span>     <span class="n">f3</span>
  <span class="n">Stack</span> <span class="n">after</span> <span class="k">return</span><span class="p">:</span>      <span class="n">f5</span>
  <span class="n">Stack</span> <span class="n">use</span> <span class="n">after</span> <span class="k">scope</span><span class="p">:</span>   <span class="n">f8</span>
  <span class="n">Global</span> <span class="n">redzone</span><span class="p">:</span>          <span class="n">f9</span>
  <span class="n">Global</span> <span class="n">init</span> <span class="n">order</span><span class="p">:</span>       <span class="n">f6</span>
  <span class="n">Poisoned</span> <span class="n">by</span> <span class="n">user</span><span class="p">:</span>        <span class="n">f7</span>
  <span class="n">Container</span> <span class="n">overflow</span><span class="p">:</span>      <span class="n">fc</span>
  <span class="n">Array</span> <span class="n">cookie</span><span class="p">:</span>            <span class="n">ac</span>
  <span class="n">Intra</span> <span class="n">object</span> <span class="n">redzone</span><span class="p">:</span>    <span class="n">bb</span>
  <span class="n">ASan</span> <span class="n">internal</span><span class="p">:</span>           <span class="n">fe</span>
  <span class="n">Left</span> <span class="n">alloca</span> <span class="n">redzone</span><span class="p">:</span>     <span class="n">ca</span>
  <span class="n">Right</span> <span class="n">alloca</span> <span class="n">redzone</span><span class="p">:</span>    <span class="n">cb</span>
<span class="p">==</span><span class="mi">2346</span><span class="p">==</span><span class="n">ABORTING</span>
<span class="n">MS</span><span class="p">:</span> <span class="mi">2</span> <span class="n">EraseBytes</span><span class="p">-</span><span class="n">PersAutoDict</span><span class="p">-</span> <span class="n">DE</span><span class="p">:</span> <span class="s">"ECDSA"</span><span class="p">-;</span> <span class="n">base</span> <span class="n">unit</span><span class="p">:</span> <span class="mi">1</span><span class="n">fd5cf2beed57b0a1a2a477ff6e33cbf1a23c38e</span>
<span class="mh">0x18</span><span class="p">,</span><span class="mh">0x3</span><span class="p">,</span><span class="mh">0x5</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x5</span><span class="p">,</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x44</span><span class="p">,</span><span class="mh">0x53</span><span class="p">,</span><span class="mh">0x41</span><span class="p">,</span>
<span class="s">\030\003\005\000\005\001</span><span class="n">ECDSA</span>
<span class="n">artifact_prefix</span><span class="p">=</span><span class="err">'</span><span class="p">./</span><span class="err">'</span><span class="p">;</span> <span class="n">Test</span> <span class="n">unit</span> <span class="n">written</span> <span class="n">to</span> <span class="p">./</span><span class="n">crash</span><span class="p">-</span><span class="mi">96</span><span class="n">ba5b3de75e70a2400b07afcf813e645282baa2</span>
<span class="n">Base64</span><span class="p">:</span> <span class="n">GAMFAAUBRUNEU0E</span><span class="p">=</span>
</pre></div>
</div>
</div>