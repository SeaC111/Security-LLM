<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<p>任意用户密码重置<br/>
漏洞位置<br/>
首先看忘记密码位置</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220163346-20fdba74-bead-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220163440-40f38ab6-bead-1.png"/><br/>
看了下逻辑，不需要旧密码，只要符合otp长度6位或者8位，用户存在，并且全部填写，就可以修改用户<br/>
当随便输入动态otp时候</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220163507-515deaa4-bead-1.png"/><br/>
会报104<br/>
那么想办法绕过104，如下是逻辑位置</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220163908-e0c6ffc8-bead-1.png"/><br/>
可以看到Check_ET_CheckPwdz201函数进行了检测<br/>
跟入该函数<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220164025-0f258290-beae-1.png"/><br/>
可以看到有算法，可能看着有点不舒服实际结构就是</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">initialMin</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">Minute</span><span class="p">;</span>  <span class="c1">// 获取当前的分钟数</span>
<span class="kt">int</span> <span class="n">min</span> <span class="p">=</span> <span class="k">delegate</span> <span class="p">(</span><span class="kt">int</span> <span class="n">min</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">Pow</span><span class="p">(</span><span class="m">2.0</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">min</span> <span class="p">-</span> <span class="m">1</span><span class="p">))</span> <span class="p">%</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">min</span> <span class="p">!=</span> <span class="m">1.0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">min</span><span class="p">++;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">;</span>
<span class="p">}(</span><span class="n">initialMin</span><span class="p">);</span>  <span class="c1">// 将当前分钟数传递给匿名函数</span>
</pre></div>
<p>min 的初始值是 DateTime.Now.Minute。<br/>
第一个匿名函数用于修改 min 使其满足特定条件。<br/>
第二个匿名函数使用修改后的 min 进行一系列计算，生成一个整数 t。<br/>
将生成的整数 t 转换为 6 位数字的字符串格式，并与输入的密码进行比较。<br/>
根据c#代码转成python代码进行生成，如下<br/>
任意用户密码重置，只要有存在的用户就可以<br/>
使用脚本生成otp</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220164513-ba84d17c-beae-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220164616-dfe6171e-beae-1.png"/><br/>
这部说明otp绕过成功，之后就可以随便修改密码了<br/>
可能有的界面不一样，但是otp生成方法一样，都可以成功</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241220164647-f26506fc-beae-1.png"/></p>
</div>
</div>