<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="bd35241718bdd1a28da10507382c115d">RSA系列之基础实战 1</h1>
<h2 data-content="1" id="a3441f0796f5b2755e8295828e336261">导入</h2>
<p>从这个系列开始，我将从简单到困难的将RSA中的题型不断更新加入此，无论是典型的dp泄露为代表计算为主的题型，或是以按行加密的代码理解为主的题型，笔者将尽力整理成册，并辅以自己的理解和总结。希望能帮助到各位读者，若有笔误或其余错误，敬请谅解并联系我更改，共勉。</p>
<h2 data-content="1" id="536bdb5e54f2d7c3dd136574426e3ceb">基础知识回顾</h2>
<p>（注：熟悉该内容可跳过）</p>
<div class="highlight"><pre><span></span><span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">):</span><span class="err">欧拉函数</span><span class="p">,</span><span class="err">小于等于</span><span class="n">n的正整数中与n互质的数的总数</span>
      <span class="mf">1.</span><span class="err">如果</span><span class="n">n是质数的某一个次方</span><span class="err">，即</span> <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">^</span><span class="n">k</span> <span class="p">(</span><span class="n">p为质数</span><span class="err">，</span><span class="n">k为大于等于1的整数</span><span class="p">)</span><span class="err">，则</span>
         <span class="err">φ</span><span class="p">(</span><span class="n">p</span><span class="o">^</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">^</span><span class="n">k</span> <span class="o">-</span> <span class="n">p</span><span class="o">^</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
     <span class="mf">2.</span><span class="err">如果</span><span class="n">n可以分解成两个互质的整数之积</span><span class="err">，</span><span class="n">n</span> <span class="o">=</span> <span class="n">p1</span> <span class="err">×</span> <span class="n">p2</span>
       <span class="err">则φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="err">φ</span><span class="p">(</span><span class="n">p1p2</span><span class="p">)</span> <span class="o">=</span> <span class="err">φ</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="err">φ</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
     <span class="mf">3.</span><span class="err">欧拉定理：如果两个正整数</span><span class="n">a和n互质</span><span class="err">，则</span><span class="n">n的欧拉函数</span> <span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="err">可以让下面的等式成立</span><span class="p">:</span>
         <span class="n">a</span><span class="o">^</span><span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span> <span class="mi">1</span> <span class="p">(</span> <span class="n">mod</span> <span class="n">n</span><span class="p">)</span>
       <span class="err">欧拉定理：如果两个正整数</span><span class="n">a和n互质</span><span class="err">，则</span><span class="n">n的欧拉函数</span> <span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="err">可以让下面的等式成立：</span>
         <span class="n">a</span><span class="o">^</span><span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="err">≡</span> <span class="mi">1</span> <span class="p">(</span> <span class="n">mod</span> <span class="n">n</span><span class="p">)</span>
     <span class="mf">4.</span><span class="err">模反元素：如果两个正整数</span><span class="n">a和n互质</span><span class="err">，那么一定可以找到整数</span><span class="n">b</span><span class="err">，</span><span class="n">ab被n除的余数是1</span>
     <span class="n">ab</span><span class="o">===</span><span class="mi">1</span><span class="p">(</span><span class="n">mod</span> <span class="n">n</span><span class="p">),</span><span class="n">b叫做a的模反元素</span>

<span class="n">RSA加密过程</span>
<span class="n">p</span><span class="p">:</span><span class="err">质数</span><span class="n">q</span>  <span class="n">q</span><span class="p">:</span><span class="err">质数</span><span class="n">q</span>  <span class="n">n</span><span class="p">:</span><span class="err">质数</span><span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="err">φ</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">=</span><span class="err">φ</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="err">φ</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e</span><span class="p">:</span><span class="err">随机选择一个整数</span><span class="n">e</span><span class="err">，条件是</span><span class="mi">1</span><span class="o">&lt;</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">，且</span><span class="n">e与φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="err">互质</span>
<span class="n">d</span><span class="p">:</span><span class="n">e对于φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">的模反元素</span><span class="n">d</span> <span class="err">即：</span><span class="n">ed</span> <span class="err">≡</span> <span class="mi">1</span> <span class="p">(</span><span class="n">mod</span> <span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">):</span><span class="err">公钥</span>  <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">):</span><span class="err">私钥</span>
<span class="n">m</span><span class="p">:</span><span class="err">明文</span>  <span class="n">c</span><span class="p">:</span><span class="err">用公钥加密后的密文</span>
     <span class="err">那么，有无可能在已知</span><span class="n">n和e的情况下</span><span class="err">，推导出</span><span class="n">d</span><span class="err">？</span>
     　　<span class="err">（</span><span class="mi">1</span><span class="err">）</span><span class="n">ed</span><span class="err">≡</span><span class="mi">1</span> <span class="p">(</span><span class="n">mod</span> <span class="err">φ</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="err">。只有知道</span><span class="n">e和φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">，才能算出</span><span class="n">d</span><span class="err">。</span>
     　　<span class="err">（</span><span class="mi">2</span><span class="err">）φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">。只有知道</span><span class="n">p和q</span><span class="err">，才能算出φ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">。</span>
     　　<span class="err">（</span><span class="mi">3</span><span class="err">）</span><span class="n">n</span><span class="o">=</span><span class="n">pq</span><span class="err">。只有将</span><span class="n">n因数分解</span><span class="err">，才能算出</span><span class="n">p和q</span><span class="err">。</span>
     <span class="err">结论：如果</span><span class="n">n可以被因数分解</span><span class="err">，</span><span class="n">d就可以算出</span><span class="err">，也就意味着私钥被破解</span>

    <span class="err">加密要用公钥</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="err">，</span><span class="n">m已知m</span><span class="o">*</span><span class="n">e</span> <span class="err">≡</span> <span class="n">c</span> <span class="p">(</span><span class="n">mod</span> <span class="n">n</span><span class="p">)</span> 
    <span class="err">加密算出</span><span class="n">c</span><span class="err">，加</span> <span class="err">密</span> <span class="err">公</span> <span class="err">式</span> <span class="err">：</span> <span class="n">m</span><span class="o">*</span><span class="n">e</span> <span class="err">≡</span> <span class="n">c</span> <span class="p">(</span> <span class="n">mod</span> <span class="n">n</span> <span class="p">)</span> <span class="err">→</span> <span class="n">c</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">e</span> <span class="err">–</span> <span class="n">k</span><span class="o">*</span><span class="n">n</span>
    <span class="err">解密要用私钥</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span><span class="err">，解密公式：</span><span class="n">cd</span> <span class="err">≡</span> <span class="n">m</span> <span class="p">(</span><span class="n">mod</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
<h2 data-content="1" id="ef0f2d249285ed76fdce910319bfbb28">例题</h2>
<h3 data-content="1" id="2f9f5e5784963bb0719d4727cd2bb5ad">1.最最基础的RSA</h3>
<h4 data-content="1" id="42fa06727bb228c0e438e296d9bde4e2">题目描述：</h4>
<div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s2">"flag{"</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"}"</span>
</pre></div>
<h4 data-content="1" id="5cdd711029f8b6c103ed843bcf7cb3cb">题目分析：</h4>
<ul>
<li>由flag可知要求出d</li>
<li>又ed≡1 (mod φ(n))，而φ(n)=(p-1)(q-1)。只有知道p和q，才能算出φ(n)</li>
<li>由N 可通过<a href="http://factordb.com/index.php?query=322831561921859" target="_blank">分解n,得p,q的网站</a>得到p与q</li>
<li>之后通过d = gmpy2.invert(e,phi)得到d</li>
<li>解d脚本：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">9046853915223503351787031888977627106934564043204783593118678181991596316582877057556463152579621699010610569526573031954779520781448550677767565207407183</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">11273732364123571293429600400343309403733952146912318879993851141423284675797325272321856863528776914709992821287788339848962916204774010644058033316303937</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
<ul>
<li>但为什么解出d后仍得不到flag？？？</li>
<li><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226123902-f76161b6-d460-1.png"/></li>
</ul>
<p>【字符串必须在哈希之前进行编码】</p>
<ul>
<li>所以完整且正确的代码如下：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">9046853915223503351787031888977627106934564043204783593118678181991596316582877057556463152579621699010610569526573031954779520781448550677767565207407183</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">11273732364123571293429600400343309403733952146912318879993851141423284675797325272321856863528776914709992821287788339848962916204774010644058033316303937</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s2">"flag{"</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"}"</span>
<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="c1"># flag{8159e6c4abdd3b94ce461ed9a1a24017}</span>
</pre></div>
<h3 data-content="1" id="08ccde17c059bcf711da49889b879c3a">2.dp</h3>
<h4 data-content="1" id="83363114b98bc858e99f3a50a43a29c2">题目描述：</h4>
<div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869</span>
<span class="n">dp</span> <span class="o">=</span> <span class="mi">734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825</span>
</pre></div>
<h4 data-content="1" id="5b849f0a70fd4fbbb8b6d0a3e19a4695">题目分析：</h4>
<blockquote>
<p>c = m^e mod n<br/>
m = c^d mod n<br/>
ϕ(n)=(p−1)*(q−1)<br/>
d∗e ≡ 1 mod ϕ(n)<br/>
dp = d mod (p−1)</p>
</blockquote>
<p>由上式可以得到</p>
<blockquote>
<p>dp*e≡d*e mod (p−1)</p>
</blockquote>
<p>因此可以得到</p>
<blockquote>
<p>式1：d∗e=k∗(p−1)+dp∗e<br/>
式2：d∗e≡1 mod ϕ(n)</p>
</blockquote>
<p>式1带入式2</p>
<blockquote>
<p>=&gt; k1∗(p−1)+dp∗e ≡1 mod ϕ(n)</p>
<p>=&gt; k1∗(p−1)+dp∗e ≡1 mod (p−1)∗(q−1)</p>
<p>=&gt; k1∗(p−1)+dp∗e = k2*(p−1)∗(q−1)+1</p>
<p>=&gt; dp*e =  k2*(p−1)∗(q−1)+1-k1∗(p−1)</p>
<p>=&gt; dp*e = (p-1)*[k2*(q-1)-k1]+1</p>
</blockquote>
<p>因dp&lt;p−1（dp是d//（p-1）的取整，dp&lt;p−1）</p>
<p>所以e &gt; k2∗(q−1)−k1</p>
<p>再次回到</p>
<blockquote>
<p>dp <em> e = (p-1)</em>[k2*(q-1)-k1]+1</p>
</blockquote>
<p>假设 x=k2∗(q−1)−k1</p>
<p>那么x的范围为 (0,e)</p>
<p>x∗(p−1)+1=dp∗e</p>
<p>枚举 x 求出p-1，即遍历(0,e)的范围，其中肯定有一个p可以被n整除，那么求出p和q</p>
<ul>
<li>最终运行代码得到 flag{dp_leaking_1s_very_d@angerous}  (嚯！原来题目就是答案啊！)</li>
<li>首先我们先看下解题脚本，再进行分析：</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">156808343598578774957375696815188980682166740609302831099696492068246337198792510898818496239166339015207305102101431634283168544492984586566799996471150252382144148257236707247267506165670877506370253127695314163987084076462560095456635833650720606337852199362362120808707925913897956527780930423574343287847</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">108542078809057774666748066235473292495343753790443966020636060807418393737258696352569345621488958094856305865603100885838672591764072157183336139243588435583104423268921439473113244493821692560960443688048994557463526099985303667243623711454841573922233051289561865599722004107134302070301237345400354257869</span>
<span class="n">dp</span> <span class="o">=</span> <span class="mi">734763139918837027274765680404546851353356952885439663987181004382601658386317353877499122276686150509151221546249750373865024485652349719427182780275825</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">65535</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">dp</span><span class="o">*</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>
        <span class="k">break</span>
<span class="c1"># print(p)</span>
<span class="c1"># print(q)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
<ul>
<li>主要还是这串代码---&gt;</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">65535</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">dp</span><span class="o">*</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>
        <span class="k">break</span>
</pre></div>
<h3 data-content="1" id="6bf9a3572805017bb10f903433581068">3.ROLL按行加密</h3>
<h4 data-content="1" id="341e826c71aa4abcd8f46924037defae">题目描述：</h4>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226130147-25135882-d464-1.png"/></p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="mi">920139713</span><span class="p">,</span><span class="mi">19</span><span class="p">}</span>

<span class="mi">704796792</span>
<span class="mi">752211152</span>
<span class="mi">274704164</span>
<span class="mi">18414022</span>
<span class="mi">368270835</span>
<span class="mi">483295235</span>
<span class="mi">263072905</span>
<span class="mi">459788476</span>
<span class="mi">483295235</span>
<span class="mi">459788476</span>
<span class="mi">663551792</span>
<span class="mi">475206804</span>
<span class="mi">459788476</span>
<span class="mi">428313374</span>
<span class="mi">475206804</span>
<span class="mi">459788476</span>
<span class="mi">425392137</span>
<span class="mi">704796792</span>
<span class="mi">458265677</span>
<span class="mi">341524652</span>
<span class="mi">483295235</span>
<span class="mi">534149509</span>
<span class="mi">425392137</span>
<span class="mi">428313374</span>
<span class="mi">425392137</span>
<span class="mi">341524652</span>
<span class="mi">458265677</span>
<span class="mi">263072905</span>
<span class="mi">483295235</span>
<span class="mi">828509797</span>
<span class="mi">341524652</span>
<span class="mi">425392137</span>
<span class="mi">475206804</span>
<span class="mi">428313374</span>
<span class="mi">483295235</span>
<span class="mi">475206804</span>
<span class="mi">459788476</span>
<span class="mi">306220148</span>
</pre></div>
<h4 data-content="1" id="680bce04521543aedfca906cec6eecbd">题目分析：</h4>
<ul>
<li>说实话一开始没看懂题目的意思，看完别人的wp才知道括号里面的两个数字是 n 与 e ,后面的是拆分的密文 c ,原来题目中的 roll 是利用题中多个 c 滚动拼接 flag 的意思</li>
<li>以下是解题代码：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libnum</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">704796792</span><span class="p">,</span>
<span class="mi">752211152</span><span class="p">,</span>
<span class="mi">274704164</span><span class="p">,</span>
<span class="mi">18414022</span><span class="p">,</span>
<span class="mi">368270835</span><span class="p">,</span>
<span class="mi">483295235</span><span class="p">,</span>
<span class="mi">263072905</span><span class="p">,</span>
<span class="mi">459788476</span><span class="p">,</span>
<span class="mi">483295235</span><span class="p">,</span>
<span class="mi">459788476</span><span class="p">,</span>
<span class="mi">663551792</span><span class="p">,</span>
<span class="mi">475206804</span><span class="p">,</span>
<span class="mi">459788476</span><span class="p">,</span>
<span class="mi">428313374</span><span class="p">,</span>
<span class="mi">475206804</span><span class="p">,</span>
<span class="mi">459788476</span><span class="p">,</span>
<span class="mi">425392137</span><span class="p">,</span>
<span class="mi">704796792</span><span class="p">,</span>
<span class="mi">458265677</span><span class="p">,</span>
<span class="mi">341524652</span><span class="p">,</span>
<span class="mi">483295235</span><span class="p">,</span>
<span class="mi">534149509</span><span class="p">,</span>
<span class="mi">425392137</span><span class="p">,</span>
<span class="mi">428313374</span><span class="p">,</span>
<span class="mi">425392137</span><span class="p">,</span>
<span class="mi">341524652</span><span class="p">,</span>
<span class="mi">458265677</span><span class="p">,</span>
<span class="mi">263072905</span><span class="p">,</span>
<span class="mi">483295235</span><span class="p">,</span>
<span class="mi">828509797</span><span class="p">,</span>
<span class="mi">341524652</span><span class="p">,</span>
<span class="mi">425392137</span><span class="p">,</span>
<span class="mi">475206804</span><span class="p">,</span>
<span class="mi">428313374</span><span class="p">,</span>
<span class="mi">483295235</span><span class="p">,</span>
<span class="mi">475206804</span><span class="p">,</span>
<span class="mi">459788476</span><span class="p">,</span>
<span class="mi">306220148</span><span class="p">]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">920139713</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">18443</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">49891</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">invmod</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># string = libnum.n2s(m) 此两句的作用等同于 flag += chr(m)</span>
    <span class="c1"># flag += string.decode()</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
<p>收获与体会：</p>
<ul>
<li>又了解了一种 rsa 题型 ---&gt; 滚动拼接法求 flag</li>
<li>懂了 str.decode() 的意思，即</li>
</ul>
<blockquote>
<p>string = libnum.n2s(m)<br/>
   flag += string.decode()<br/>
   此两句的作用等同于<br/>
   flag += chr(m)</p>
</blockquote>
<h3 data-content="1" id="9292013085adb81513bf217ce8e656d6">4.古典1</h3>
<h4 data-content="1" id="e58dac2e8c2017177a9da1010a42f397">题目描述：</h4>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226191308-0554b1f6-d498-1.png"/></p>
<h4 data-content="1" id="68ed7dc856855df1c666e076ff802a88">题目分析：</h4>
<ul>
<li>翻译一下可知：</li>
</ul>
<blockquote>
<p>前提：用0、1、2、…..枚举字母表25<br/>
使用RSA系统<br/>
加密：0156 0821 1616 0041 0140 2130 1616 0793<br/>
公钥：2537和13<br/>
私钥：2537和937</p>
</blockquote>
<ul>
<li>从提示可以得知 n = 2537 , e = 13 , d = 937 </li>
<li>分解 n ,可知 p = 43 , q = 59</li>
<li>做过 buu RSAROLL 1 便可知道此题大致考的什么</li>
<li>里面的 “ 0156 0821 1616 0041 0140 2130 1616 0793 ” 即是 c ,只不过是多个 c ,将解出来的明文拼接在一起便可得到 flag</li>
<li>代码如下：</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="s1">'abcdefghigklmnopqrstuvwxyz'</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">43</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">59</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">937</span>
<span class="n">c</span> <span class="o">=</span> <span class="s1">'0156 0821 1616 0041 0140 2130 1616 0793'</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="nb">pow</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)]</span>
<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="c1">#flag{iloveyou}</span>
</pre></div>
<h4 data-content="1" id="2b4a837d411d029229f9cbb4f5650b36">收获与体会：</h4>
<ul>
<li>此题有一个特殊之处，即里面的 c , e , n 都很小，很反常！</li>
<li>如果按  buu RSAROLL 这道题来写的话，得不到答案，因为打印 pow(int(i),d,n) 后会得到</li>
</ul>
<blockquote>
<p>8<br/>
11<br/>
14<br/>
21<br/>
4<br/>
24<br/>
14<br/>
20</p>
</blockquote>
<p>一串很小的数字，对应ascii码后会得到一些 特别的东西，没有字母也没有数字</p>
<ul>
<li>所以就会想到可能是按照26个字母表进行转换，位置一一对应即可转化成功得到 flag</li>
<li>所以数字在1~26之间就转字母便，大于26就转 ascii 码</li>
</ul>
<h3 data-content="1" id="8c791b6b5c265ec64774f7bb31e241da">5.共享素数+爆破</h3>
<h4 data-content="1" id="165d279327b534580bcfa7410f81a5b9">题目描述：</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">getPrime</span><span class="p">,</span><span class="n">bytes_to_long</span>

<span class="n">flag</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">"flag"</span><span class="p">,</span><span class="s2">"rb"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">p</span><span class="o">=</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">e</span><span class="o">&lt;</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="n">m</span><span class="o">=</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span> <span class="n">c</span><span class="p">,</span><span class="n">n</span>
<span class="k">print</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">294</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="n">p</span><span class="o">=</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="n">m</span><span class="o">=</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="s2">"BJD"</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span>
<span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span> <span class="n">c</span><span class="p">,</span><span class="n">n</span>

<span class="n">c1</span> <span class="o">=</span> <span class="mi">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>
<span class="n">_294c</span> <span class="o">=</span> <span class="mi">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721</span>  
<span class="n">n2</span> <span class="o">=</span> <span class="mi">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>
</pre></div>
<h4 data-content="1" id="618ea63f61c286311e1821785b672ac4">题目分析：</h4>
<ul>
<li>从题目中知道e&lt;100000,比较小，且有多个n与c，且多个n共用一个q,所以想到共享素数,如此便可求到q,然后得到p</li>
<li>之后d也容易得到，最后只剩e不知道啦，然而题目中表示e较小，直接爆破求出，几个未知数都知道了，那flag岂不手到擒来啦！</li>
<li>以下是解题代码：</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">c1</span> <span class="o">=</span> <span class="mi">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>
<span class="n">_294c</span> <span class="o">=</span> <span class="mi">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721</span>  
<span class="n">n2</span> <span class="o">=</span> <span class="mi">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>

<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">import</span> <span class="nn">libnum</span>
<span class="c1"># n1和 n2公用了一个 q 用gcd欧几里得算法求得q</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">n1</span><span class="o">//</span><span class="n">p</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># 此时知道e即可解题 因为我们知道pow(294,e,n) 还知道e的范围所以可以爆破e</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">294</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">n1</span><span class="p">)</span> <span class="o">==</span> <span class="n">_294c</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<span class="c1"># b'BJD{p_is_common_divisor}'</span>
</pre></div>
<h3 data-content="1" id="3ea0b4211590d1649be1e6c9060e30cc">6.位数之谜</h3>
<h4 data-content="1" id="3c73e563ee539418259f157b1ed4c574">题目描述：</h4>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226191609-71345aa2-d498-1.png"/></p>
<h4 data-content="1" id="40a07ca85f994e4634622c9b2bc49d39">题目分析：</h4>
<ul>
<li>首先明确两个公式：</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">e</span><span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">mod</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ed1</span> <span class="o">=</span> <span class="n">e</span><span class="o">*</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<ul>
<li>想要解出此题，我们必须知道n,而要知道n,我们要知道p和q的值</li>
<li>通过 e*d 的计算，我们知道其长度为2064位，而生成p的条件为 getPrime(1024)，所以（p-1)（q-1）应该为2048位</li>
</ul>
<blockquote>
<p>此处所说的位数长度是以Bit为单位，加一减一都不影响位数，相乘的话即为位数相加，这些性质记住就好，以下是计算代码：</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span> <span class="c1"># 转二进 e = 0b10000000000000001,直接数得到长度为17</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913</span>
<span class="k">print</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="p">))</span>
<span class="c1"># 2064</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="c1"># 1024</span>
<span class="k">print</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># 1024</span>
</pre></div>
<ul>
<li>又 ed1 = e*d - 1 = k(p-1)(q-1)，2064-2048 = 16，所以k值必在 pow(2,15)至pow(2,16)之间 （想知道为什么看结尾的知识总结，此处专注解题，不深层探究）</li>
<li>所以，我们可以利用此条件暴力求解k值，从而求出(p-1)*(q-1),间接求出 p 和 q 的值</li>
<li>那如何间接法呢？</li>
<li>首先我们求得了(p-1)<em>(q-1),而p和q是两个相邻的质数，所以我们可以使用sympy库对p,q进行求解。思路为先对(p-1)</em>(q-1)开方，再求得大于开方所得数和小于开方所得数的质数</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">prevprime</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">nextprime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
<ul>
<li>其中 sympy.prevprime(x)是求小于x最近的质数，sympy.nextprime(x)是求大于x最近的质数。</li>
<li>解题代码如下：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="c1"># e = 0x10001</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)):</span>
    <span class="c1">#  pow(x,y) ---&gt; x 的 y 次方</span>
    <span class="c1">#  pow(x,y,z) ---&gt; x 的 y 次方后，取余 z</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">prevprime</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># sympy.prevprime(x)是求大于x最近的质数</span>
        <span class="c1"># iroot(x,n) ---&gt; x开n次根 ,返回值有两个，前一个是开方出来的整数部分，后一个是能否开出来，若能则为true,不能则为flase</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">nextprime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="c1"># sympy.nextprime(x)是求小于x最近的质数</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">k</span><span class="p">:</span>
            <span class="k">break</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<span class="c1">#flag{70u2_nn47h_14_v3ry_gOO0000000d}</span>
</pre></div>
<p>收获与体会：</p>
<ul>
<li>了解了一些字节的相关知识</li>
<li>知道了函数 sympy.prevprime(x)和sympy.nextprime(x)的相关知识</li>
</ul>
<blockquote>
<p>sympy.prevprime(x)是求小于x最近的质数<br/>
sympy.nextprime(x)是求大于x最近的质数</p>
</blockquote>
<ul>
<li>回顾了iroot(x,n) 和 pow(x,y) 的相关知识</li>
</ul>
<blockquote>
<p>iroot(x,n) ---&gt; x开n次根,返回值有两个，前一个是开方出来的整数部分，后一个是能否开出来，若能则为true,不能则为flase<br/>
pow(x,y) ---&gt; x 的 y 次方<br/>
pow(x,y,z) ---&gt; x 的 y 次方后，取余 z</p>
</blockquote>
<h3 data-content="1" id="ae981baf4da13bd34005c6d5d9e22ab4">7.威尔逊</h3>
<h4 data-content="1" id="0123b6fe85f9c922912ffadbd4bbd189">题目描述：</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">myGetPrime</span><span class="p">():</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">513</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">B</span><span class="o">=</span><span class="n">A</span><span class="o">-</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e5</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sympy</span><span class="o">.</span><span class="n">nextPrime</span><span class="p">((</span><span class="n">B</span><span class="err">!</span><span class="p">)</span><span class="o">%</span><span class="n">A</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="n">myGetPrime</span><span class="p">()</span>
<span class="c1">#A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span>
<span class="c1">#B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span>

<span class="n">q</span><span class="o">=</span><span class="n">myGetPrime</span><span class="p">()</span>
<span class="c1">#A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span>
<span class="c1">#B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span>

<span class="n">r</span><span class="o">=</span><span class="n">myGetPrime</span><span class="p">()</span>

<span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">r</span>
<span class="c1">#n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span>
<span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="c1">#e=0x1001</span>
<span class="c1">#c=75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span>
<span class="c1">#so,what is the flag?</span>
</pre></div>
<h4 data-content="1" id="9823ce81cf5fbe5d236710cc8884547c">题目分析：</h4>
<ul>
<li>首先我们先看到 n = p <em> q </em> r （n 分解成了三个素数） ,而 e,c 都知道，所以要求明文 m = pow(c,d,n) 先要求出 d 来</li>
<li>而 d = gmpy2.invert(e,phi)</li>
<li>其中欧拉函数 phi = (p-1) <em> (q-1) </em> (r-1)</li>
<li>所以要求 d ,那么要求出 p 与 q </li>
<li>代码中 p = myGetPrime() = sympy.nextPrime((B!)%A) </li>
</ul>
<blockquote>
<p>sympy.nextprime(x) 是求大于x最近的质数</p>
</blockquote>
<ul>
<li>所以最终要求 (B!)%A，即B的阶乘模A，其中 A,B 都知道，那么B!（B的阶乘）怎么求呢？</li>
<li>有一个定理可以解决这个问题，即 威尔逊定理</li>
</ul>
<p>威尔逊定理</p>
<blockquote>
<p>当且仅当p为素数时：( p -1 ) ! ≡ -1 ( mod p )  ---&gt;   (p-1) ! +1=0 (mod p)</p>
</blockquote>
<ul>
<li>A = getPrime(513)，可知A为素数，又 B=A-random.randint(1e3,1e5)，通过威尔逊定理，可知(A-1) ! +1≡0 (mod A)，故B!(B+1)(B+2)…(A-1) ≡ -1 (mod A)，即B! * C = ≡ -1 ( mod A )，其中C = (A - 1)! / (B) !，也就是B之后的数字之积<br/>
两边同时乘上C的逆元C1*(C * C1 = 1)，B ! = -1 * C1(mod A1)</li>
<li>B ! 求出来了，那么 p = myGetPrime() = sympy.nextPrime((B!)%A) 也就求出来了</li>
<li>如此，p,q 都求出来了，r = n // (p * q) ,自此p,q,r,都求出来了，最终flag也就出来了</li>
<li>代码如下：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libnum</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">A1</span><span class="o">=</span><span class="mi">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span>
<span class="n">B1</span><span class="o">=</span><span class="mi">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span>
<span class="n">A2</span><span class="o">=</span><span class="mi">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span>
<span class="n">B2</span><span class="o">=</span><span class="mi">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span>
<span class="n">n</span><span class="o">=</span><span class="mi">85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span>
<span class="c1"># e=0x1001，转十进制</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">4097</span>
<span class="n">c</span><span class="o">=</span><span class="mi">75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span>
<span class="k">def</span> <span class="nf">mydecryp</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">)</span> <span class="c1"># temp=-1 mod A</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="n">C1</span><span class="o">*</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">A</span><span class="p">))</span><span class="o">%</span><span class="n">A</span> <span class="c1"># C1是从B+1~A中每个数对A的逆元的乘积</span>
    <span class="k">return</span> <span class="n">sympy</span><span class="o">.</span><span class="n">nextprime</span><span class="p">((</span><span class="n">C1</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span><span class="o">%</span><span class="n">A</span><span class="p">)</span> <span class="c1"># (C1*temp) = B!， (C1*temp)%A = (B!)%A</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">mydecryp</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span><span class="n">B1</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">mydecryp</span><span class="p">(</span><span class="n">A2</span><span class="p">,</span><span class="n">B2</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span><span class="o">//</span><span class="n">q</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<span class="c1">#flag{wm-CongrAtu1ation4-1t4-ju4t-A-bAby-R4A}</span>
</pre></div>
<h3 data-content="1" id="be34c51093ee83f2d5a6dded8b9ee87a">8.方程计算</h3>
<h4 data-content="1" id="4163bf15d40566e8a465a805a24938cc">题目描述：</h4>
<div class="highlight"><pre><span></span><span class="n">A</span><span class="o">=</span><span class="p">(((</span><span class="n">y</span><span class="o">%</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">y</span><span class="p">))</span><span class="o">**</span><span class="mi">2019</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">316</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">x</span>
<span class="n">p</span><span class="o">=</span><span class="n">next_prime</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="n">next_prime</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span>  <span class="mi">2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724</span>
<span class="n">n</span> <span class="o">=</span>  <span class="mi">117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127</span>
<span class="n">c</span> <span class="o">=</span>  <span class="mi">41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128</span>
</pre></div>
<h4 data-content="1" id="80957d79934a0b8125118040b4435537">题目分析：</h4>
<ul>
<li>这题看了别人写的题解，知道了两种不同的解题方法</li>
<li>
<p>第一种是契合题目所给字母，先通过爆破求出x,y，但奇怪的是我用pycharm重写了一遍他们的代码，都出现了报错：<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226192321-72b0e76e-d499-1.png"/><br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20240226192334-7a556c2e-d499-1.png"/></p>
</li>
<li>
<p>上面两种一个是报错，一个是直接结束程序，反正都求不出x,y（我也求不出）</p>
</li>
<li>所以尝试了另外一种方法：直接爆破求e,（p,q可以通过n分解得到），所以字母都求出来了，那么最后答案也就差不多了，代码如下：</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">A</span> <span class="o">=</span> <span class="mi">2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">842868045681390934539739959201847552284980179958879667933078453950968566151662147267006293571765463137270594151138695778986165111380428806545593588078365331313084230014618714412959584843421586674162688321942889369912392031882620994944241987153078156389470370195514285850736541078623854327959382156753458569</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">139916095583110895133596833227506693679306709873174024876891023355860781981175916446323044732913066880786918629089023499311703408489151181886568535621008644997971982182426706592551291084007983387911006261442519635405457077292515085160744169867410973960652081452455371451222265819051559818441257438021073941183</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100000</span><span class="p">):</span> <span class="c1"># 此时的i即为e</span>
    <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="c1"># 判断i是否为素数</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="c1"># 此时 type(flag) = &lt;class 'bytes'&gt;,所以下面要转字符串，一开始没转字符串报错，所以才会想到这里</span>
            <span class="k">if</span> <span class="s1">'CTF'</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">'flag'</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">continue</span>
            <span class="c1">#flag{wm-l1l1ll1l1l1l111ll}，e = 65537</span>
</pre></div>
<h4 data-content="1" id="362bd38a6b0519b52014c3bf17ad709a">收获与体会:</h4>
<ul>
<li>真是巧了，e = 65537</li>
<li>所以如果以后要求e来求flag的，我们可以先大胆令e = 65537来试一下，没准就瞎猫碰上死耗子，答案就出来了，省时还省力（但遇上这种题的可能性确实挺小的）</li>
</ul>
<h2 data-content="1" id="a141ba35443e29efafcb7e2a7f15438b">知识总结：</h2>
<h3 data-content="1" id="a8ddb28c4cd0f5c67f2541ed50043d89">1.</h3>
<p>当出现多个c（并没有多个n）则想到拼接法。若每个c相对偏小，那么就意味着求出的m相对偏小，若m &lt;= 26 则想到对应26个字母表，若m &gt; 26，则直接 flag += chr(m)</p>
<h3 data-content="1" id="e099ac5d77c0d22a78375a2c29922a9e">2.</h3>
<blockquote>
<p>sympy.prevprime(x)是求小于x最近的质数<br/>
 sympy.nextprime(x)是求大于x最近的质数</p>
</blockquote>
<h3 data-content="1" id="825fb0b509018b3e087ab09bc70b278f">3.</h3>
<p>encode(),decode()相关小知识</p>
<p>encode() 方法以指定的编码格式编码字符串，默认编码为 ‘utf-8’。</p>
<p>对应的解码方法：bytes <a href="https://so.csdn.net/so/search?q=decode&amp;spm=1001.2101.3001.7020" target="_blank">decode</a>() 方法，bytes:字节。该方法返回编码后的字符串，它是一个 bytes 对象实例</p>
<p>bytes通过decode（）转换为str（字符串）</p>
<p>str通过encode（）转换为bytes（二进制）</p>
<p>在python3中，encode（）和decode（）默认使用UTF-8</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">'你好'</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
<span class="c1"># b'\xe4\xbd\xa0\xe5\xa5\xbd' (转为二进制形式)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\xe4\xbd\xa0\xe5\xa5\xbd</span><span class="s1">'</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="c1"># 你好 (转为字符串形式)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">'passport'</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
<span class="c1"># b'passport'</span>

<span class="k">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">'passport'</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="c1"># passport</span>
</pre></div>
<h3 data-content="1" id="d88cd61f6c5a4a3e1fa26bd1e68dff1c">4.</h3>
<p>b2a_hex(data)，a2b_hex(hexstr)，hexlify(data)，unhexlify(hexstr) 相关知识</p>
<ul>
<li>
<p>b2a_hex(data) = hexlify(data)：<br/>
返回二进制数据的十六进制表示。每个字节被转换成相应的2位十六进制表示形式。因此，得到的字符串是是原数据长度的两倍。</p>
</li>
<li>
<p>a2b_hex(hexstr) = unhexlify(hexstr)：<br/>
从十六进制字符串hexstr返回二进制数据。是b2a_hex的逆向操作。 hexstr必须包含偶数个十六进制数字（可以是大写或小写），否则报TypeError。</p>
</li>
<li>例如：</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="s1">'woker'</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="c1"># 0x4244 2进制数据转16进制  </span>
<span class="n">c</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">a2b_hex</span><span class="p">(</span><span class="s1">'0x4244'</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="c1"># woker 16进制转二进制数据</span>
</pre></div>
<h3 data-content="1" id="a911471ffec3dec329c8136b04cd05d0">5.</h3>
<p>当出现多个c（并没有多个n）则想到拼接法。若每个c相对偏小，那么就意味着求出的m相对偏小，则直接 flag += chr(m)</p>
<h3 data-content="1" id="8e16c930fc9d1a442390dd2b976d4e7f">6.</h3>
<p>出现多个n与c，若e很小（小于100），则考虑低加密指数攻击，若e相对较小（小于100000）则可想到n之间不互素的情况</p>
</div>
</div>