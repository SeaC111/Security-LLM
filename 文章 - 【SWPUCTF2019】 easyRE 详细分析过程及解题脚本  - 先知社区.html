<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<p>main函数：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">_DWORD</span> <span class="n">v4</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span> <span class="c1">// [esp-6Ch] [ebp-F8h] BYREF</span>
  <span class="n">_DWORD</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-88h]</span>
  <span class="n">_DWORD</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-84h]</span>
  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-80h]</span>
  <span class="kt">char</span> <span class="n">v8</span><span class="p">[</span><span class="mi">108</span><span class="p">];</span> <span class="c1">// [esp+10h] [ebp-7Ch] BYREF</span>
  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp+88h] [ebp-4h]</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">sub_40EF90</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">sub_4026C0</span><span class="p">(</span><span class="mh">0x6Cu</span><span class="p">);</span>
  <span class="n">sub_401FE0</span><span class="p">(</span><span class="n">v4</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">v5</span><span class="p">);</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
  <span class="n">sub_40F360</span><span class="p">(</span><span class="n">v8</span><span class="p">);</span>
  <span class="n">sub_40F080</span><span class="p">(</span><span class="n">v4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v4</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
  <span class="n">sub_40F360</span><span class="p">(</span><span class="n">v8</span><span class="p">);</span>
  <span class="n">sub_40F150</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">argv</span><span class="p">);</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">sub_4021C0</span><span class="p">(</span><span class="n">v8</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">v7</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>首先调用<code>sub_40EF90</code>进行check：</p>
<div class="highlight"><pre><span></span><span class="n">BOOL</span> <span class="nf">sub_40EF90</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">HANDLE</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="n">NTSTATUS</span> <span class="p">(</span><span class="kr">__stdcall</span> <span class="o">*</span><span class="n">NtQueryInformationProcess</span><span class="p">)(</span><span class="n">HANDLE</span><span class="p">,</span> <span class="n">PROCESSINFOCLASS</span><span class="p">,</span> <span class="n">PVOID</span><span class="p">,</span> <span class="n">ULONG</span><span class="p">,</span> <span class="n">PULONG</span><span class="p">);</span> <span class="c1">// [esp+0h] [ebp-14h]</span>
  <span class="n">HMODULE</span> <span class="n">hModule</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-10h]</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-8h] BYREF</span>

  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">hModule</span> <span class="o">=</span> <span class="n">LoadLibraryA</span><span class="p">(</span><span class="s">"Ntdll.dll"</span><span class="p">);</span>
  <span class="n">NtQueryInformationProcess</span> <span class="o">=</span> <span class="p">(</span><span class="n">NTSTATUS</span> <span class="p">(</span><span class="kr">__stdcall</span> <span class="o">*</span><span class="p">)(</span><span class="n">HANDLE</span><span class="p">,</span> <span class="n">PROCESSINFOCLASS</span><span class="p">,</span> <span class="n">PVOID</span><span class="p">,</span> <span class="n">ULONG</span><span class="p">,</span> <span class="n">PULONG</span><span class="p">))</span><span class="n">GetProcAddress</span><span class="p">(</span><span class="n">hModule</span><span class="p">,</span> <span class="s">"NtQueryInformationProcess"</span><span class="p">);</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="n">GetCurrentProcess</span><span class="p">();</span>
  <span class="n">NtQueryInformationProcess</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">ProcessDebugPort</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>搜了一下官方文档，发现ProcessDebugPort就是用来检测程序是否处于调试状态的:<br/>
<img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145538-7d7ab232-6df4-1.png"/><br/>
这里crack很简单，动态调试单步来到这个位置，这里是压入三个参数的，一般就是main函数的入口了：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145551-84f08d84-6df4-1.png"/></p>
<p>call完EF90之后会有个关键跳，这里jmp实现的话就直接退出程序了，直接nop掉jmp即可：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145608-8f94671a-6df4-1.png"/></p>
<p>Patch完之后重新载入x64dbg，此时就可以正常调试了：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145615-9375fa06-6df4-1.png"/></p>
<p>当然了这个调试状态检测我们是可以绕过的，因为是在检测调试之后再执行真正的代码，所以可以先直接运行程序，然后用附加程序，这时候程序已经运行到输入flag的位置了，附加时已经过了检测函数，所以也可以正常进行调试：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145622-97ece2fc-6df4-1.png"/></p>
<p>往下来到sub_401FE0，发现有个<code>EASYRE::vftable</code>虚函数表，然后往下对内存进行赋值，总共20个字节，往下还有个内存复制，也是20个字节：</p>
<div class="highlight"><pre><span></span><span class="n">_DWORD</span> <span class="o">*</span><span class="n">__thiscall</span> <span class="nf">sub_401FE0</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="n">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-14h]</span>

  <span class="o">*</span><span class="n">this</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">EASYRE</span><span class="o">::</span><span class="err">`</span><span class="n">vftable</span><span class="err">'</span><span class="p">;</span>
  <span class="n">this</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">52</span><span class="p">)</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">53</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">54</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x58</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xDE</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">56</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x94</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">57</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xD0</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">58</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x3B</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">59</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xBE</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">60</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x88</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">61</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xD4</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">62</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">63</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xB6</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">65</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">66</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xB7</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">67</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xAF</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">68</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">69</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x54</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">70</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x7F</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">71</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xCF</span><span class="p">;</span>
  <span class="n">qmemcpy</span><span class="p">(</span><span class="n">this</span> <span class="o">+</span> <span class="mi">18</span><span class="p">,</span> <span class="s">"  03</span><span class="se">\"</span><span class="s">3   0 203</span><span class="se">\"</span><span class="s">   $ "</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
  <span class="n">sub_4030A0</span><span class="p">(</span><span class="n">this</span> <span class="o">+</span> <span class="mi">23</span><span class="p">);</span>
  <span class="n">sub_402DE0</span><span class="p">(</span><span class="n">this</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105145650-a82636f0-6df4-1.png"/></p>
<p>字符串定位到<code>sub_40F150</code>，传入的<code>flag</code>通过<code>sub_4024B0</code>进行校验，条件成立才能输出Congratulations:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">sub_40F150</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> <span class="c1">// [esp+Ch] [ebp-38h] BYREF</span>
  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [esp+40h] [ebp-4h]</span>
  <span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span> <span class="c1">// [esp+54h] [ebp+10h] BYREF</span>

  <span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v6</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">sub_40F5B0</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">"Please input your flag : "</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">sub_40F8F0</span><span class="p">);</span>
  <span class="n">sub_40F930</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">sub_4024B0</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">sub_40F5B0</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_4122F0</span><span class="p">);</span>    <span class="c1">// Congratulations</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">sub_40F8F0</span><span class="p">);</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">sub_4021C0</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="n">sub_40F5B0</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_41231C</span><span class="p">);</span>   <span class="c1">// I'm sorry</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">sub_40F8F0</span><span class="p">);</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">sub_4021C0</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><code>sub_4024B0</code>，虚函数调用的特征：</p>
<div class="highlight"><pre><span></span><span class="n">BOOL</span> <span class="n">__thiscall</span> <span class="nf">sub_4024B0</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax</span>

  <span class="k">this</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="n">__thiscall</span> <span class="o">**</span><span class="p">)(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">))(</span><span class="o">*</span><span class="k">this</span> <span class="o">+</span> <span class="mh">0xC</span><span class="p">))(</span><span class="k">this</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="n">__thiscall</span> <span class="o">**</span><span class="p">)(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">))(</span><span class="o">*</span><span class="k">this</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">))(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="n">__thiscall</span> <span class="o">**</span><span class="p">)(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">))(</span><span class="o">*</span><span class="k">this</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))(</span><span class="k">this</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>根据虚表简化得到：</p>
<div class="highlight"><pre><span></span><span class="n">BOOL</span> <span class="n">__thiscall</span> <span class="nf">sub_4024B0</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax</span>

  <span class="k">this</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">sub_402500</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">sub_4026E0</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">sub_402A00</span><span class="p">()</span> <span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h3 data-content="1" id="6f6b3cba4f7eaefcbc63227b56c333bc">sub_402500</h3>
<p>将字符串<code>Ncg</code>复制到<code>v8</code>然后将<code>v8</code>的值逐个异或<code>0x10</code>:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">__thiscall</span> <span class="nf">sub_402500</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="k">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-B0h]</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+14h] [ebp-A8h]</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+24h] [ebp-98h]</span>
  <span class="kt">char</span> <span class="n">v6</span><span class="p">[</span><span class="mi">56</span><span class="p">];</span> <span class="c1">// [esp+30h] [ebp-8Ch] BYREF</span>
  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span> <span class="c1">// [esp+68h] [ebp-54h] BYREF</span>
  <span class="kt">char</span> <span class="n">v8</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span> <span class="c1">// [esp+7Ch] [ebp-40h] BYREF</span>
  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [esp+B8h] [ebp-4h]</span>

  <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="k">this</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">strlen</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">2</span><span class="p">])];</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="s">"Ncg`esdvLkLgk$mL=Lgk$mL=Lgk$mL=Lgk$mL=Lgk$mLm"</span><span class="p">);</span>
  <span class="n">sub_4026C0</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="mh">0x38u</span><span class="p">);</span>
  <span class="n">sub_402B00</span><span class="p">();</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="n">v8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="mh">0x10u</span><span class="p">;</span>
  <span class="n">sub_4026C0</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="mh">0x14u</span><span class="p">);</span>
  <span class="n">sub_402A70</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">LOBYTE</span><span class="p">(</span><span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">sub_404260</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">LOBYTE</span><span class="p">(</span><span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">sub_402A50</span><span class="p">(</span><span class="n">v7</span><span class="p">);</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">sub_4026A0</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">v2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>得到一个正则表达式：<code>^swpuctf\\{\\w{4}\\-\\w{4}\\-\\w{4}\\-\\w{4}\\-\\w{4}\\}</code>为flag的格式</p>
<div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">"Ncg`esdvLkLgk$mL=Lgk$mL=Lgk$mL=Lgk$mL=Lgk$mLm"</span>
<span class="n">s2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="mh">0x10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s2</span><span class="p">))</span>

<span class="c1"># ^swpuctf\\{\\w{4}\\-\\w{4}\\-\\w{4}\\-\\w{4}\\-\\w{4}\\}</span>
</pre></div>
<p>那么可以得到第一个函数就是校验flag的格式，dbg中输入：<code>swpuctf{1234-5678-9012-3456-7890}</code>，此时跳转已经不实现：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105150021-265c82c2-6df5-1.png"/></p>
<h3 data-content="1" id="d3e36d93f39f53eb15eaf386dc6fb912">sub_402A00</h3>
<p>先看到最后一个函数，需要让if成立，使得result=1，才能最终输出Congratulations</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">sub_402A00</span><span class="p">()</span> <span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">__thiscall</span> <span class="nf">sub_402A00</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="n">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-4h]</span>

  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">this</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">52</span><span class="p">]</span> <span class="o">!=</span> <span class="n">this</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">]</span> <span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><code>this[52]</code>在<code>sub_401FE0</code>中进行了赋值，需要注意i从0开始经过40次循环，回到sub_401FE0的初始化，发现还存在一个字符串：<code>03\"3   0 203\"   $</code>，说明还存在一个需要比较的结果：</p>
<div class="highlight"><pre><span></span><span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">52</span><span class="p">)</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">53</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">54</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x58</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xDE</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">56</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x94</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">57</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xD0</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">58</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x3B</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">59</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xBE</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">60</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x88</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">61</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xD4</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">62</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">63</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xB6</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">64</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">65</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">66</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xB7</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">67</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xAF</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">68</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">69</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x54</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">70</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x7F</span><span class="p">;</span>
<span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mi">71</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0xCF</span><span class="p">;</span>
<span class="n">qmemcpy</span><span class="p">(</span><span class="n">this</span> <span class="o">+</span> <span class="mi">18</span><span class="p">,</span> <span class="s">"  03</span><span class="se">\"</span><span class="s">3   0 203</span><span class="se">\"</span><span class="s">   $ "</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</pre></div>
<h3 data-content="1" id="34a98889120c6cefba98b9d80a868244">sub_4026E0</h3>
<p>来到关键的处理函数：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">__thiscall</span> <span class="nf">sub_4026E0</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">this</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-4h]</span>

  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="n">__thiscall</span> <span class="o">**</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">))(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mh">0x1C</span><span class="p">))(</span><span class="n">this</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">//</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="n">__thiscall</span> <span class="o">**</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">))(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">this</span> <span class="o">+</span> <span class="mh">0x24</span><span class="p">))(</span><span class="n">this</span><span class="p">);</span> <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<p>同样查表：</p>
<div class="highlight"><pre><span></span><span class="n">this</span><span class="o">+</span><span class="mh">0x1c</span> <span class="o">-&gt;</span> <span class="n">sub_402730</span>
<span class="n">this</span><span class="o">+</span><span class="mh">0x24</span> <span class="o">-&gt;</span> <span class="n">sub_4028A0</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220105150828-488a639a-6df6-1.png"/></p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">__thiscall</span> <span class="nf">sub_402730</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="n">this</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// esi</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// ecx</span>
  <span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// al</span>
  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// cf</span>
  <span class="kt">char</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// bl</span>
  <span class="kt">char</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// t2</span>
  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-30h]</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+14h] [ebp-28h]</span>
  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-20h]</span>
  <span class="kt">int</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// [esp+20h] [ebp-1Ch] BYREF</span>
  <span class="kt">int</span> <span class="n">v14</span><span class="p">;</span> <span class="c1">// [esp+24h] [ebp-18h]</span>
  <span class="kt">int</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// [esp+28h] [ebp-14h]</span>
  <span class="kt">int</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// [esp+2Ch] [ebp-10h]</span>
  <span class="kt">int</span> <span class="n">v17</span><span class="p">;</span> <span class="c1">// [esp+30h] [ebp-Ch]</span>
  <span class="kt">int</span> <span class="n">v18</span><span class="p">;</span> <span class="c1">// [esp+34h] [ebp-8h]</span>

  <span class="n">v13</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v14</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v17</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="n">this</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// 根据传入的a2取flag的各个部分</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">v10</span><span class="p">);</span> <span class="c1">// 复制内存</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">do</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">v2</span><span class="p">);</span> 
    <span class="n">_DL</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
    <span class="kr">__asm</span> <span class="p">{</span> <span class="n">rcl</span>     <span class="n">dl</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">v2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">v8</span> <span class="o">=</span> <span class="n">v6</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 影响循环次数</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">v8</span><span class="p">;</span>
      <span class="o">++</span><span class="n">v7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">v6</span> <span class="p">);</span> 
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">v2</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="n">v7</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="o">--</span><span class="n">v3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v14</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v17</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">j</span><span class="p">)))</span> <span class="o">|</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sub_402F80</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v13</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p><code>v10 = this[2] + 5 * a2 + 8;</code>，<code>a2</code>作为下标，通过<code>-</code>分割开取值，此时外层循环中i为<code>0</code>，所以传入的<code>a2</code>也是<code>0</code>，在x64dbg中存储为<code>ecx</code>，所以此时<code>v10</code>指向的就是<code>flag</code>的第一部分<code>1234</code>：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165018-accf861e-6ecd-1.png"/></p>
<p><code>do-while</code>循环中是针对单字符进行处理的，<code>v2</code>作为索引，每次取一个字符放到<code>v4</code>中，<code>v3</code>作为循环次数，每循环一次减一：</p>
<p>这里只写了<code>rcl dl,1</code></p>
<div class="highlight"><pre><span></span><span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">v3</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">do</span>
<span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">v2</span><span class="p">);</span> <span class="c1">// 取单个字符</span>
    <span class="n">_DL</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
    <span class="kr">__asm</span> <span class="p">{</span> <span class="n">rcl</span>     <span class="n">dl</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="c1">// 循环左移</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">v2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">v8</span> <span class="o">=</span> <span class="n">v6</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
        <span class="n">v6</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 影响循环次数</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">v8</span><span class="p">;</span>
        <span class="o">++</span><span class="n">v7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">v6</span> <span class="p">);</span> 
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">v2</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="n">v7</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="o">--</span><span class="n">v3</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">);</span>
</pre></div>
<p>x64dbg调试发现<code>rcl</code>下面存在一个<code>jb</code>指令，这个指令受<code>CF</code>位的影响，当<code>CF</code>为1时跳转指令成立，这里跟<code>dl</code>的值有关，当<code>dl</code>产生进位时<code>CF</code>置<code>1</code>，跳转成立，出循环：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165132-d880daba-6ecd-1.png"/></p>
<p>经测试可以发现当<code>0x31</code>左移<code>3</code>次时产生进位，所以此时<code>ebx</code>值为3，那么<code>ebx</code>中记录的就是左移的位数：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165155-e6baafe8-6ecd-1.png"/></p>
<p>同理，往下对<code>0x31</code>进行右移，当产生进位时<code>CF</code>置<code>1</code>，跳出循环，<code>ebx</code>记录右移次数减一的值：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165216-f304d8b4-6ecd-1.png"/></p>
<p>这一部分在IDA反编译的不太一样，按照动态调试中体现的汇编更容易理解：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165227-f99ab8e2-6ecd-1.png"/></p>
<p>4次循环之后得到，分别对应<code>0x31 0x32 0x33 0x34</code>，左边的为左移到进位的次数；右边为右移次数减一，这么理解比较奇怪，我觉得可以理解为从右边0的个数：</p>
<p>如：<code>0x31</code>，二进制为 <code>0011 0001</code>，所以此时右边0的个数为0</p>
<p>​       <code>0x32</code>，二进制为 <code>0011 0010</code>，所以此时右边0的个数为1</p>
<p>​       <code>0x34</code>，二进制为 <code>0011 0100</code>，所以此时右边0的个数为2</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164955-9f13ca1c-6ecd-1.png"/></p>
<p>第二个循环：</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v14</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v17</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v16</span> <span class="o">+</span> <span class="n">j</span><span class="p">)))</span> <span class="o">|</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v13</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v15</span> <span class="o">+</span> <span class="n">j</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
<p>根据第一个循环简化，最终生成三个值，处理每个字符的结果是独立进行计算的，跟位置和前后字符无关，互不影响：</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">res1</span> <span class="o">=</span> <span class="err">右边</span><span class="mi">0</span><span class="err">的个数</span> <span class="o">+</span> <span class="err">左移进位次数</span><span class="p">;</span> 
    <span class="n">res2</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">&lt;&lt;</span> <span class="err">左移进位次数</span><span class="p">;</span>
    <span class="n">res3</span> <span class="o">=</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">0</span><span class="err">的个数</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">flag</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="err">左移次数</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="err">左移次数</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>这里IDA反编译的res2应该是少了一个移位运算，第一步移位之后，将低8位存入内存中，然后再取res1，作为右移的位数：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165738-b2ffebd6-6ece-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165909-e908101e-6ece-1.png"/></p>
<p>右移之后的结果才是res2：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106165947-ffebd108-6ece-1.png"/></p>
<p>所以这里应该是：</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">res1</span> <span class="o">=</span> <span class="err">右边</span><span class="mi">0</span><span class="err">的个数</span> <span class="o">+</span> <span class="err">左移进位次数</span><span class="p">;</span> 
    <span class="n">res2</span> <span class="o">=</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;&lt;</span> <span class="err">左移进位次数</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="o">&gt;&gt;</span> <span class="n">res1</span><span class="p">;</span>
    <span class="n">res3</span> <span class="o">=</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">0</span><span class="err">的个数</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">flag</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="err">左移次数</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="err">左移次数</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>运行之后得到:</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164939-951ca01a-6ecd-1.png"/></p>
<p>往下走到最后一个处理的函数<code>sub_4028A0</code>，存在while循环，这里while循环的条件为<code>sub_402E00</code>传入v2之后的结果，大致理解为flag的结束，说明while循环针对flag进行遍历的，每个while循环对单个字符进行处理，跟之前的处理一样，不受位置和前后字符值的影响：</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">sub_402E00</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">_BYTE</span><span class="p">)</span><span class="n">result</span> <span class="p">)</span>
    <span class="k">break</span><span class="p">;</span>
</pre></div>
<p>在<code>while</code>中存在一个<code>for</code>循环，该循环分为上下两部分，前四次循环会对<code>v15</code>和<code>v15+i+20</code>进行运算处理，后四次循环只对<code>v15</code>进行处理,这里<code>sub_402DC0</code>指向处理后的字符以及<code>sub_402730</code>处理后的结果：</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">v9</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="n">v14</span> <span class="o">-=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">v10</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="o">*</span><span class="n">v15</span> <span class="o">|=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="n">v13</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v4</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
        <span class="n">v14</span> <span class="o">-=</span> <span class="n">v13</span><span class="p">;</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="o">*</span><span class="n">v15</span> <span class="o">|=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v5</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span><span class="p">;</span>
        <span class="n">v6</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="n">v7</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v6</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">v8</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
        <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v15</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v8</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="n">v7</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>执行<code>sub_402DC0</code>后返回<code>0xDC41D8</code>:</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164910-8426d032-6ecd-1.png"/></p>
<p>根据0xDC41D8指向的内存，可以简化该循环：</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">{</span>
    <span class="n">v9</span> <span class="o">=</span> <span class="n">sub_402DC0</span><span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="mi">26</span><span class="p">);</span>
    <span class="n">v14</span> <span class="o">-=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span> <span class="c1">// v14的初始值为0x20</span>
    <span class="o">*</span><span class="n">v15</span> <span class="o">|=</span> <span class="n">res3</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span><span class="p">;</span> 
<span class="p">}</span>    
<span class="k">else</span> <span class="p">{</span>
    <span class="n">v14</span> <span class="o">-=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">res1</span><span class="p">;</span>
    <span class="o">*</span><span class="n">v15</span> <span class="o">|=</span> <span class="n">res3</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span><span class="p">;</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v15</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="err">的个数</span> <span class="o">|</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="err">左移进位位数</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>可以发现<code>v15 + i + 20</code>是直接赋值，而这里i注意是跟循环有关，那么每个<code>for</code>循环会生成<code>4</code>个值，而<code>v15</code>注意到是<code>DWORD</code>指针，每个for循环也是生成一个<code>DWORD</code>类型的数据，可以判断出<code>while</code>循环应该是进行<code>5</code>次，每次对一部分flag进行处理，最终会得到一个长度为<code>40</code>的结果，调用<code>sub_402A00</code>进行比较</p>
<p>第一个循环解决之后得到两个值，顺带发现了最终对比的数据就是前面初始化值的数据</p>
<p>第一个循环exam：</p>
<div class="highlight"><pre><span></span><span class="mh">0x11</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mh">0x20</span> <span class="o">-</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">res1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x88000000</span> <span class="c1">// 小端存储</span>
<span class="mi">0</span> <span class="o">|</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x30</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164826-69c05416-6ecd-1.png"/></p>
<p>第二次循环结束，发现第一部分是会受其他循环影响的，而第二部分是不受其他循环影响的，因为第一部分的值是通过或运算得到的，而第二部分的值是各个字符单独运算</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164808-5efa6a44-6ecd-1.png"/></p>
<p>当<code>i&gt;=4</code>时，是直接取<code>res1</code>：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164757-587935b0-6ecd-1.png"/></p>
<p>和<code>res3</code>进行运算：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164745-51689d9c-6ecd-1.png"/></p>
<div class="highlight"><pre><span></span><span class="o">*</span><span class="n">v15</span> <span class="o">|=</span> <span class="n">res3</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">v14</span> <span class="o">-</span> <span class="n">res1</span><span class="p">)</span>
</pre></div>
<p>最终的比较：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164731-490f93ee-6ecd-1.png"/></p>
<p>分析到这里，整个程序流程基本上就都了解了：</p>
<ol>
<li>校验<code>flag</code>格式</li>
<li>通过<code>-</code>分割<code>flag</code>成<code>5</code>部分，对<code>flag</code>进行位移运算，对flag的每个字符都得到<code>5</code>个结果，将其存储到内存中</li>
<li>进行5次循环，每次循环处理4个字符，利用每个字符得到的5个结果继续进行移位和或运算，最终会生成两个结果，一个结果受字符影响，而另外一个结果是每个字符独立存在，不受其他字符的影响</li>
<li>将得到的结果与<code>sub_401FE0</code>中初始化中的两个字符串进行对比</li>
</ol>
<h3 data-content="1" id="e91bcb3018798d80f242bebba0c920d8">exp</h3>
<p>第一部分check_1左移进位位数，check_0计算右边0的个数，然后generate计算sub_402730后面的结果，并将三个结果作为list返回：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num</span>

<span class="k">def</span> <span class="nf">check_0</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="c1"># 右边0的个数</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">generate_0</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">res1</span> <span class="o">=</span> <span class="n">check_0</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">res2</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">res1</span>
    <span class="n">res3</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">check_0</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">res1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">res1</span><span class="p">,</span> <span class="n">res2</span><span class="p">,</span> <span class="n">res3</span><span class="p">]</span>
</pre></div>
<p>第二部分就是通过<code>03\"3   0 203\"   $</code>进行字符串排除，这里可以判断flag的范围应该是<code>A-Za-z0-9</code>，通过前面的分析知道每个字符运算的结果互相独立，但是这里可能存在重复的情况，所以先用<code>set</code>去重，然后对<code>set</code>中每个元素作为<code>key</code>，创建一个字典，如果<code>check</code>的结果为<code>key</code>则加入该<code>key</code>的<code>value</code>中，最后返回结果：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_part</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="s1">'  03</span><span class="se">\"</span><span class="s1">3   0 203</span><span class="se">\"</span><span class="s1">   $ '</span><span class="p">))</span>
    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">check_0</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">check_1</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tmp2</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span>

    <span class="k">return</span> <span class="s1">''</span>

<span class="k">def</span> <span class="nf">classify</span><span class="p">():</span>
    <span class="n">for_each</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
    <span class="n">second_part_res</span> <span class="o">=</span> <span class="s1">'  03</span><span class="se">\"</span><span class="s1">3   0 203</span><span class="se">\"</span><span class="s1">   $ '</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">second_part_res</span><span class="p">)))</span>
    <span class="c1"># print(d)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">second_part_res</span><span class="p">)):</span>
        <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">for_each</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">check_part</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">tmp</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span>
</pre></div>
<p>第三部分，<code>test_1</code>作为for循环中前四部分的计算，这里需要注意<code>v14</code>要代入并返回，经过<code>8</code>次运算后，将结果或运算成一个<code>DWORD</code>值，与<code>first_part</code>对应的<code>DWORD</code>进行对比，如果相等则返回此时循环的<code>4</code>个字符，这里是可以得到唯一值的，最终拼接得到flag：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v14</span><span class="p">):</span>
    <span class="n">exam</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">generate_0</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))}</span>
    <span class="n">v14</span> <span class="o">=</span> <span class="n">v14</span> <span class="o">-</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">exam</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">exam</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">v14</span>


<span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v14</span><span class="p">):</span>
    <span class="n">exam</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">generate_0</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))}</span>
    <span class="n">v14</span> <span class="o">=</span> <span class="n">v14</span> <span class="o">-</span> <span class="n">exam</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">exam</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">v14</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">v14</span>


<span class="k">def</span> <span class="nf">check_first_part</span><span class="p">(</span><span class="n">second_part</span><span class="p">,</span> <span class="n">first_part</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">second_part</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">second_part</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">second_part</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">second_part</span><span class="p">[</span><span class="mi">3</span><span class="p">]]:</span>
                    <span class="n">v14</span> <span class="o">=</span> <span class="mh">0x20</span>
                    <span class="n">tmp</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp2</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_1</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp3</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp4</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_1</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp5</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp6</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_2</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp7</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_2</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp8</span><span class="p">,</span> <span class="n">v14</span> <span class="o">=</span> <span class="n">test_2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">|</span> <span class="n">tmp2</span> <span class="o">|</span> <span class="n">tmp3</span> <span class="o">|</span> <span class="n">tmp4</span> <span class="o">|</span> <span class="n">tmp5</span> <span class="o">|</span> <span class="n">tmp6</span> <span class="o">|</span> <span class="n">tmp7</span> <span class="o">|</span> <span class="n">tmp8</span>
                    <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="n">first_part</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="n">m</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">classify</span><span class="p">()</span>
<span class="n">s2</span> <span class="o">=</span> <span class="s1">'  03</span><span class="se">\"</span><span class="s1">3   0 203</span><span class="se">\"</span><span class="s1">   $ '</span>
<span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'08'</span><span class="p">,</span> <span class="s1">'EA'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">,</span> <span class="s1">'DE'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'D0'</span><span class="p">,</span> <span class="s1">'3B'</span><span class="p">,</span> <span class="s1">'BE'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">,</span> <span class="s1">'D4'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'B6'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'82'</span><span class="p">,</span> <span class="s1">'B7'</span><span class="p">,</span> <span class="s1">'AF'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'7F'</span><span class="p">,</span> <span class="s1">'CF'</span><span class="p">]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s1">'swpuctf{'</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">first_part</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">second_part</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">check_first_part</span><span class="p">(</span><span class="n">second_part</span><span class="p">,</span> <span class="n">first_part</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">+=</span> <span class="n">res</span>
        <span class="k">break</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="n">res</span> <span class="o">+</span> <span class="s1">'-'</span>
<span class="n">flag</span> <span class="o">+=</span> <span class="s1">'}'</span>
</pre></div>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164641-2b5897b0-6ecd-1.png"/></p>
<p>flag：</p>
<pre><code>swpuctf{we18-l8co-m1e4-58to-swpu}</code></pre>
<p>提交BUUCTF验证：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20220106164628-239fbf30-6ecd-1.png"/></p>
</div>
</div>